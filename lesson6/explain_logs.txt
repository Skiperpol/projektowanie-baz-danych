========================================================================================================================
START EXPLAIN RUN — 2025-11-22 17:00:05.949264
========================================================================================================================


==================================================
EXPLAIN ANALYZE — Query 1: Średnia Wartość Zamówienia (AOV) w Ostatnim Miesiącu
==================================================
Aggregate  (cost=4940.05..4940.06 rows=1 width=32) (actual time=168.783..168.786 rows=1 loops=1)
  ->  HashAggregate  (cost=4909.62..4924.83 rows=1217 width=36) (actual time=168.247..168.676 rows=1215 loops=1)
        Group Key: o.id
        Batches: 1  Memory Usage: 577kB
        ->  Hash Join  (cost=4523.04..4903.54 rows=1217 width=10) (actual time=111.630..165.681 rows=1243 loops=1)
              Hash Cond: (oi.order_id = o.id)
              ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.016..27.913 rows=20000 loops=1)
              ->  Hash  (cost=4218.86..4218.86 rows=24334 width=4) (actual time=111.113..111.115 rows=24630 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1122kB
                    ->  Bitmap Heap Scan on "Order" o  (cost=457.02..4218.86 rows=24334 width=4) (actual time=37.787..105.859 rows=24630 loops=1)
                          Recheck Cond: (order_date >= (now() - '1 mon'::interval))
                          Heap Blocks: exact=3333
                          ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..450.93 rows=24334 width=0) (actual time=37.400..37.400 rows=24630 loops=1)
                                Index Cond: (order_date >= (now() - '1 mon'::interval))
Planning Time: 55.912 ms
Execution Time: 170.710 ms


==================================================
EXPLAIN ANALYZE — Query 2: Średnia wartość zamówienia per użytkownik
==================================================
Sort  (cost=16066.87..16115.61 rows=19495 width=50) (actual time=5561.239..5681.472 rows=19296 loops=1)
  Sort Key: (round(avg(order_totals.total_price), 2)) DESC
  Sort Method: quicksort  Memory: 1612kB
  ->  Finalize HashAggregate  (cost=14385.35..14677.77 rows=19495 width=50) (actual time=5511.782..5654.172 rows=19296 loops=1)
        Group Key: u.id
        Batches: 5  Memory Usage: 8241kB  Disk Usage: 224kB
        ->  Gather  (cost=12537.36..14263.50 rows=16246 width=50) (actual time=5264.828..5477.157 rows=19419 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial HashAggregate  (cost=11537.36..11638.90 rows=8123 width=50) (actual time=4851.104..4865.968 rows=6473 loops=3)
                    Group Key: u.id
                    Batches: 1  Memory Usage: 2961kB
                    Worker 0:  Batches: 1  Memory Usage: 2961kB
                    Worker 1:  Batches: 1  Memory Usage: 2961kB
                    ->  Nested Loop  (cost=1110.75..11496.75 rows=8123 width=50) (actual time=193.574..4812.771 rows=6498 loops=3)
                          ->  Hash Join  (cost=1110.33..6550.49 rows=8123 width=36) (actual time=149.010..256.654 rows=6498 loops=3)
                                Hash Cond: (o.id = order_totals.order_id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.198..39.467 rows=133333 loops=3)
                                ->  Hash  (cost=866.64..866.64 rows=19495 width=36) (actual time=140.807..142.283 rows=19495 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1094kB
                                      ->  Subquery Scan on order_totals  (cost=428.00..866.64 rows=19495 width=36) (actual time=64.940..106.798 rows=19495 loops=3)
                                            ->  HashAggregate  (cost=428.00..671.69 rows=19495 width=36) (actual time=64.938..100.292 rows=19495 loops=3)
                                                  Group Key: oi.order_id
                                                  Batches: 1  Memory Usage: 7953kB
                                                  Worker 0:  Batches: 1  Memory Usage: 7953kB
                                                  Worker 1:  Batches: 1  Memory Usage: 7953kB
                                                  ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=5.073..13.440 rows=20000 loops=3)
                          ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.697..0.697 rows=1 loops=19495)
                                Index Cond: (id = o.user_id)
Planning Time: 36.936 ms
Execution Time: 5719.548 ms


==================================================
EXPLAIN ANALYZE — Query 3: Top 10 Najlepiej Sprzedających Się Produktów (wg. Ilości Sprzedanych Jednostek) w Ostatnim Kwartale
==================================================
Limit  (cost=11754.11..11754.13 rows=10 width=46) (actual time=1967.675..2116.193 rows=10 loops=1)
  ->  Sort  (cost=11754.11..11765.56 rows=4580 width=46) (actual time=1967.670..2114.949 rows=10 loops=1)
        Sort Key: (count(*)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=11609.34..11655.14 rows=4580 width=46) (actual time=1963.840..2112.070 rows=3927 loops=1)
              Group Key: p.name, m.name
              Batches: 1  Memory Usage: 721kB
              ->  Gather  (cost=11180.04..11580.72 rows=3816 width=46) (actual time=1893.635..2106.615 rows=4345 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=10180.04..10199.12 rows=1908 width=46) (actual time=1663.781..1665.365 rows=1448 loops=3)
                          Group Key: p.name, m.name
                          Batches: 1  Memory Usage: 369kB
                          Worker 0:  Batches: 1  Memory Usage: 369kB
                          Worker 1:  Batches: 1  Memory Usage: 369kB
                          ->  Hash Join  (cost=2302.67..10165.73 rows=1908 width=38) (actual time=61.748..1655.268 rows=1521 loops=3)
                                Hash Cond: (p.manufacturer_id = m.id)
                                ->  Nested Loop  (cost=2297.30..10155.20 rows=1908 width=17) (actual time=57.318..1649.101 rows=1521 loops=3)
                                      ->  Nested Loop  (cost=2297.01..9525.36 rows=1908 width=4) (actual time=54.921..1542.169 rows=1521 loops=3)
                                            ->  Nested Loop  (cost=2296.72..8926.00 rows=1908 width=4) (actual time=51.324..1389.922 rows=1521 loops=3)
                                                  ->  Hash Join  (cost=2296.30..6557.80 rows=1908 width=4) (actual time=37.649..130.270 rows=1521 loops=3)
                                                        Hash Cond: (o.id = oi.order_id)
                                                        ->  Parallel Bitmap Heap Scan on "Order" o  (cost=1718.30..5722.18 rows=38165 width=4) (actual time=25.556..106.986 rows=30431 loops=3)
                                                              Recheck Cond: (order_date >= (now() - '3 mons'::interval))
                                                              Heap Blocks: exact=1218
                                                              ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..1695.40 rows=91596 width=0) (actual time=62.528..62.529 rows=91293 loops=1)
                                                                    Index Cond: (order_date >= (now() - '3 mons'::interval))
                                                        ->  Hash  (cost=328.00..328.00 rows=20000 width=8) (actual time=7.255..7.256 rows=20000 loops=3)
                                                              Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                                                              ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=8) (actual time=0.033..3.224 rows=20000 loops=3)
                                                  ->  Index Scan using "StockItem_pkey" on "StockItem" si  (cost=0.42..1.24 rows=1 width=8) (actual time=0.827..0.827 rows=1 loops=4563)
                                                        Index Cond: (id = oi.stock_item_id)
                                            ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.31 rows=1 width=8) (actual time=0.098..0.098 rows=1 loops=4563)
                                                  Index Cond: (id = si.variant_id)
                                      ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=21) (actual time=0.069..0.069 rows=1 loops=4563)
                                            Index Cond: (id = v.product_id)
                                ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=4.171..4.172 rows=150 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 18kB
                                      ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=3.409..3.428 rows=150 loops=3)
Planning Time: 85.762 ms
Execution Time: 2127.807 ms


==================================================
EXPLAIN ANALYZE — Query 4: Top 5 produktów z najwięcej recenzjami
==================================================
Limit  (cost=1792.59..1792.61 rows=5 width=25) (actual time=220.129..220.133 rows=5 loops=1)
  ->  Sort  (cost=1792.59..1842.59 rows=20000 width=25) (actual time=220.128..220.131 rows=5 loops=1)
        Sort Key: (COALESCE(r.count, '0'::bigint)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Hash Left Join  (cost=969.89..1460.40 rows=20000 width=25) (actual time=209.652..216.862 rows=20000 loops=1)
              Hash Cond: (p.id = r.product_id)
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.012..1.556 rows=20000 loops=1)
              ->  Hash  (cost=812.24..812.24 rows=12612 width=12) (actual time=209.628..209.630 rows=12612 loops=1)
                    Buckets: 16384  Batches: 1  Memory Usage: 670kB
                    ->  Subquery Scan on r  (cost=560.00..812.24 rows=12612 width=12) (actual time=201.941..205.737 rows=12612 loops=1)
                          ->  HashAggregate  (cost=560.00..686.12 rows=12612 width=12) (actual time=201.941..204.542 rows=12612 loops=1)
                                Group Key: "Review".product_id
                                Batches: 1  Memory Usage: 1425kB
                                ->  Seq Scan on "Review"  (cost=0.00..460.00 rows=20000 width=4) (actual time=1.816..194.505 rows=20000 loops=1)
Planning Time: 19.445 ms
Execution Time: 220.214 ms


==================================================
EXPLAIN ANALYZE — Query 5: Całkowity Przychód Pogrupowany Miesięcznie za Ostatni Rok
==================================================
Finalize GroupAggregate  (cost=9719.19..11975.47 rows=17309 width=36) (actual time=173.835..268.582 rows=11 loops=1)
  Group Key: ((date_trunc('month'::text, o.order_date))::date)
  ->  Gather Merge  (cost=9719.19..11564.38 rows=14424 width=36) (actual time=172.769..266.866 rows=33 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=8719.17..8899.47 rows=7212 width=36) (actual time=84.805..86.163 rows=11 loops=3)
              Group Key: ((date_trunc('month'::text, o.order_date))::date)
              ->  Sort  (cost=8719.17..8737.20 rows=7212 width=10) (actual time=83.148..83.690 rows=5760 loops=3)
                    Sort Key: ((date_trunc('month'::text, o.order_date))::date) DESC
                    Sort Method: quicksort  Memory: 851kB
                    Worker 0:  Sort Method: quicksort  Memory: 50kB
                    Worker 1:  Sort Method: quicksort  Memory: 96kB
                    ->  Hash Join  (cost=578.00..8257.02 rows=7212 width=10) (actual time=11.948..81.334 rows=5760 loops=3)
                          Hash Cond: (o.id = oi.order_id)
                          ->  Parallel Seq Scan on "Order" o  (cost=0.00..6669.33 rows=144241 width=12) (actual time=0.014..47.383 rows=115772 loops=3)
                                Filter: (order_date >= (date_trunc('year'::text, now()) - '00:00:00'::interval))
                                Rows Removed by Filter: 17562
                          ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=11.066..11.067 rows=20000 loops=3)
                                Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.024..4.921 rows=20000 loops=3)
Planning Time: 6.131 ms
Execution Time: 279.011 ms


==================================================
EXPLAIN ANALYZE — Query 6: Produkty najczęściej dodawane do ulubionych
==================================================
Limit  (cost=14382.58..14382.60 rows=10 width=25) (actual time=1288.846..1334.372 rows=10 loops=1)
  ->  Sort  (cost=14382.58..14432.58 rows=20000 width=25) (actual time=1288.837..1333.099 rows=10 loops=1)
        Sort Key: (count(f.id)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=13750.38..13950.38 rows=20000 width=25) (actual time=1278.770..1326.100 rows=20000 loops=1)
              Group Key: p.id
              Batches: 1  Memory Usage: 2577kB
              ->  Gather  (cost=9350.38..13550.38 rows=40000 width=25) (actual time=849.665..1096.151 rows=59999 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=8350.38..8550.38 rows=20000 width=25) (actual time=789.890..825.622 rows=20000 loops=3)
                          Group Key: p.id
                          Batches: 1  Memory Usage: 2577kB
                          Worker 0:  Batches: 1  Memory Usage: 2577kB
                          Worker 1:  Batches: 1  Memory Usage: 2577kB
                          ->  Hash Join  (cost=688.00..7100.38 rows=250000 width=21) (actual time=13.927..688.526 rows=200000 loops=3)
                                Hash Cond: (f.product_id = p.id)
                                ->  Parallel Seq Scan on "FavoriteProduct" f  (cost=0.00..5756.00 rows=250000 width=8) (actual time=5.613..582.242 rows=200000 loops=3)
                                ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=7.913..8.627 rows=20000 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1215kB
                                      ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.042..3.113 rows=20000 loops=3)
Planning Time: 29.298 ms
Execution Time: 1337.308 ms


==================================================
EXPLAIN ANALYZE — Query 7: Dostępny Stan Magazynowy Wariantów Produktu Pogrupowany po Magazynach
==================================================
GroupAggregate  (cost=37640.01..42664.89 rows=223328 width=61) (actual time=1355.942..1674.264 rows=178012 loops=1)
  Group Key: p.name, w.name, v.sku
  ->  Sort  (cost=37640.01..38198.33 rows=223328 width=57) (actual time=1352.277..1574.732 rows=223971 loops=1)
        Sort Key: p.name, w.name, v.sku
        Sort Method: external merge  Disk: 15248kB
        ->  Hash Join  (cost=2189.15..9398.65 rows=223328 width=57) (actual time=31.636..572.287 rows=223971 loops=1)
              Hash Cond: (si.warehouse_id = w.id)
              ->  Hash Join  (cost=2144.50..8766.15 rows=223328 width=44) (actual time=31.119..530.029 rows=223971 loops=1)
                    Hash Cond: (v.product_id = p.id)
                    ->  Hash Join  (cost=1456.50..7491.79 rows=223328 width=35) (actual time=24.588..439.689 rows=223971 loops=1)
                          Hash Cond: (si.variant_id = v.id)
                          ->  Seq Scan on "StockItem" si  (cost=0.00..5449.00 rows=223328 width=12) (actual time=0.016..307.939 rows=223971 loops=1)
                                Filter: (shipment_id IS NULL)
                                Rows Removed by Filter: 96029
                          ->  Hash  (cost=869.00..869.00 rows=47000 width=31) (actual time=24.551..25.601 rows=47000 loops=1)
                                Buckets: 65536  Batches: 1  Memory Usage: 3450kB
                                ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=31) (actual time=0.005..6.569 rows=47000 loops=1)
                    ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=6.520..6.520 rows=20000 loops=1)
                          Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                          ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.006..2.486 rows=20000 loops=1)
              ->  Hash  (cost=25.40..25.40 rows=1540 width=21) (actual time=0.511..0.511 rows=10 loops=1)
                    Buckets: 2048  Batches: 1  Memory Usage: 17kB
                    ->  Seq Scan on "Warehouse" w  (cost=0.00..25.40 rows=1540 width=21) (actual time=0.012..0.014 rows=10 loops=1)
Planning Time: 12.410 ms
Execution Time: 1694.315 ms


==================================================
EXPLAIN ANALYZE — Query 8: Stan magazynowy per produkt
==================================================
Sort  (cost=11494.90..11544.43 rows=19812 width=21) (actual time=297.073..298.822 rows=17916 loops=1)
  Sort Key: (count(si.id)) DESC
  Sort Method: quicksort  Memory: 1482kB
  ->  HashAggregate  (cost=9882.79..10080.91 rows=19812 width=21) (actual time=289.609..293.597 rows=17916 loops=1)
        Group Key: p.name
        Batches: 1  Memory Usage: 2065kB
        ->  Hash Join  (cost=2144.50..8766.15 rows=223328 width=17) (actual time=18.555..211.377 rows=223971 loops=1)
              Hash Cond: (v.product_id = p.id)
              ->  Hash Join  (cost=1456.50..7491.79 rows=223328 width=8) (actual time=12.280..137.017 rows=223971 loops=1)
                    Hash Cond: (si.variant_id = v.id)
                    ->  Seq Scan on "StockItem" si  (cost=0.00..5449.00 rows=223328 width=8) (actual time=0.014..37.888 rows=223971 loops=1)
                          Filter: (shipment_id IS NULL)
                          Rows Removed by Filter: 96029
                    ->  Hash  (cost=869.00..869.00 rows=47000 width=8) (actual time=12.245..12.246 rows=47000 loops=1)
                          Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                          ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=8) (actual time=0.005..5.118 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=6.263..6.264 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.599..2.980 rows=20000 loops=1)
Planning Time: 15.937 ms
Execution Time: 300.335 ms


==================================================
EXPLAIN ANALYZE — Query 9: Najpopularniejsze Kategorie (wg. Całkowitego Przychodu)
==================================================
Limit  (cost=12371.00..12371.02 rows=10 width=44) (actual time=642.366..873.014 rows=10 loops=1)
  ->  Sort  (cost=12371.00..12371.37 rows=150 width=44) (actual time=641.606..871.176 rows=10 loops=1)
        Sort Key: (sum(oi.unit_price)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize GroupAggregate  (cost=12328.63..12367.76 rows=150 width=44) (actual time=636.523..867.601 rows=150 loops=1)
              Group Key: c.name
              ->  Gather Merge  (cost=12328.63..12363.63 rows=300 width=44) (actual time=625.518..860.430 rows=428 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Sort  (cost=11328.61..11328.98 rows=150 width=44) (actual time=300.360..303.231 rows=143 loops=3)
                          Sort Key: c.name
                          Sort Method: quicksort  Memory: 39kB
                          Worker 0:  Sort Method: quicksort  Memory: 37kB
                          Worker 1:  Sort Method: quicksort  Memory: 38kB
                          ->  Partial HashAggregate  (cost=11321.31..11323.19 rows=150 width=44) (actual time=266.800..268.980 rows=143 loops=3)
                                Group Key: c.name
                                Batches: 1  Memory Usage: 96kB
                                Worker 0:  Batches: 1  Memory Usage: 96kB
                                Worker 1:  Batches: 1  Memory Usage: 96kB
                                ->  Hash Join  (cost=8362.48..11112.98 rows=41667 width=18) (actual time=112.481..251.650 rows=33334 loops=3)
                                      Hash Cond: (pc.category_id = c.id)
                                      ->  Parallel Hash Join  (cost=8357.10..10995.13 rows=41667 width=10) (actual time=104.771..237.158 rows=33334 loops=3)
                                            Hash Cond: (pc.product_id = p.id)
                                            ->  Parallel Index Only Scan using uq_prodcat_product_category on "ProductCategory" pc  (cost=0.29..2236.96 rows=41667 width=8) (actual time=48.134..168.312 rows=33333 loops=3)
                                                  Heap Fetches: 0
                                            ->  Parallel Hash  (cost=8209.75..8209.75 rows=11765 width=14) (actual time=45.726..46.874 rows=6667 loops=3)
                                                  Buckets: 32768  Batches: 1  Memory Usage: 1216kB
                                                  ->  Hash Join  (cost=2722.50..8209.75 rows=11765 width=14) (actual time=24.237..117.918 rows=20000 loops=1)
                                                        Hash Cond: (v.product_id = p.id)
                                                        ->  Hash Join  (cost=2034.50..7490.85 rows=11765 width=10) (actual time=18.869..103.555 rows=20000 loops=1)
                                                              Hash Cond: (si.variant_id = v.id)
                                                              ->  Hash Join  (cost=578.00..6003.47 rows=11765 width=10) (actual time=6.091..81.746 rows=20000 loops=1)
                                                                    Hash Cond: (si.id = oi.stock_item_id)
                                                                    ->  Parallel Seq Scan on "StockItem" si  (cost=0.00..4131.35 rows=188235 width=8) (actual time=0.005..23.122 rows=320000 loops=1)
                                                                    ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=5.537..6.237 rows=20000 loops=1)
                                                                          Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                                                          ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.014..2.292 rows=20000 loops=1)
                                                              ->  Hash  (cost=869.00..869.00 rows=47000 width=8) (actual time=12.758..12.758 rows=47000 loops=1)
                                                                    Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                                                    ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=8) (actual time=0.009..5.195 rows=47000 loops=1)
                                                        ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=5.356..6.199 rows=20000 loops=1)
                                                              Buckets: 32768  Batches: 1  Memory Usage: 960kB
                                                              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.010..2.082 rows=20000 loops=1)
                                      ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=6.462..6.463 rows=150 loops=3)
                                            Buckets: 1024  Batches: 1  Memory Usage: 16kB
                                            ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=6.404..6.425 rows=150 loops=3)
Planning Time: 22.436 ms
Execution Time: 877.213 ms


==================================================
EXPLAIN ANALYZE — Query 10: Liczba produktów per kategoria
==================================================
Sort  (cost=2342.22..2342.59 rows=150 width=20) (actual time=197.214..197.225 rows=150 loops=1)
  Sort Key: (count(pc.product_id)) DESC
  Sort Method: quicksort  Memory: 30kB
  ->  HashAggregate  (cost=2335.30..2336.80 rows=150 width=20) (actual time=196.586..196.611 rows=150 loops=1)
        Group Key: c.name
        Batches: 1  Memory Usage: 48kB
        ->  Hash Right Join  (cost=5.38..1835.30 rows=100000 width=16) (actual time=2.080..176.021 rows=100000 loops=1)
              Hash Cond: (pc.category_id = c.id)
              ->  Seq Scan on "ProductCategory" pc  (cost=0.00..1560.00 rows=100000 width=8) (actual time=1.417..153.560 rows=100000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=0.063..0.065 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 16kB
                    ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=0.013..0.036 rows=150 loops=1)
Planning Time: 0.230 ms
Execution Time: 197.293 ms


==================================================
EXPLAIN ANALYZE — Query 11: Liczba zamówień per metoda płatności
==================================================
Sort  (cost=7808.47..7808.49 rows=6 width=50) (actual time=192.926..310.019 rows=6 loops=1)
  Sort Key: (sum(oi.unit_price)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  Finalize GroupAggregate  (cost=7806.80..7808.40 rows=6 width=50) (actual time=192.271..309.371 rows=6 loops=1)
        Group Key: pm.name
        ->  Gather Merge  (cost=7806.80..7808.20 rows=12 width=50) (actual time=186.203..302.154 rows=6 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Sort  (cost=6806.78..6806.79 rows=6 width=50) (actual time=55.958..55.963 rows=2 loops=3)
                    Sort Key: pm.name
                    Sort Method: quicksort  Memory: 25kB
                    Worker 0:  Sort Method: quicksort  Memory: 25kB
                    Worker 1:  Sort Method: quicksort  Memory: 25kB
                    ->  Partial HashAggregate  (cost=6806.62..6806.70 rows=6 width=50) (actual time=52.963..52.969 rows=2 loops=3)
                          Group Key: pm.name
                          Batches: 1  Memory Usage: 24kB
                          Worker 0:  Batches: 1  Memory Usage: 24kB
                          Worker 1:  Batches: 1  Memory Usage: 24kB
                          ->  Hash Join  (cost=579.13..6744.13 rows=8333 width=20) (actual time=7.098..49.965 rows=6667 loops=3)
                                Hash Cond: (o.payment_method_id = pm.id)
                                ->  Hash Join  (cost=578.00..6705.67 rows=8333 width=14) (actual time=1.853..43.296 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.002..14.114 rows=133333 loops=3)
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=5.534..5.535 rows=20000 loops=1)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.006..2.316 rows=20000 loops=1)
                                ->  Hash  (cost=1.06..1.06 rows=6 width=14) (actual time=4.781..4.782 rows=6 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                      ->  Seq Scan on "PaymentMethod" pm  (cost=0.00..1.06 rows=6 width=14) (actual time=3.701..3.703 rows=6 loops=3)
Planning Time: 21.743 ms
Execution Time: 319.795 ms


==================================================
EXPLAIN ANALYZE — Query 12: Średnia ocena per producent
==================================================
Sort  (cost=1367.54..1367.91 rows=150 width=57) (actual time=36.754..36.764 rows=150 loops=1)
  Sort Key: (round(avg(r.rating), 2)) DESC NULLS LAST
  Sort Method: quicksort  Memory: 32kB
  ->  HashAggregate  (cost=1359.87..1362.12 rows=150 width=57) (actual time=35.458..35.529 rows=150 loops=1)
        Group Key: m.name
        Batches: 1  Memory Usage: 64kB
        ->  Hash Join  (cost=693.38..1259.87 rows=20000 width=29) (actual time=8.624..28.471 rows=27388 loops=1)
              Hash Cond: (p.manufacturer_id = m.id)
              ->  Hash Right Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=5.971..20.170 rows=27388 loops=1)
                    Hash Cond: (r.product_id = p.id)
                    ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=0.016..2.214 rows=20000 loops=1)
                    ->  Hash  (cost=438.00..438.00 rows=20000 width=8) (actual time=5.939..5.940 rows=20000 loops=1)
                          Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                          ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=8) (actual time=0.008..2.871 rows=20000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=2.001..2.002 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 18kB
                    ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=1.957..1.973 rows=150 loops=1)
Planning Time: 13.683 ms
Execution Time: 38.098 ms


==================================================
EXPLAIN ANALYZE — Query 13: Aktywne promocje i objęta nimi liczba wariantów
==================================================
Sort  (cost=395.64..395.76 rows=47 width=14) (actual time=13.984..15.093 rows=46 loops=1)
  Sort Key: (count(v.id)) DESC
  Sort Method: quicksort  Memory: 26kB
  ->  HashAggregate  (cost=393.87..394.34 rows=47 width=14) (actual time=13.954..13.963 rows=46 loops=1)
        Group Key: pr.name
        Batches: 1  Memory Usage: 24kB
        ->  Merge Join  (cost=7.63..337.47 rows=11280 width=10) (actual time=4.678..11.655 rows=1340 loops=1)
              Merge Cond: (v.promotion_id = pr.id)
              ->  Index Scan using idx_variant_promotion on "Variant" v  (cost=0.29..2469.28 rows=47000 width=8) (actual time=0.028..6.180 rows=5685 loops=1)
              ->  Sort  (cost=7.34..7.46 rows=48 width=10) (actual time=3.382..3.389 rows=47 loops=1)
                    Sort Key: pr.id
                    Sort Method: quicksort  Memory: 26kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=48 width=10) (actual time=2.496..2.521 rows=47 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 153
Planning Time: 53.157 ms
Execution Time: 44.257 ms


==================================================
EXPLAIN ANALYZE — Query 14: Najczęściej wybierane warianty w koszykach
==================================================
Limit  (cost=224158.84..224158.87 rows=10 width=44) (actual time=8395.718..8395.723 rows=10 loops=1)
  ->  Sort  (cost=224158.84..227908.84 rows=1500000 width=44) (actual time=8395.717..8395.719 rows=10 loops=1)
        Sort Key: (sum(ci.quantity)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  GroupAggregate  (cost=4.24..191744.38 rows=1500000 width=44) (actual time=112.478..8384.609 rows=47000 loops=1)
              Group Key: v.sku, p.name
              ->  Incremental Sort  (cost=4.24..165494.38 rows=1500000 width=40) (actual time=53.589..8087.029 rows=1500000 loops=1)
                    Sort Key: v.sku, p.name
                    Presorted Key: v.sku
                    Full-sort Groups: 31708  Sort Method: quicksort  Average Memory: 27kB  Peak Memory: 27kB
                    Pre-sorted Groups: 6442  Sort Method: quicksort  Average Memory: 26kB  Peak Memory: 26kB
                    ->  Nested Loop  (cost=1.14..108333.20 rows=1500000 width=40) (actual time=12.567..7596.743 rows=1500000 loops=1)
                          ->  Nested Loop  (cost=0.71..8804.70 rows=47000 width=40) (actual time=11.333..189.158 rows=47000 loops=1)
                                ->  Index Scan using "Variant_sku_key" on "Variant" v  (cost=0.41..2051.42 rows=47000 width=31) (actual time=9.076..38.401 rows=47000 loops=1)
                                ->  Memoize  (cost=0.30..0.34 rows=1 width=17) (actual time=0.003..0.003 rows=1 loops=47000)
                                      Cache Key: v.product_id
                                      Cache Mode: logical
                                      Hits: 28889  Misses: 18111  Evictions: 0  Overflows: 0  Memory Usage: 2099kB
                                      ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=17) (actual time=0.004..0.004 rows=1 loops=18111)
                                            Index Cond: (id = v.product_id)
                          ->  Index Scan using idx_cartitem_variant_id on "CartItem" ci  (cost=0.43..1.80 rows=32 width=8) (actual time=0.008..0.153 rows=32 loops=47000)
                                Index Cond: (variant_id = v.id)
Planning Time: 117.098 ms
Execution Time: 8410.873 ms


==================================================
EXPLAIN ANALYZE — Query 15: Produkty z Największą Różnicą Między Ceną Podstawową a Ceną Wariantu
==================================================
Limit  (cost=2813.55..2813.58 rows=10 width=80) (actual time=47.660..48.580 rows=10 loops=1)
  ->  Sort  (cost=2813.55..2931.05 rows=47000 width=80) (actual time=47.658..47.661 rows=10 loops=1)
        Sort Key: v.price_modifier DESC
        Sort Method: top-N heapsort  Memory: 27kB
        ->  Hash Join  (cost=688.00..1797.90 rows=47000 width=80) (actual time=7.150..32.619 rows=47000 loops=1)
              Hash Cond: (v.product_id = p.id)
              ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=33) (actual time=0.805..4.140 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=6.324..6.326 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1381kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.019..2.725 rows=20000 loops=1)
Planning Time: 27.571 ms
Execution Time: 50.936 ms


==================================================
EXPLAIN ANALYZE — Query 16: Konwersja zamówień wg statusu
==================================================
Sort  (cost=7957.56..7962.66 rows=2040 width=48) (actual time=463.739..1221.764 rows=7 loops=1)
  Sort Key: (count(o.id)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  WindowAgg  (cost=7824.99..7845.41 rows=2040 width=48) (actual time=463.724..1221.112 rows=7 loops=1)
        ->  Finalize HashAggregate  (cost=7779.11..7799.51 rows=2040 width=16) (actual time=459.024..1216.424 rows=7 loops=1)
              Group Key: s.name
              Batches: 1  Memory Usage: 121kB
              ->  Gather  (cost=7330.31..7758.71 rows=4080 width=16) (actual time=237.806..1213.864 rows=7 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=6330.31..6350.71 rows=2040 width=16) (actual time=73.558..73.566 rows=2 loops=3)
                          Group Key: s.name
                          Batches: 1  Memory Usage: 121kB
                          Worker 0:  Batches: 1  Memory Usage: 121kB
                          Worker 1:  Batches: 1  Memory Usage: 121kB
                          ->  Hash Join  (cost=55.90..5496.98 rows=166667 width=12) (actual time=0.018..44.950 rows=133333 loops=3)
                                Hash Cond: (o.status_id = s.id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.004..12.279 rows=133333 loops=3)
                                ->  Hash  (cost=30.40..30.40 rows=2040 width=12) (actual time=0.022..0.023 rows=7 loops=1)
                                      Buckets: 2048  Batches: 1  Memory Usage: 17kB
                                      ->  Seq Scan on "Status" s  (cost=0.00..30.40 rows=2040 width=12) (actual time=0.015..0.017 rows=7 loops=1)
Planning Time: 39.393 ms
Execution Time: 1229.176 ms


==================================================
EXPLAIN ANALYZE — Query 17: Top klienci wg wydatków
==================================================
Limit  (cost=15399.41..15399.44 rows=10 width=50) (actual time=4386.847..4438.332 rows=10 loops=1)
  ->  Sort  (cost=15399.41..15449.41 rows=20000 width=50) (actual time=4386.847..4438.329 rows=10 loops=1)
        Sort Key: (sum(oi.unit_price)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=14717.22..14967.22 rows=20000 width=50) (actual time=4341.931..4426.191 rows=19296 loops=1)
              Group Key: u.id
              Batches: 5  Memory Usage: 8241kB  Disk Usage: 216kB
              ->  Gather  (cost=12821.46..14592.22 rows=16666 width=50) (actual time=3710.241..3984.428 rows=19416 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=11821.46..11925.62 rows=8333 width=50) (actual time=3576.921..3660.292 rows=6472 loops=3)
                          Group Key: u.id
                          Batches: 1  Memory Usage: 3217kB
                          Worker 0:  Batches: 1  Memory Usage: 2961kB
                          Worker 1:  Batches: 1  Memory Usage: 2961kB
                          ->  Nested Loop  (cost=578.42..11779.80 rows=8333 width=24) (actual time=27.369..3484.023 rows=6667 loops=3)
                                ->  Hash Join  (cost=578.00..6705.67 rows=8333 width=10) (actual time=7.753..225.201 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.009..145.058 rows=133333 loops=3)
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=7.503..8.140 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.468..2.971 rows=20000 loops=3)
                                ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.479..0.479 rows=1 loops=20000)
                                      Index Cond: (id = o.user_id)
Planning Time: 24.907 ms
Execution Time: 4460.907 ms


==================================================
EXPLAIN ANALYZE — Query 18: Produkty z wariantami objętymi promocją, z końcową ceną
==================================================
Sort  (cost=1983.52..2011.72 rows=11280 width=132) (actual time=62.745..62.885 rows=1340 loops=1)
  Sort Key: (round(((p.price + v.price_modifier) * ('1'::numeric - pr.discount_percentage)), 2))
  Sort Method: quicksort  Memory: 146kB
  ->  Hash Join  (cost=695.63..1224.29 rows=11280 width=132) (actual time=32.321..60.390 rows=1340 loops=1)
        Hash Cond: (v.product_id = p.id)
        ->  Merge Join  (cost=7.63..337.47 rows=11280 width=39) (actual time=0.687..27.165 rows=1340 loops=1)
              Merge Cond: (v.promotion_id = pr.id)
              ->  Index Scan using idx_variant_promotion on "Variant" v  (cost=0.29..2469.28 rows=47000 width=37) (actual time=0.023..25.619 rows=5685 loops=1)
              ->  Sort  (cost=7.34..7.46 rows=48 width=10) (actual time=0.660..0.670 rows=47 loops=1)
                    Sort Key: pr.id
                    Sort Method: quicksort  Memory: 26kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=48 width=10) (actual time=0.021..0.045 rows=47 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 153
        ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=30.999..31.000 rows=20000 loops=1)
              Buckets: 32768  Batches: 1  Memory Usage: 1381kB
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.478..15.165 rows=20000 loops=1)
Planning Time: 37.238 ms
Execution Time: 64.169 ms


==================================================
EXPLAIN ANALYZE — Query 19: Użytkownicy, Którzy Dodali Produkt do Koszyka, Ale Nie Złożyli Zamówienia (Potencjał Odbudowy Koszyka)
==================================================
Hash Join  (cost=45873.97..103632.31 rows=1070130 width=55) (actual time=4715.973..10804.769 rows=1005006 loops=1)
  Hash Cond: (v.product_id = p.id)
  ->  Hash Join  (cost=45185.97..100134.62 rows=1070130 width=46) (actual time=4706.871..10203.411 rows=1005006 loops=1)
        Hash Cond: (ci.variant_id = v.id)
        ->  Hash Join  (cost=43729.47..95868.77 rows=1070130 width=46) (actual time=4689.572..9513.960 rows=1005006 loops=1)
              Hash Cond: (ci.cart_id = c.id)
              ->  Seq Scan on "CartItem" ci  (cost=0.00..23152.00 rows=1500000 width=8) (actual time=1.286..3794.586 rows=1500000 loops=1)
              ->  Hash  (cost=41450.81..41450.81 rows=107013 width=46) (actual time=4682.205..4693.775 rows=100414 loops=1)
                    Buckets: 131072  Batches: 2  Memory Usage: 4929kB
                    ->  Gather  (cost=25017.67..41450.81 rows=107013 width=46) (actual time=4344.656..4411.264 rows=100414 loops=1)
                          Workers Planned: 2
                          Workers Launched: 2
                          ->  Parallel Hash Right Anti Join  (cost=24017.67..29749.51 rows=44589 width=46) (actual time=3689.608..3716.659 rows=33471 loops=3)
                                Hash Cond: (o.user_id = u.id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=4) (actual time=7.598..633.759 rows=133333 loops=3)
                                ->  Parallel Hash  (cost=23236.42..23236.42 rows=62500 width=50) (actual time=2570.403..2570.790 rows=50000 loops=3)
                                      Buckets: 262144  Batches: 1  Memory Usage: 14720kB
                                      ->  Hash Join  (cost=4079.00..23236.42 rows=62500 width=50) (actual time=291.642..2245.986 rows=50000 loops=3)
                                            Hash Cond: (u.id = c.user_id)
                                            ->  Parallel Seq Scan on "User" u  (cost=0.00..18063.67 rows=416667 width=46) (actual time=1.011..1538.538 rows=333333 loops=3)
                                            ->  Hash  (cost=2204.00..2204.00 rows=150000 width=8) (actual time=284.038..284.039 rows=150000 loops=3)
                                                  Buckets: 262144  Batches: 1  Memory Usage: 7908kB
                                                  ->  Seq Scan on "Cart" c  (cost=0.00..2204.00 rows=150000 width=8) (actual time=5.124..147.487 rows=150000 loops=3)
        ->  Hash  (cost=869.00..869.00 rows=47000 width=8) (actual time=13.885..13.886 rows=47000 loops=1)
              Buckets: 65536  Batches: 1  Memory Usage: 2348kB
              ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=8) (actual time=0.012..5.111 rows=47000 loops=1)
  ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=5.713..5.714 rows=20000 loops=1)
        Buckets: 32768  Batches: 1  Memory Usage: 1245kB
        ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.015..2.371 rows=20000 loops=1)
Planning Time: 58.499 ms
Execution Time: 10938.107 ms


==================================================
EXPLAIN ANALYZE — Query 20: Wyszukiwanie produktów po nazwie lub opisie (parametryzowane)
==================================================
Bitmap Heap Scan on "Product"  (cost=43.00..57.51 rows=4 width=60) (actual time=4.072..35.648 rows=143 loops=1)
  Recheck Cond: (((name)::text ~~* '%test%'::text) OR (description ~~* '%test%'::text))
  Heap Blocks: exact=106
  ->  BitmapOr  (cost=43.00..43.00 rows=4 width=0) (actual time=2.935..2.936 rows=0 loops=1)
        ->  Bitmap Index Scan on idx_product_name_trgm  (cost=0.00..21.50 rows=2 width=0) (actual time=1.745..1.746 rows=42 loops=1)
              Index Cond: ((name)::text ~~* '%test%'::text)
        ->  Bitmap Index Scan on idx_product_description_trgm  (cost=0.00..21.50 rows=2 width=0) (actual time=1.184..1.184 rows=102 loops=1)
              Index Cond: (description ~~* '%test%'::text)
Planning Time: 136.540 ms
Execution Time: 42.813 ms


==================================================
EXPLAIN ANALYZE — Query 21: Użytkownicy, Którzy Zapisali Konkretny Produkt jako Ulubiony (np. Product ID=350259)
==================================================
Nested Loop  (cost=0.85..262.23 rows=30 width=56) (actual time=4.465..26.181 rows=26 loops=1)
  ->  Index Only Scan using idx_favoriteproduct_product_user on "FavoriteProduct" fp  (cost=0.42..8.95 rows=30 width=4) (actual time=3.896..3.907 rows=26 loops=1)
        Index Cond: (product_id = 35)
        Heap Fetches: 0
  ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..8.44 rows=1 width=60) (actual time=0.856..0.856 rows=1 loops=26)
        Index Cond: (id = fp.user_id)
Planning Time: 13.601 ms
Execution Time: 26.218 ms


==================================================
EXPLAIN ANALYZE — Query 22: Znajdź Magazyny, Które Posiadają Zapasy Konkretnego Wariantu (np. SKU='VR-000000-a637d44b7afd')
==================================================
GroupAggregate  (cost=24.91..25.01 rows=2 width=25) (actual time=3.077..3.078 rows=0 loops=1)
  Group Key: w.name
  Filter: (count(si.id) > 0)
  ->  Sort  (cost=24.91..24.93 rows=5 width=21) (actual time=3.075..3.077 rows=0 loops=1)
        Sort Key: w.name
        Sort Method: quicksort  Memory: 25kB
        ->  Nested Loop  (cost=0.99..24.86 rows=5 width=21) (actual time=2.483..2.484 rows=0 loops=1)
              ->  Nested Loop  (cost=0.84..24.00 rows=5 width=8) (actual time=2.482..2.483 rows=0 loops=1)
                    ->  Index Scan using "Variant_sku_key" on "Variant" v  (cost=0.41..8.43 rows=1 width=4) (actual time=2.481..2.482 rows=0 loops=1)
                          Index Cond: ((sku)::text = 'VR-000001-2704de10f283'::text)
                    ->  Index Scan using idx_stockitem_shipment_variant_warehouse on "StockItem" si  (cost=0.42..15.52 rows=5 width=12) (never executed)
                          Index Cond: ((shipment_id IS NULL) AND (variant_id = v.id))
              ->  Index Scan using "Warehouse_pkey" on "Warehouse" w  (cost=0.15..0.17 rows=1 width=21) (never executed)
                    Index Cond: (id = si.warehouse_id)
Planning Time: 20.000 ms
Execution Time: 3.757 ms


==================================================
EXPLAIN ANALYZE — Query 23: Warianty, Które Wymagają Uzyskania Konkretnej Opcji (np. 'Kolor'='Czerwony')
==================================================
Nested Loop  (cost=6.96..680.20 rows=1 width=36) (actual time=0.616..0.616 rows=0 loops=1)
  ->  Nested Loop  (cost=6.67..679.87 rows=1 width=27) (actual time=0.615..0.616 rows=0 loops=1)
        ->  Nested Loop  (cost=6.38..679.55 rows=1 width=4) (actual time=0.615..0.616 rows=0 loops=1)
              Join Filter: (opt.attribute_id = a.id)
              ->  Index Scan using "Attribute_name_key" on "Attribute" a  (cost=0.15..8.17 rows=1 width=4) (actual time=0.615..0.615 rows=0 loops=1)
                    Index Cond: ((name)::text = 'Attr_49_Century'::text)
              ->  Nested Loop  (cost=6.23..668.26 rows=250 width=8) (never executed)
                    ->  Seq Scan on "Option" opt  (cost=0.00..18.50 rows=1 width=8) (never executed)
                          Filter: ((value)::text = 'do'::text)
                    ->  Bitmap Heap Scan on "VariantOption" vo  (cost=6.23..647.26 rows=250 width=8) (never executed)
                          Recheck Cond: (option_id = opt.id)
                          ->  Bitmap Index Scan on idx_variantoption_option_id  (cost=0.00..6.17 rows=250 width=0) (never executed)
                                Index Cond: (option_id = opt.id)
        ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.32 rows=1 width=31) (never executed)
              Index Cond: (id = vo.variant_id)
  ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=17) (never executed)
        Index Cond: (id = v.product_id)
Planning Time: 51.265 ms
Execution Time: 0.668 ms


==================================================
EXPLAIN ANALYZE — Query 24: Znajdź Zamówienia Użytkownika (np. email='debbie.lane.16786.50af0753@example.com') o Statusie 'Paid'
==================================================
Nested Loop  (cost=1.00..17.09 rows=1 width=20) (actual time=3.551..3.552 rows=0 loops=1)
  ->  Nested Loop  (cost=0.85..16.89 rows=1 width=16) (actual time=3.550..3.551 rows=0 loops=1)
        ->  Index Scan using "User_email_key" on "User" u  (cost=0.42..8.44 rows=1 width=4) (actual time=3.550..3.550 rows=0 loops=1)
              Index Cond: ((email)::text = 'debbie.lane.16786.50af0753@example.com'::text)
        ->  Index Scan using idx_order_user_id on "Order" o  (cost=0.42..8.44 rows=1 width=20) (never executed)
              Index Cond: (user_id = u.id)
  ->  Index Scan using "Status_pkey" on "Status" s  (cost=0.15..0.17 rows=1 width=12) (never executed)
        Index Cond: (id = o.status_id)
        Filter: ((name)::text = 'Paid'::text)
Planning Time: 8.171 ms
Execution Time: 3.592 ms


==================================================
EXPLAIN ANALYZE — Query 25: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
Nested Loop Left Join  (cost=5.45..49.87 rows=16 width=87) (actual time=3.601..9.670 rows=18 loops=1)
  ->  Nested Loop Left Join  (cost=5.30..46.34 rows=16 width=45) (actual time=2.744..8.780 rows=18 loops=1)
        ->  Nested Loop Left Join  (cost=5.02..41.66 rows=16 width=39) (actual time=2.710..7.550 rows=18 loops=1)
              ->  Nested Loop  (cost=4.60..23.91 rows=3 width=39) (actual time=0.034..1.244 rows=4 loops=1)
                    ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..8.30 rows=1 width=10) (actual time=0.008..0.010 rows=1 loops=1)
                          Index Cond: (id = 35)
                    ->  Bitmap Heap Scan on "Variant" v  (cost=4.31..15.57 rows=3 width=37) (actual time=0.021..1.227 rows=4 loops=1)
                          Recheck Cond: (product_id = 35)
                          Heap Blocks: exact=4
                          ->  Bitmap Index Scan on idx_variant_product_id  (cost=0.00..4.31 rows=3 width=0) (actual time=0.007..0.007 rows=4 loops=1)
                                Index Cond: (product_id = 35)
              ->  Index Only Scan using uq_varopt_variant_option on "VariantOption" vo  (cost=0.42..5.86 rows=6 width=8) (actual time=1.573..1.575 rows=4 loops=4)
                    Index Cond: (variant_id = v.id)
                    Heap Fetches: 0
        ->  Index Scan using "Option_pkey" on "Option" opt  (cost=0.28..0.29 rows=1 width=14) (actual time=0.068..0.068 rows=1 loops=18)
              Index Cond: (id = vo.option_id)
  ->  Index Scan using "Attribute_pkey" on "Attribute" a  (cost=0.15..0.22 rows=1 width=18) (actual time=0.001..0.001 rows=1 loops=18)
        Index Cond: (id = opt.attribute_id)
Planning Time: 0.545 ms
Execution Time: 9.719 ms


==================================================
EXPLAIN ANALYZE — Query 26: Lista Wszystkich Dziecięcych Kategorii (Podkategorii) dla Konkretnej Kategorii Nadrzędnej (np. ID=5)
==================================================
Seq Scan on "Category"  (cost=0.00..3.88 rows=3 width=12) (actual time=1.292..1.930 rows=3 loops=1)
  Filter: (parent_id = 5)
  Rows Removed by Filter: 147
Planning Time: 1.364 ms
Execution Time: 1.951 ms


==================================================
EXPLAIN ANALYZE — Query 27: Porównanie Średniej Oceny dla Promowanych i Niepromowanych Produktów
==================================================
HashAggregate  (cost=87850.51..87853.01 rows=200 width=64) (actual time=154.403..154.407 rows=2 loops=1)
  Group Key: CASE WHEN (ANY (p.id = (hashed SubPlan 2).col1)) THEN 'Promowany'::text ELSE 'Niepromowany'::text END
  Batches: 1  Memory Usage: 40kB
  ->  HashAggregate  (cost=1300.51..87550.51 rows=20000 width=68) (actual time=144.504..151.386 rows=12612 loops=1)
        Group Key: p.id
        Batches: 1  Memory Usage: 2577kB
        ->  Hash Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=58.523..127.448 rows=20000 loops=1)
              Hash Cond: (r.product_id = p.id)
              ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=1.307..61.858 rows=20000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=54.671..54.672 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 960kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.013..51.056 rows=20000 loops=1)
        SubPlan 2
          ->  Index Only Scan using idx_variant_product_promotion on "Variant" v2  (cost=0.28..158.09 rows=5739 width=4) (actual time=2.126..6.234 rows=5684 loops=1)
                Heap Fetches: 0
Planning Time: 7.895 ms
Execution Time: 157.204 ms


==================================================
EXPLAIN ANALYZE — Query 28: Top 5 Miast Generujących Największy Przychód (Wg. Adresu Wysyłki)
==================================================
Limit  (cost=15315.16..15315.17 rows=5 width=45) (actual time=3910.969..3958.469 rows=5 loops=1)
  ->  Sort  (cost=15315.16..15365.16 rows=20000 width=45) (actual time=3910.081..3957.578 rows=5 loops=1)
        Sort Key: (sum(oi.unit_price)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=14732.97..14982.97 rows=20000 width=45) (actual time=3900.863..3953.702 rows=12950 loops=1)
              Group Key: a.city
              Batches: 1  Memory Usage: 5905kB
              ->  Gather  (cost=12837.21..14607.97 rows=16666 width=45) (actual time=3673.037..3804.890 rows=16154 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=11837.21..11941.37 rows=8333 width=45) (actual time=3630.203..3637.711 rows=5385 loops=3)
                          Group Key: a.city
                          Batches: 1  Memory Usage: 2705kB
                          Worker 0:  Batches: 1  Memory Usage: 2449kB
                          Worker 1:  Batches: 1  Memory Usage: 2449kB
                          ->  Nested Loop  (cost=578.43..11795.55 rows=8333 width=19) (actual time=16.320..3603.941 rows=6667 loops=3)
                                ->  Hash Join  (cost=578.00..6705.67 rows=8333 width=10) (actual time=12.678..211.149 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.008..130.205 rows=133333 loops=3)
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=12.341..12.659 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.696..8.183 rows=20000 loops=3)
                                ->  Index Scan using "Address_pkey" on "Address" a  (cost=0.43..0.61 rows=1 width=17) (actual time=0.508..0.508 rows=1 loops=20000)
                                      Index Cond: (id = o.shipping_address_id)
Planning Time: 22.151 ms
Execution Time: 3967.894 ms


==================================================
EXPLAIN ANALYZE — Query 29: Porównanie Wolumenu Sprzedaży Produktów Promowanych vs. Niepromowanych (w Ostatnich 30 Dniach)
==================================================
Finalize GroupAggregate  (cost=6359.60..6415.40 rows=200 width=40) (actual time=1053.620..1199.300 rows=2 loops=1)
  Group Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
  ->  Gather Merge  (cost=6359.60..6411.40 rows=400 width=40) (actual time=1045.493..1195.763 rows=6 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=5359.58..5365.21 rows=200 width=40) (actual time=625.533..626.976 rows=2 loops=3)
              Group Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
              ->  Sort  (cost=5359.58..5360.79 rows=484 width=32) (actual time=612.755..614.718 rows=393 loops=3)
                    Sort Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
                    Sort Method: quicksort  Memory: 25kB
                    Worker 0:  Sort Method: quicksort  Memory: 25kB
                    Worker 1:  Sort Method: quicksort  Memory: 25kB
                    ->  Nested Loop  (cost=1015.19..5337.99 rows=484 width=32) (actual time=20.198..575.266 rows=393 loops=3)
                          ->  Nested Loop  (cost=1014.90..5185.96 rows=484 width=4) (actual time=19.068..499.275 rows=393 loops=3)
                                ->  Hash Join  (cost=1014.48..4585.22 rows=484 width=4) (actual time=16.819..43.261 rows=393 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Bitmap Heap Scan on "Order" o  (cost=436.48..3941.88 rows=9680 width=4) (actual time=8.101..31.704 rows=7846 loops=3)
                                            Recheck Cond: (order_date >= (now() - '30 days'::interval))
                                            Heap Blocks: exact=1723
                                            ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..430.67 rows=23232 width=0) (actual time=14.965..14.966 rows=23538 loops=1)
                                                  Index Cond: (order_date >= (now() - '30 days'::interval))
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=8) (actual time=7.245..7.249 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=8) (actual time=0.448..2.720 rows=20000 loops=3)
                                ->  Index Scan using "StockItem_pkey" on "StockItem" si  (cost=0.42..1.24 rows=1 width=8) (actual time=1.158..1.158 rows=1 loops=1180)
                                      Index Cond: (id = oi.stock_item_id)
                          ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.31 rows=1 width=8) (actual time=0.190..0.190 rows=1 loops=1180)
                                Index Cond: (id = si.variant_id)
Planning Time: 36.077 ms
Execution Time: 1203.565 ms


==================================================
EXPLAIN ANALYZE — Query 30: Wskaźnik Lojalności (Repeat Purchase Rate) Użytkowników z Podziałem na Miasto Adresu Rozliczeniowego
==================================================
Sort  (cost=68134.41..68209.82 rows=30162 width=61) (actual time=5204.024..5228.981 rows=66456 loops=1)
  Sort Key: (round((((count(*) FILTER (WHERE (u.orders_count > 1)))::numeric * 100.0) / (NULLIF(count(*), 0))::numeric), 2)) DESC
  Sort Method: external merge  Disk: 3192kB
  ->  Finalize HashAggregate  (cost=65136.24..65890.29 rows=30162 width=61) (actual time=5053.364..5116.889 rows=66456 loops=1)
        Group Key: a.city
        Batches: 5  Memory Usage: 8241kB  Disk Usage: 712kB
        ->  Gather  (cost=58349.79..64683.81 rows=60324 width=29) (actual time=4645.973..4758.429 rows=121979 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial HashAggregate  (cost=57349.79..57651.41 rows=30162 width=29) (actual time=4442.528..4456.427 rows=40660 loops=3)
                    Group Key: a.city
                    Batches: 1  Memory Usage: 5393kB
                    Worker 0:  Batches: 1  Memory Usage: 5137kB
                    Worker 1:  Batches: 1  Memory Usage: 5137kB
                    ->  Parallel Hash Join  (cost=34825.67..55683.12 rows=166667 width=21) (actual time=1368.726..3880.865 rows=133333 loops=3)
                          Hash Cond: (a.id = o.billing_address_id)
                          ->  Parallel Seq Scan on "Address" a  (cost=0.00..18288.00 rows=500000 width=17) (actual time=7.164..1570.665 rows=400000 loops=3)
                          ->  Parallel Hash  (cost=32742.34..32742.34 rows=166667 width=12) (actual time=1358.545..1360.569 rows=133333 loops=3)
                                Buckets: 524288  Batches: 1  Memory Usage: 22912kB
                                ->  Hash Join  (cost=24598.16..32742.34 rows=166667 width=12) (actual time=677.006..1082.948 rows=133333 loops=3)
                                      Hash Cond: (o.user_id = u.user_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.426..141.960 rows=133333 loops=3)
                                      ->  Hash  (cost=19615.94..19615.94 rows=286577 width=12) (actual time=551.457..553.016 rows=329619 loops=3)
                                            Buckets: 262144  Batches: 4  Memory Usage: 5596kB
                                            ->  Subquery Scan on u  (cost=0.42..19615.94 rows=286577 width=12) (actual time=10.994..404.571 rows=329619 loops=3)
                                                  ->  GroupAggregate  (cost=0.42..16750.17 rows=286577 width=12) (actual time=10.993..358.358 rows=329619 loops=3)
                                                        Group Key: "Order".user_id
                                                        ->  Index Only Scan using idx_order_user_id on "Order"  (cost=0.42..11884.40 rows=400000 width=4) (actual time=10.260..232.282 rows=400000 loops=3)
                                                              Heap Fetches: 150240
Planning Time: 19.245 ms
Execution Time: 5313.600 ms

FINISHED — 2025-11-22 17:01:00.416043
========================================================================================================================
========================================================================================================================
START EXPLAIN RUN — 2025-11-22 17:13:38.192002
========================================================================================================================


==================================================
EXPLAIN ANALYZE — Query 1: Średnia Wartość Zamówienia (AOV) w Ostatnim Miesiącu
==================================================
Aggregate  (cost=4939.64..4939.65 rows=1 width=32) (actual time=862.942..862.944 rows=1 loops=1)
  ->  HashAggregate  (cost=4909.24..4924.44 rows=1216 width=36) (actual time=862.419..862.845 rows=1213 loops=1)
        Group Key: o.id
        Batches: 1  Memory Usage: 577kB
        ->  Hash Join  (cost=4522.66..4903.16 rows=1216 width=10) (actual time=829.466..859.604 rows=1241 loops=1)
              Hash Cond: (oi.order_id = o.id)
              ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.582..13.336 rows=20000 loops=1)
              ->  Hash  (cost=4218.61..4218.61 rows=24324 width=4) (actual time=828.178..828.179 rows=24622 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1122kB
                    ->  Bitmap Heap Scan on "Order" o  (cost=456.94..4218.61 rows=24324 width=4) (actual time=32.676..820.182 rows=24622 loops=1)
                          Recheck Cond: (order_date >= (now() - '1 mon'::interval))
                          Heap Blocks: exact=3333
                          ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..450.86 rows=24324 width=0) (actual time=32.279..32.279 rows=24622 loops=1)
                                Index Cond: (order_date >= (now() - '1 mon'::interval))
Planning Time: 39.699 ms
Execution Time: 863.817 ms


==================================================
EXPLAIN ANALYZE — Query 2: Średnia wartość zamówienia per użytkownik
==================================================
Sort  (cost=16066.87..16115.61 rows=19495 width=50) (actual time=4961.825..5031.753 rows=19296 loops=1)
  Sort Key: (round(avg(order_totals.total_price), 2)) DESC
  Sort Method: quicksort  Memory: 1612kB
  ->  Finalize HashAggregate  (cost=14385.35..14677.77 rows=19495 width=50) (actual time=4926.081..5011.744 rows=19296 loops=1)
        Group Key: u.id
        Batches: 5  Memory Usage: 8241kB  Disk Usage: 224kB
        ->  Gather  (cost=12537.36..14263.50 rows=16246 width=50) (actual time=4794.781..4921.565 rows=19425 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial HashAggregate  (cost=11537.36..11638.90 rows=8123 width=50) (actual time=4343.477..4350.826 rows=6475 loops=3)
                    Group Key: u.id
                    Batches: 1  Memory Usage: 3217kB
                    Worker 0:  Batches: 1  Memory Usage: 2961kB
                    Worker 1:  Batches: 1  Memory Usage: 2961kB
                    ->  Nested Loop  (cost=1110.75..11496.75 rows=8123 width=50) (actual time=179.143..4282.509 rows=6498 loops=3)
                          ->  Hash Join  (cost=1110.33..6550.49 rows=8123 width=36) (actual time=118.861..372.730 rows=6498 loops=3)
                                Hash Cond: (o.id = order_totals.order_id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.016..128.701 rows=133333 loops=3)
                                ->  Hash  (cost=866.64..866.64 rows=19495 width=36) (actual time=112.926..114.299 rows=19495 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1094kB
                                      ->  Subquery Scan on order_totals  (cost=428.00..866.64 rows=19495 width=36) (actual time=96.610..106.974 rows=19495 loops=3)
                                            ->  HashAggregate  (cost=428.00..671.69 rows=19495 width=36) (actual time=96.125..104.308 rows=19495 loops=3)
                                                  Group Key: oi.order_id
                                                  Batches: 1  Memory Usage: 7953kB
                                                  Worker 0:  Batches: 1  Memory Usage: 7953kB
                                                  Worker 1:  Batches: 1  Memory Usage: 7953kB
                                                  ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=6.921..29.520 rows=20000 loops=3)
                          ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.594..0.594 rows=1 loops=19495)
                                Index Cond: (id = o.user_id)
Planning Time: 26.482 ms
Execution Time: 5073.759 ms


==================================================
EXPLAIN ANALYZE — Query 3: Top 10 Najlepiej Sprzedających Się Produktów (wg. Ilości Sprzedanych Jednostek) w Ostatnim Kwartale
==================================================
Limit  (cost=11753.90..11753.93 rows=10 width=46) (actual time=1633.327..1849.461 rows=10 loops=1)
  ->  Sort  (cost=11753.90..11765.35 rows=4579 width=46) (actual time=1633.322..1848.867 rows=10 loops=1)
        Sort Key: (count(*)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=11609.16..11654.95 rows=4579 width=46) (actual time=1630.282..1846.759 rows=3927 loops=1)
              Group Key: p.name, m.name
              Batches: 1  Memory Usage: 721kB
              ->  Gather  (cost=11179.86..11580.54 rows=3816 width=46) (actual time=1557.516..1842.756 rows=4336 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=10179.86..10198.94 rows=1908 width=46) (actual time=1479.700..1481.043 rows=1445 loops=3)
                          Group Key: p.name, m.name
                          Batches: 1  Memory Usage: 369kB
                          Worker 0:  Batches: 1  Memory Usage: 369kB
                          Worker 1:  Batches: 1  Memory Usage: 369kB
                          ->  Hash Join  (cost=2302.59..10165.55 rows=1908 width=38) (actual time=32.580..1467.101 rows=1521 loops=3)
                                Hash Cond: (p.manufacturer_id = m.id)
                                ->  Nested Loop  (cost=2297.22..10155.02 rows=1908 width=17) (actual time=31.331..1463.483 rows=1521 loops=3)
                                      ->  Nested Loop  (cost=2296.93..9525.18 rows=1908 width=4) (actual time=29.794..1369.323 rows=1521 loops=3)
                                            ->  Nested Loop  (cost=2296.64..8925.83 rows=1908 width=4) (actual time=28.704..1259.192 rows=1521 loops=3)
                                                  ->  Hash Join  (cost=2296.22..6557.62 rows=1908 width=4) (actual time=22.435..158.683 rows=1521 loops=3)
                                                        Hash Cond: (o.id = oi.order_id)
                                                        ->  Parallel Bitmap Heap Scan on "Order" o  (cost=1718.22..5722.03 rows=38161 width=4) (actual time=12.683..130.948 rows=30429 loops=3)
                                                              Recheck Cond: (order_date >= (now() - '3 mons'::interval))
                                                              Heap Blocks: exact=1181
                                                              ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..1695.32 rows=91586 width=0) (actual time=37.480..37.480 rows=91287 loops=1)
                                                                    Index Cond: (order_date >= (now() - '3 mons'::interval))
                                                        ->  Hash  (cost=328.00..328.00 rows=20000 width=8) (actual time=6.656..6.657 rows=20000 loops=3)
                                                              Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                                                              ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=8) (actual time=0.407..2.653 rows=20000 loops=3)
                                                  ->  Index Scan using "StockItem_pkey" on "StockItem" si  (cost=0.42..1.24 rows=1 width=8) (actual time=0.722..0.722 rows=1 loops=4563)
                                                        Index Cond: (id = oi.stock_item_id)
                                            ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.31 rows=1 width=8) (actual time=0.071..0.071 rows=1 loops=4563)
                                                  Index Cond: (id = si.variant_id)
                                      ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=21) (actual time=0.060..0.060 rows=1 loops=4563)
                                            Index Cond: (id = v.product_id)
                                ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.821..0.821 rows=150 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 18kB
                                      ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.035..0.053 rows=150 loops=3)
Planning Time: 96.254 ms
Execution Time: 1862.050 ms


==================================================
EXPLAIN ANALYZE — Query 4: Top 5 produktów z najwięcej recenzjami
==================================================
Limit  (cost=1792.59..1792.61 rows=5 width=25) (actual time=142.168..143.180 rows=5 loops=1)
  ->  Sort  (cost=1792.59..1842.59 rows=20000 width=25) (actual time=141.114..141.118 rows=5 loops=1)
        Sort Key: (COALESCE(r.count, '0'::bigint)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Hash Left Join  (cost=969.89..1460.40 rows=20000 width=25) (actual time=130.195..137.301 rows=20000 loops=1)
              Hash Cond: (p.id = r.product_id)
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.011..1.493 rows=20000 loops=1)
              ->  Hash  (cost=812.24..812.24 rows=12612 width=12) (actual time=130.172..130.173 rows=12612 loops=1)
                    Buckets: 16384  Batches: 1  Memory Usage: 670kB
                    ->  Subquery Scan on r  (cost=560.00..812.24 rows=12612 width=12) (actual time=123.286..127.006 rows=12612 loops=1)
                          ->  HashAggregate  (cost=560.00..686.12 rows=12612 width=12) (actual time=123.285..125.830 rows=12612 loops=1)
                                Group Key: "Review".product_id
                                Batches: 1  Memory Usage: 1425kB
                                ->  Seq Scan on "Review"  (cost=0.00..460.00 rows=20000 width=4) (actual time=1.908..116.292 rows=20000 loops=1)
Planning Time: 16.822 ms
Execution Time: 145.559 ms


==================================================
EXPLAIN ANALYZE — Query 5: Całkowity Przychód Pogrupowany Miesięcznie za Ostatni Rok
==================================================
Finalize GroupAggregate  (cost=9719.19..11975.47 rows=17309 width=36) (actual time=181.047..287.308 rows=11 loops=1)
  Group Key: ((date_trunc('month'::text, o.order_date))::date)
  ->  Gather Merge  (cost=9719.19..11564.38 rows=14424 width=36) (actual time=180.570..286.297 rows=33 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=8719.17..8899.47 rows=7212 width=36) (actual time=84.427..85.790 rows=11 loops=3)
              Group Key: ((date_trunc('month'::text, o.order_date))::date)
              ->  Sort  (cost=8719.17..8737.20 rows=7212 width=10) (actual time=82.835..83.387 rows=5760 loops=3)
                    Sort Key: ((date_trunc('month'::text, o.order_date))::date) DESC
                    Sort Method: quicksort  Memory: 864kB
                    Worker 0:  Sort Method: quicksort  Memory: 45kB
                    Worker 1:  Sort Method: quicksort  Memory: 89kB
                    ->  Hash Join  (cost=578.00..8257.02 rows=7212 width=10) (actual time=6.837..77.722 rows=5760 loops=3)
                          Hash Cond: (o.id = oi.order_id)
                          ->  Parallel Seq Scan on "Order" o  (cost=0.00..6669.33 rows=144241 width=12) (actual time=0.014..51.575 rows=115772 loops=3)
                                Filter: (order_date >= (date_trunc('year'::text, now()) - '00:00:00'::interval))
                                Rows Removed by Filter: 17562
                          ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=6.536..6.537 rows=20000 loops=3)
                                Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.027..2.651 rows=20000 loops=3)
Planning Time: 3.781 ms
Execution Time: 294.774 ms


==================================================
EXPLAIN ANALYZE — Query 6: Produkty najczęściej dodawane do ulubionych
==================================================
Limit  (cost=14382.58..14382.60 rows=10 width=25) (actual time=1070.334..1220.649 rows=10 loops=1)
  ->  Sort  (cost=14382.58..14432.58 rows=20000 width=25) (actual time=1070.327..1219.245 rows=10 loops=1)
        Sort Key: (count(f.id)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=13750.38..13950.38 rows=20000 width=25) (actual time=1058.698..1210.862 rows=20000 loops=1)
              Group Key: p.id
              Batches: 1  Memory Usage: 2577kB
              ->  Gather  (cost=9350.38..13550.38 rows=40000 width=25) (actual time=924.664..1133.487 rows=59996 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=8350.38..8550.38 rows=20000 width=25) (actual time=838.245..844.732 rows=19999 loops=3)
                          Group Key: p.id
                          Batches: 1  Memory Usage: 2577kB
                          Worker 0:  Batches: 1  Memory Usage: 2577kB
                          Worker 1:  Batches: 1  Memory Usage: 2577kB
                          ->  Hash Join  (cost=688.00..7100.38 rows=250000 width=21) (actual time=13.867..744.719 rows=200000 loops=3)
                                Hash Cond: (f.product_id = p.id)
                                ->  Parallel Seq Scan on "FavoriteProduct" f  (cost=0.00..5756.00 rows=250000 width=8) (actual time=5.835..646.143 rows=200000 loops=3)
                                ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=7.668..8.113 rows=20000 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1215kB
                                      ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.299..3.348 rows=20000 loops=3)
Planning Time: 39.580 ms
Execution Time: 1225.386 ms


==================================================
EXPLAIN ANALYZE — Query 7: Dostępny Stan Magazynowy Wariantów Produktu Pogrupowany po Magazynach
==================================================
GroupAggregate  (cost=37640.01..42664.89 rows=223328 width=61) (actual time=1381.697..1682.704 rows=178012 loops=1)
  Group Key: p.name, w.name, v.sku
  ->  Sort  (cost=37640.01..38198.33 rows=223328 width=57) (actual time=1381.669..1590.120 rows=223971 loops=1)
        Sort Key: p.name, w.name, v.sku
        Sort Method: external merge  Disk: 15248kB
        ->  Hash Join  (cost=2189.15..9398.65 rows=223328 width=57) (actual time=29.323..589.759 rows=223971 loops=1)
              Hash Cond: (si.warehouse_id = w.id)
              ->  Hash Join  (cost=2144.50..8766.15 rows=223328 width=44) (actual time=29.304..548.134 rows=223971 loops=1)
                    Hash Cond: (v.product_id = p.id)
                    ->  Hash Join  (cost=1456.50..7491.79 rows=223328 width=35) (actual time=22.497..459.094 rows=223971 loops=1)
                          Hash Cond: (si.variant_id = v.id)
                          ->  Seq Scan on "StockItem" si  (cost=0.00..5449.00 rows=223328 width=12) (actual time=0.015..332.023 rows=223971 loops=1)
                                Filter: (shipment_id IS NULL)
                                Rows Removed by Filter: 96029
                          ->  Hash  (cost=869.00..869.00 rows=47000 width=31) (actual time=22.460..23.523 rows=47000 loops=1)
                                Buckets: 65536  Batches: 1  Memory Usage: 3450kB
                                ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=31) (actual time=0.006..8.209 rows=47000 loops=1)
                    ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=6.797..6.798 rows=20000 loops=1)
                          Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                          ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.005..2.372 rows=20000 loops=1)
              ->  Hash  (cost=25.40..25.40 rows=1540 width=21) (actual time=0.014..0.015 rows=10 loops=1)
                    Buckets: 2048  Batches: 1  Memory Usage: 17kB
                    ->  Seq Scan on "Warehouse" w  (cost=0.00..25.40 rows=1540 width=21) (actual time=0.009..0.010 rows=10 loops=1)
Planning Time: 16.907 ms
Execution Time: 1703.200 ms


==================================================
EXPLAIN ANALYZE — Query 8: Stan magazynowy per produkt
==================================================
Sort  (cost=11494.90..11544.43 rows=19812 width=21) (actual time=300.622..302.234 rows=17916 loops=1)
  Sort Key: (count(si.id)) DESC
  Sort Method: quicksort  Memory: 1482kB
  ->  HashAggregate  (cost=9882.79..10080.91 rows=19812 width=21) (actual time=293.280..297.075 rows=17916 loops=1)
        Group Key: p.name
        Batches: 1  Memory Usage: 2065kB
        ->  Hash Join  (cost=2144.50..8766.15 rows=223328 width=17) (actual time=20.502..214.867 rows=223971 loops=1)
              Hash Cond: (v.product_id = p.id)
              ->  Hash Join  (cost=1456.50..7491.79 rows=223328 width=8) (actual time=12.636..138.627 rows=223971 loops=1)
                    Hash Cond: (si.variant_id = v.id)
                    ->  Seq Scan on "StockItem" si  (cost=0.00..5449.00 rows=223328 width=8) (actual time=0.018..39.149 rows=223971 loops=1)
                          Filter: (shipment_id IS NULL)
                          Rows Removed by Filter: 96029
                    ->  Hash  (cost=869.00..869.00 rows=47000 width=8) (actual time=12.596..12.598 rows=47000 loops=1)
                          Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                          ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=8) (actual time=0.005..5.225 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=7.853..7.853 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.019..3.503 rows=20000 loops=1)
Planning Time: 15.274 ms
Execution Time: 303.877 ms


==================================================
EXPLAIN ANALYZE — Query 9: Najpopularniejsze Kategorie (wg. Całkowitego Przychodu)
==================================================
Limit  (cost=12371.00..12371.02 rows=10 width=44) (actual time=1136.437..1286.393 rows=10 loops=1)
  ->  Sort  (cost=12371.00..12371.37 rows=150 width=44) (actual time=1135.629..1284.473 rows=10 loops=1)
        Sort Key: (sum(oi.unit_price)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize GroupAggregate  (cost=12328.63..12367.76 rows=150 width=44) (actual time=1134.453..1283.435 rows=150 loops=1)
              Group Key: c.name
              ->  Gather Merge  (cost=12328.63..12363.63 rows=300 width=44) (actual time=1126.445..1275.325 rows=150 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Sort  (cost=11328.61..11328.98 rows=150 width=44) (actual time=200.315..201.933 rows=50 loops=3)
                          Sort Key: c.name
                          Sort Method: quicksort  Memory: 39kB
                          Worker 0:  Sort Method: quicksort  Memory: 25kB
                          Worker 1:  Sort Method: quicksort  Memory: 25kB
                          ->  Partial HashAggregate  (cost=11321.31..11323.19 rows=150 width=44) (actual time=191.898..193.370 rows=50 loops=3)
                                Group Key: c.name
                                Batches: 1  Memory Usage: 96kB
                                Worker 0:  Batches: 1  Memory Usage: 40kB
                                Worker 1:  Batches: 1  Memory Usage: 40kB
                                ->  Hash Join  (cost=8362.48..11112.98 rows=41667 width=18) (actual time=68.941..179.443 rows=33334 loops=3)
                                      Hash Cond: (pc.category_id = c.id)
                                      ->  Parallel Hash Join  (cost=8357.10..10995.13 rows=41667 width=10) (actual time=54.089..157.853 rows=33334 loops=3)
                                            Hash Cond: (pc.product_id = p.id)
                                            ->  Parallel Index Only Scan using uq_prodcat_product_category on "ProductCategory" pc  (cost=0.29..2236.96 rows=41667 width=8) (actual time=8.499..284.567 rows=100000 loops=1)
                                                  Heap Fetches: 0
                                            ->  Parallel Hash  (cost=8209.75..8209.75 rows=11765 width=14) (actual time=47.699..48.248 rows=6667 loops=3)
                                                  Buckets: 32768  Batches: 1  Memory Usage: 1216kB
                                                  ->  Hash Join  (cost=2722.50..8209.75 rows=11765 width=14) (actual time=23.041..114.745 rows=20000 loops=1)
                                                        Hash Cond: (v.product_id = p.id)
                                                        ->  Hash Join  (cost=2034.50..7490.85 rows=11765 width=10) (actual time=18.055..101.656 rows=20000 loops=1)
                                                              Hash Cond: (si.variant_id = v.id)
                                                              ->  Hash Join  (cost=578.00..6003.47 rows=11765 width=10) (actual time=5.509..80.188 rows=20000 loops=1)
                                                                    Hash Cond: (si.id = oi.stock_item_id)
                                                                    ->  Parallel Seq Scan on "StockItem" si  (cost=0.00..4131.35 rows=188235 width=8) (actual time=0.005..23.547 rows=320000 loops=1)
                                                                    ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=5.485..6.111 rows=20000 loops=1)
                                                                          Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                                                          ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.010..2.335 rows=20000 loops=1)
                                                              ->  Hash  (cost=869.00..869.00 rows=47000 width=8) (actual time=12.526..12.527 rows=47000 loops=1)
                                                                    Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                                                    ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=8) (actual time=0.011..5.205 rows=47000 loops=1)
                                                        ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=4.973..4.973 rows=20000 loops=1)
                                                              Buckets: 32768  Batches: 1  Memory Usage: 960kB
                                                              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.037..2.148 rows=20000 loops=1)
                                      ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=13.653..13.654 rows=150 loops=3)
                                            Buckets: 1024  Batches: 1  Memory Usage: 16kB
                                            ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=11.706..11.729 rows=150 loops=3)
Planning Time: 22.199 ms
Execution Time: 1312.041 ms


==================================================
EXPLAIN ANALYZE — Query 10: Liczba produktów per kategoria
==================================================
Sort  (cost=2342.22..2342.59 rows=150 width=20) (actual time=225.946..225.956 rows=150 loops=1)
  Sort Key: (count(pc.product_id)) DESC
  Sort Method: quicksort  Memory: 30kB
  ->  HashAggregate  (cost=2335.30..2336.80 rows=150 width=20) (actual time=225.854..225.882 rows=150 loops=1)
        Group Key: c.name
        Batches: 1  Memory Usage: 48kB
        ->  Hash Right Join  (cost=5.38..1835.30 rows=100000 width=16) (actual time=1.927..204.810 rows=100000 loops=1)
              Hash Cond: (pc.category_id = c.id)
              ->  Seq Scan on "ProductCategory" pc  (cost=0.00..1560.00 rows=100000 width=8) (actual time=1.226..181.784 rows=100000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=0.070..0.071 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 16kB
                    ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=0.022..0.043 rows=150 loops=1)
Planning Time: 0.785 ms
Execution Time: 226.628 ms


==================================================
EXPLAIN ANALYZE — Query 11: Liczba zamówień per metoda płatności
==================================================
Sort  (cost=7808.47..7808.49 rows=6 width=50) (actual time=136.286..204.311 rows=6 loops=1)
  Sort Key: (sum(oi.unit_price)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  Finalize GroupAggregate  (cost=7806.80..7808.40 rows=6 width=50) (actual time=134.866..202.902 rows=6 loops=1)
        Group Key: pm.name
        ->  Gather Merge  (cost=7806.80..7808.20 rows=12 width=50) (actual time=134.851..202.880 rows=18 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Sort  (cost=6806.78..6806.79 rows=6 width=50) (actual time=61.789..61.793 rows=6 loops=3)
                    Sort Key: pm.name
                    Sort Method: quicksort  Memory: 25kB
                    Worker 0:  Sort Method: quicksort  Memory: 25kB
                    Worker 1:  Sort Method: quicksort  Memory: 25kB
                    ->  Partial HashAggregate  (cost=6806.62..6806.70 rows=6 width=50) (actual time=58.119..58.124 rows=6 loops=3)
                          Group Key: pm.name
                          Batches: 1  Memory Usage: 24kB
                          Worker 0:  Batches: 1  Memory Usage: 24kB
                          Worker 1:  Batches: 1  Memory Usage: 24kB
                          ->  Hash Join  (cost=579.13..6744.13 rows=8333 width=20) (actual time=14.015..56.142 rows=6667 loops=3)
                                Hash Cond: (o.payment_method_id = pm.id)
                                ->  Hash Join  (cost=578.00..6705.67 rows=8333 width=14) (actual time=13.188..53.979 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.003..16.225 rows=133333 loops=3)
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=12.918..12.918 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.014..5.742 rows=20000 loops=3)
                                ->  Hash  (cost=1.06..1.06 rows=6 width=14) (actual time=0.198..0.199 rows=6 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                      ->  Seq Scan on "PaymentMethod" pm  (cost=0.00..1.06 rows=6 width=14) (actual time=0.026..0.028 rows=6 loops=3)
Planning Time: 12.651 ms
Execution Time: 206.288 ms


==================================================
EXPLAIN ANALYZE — Query 12: Średnia ocena per producent
==================================================
Sort  (cost=1367.54..1367.91 rows=150 width=57) (actual time=36.318..36.329 rows=150 loops=1)
  Sort Key: (round(avg(r.rating), 2)) DESC NULLS LAST
  Sort Method: quicksort  Memory: 32kB
  ->  HashAggregate  (cost=1359.87..1362.12 rows=150 width=57) (actual time=34.802..34.872 rows=150 loops=1)
        Group Key: m.name
        Batches: 1  Memory Usage: 64kB
        ->  Hash Join  (cost=693.38..1259.87 rows=20000 width=29) (actual time=8.471..26.987 rows=27388 loops=1)
              Hash Cond: (p.manufacturer_id = m.id)
              ->  Hash Right Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=6.462..19.606 rows=27388 loops=1)
                    Hash Cond: (r.product_id = p.id)
                    ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=0.012..3.428 rows=20000 loops=1)
                    ->  Hash  (cost=438.00..438.00 rows=20000 width=8) (actual time=6.435..6.436 rows=20000 loops=1)
                          Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                          ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=8) (actual time=0.006..2.335 rows=20000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=1.286..1.287 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 18kB
                    ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=1.243..1.259 rows=150 loops=1)
Planning Time: 28.757 ms
Execution Time: 37.659 ms


==================================================
EXPLAIN ANALYZE — Query 13: Aktywne promocje i objęta nimi liczba wariantów
==================================================
Sort  (cost=395.64..395.76 rows=47 width=14) (actual time=5.023..5.026 rows=46 loops=1)
  Sort Key: (count(v.id)) DESC
  Sort Method: quicksort  Memory: 26kB
  ->  HashAggregate  (cost=393.87..394.34 rows=47 width=14) (actual time=5.001..5.009 rows=46 loops=1)
        Group Key: pr.name
        Batches: 1  Memory Usage: 24kB
        ->  Merge Join  (cost=7.63..337.47 rows=11280 width=10) (actual time=0.066..4.689 rows=1340 loops=1)
              Merge Cond: (v.promotion_id = pr.id)
              ->  Index Scan using idx_variant_promotion on "Variant" v  (cost=0.29..2469.28 rows=47000 width=8) (actual time=0.013..3.823 rows=5685 loops=1)
              ->  Sort  (cost=7.34..7.46 rows=48 width=10) (actual time=0.048..0.053 rows=47 loops=1)
                    Sort Key: pr.id
                    Sort Method: quicksort  Memory: 26kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=48 width=10) (actual time=0.014..0.038 rows=47 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 153
Planning Time: 13.783 ms
Execution Time: 5.106 ms


==================================================
EXPLAIN ANALYZE — Query 14: Najczęściej wybierane warianty w koszykach
==================================================
Limit  (cost=224158.84..224158.87 rows=10 width=44) (actual time=8545.682..8545.690 rows=10 loops=1)
  ->  Sort  (cost=224158.84..227908.84 rows=1500000 width=44) (actual time=8545.037..8545.039 rows=10 loops=1)
        Sort Key: (sum(ci.quantity)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  GroupAggregate  (cost=4.24..191744.38 rows=1500000 width=44) (actual time=111.359..8534.694 rows=47000 loops=1)
              Group Key: v.sku, p.name
              ->  Incremental Sort  (cost=4.24..165494.38 rows=1500000 width=40) (actual time=51.198..8235.298 rows=1500000 loops=1)
                    Sort Key: v.sku, p.name
                    Presorted Key: v.sku
                    Full-sort Groups: 31708  Sort Method: quicksort  Average Memory: 27kB  Peak Memory: 27kB
                    Pre-sorted Groups: 6442  Sort Method: quicksort  Average Memory: 26kB  Peak Memory: 26kB
                    ->  Nested Loop  (cost=1.14..108333.20 rows=1500000 width=40) (actual time=7.200..7748.930 rows=1500000 loops=1)
                          ->  Nested Loop  (cost=0.71..8804.70 rows=47000 width=40) (actual time=5.360..184.815 rows=47000 loops=1)
                                ->  Index Scan using "Variant_sku_key" on "Variant" v  (cost=0.41..2051.42 rows=47000 width=31) (actual time=4.687..38.230 rows=47000 loops=1)
                                ->  Memoize  (cost=0.30..0.34 rows=1 width=17) (actual time=0.003..0.003 rows=1 loops=47000)
                                      Cache Key: v.product_id
                                      Cache Mode: logical
                                      Hits: 28889  Misses: 18111  Evictions: 0  Overflows: 0  Memory Usage: 2099kB
                                      ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=17) (actual time=0.003..0.003 rows=1 loops=18111)
                                            Index Cond: (id = v.product_id)
                          ->  Index Scan using idx_cartitem_variant_id on "CartItem" ci  (cost=0.43..1.80 rows=32 width=8) (actual time=0.008..0.156 rows=32 loops=47000)
                                Index Cond: (variant_id = v.id)
Planning Time: 16.324 ms
Execution Time: 8547.286 ms


==================================================
EXPLAIN ANALYZE — Query 15: Produkty z Największą Różnicą Między Ceną Podstawową a Ceną Wariantu
==================================================
Limit  (cost=2813.55..2813.58 rows=10 width=80) (actual time=48.612..48.616 rows=10 loops=1)
  ->  Sort  (cost=2813.55..2931.05 rows=47000 width=80) (actual time=48.610..48.613 rows=10 loops=1)
        Sort Key: v.price_modifier DESC
        Sort Method: top-N heapsort  Memory: 27kB
        ->  Hash Join  (cost=688.00..1797.90 rows=47000 width=80) (actual time=7.829..34.305 rows=47000 loops=1)
              Hash Cond: (v.product_id = p.id)
              ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=33) (actual time=1.483..4.862 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=6.327..6.328 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1381kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.009..2.663 rows=20000 loops=1)
Planning Time: 25.590 ms
Execution Time: 50.999 ms


==================================================
EXPLAIN ANALYZE — Query 16: Konwersja zamówień wg statusu
==================================================
Sort  (cost=7957.56..7962.66 rows=2040 width=48) (actual time=702.610..790.976 rows=7 loops=1)
  Sort Key: (count(o.id)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  WindowAgg  (cost=7824.99..7845.41 rows=2040 width=48) (actual time=697.853..785.215 rows=7 loops=1)
        ->  Finalize HashAggregate  (cost=7779.11..7799.51 rows=2040 width=16) (actual time=689.835..777.205 rows=7 loops=1)
              Group Key: s.name
              Batches: 1  Memory Usage: 121kB
              ->  Gather  (cost=7330.31..7758.71 rows=4080 width=16) (actual time=258.047..773.620 rows=7 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=6330.31..6350.71 rows=2040 width=16) (actual time=71.184..71.197 rows=2 loops=3)
                          Group Key: s.name
                          Batches: 1  Memory Usage: 121kB
                          Worker 0:  Batches: 1  Memory Usage: 121kB
                          Worker 1:  Batches: 1  Memory Usage: 121kB
                          ->  Hash Join  (cost=55.90..5496.98 rows=166667 width=12) (actual time=3.480..42.098 rows=133333 loops=3)
                                Hash Cond: (o.status_id = s.id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=1.893..11.581 rows=133333 loops=3)
                                ->  Hash  (cost=30.40..30.40 rows=2040 width=12) (actual time=1.865..1.880 rows=7 loops=1)
                                      Buckets: 2048  Batches: 1  Memory Usage: 17kB
                                      ->  Seq Scan on "Status" s  (cost=0.00..30.40 rows=2040 width=12) (actual time=0.762..0.765 rows=7 loops=1)
Planning Time: 75.663 ms
Execution Time: 812.592 ms


==================================================
EXPLAIN ANALYZE — Query 17: Top klienci wg wydatków
==================================================
Limit  (cost=15399.41..15399.44 rows=10 width=50) (actual time=3967.911..3972.734 rows=10 loops=1)
  ->  Sort  (cost=15399.41..15449.41 rows=20000 width=50) (actual time=3967.910..3972.731 rows=10 loops=1)
        Sort Key: (sum(oi.unit_price)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=14717.22..14967.22 rows=20000 width=50) (actual time=3951.657..3965.520 rows=19296 loops=1)
              Group Key: u.id
              Batches: 5  Memory Usage: 8241kB  Disk Usage: 224kB
              ->  Gather  (cost=12821.46..14592.22 rows=16666 width=50) (actual time=3418.907..3594.201 rows=19431 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=11821.46..11925.62 rows=8333 width=50) (actual time=3318.723..3401.523 rows=6477 loops=3)
                          Group Key: u.id
                          Batches: 1  Memory Usage: 3217kB
                          Worker 0:  Batches: 1  Memory Usage: 2961kB
                          Worker 1:  Batches: 1  Memory Usage: 2961kB
                          ->  Nested Loop  (cost=578.42..11779.80 rows=8333 width=24) (actual time=9.147..3267.573 rows=6667 loops=3)
                                ->  Hash Join  (cost=578.00..6705.67 rows=8333 width=10) (actual time=6.673..273.268 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.008..196.013 rows=133333 loops=3)
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=6.394..7.044 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.028..2.375 rows=20000 loops=3)
                                ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.447..0.447 rows=1 loops=20000)
                                      Index Cond: (id = o.user_id)
Planning Time: 25.606 ms
Execution Time: 3989.569 ms


==================================================
EXPLAIN ANALYZE — Query 18: Produkty z wariantami objętymi promocją, z końcową ceną
==================================================
Sort  (cost=1983.52..2011.72 rows=11280 width=132) (actual time=45.121..46.215 rows=1340 loops=1)
  Sort Key: (round(((p.price + v.price_modifier) * ('1'::numeric - pr.discount_percentage)), 2))
  Sort Method: quicksort  Memory: 146kB
  ->  Hash Join  (cost=695.63..1224.29 rows=11280 width=132) (actual time=23.712..42.645 rows=1340 loops=1)
        Hash Cond: (v.product_id = p.id)
        ->  Merge Join  (cost=7.63..337.47 rows=11280 width=39) (actual time=2.892..20.271 rows=1340 loops=1)
              Merge Cond: (v.promotion_id = pr.id)
              ->  Index Scan using idx_variant_promotion on "Variant" v  (cost=0.29..2469.28 rows=47000 width=37) (actual time=0.019..16.529 rows=5685 loops=1)
              ->  Sort  (cost=7.34..7.46 rows=48 width=10) (actual time=2.868..2.878 rows=47 loops=1)
                    Sort Key: pr.id
                    Sort Method: quicksort  Memory: 26kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=48 width=10) (actual time=2.268..2.292 rows=47 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 153
        ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=19.483..19.484 rows=20000 loops=1)
              Buckets: 32768  Batches: 1  Memory Usage: 1381kB
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.008..14.099 rows=20000 loops=1)
Planning Time: 53.675 ms
Execution Time: 61.031 ms


==================================================
EXPLAIN ANALYZE — Query 19: Użytkownicy, Którzy Dodali Produkt do Koszyka, Ale Nie Złożyli Zamówienia (Potencjał Odbudowy Koszyka)
==================================================
Hash Join  (cost=45873.97..103632.31 rows=1070130 width=55) (actual time=3209.456..9863.097 rows=1005006 loops=1)
  Hash Cond: (v.product_id = p.id)
  ->  Hash Join  (cost=45185.97..100134.62 rows=1070130 width=46) (actual time=3199.872..9258.740 rows=1005006 loops=1)
        Hash Cond: (ci.variant_id = v.id)
        ->  Hash Join  (cost=43729.47..95868.77 rows=1070130 width=46) (actual time=3184.329..8465.611 rows=1005006 loops=1)
              Hash Cond: (ci.cart_id = c.id)
              ->  Seq Scan on "CartItem" ci  (cost=0.00..23152.00 rows=1500000 width=8) (actual time=0.035..4076.583 rows=1500000 loops=1)
              ->  Hash  (cost=41450.81..41450.81 rows=107013 width=46) (actual time=3173.218..3191.719 rows=100414 loops=1)
                    Buckets: 131072  Batches: 2  Memory Usage: 4929kB
                    ->  Gather  (cost=25017.67..41450.81 rows=107013 width=46) (actual time=2816.522..2892.605 rows=100414 loops=1)
                          Workers Planned: 2
                          Workers Launched: 2
                          ->  Parallel Hash Right Anti Join  (cost=24017.67..29749.51 rows=44589 width=46) (actual time=2295.597..2311.822 rows=33471 loops=3)
                                Hash Cond: (o.user_id = u.id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=4) (actual time=14.828..466.630 rows=133333 loops=3)
                                ->  Parallel Hash  (cost=23236.42..23236.42 rows=62500 width=50) (actual time=1664.047..1664.567 rows=50000 loops=3)
                                      Buckets: 262144  Batches: 1  Memory Usage: 14720kB
                                      ->  Hash Join  (cost=4079.00..23236.42 rows=62500 width=50) (actual time=164.967..1469.483 rows=50000 loops=3)
                                            Hash Cond: (u.id = c.user_id)
                                            ->  Parallel Seq Scan on "User" u  (cost=0.00..18063.67 rows=416667 width=46) (actual time=5.840..1064.780 rows=333333 loops=3)
                                            ->  Hash  (cost=2204.00..2204.00 rows=150000 width=8) (actual time=140.447..140.452 rows=150000 loops=3)
                                                  Buckets: 262144  Batches: 1  Memory Usage: 7908kB
                                                  ->  Seq Scan on "Cart" c  (cost=0.00..2204.00 rows=150000 width=8) (actual time=24.671..76.296 rows=150000 loops=3)
        ->  Hash  (cost=869.00..869.00 rows=47000 width=8) (actual time=13.280..13.281 rows=47000 loops=1)
              Buckets: 65536  Batches: 1  Memory Usage: 2348kB
              ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=8) (actual time=0.015..5.159 rows=47000 loops=1)
  ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=7.383..7.384 rows=20000 loops=1)
        Buckets: 32768  Batches: 1  Memory Usage: 1245kB
        ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=1.773..4.129 rows=20000 loops=1)
Planning Time: 138.303 ms
Execution Time: 9971.295 ms


==================================================
EXPLAIN ANALYZE — Query 20: Wyszukiwanie produktów po nazwie lub opisie (parametryzowane)
==================================================
Bitmap Heap Scan on "Product"  (cost=43.00..57.51 rows=4 width=60) (actual time=6.687..37.154 rows=143 loops=1)
  Recheck Cond: (((name)::text ~~* '%test%'::text) OR (description ~~* '%test%'::text))
  Heap Blocks: exact=106
  ->  BitmapOr  (cost=43.00..43.00 rows=4 width=0) (actual time=6.661..6.662 rows=0 loops=1)
        ->  Bitmap Index Scan on idx_product_name_trgm  (cost=0.00..21.50 rows=2 width=0) (actual time=2.285..2.285 rows=42 loops=1)
              Index Cond: ((name)::text ~~* '%test%'::text)
        ->  Bitmap Index Scan on idx_product_description_trgm  (cost=0.00..21.50 rows=2 width=0) (actual time=4.371..4.371 rows=102 loops=1)
              Index Cond: (description ~~* '%test%'::text)
Planning Time: 70.539 ms
Execution Time: 39.963 ms


==================================================
EXPLAIN ANALYZE — Query 21: Użytkownicy, Którzy Zapisali Konkretny Produkt jako Ulubiony (np. Product ID=350259)
==================================================
Nested Loop  (cost=0.85..262.23 rows=30 width=56) (actual time=4.095..22.221 rows=26 loops=1)
  ->  Index Only Scan using idx_favoriteproduct_product_user on "FavoriteProduct" fp  (cost=0.42..8.95 rows=30 width=4) (actual time=3.628..3.642 rows=26 loops=1)
        Index Cond: (product_id = 35)
        Heap Fetches: 0
  ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..8.44 rows=1 width=60) (actual time=0.713..0.713 rows=1 loops=26)
        Index Cond: (id = fp.user_id)
Planning Time: 16.092 ms
Execution Time: 22.275 ms


==================================================
EXPLAIN ANALYZE — Query 22: Znajdź Magazyny, Które Posiadają Zapasy Konkretnego Wariantu (np. SKU='VR-000000-a637d44b7afd')
==================================================
GroupAggregate  (cost=24.91..25.01 rows=2 width=25) (actual time=3.542..3.544 rows=0 loops=1)
  Group Key: w.name
  Filter: (count(si.id) > 0)
  ->  Sort  (cost=24.91..24.93 rows=5 width=21) (actual time=3.540..3.541 rows=0 loops=1)
        Sort Key: w.name
        Sort Method: quicksort  Memory: 25kB
        ->  Nested Loop  (cost=0.99..24.86 rows=5 width=21) (actual time=2.469..2.470 rows=0 loops=1)
              ->  Nested Loop  (cost=0.84..24.00 rows=5 width=8) (actual time=2.468..2.469 rows=0 loops=1)
                    ->  Index Scan using "Variant_sku_key" on "Variant" v  (cost=0.41..8.43 rows=1 width=4) (actual time=2.467..2.468 rows=0 loops=1)
                          Index Cond: ((sku)::text = 'VR-000001-2704de10f283'::text)
                    ->  Index Scan using idx_stockitem_shipment_variant_warehouse on "StockItem" si  (cost=0.42..15.52 rows=5 width=12) (never executed)
                          Index Cond: ((shipment_id IS NULL) AND (variant_id = v.id))
              ->  Index Scan using "Warehouse_pkey" on "Warehouse" w  (cost=0.15..0.17 rows=1 width=21) (never executed)
                    Index Cond: (id = si.warehouse_id)
Planning Time: 12.980 ms
Execution Time: 5.263 ms


==================================================
EXPLAIN ANALYZE — Query 23: Warianty, Które Wymagają Uzyskania Konkretnej Opcji (np. 'Kolor'='Czerwony')
==================================================
Nested Loop  (cost=6.96..680.20 rows=1 width=36) (actual time=0.026..0.027 rows=0 loops=1)
  ->  Nested Loop  (cost=6.67..679.87 rows=1 width=27) (actual time=0.025..0.026 rows=0 loops=1)
        ->  Nested Loop  (cost=6.38..679.55 rows=1 width=4) (actual time=0.025..0.026 rows=0 loops=1)
              Join Filter: (opt.attribute_id = a.id)
              ->  Index Scan using "Attribute_name_key" on "Attribute" a  (cost=0.15..8.17 rows=1 width=4) (actual time=0.025..0.025 rows=0 loops=1)
                    Index Cond: ((name)::text = 'Attr_49_Century'::text)
              ->  Nested Loop  (cost=6.23..668.26 rows=250 width=8) (never executed)
                    ->  Seq Scan on "Option" opt  (cost=0.00..18.50 rows=1 width=8) (never executed)
                          Filter: ((value)::text = 'do'::text)
                    ->  Bitmap Heap Scan on "VariantOption" vo  (cost=6.23..647.26 rows=250 width=8) (never executed)
                          Recheck Cond: (option_id = opt.id)
                          ->  Bitmap Index Scan on idx_variantoption_option_id  (cost=0.00..6.17 rows=250 width=0) (never executed)
                                Index Cond: (option_id = opt.id)
        ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.32 rows=1 width=31) (never executed)
              Index Cond: (id = vo.variant_id)
  ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=17) (never executed)
        Index Cond: (id = v.product_id)
Planning Time: 40.259 ms
Execution Time: 0.074 ms


==================================================
EXPLAIN ANALYZE — Query 24: Znajdź Zamówienia Użytkownika (np. email='debbie.lane.16786.50af0753@example.com') o Statusie 'Paid'
==================================================
Nested Loop  (cost=1.00..17.09 rows=1 width=20) (actual time=3.045..3.046 rows=0 loops=1)
  ->  Nested Loop  (cost=0.85..16.89 rows=1 width=16) (actual time=3.044..3.045 rows=0 loops=1)
        ->  Index Scan using "User_email_key" on "User" u  (cost=0.42..8.44 rows=1 width=4) (actual time=3.044..3.044 rows=0 loops=1)
              Index Cond: ((email)::text = 'debbie.lane.16786.50af0753@example.com'::text)
        ->  Index Scan using idx_order_user_id on "Order" o  (cost=0.42..8.44 rows=1 width=20) (never executed)
              Index Cond: (user_id = u.id)
  ->  Index Scan using "Status_pkey" on "Status" s  (cost=0.15..0.17 rows=1 width=12) (never executed)
        Index Cond: (id = o.status_id)
        Filter: ((name)::text = 'Paid'::text)
Planning Time: 7.991 ms
Execution Time: 3.087 ms


==================================================
EXPLAIN ANALYZE — Query 25: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
Nested Loop Left Join  (cost=5.45..49.87 rows=16 width=87) (actual time=1.957..4.591 rows=18 loops=1)
  ->  Nested Loop Left Join  (cost=5.30..46.34 rows=16 width=45) (actual time=1.929..4.534 rows=18 loops=1)
        ->  Nested Loop Left Join  (cost=5.02..41.66 rows=16 width=39) (actual time=0.741..3.274 rows=18 loops=1)
              ->  Nested Loop  (cost=4.60..23.91 rows=3 width=39) (actual time=0.038..0.061 rows=4 loops=1)
                    ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..8.30 rows=1 width=10) (actual time=0.008..0.009 rows=1 loops=1)
                          Index Cond: (id = 35)
                    ->  Bitmap Heap Scan on "Variant" v  (cost=4.31..15.57 rows=3 width=37) (actual time=0.026..0.047 rows=4 loops=1)
                          Recheck Cond: (product_id = 35)
                          Heap Blocks: exact=4
                          ->  Bitmap Index Scan on idx_variant_product_id  (cost=0.00..4.31 rows=3 width=0) (actual time=0.006..0.006 rows=4 loops=1)
                                Index Cond: (product_id = 35)
              ->  Index Only Scan using uq_varopt_variant_option on "VariantOption" vo  (cost=0.42..5.86 rows=6 width=8) (actual time=0.800..0.801 rows=4 loops=4)
                    Index Cond: (variant_id = v.id)
                    Heap Fetches: 0
        ->  Index Scan using "Option_pkey" on "Option" opt  (cost=0.28..0.29 rows=1 width=14) (actual time=0.069..0.069 rows=1 loops=18)
              Index Cond: (id = vo.option_id)
  ->  Index Scan using "Attribute_pkey" on "Attribute" a  (cost=0.15..0.22 rows=1 width=18) (actual time=0.001..0.001 rows=1 loops=18)
        Index Cond: (id = opt.attribute_id)
Planning Time: 0.612 ms
Execution Time: 4.644 ms


==================================================
EXPLAIN ANALYZE — Query 26: Lista Wszystkich Dziecięcych Kategorii (Podkategorii) dla Konkretnej Kategorii Nadrzędnej (np. ID=5)
==================================================
Seq Scan on "Category"  (cost=0.00..3.88 rows=3 width=12) (actual time=0.643..0.655 rows=3 loops=1)
  Filter: (parent_id = 5)
  Rows Removed by Filter: 147
Planning Time: 1.316 ms
Execution Time: 0.674 ms


==================================================
EXPLAIN ANALYZE — Query 27: Porównanie Średniej Oceny dla Promowanych i Niepromowanych Produktów
==================================================
HashAggregate  (cost=87850.51..87853.01 rows=200 width=64) (actual time=128.987..128.991 rows=2 loops=1)
  Group Key: CASE WHEN (ANY (p.id = (hashed SubPlan 2).col1)) THEN 'Promowany'::text ELSE 'Niepromowany'::text END
  Batches: 1  Memory Usage: 40kB
  ->  HashAggregate  (cost=1300.51..87550.51 rows=20000 width=68) (actual time=119.288..126.050 rows=12612 loops=1)
        Group Key: p.id
        Batches: 1  Memory Usage: 2577kB
        ->  Hash Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=58.361..104.377 rows=20000 loops=1)
              Hash Cond: (r.product_id = p.id)
              ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=1.404..39.100 rows=20000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=54.940..54.941 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 960kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.018..50.381 rows=20000 loops=1)
        SubPlan 2
          ->  Index Only Scan using idx_variant_product_promotion on "Variant" v2  (cost=0.28..158.09 rows=5739 width=4) (actual time=2.447..5.169 rows=5684 loops=1)
                Heap Fetches: 0
Planning Time: 3.702 ms
Execution Time: 131.533 ms


==================================================
EXPLAIN ANALYZE — Query 28: Top 5 Miast Generujących Największy Przychód (Wg. Adresu Wysyłki)
==================================================
Limit  (cost=15315.16..15315.17 rows=5 width=45) (actual time=4184.485..4221.801 rows=5 loops=1)
  ->  Sort  (cost=15315.16..15365.16 rows=20000 width=45) (actual time=4184.477..4221.788 rows=5 loops=1)
        Sort Key: (sum(oi.unit_price)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=14732.97..14982.97 rows=20000 width=45) (actual time=4175.354..4218.098 rows=12950 loops=1)
              Group Key: a.city
              Batches: 1  Memory Usage: 5905kB
              ->  Gather  (cost=12837.21..14607.97 rows=16666 width=45) (actual time=4004.279..4071.541 rows=16089 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=11837.21..11941.37 rows=8333 width=45) (actual time=3963.961..3980.534 rows=5363 loops=3)
                          Group Key: a.city
                          Batches: 1  Memory Usage: 2449kB
                          Worker 0:  Batches: 1  Memory Usage: 2449kB
                          Worker 1:  Batches: 1  Memory Usage: 2449kB
                          ->  Nested Loop  (cost=578.43..11795.55 rows=8333 width=19) (actual time=37.734..3892.903 rows=6667 loops=3)
                                ->  Hash Join  (cost=578.00..6705.67 rows=8333 width=10) (actual time=34.607..290.764 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.190..159.268 rows=133333 loops=3)
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=33.087..33.326 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.366..28.506 rows=20000 loops=3)
                                ->  Index Scan using "Address_pkey" on "Address" a  (cost=0.43..0.61 rows=1 width=17) (actual time=0.536..0.536 rows=1 loops=20000)
                                      Index Cond: (id = o.shipping_address_id)
Planning Time: 21.536 ms
Execution Time: 4229.472 ms


==================================================
EXPLAIN ANALYZE — Query 29: Porównanie Wolumenu Sprzedaży Produktów Promowanych vs. Niepromowanych (w Ostatnich 30 Dniach)
==================================================
Finalize GroupAggregate  (cost=6359.42..6415.22 rows=200 width=40) (actual time=787.665..951.232 rows=2 loops=1)
  Group Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
  ->  Gather Merge  (cost=6359.42..6411.22 rows=400 width=40) (actual time=779.575..946.870 rows=6 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=5359.40..5365.03 rows=200 width=40) (actual time=602.708..604.169 rows=2 loops=3)
              Group Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
              ->  Sort  (cost=5359.40..5360.61 rows=484 width=32) (actual time=598.806..599.050 rows=393 loops=3)
                    Sort Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
                    Sort Method: quicksort  Memory: 25kB
                    Worker 0:  Sort Method: quicksort  Memory: 25kB
                    Worker 1:  Sort Method: quicksort  Memory: 25kB
                    ->  Nested Loop  (cost=1015.11..5337.82 rows=484 width=32) (actual time=20.862..575.000 rows=393 loops=3)
                          ->  Nested Loop  (cost=1014.82..5185.78 rows=484 width=4) (actual time=19.347..507.868 rows=393 loops=3)
                                ->  Hash Join  (cost=1014.40..4585.04 rows=484 width=4) (actual time=11.853..36.321 rows=393 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Bitmap Heap Scan on "Order" o  (cost=436.40..3941.73 rows=9676 width=4) (actual time=4.842..26.211 rows=7842 loops=3)
                                            Recheck Cond: (order_date >= (now() - '30 days'::interval))
                                            Heap Blocks: exact=1329
                                            ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..430.59 rows=23222 width=0) (actual time=10.334..10.334 rows=23526 loops=1)
                                                  Index Cond: (order_date >= (now() - '30 days'::interval))
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=8) (actual time=6.235..6.238 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=8) (actual time=0.041..2.342 rows=20000 loops=3)
                                ->  Index Scan using "StockItem_pkey" on "StockItem" si  (cost=0.42..1.24 rows=1 width=8) (actual time=1.198..1.198 rows=1 loops=1179)
                                      Index Cond: (id = oi.stock_item_id)
                          ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.31 rows=1 width=8) (actual time=0.168..0.168 rows=1 loops=1179)
                                Index Cond: (id = si.variant_id)
Planning Time: 32.971 ms
Execution Time: 960.327 ms


==================================================
EXPLAIN ANALYZE — Query 30: Wskaźnik Lojalności (Repeat Purchase Rate) Użytkowników z Podziałem na Miasto Adresu Rozliczeniowego
==================================================
Sort  (cost=68134.41..68209.82 rows=30162 width=61) (actual time=6329.610..6350.510 rows=66456 loops=1)
  Sort Key: (round((((count(*) FILTER (WHERE (u.orders_count > 1)))::numeric * 100.0) / (NULLIF(count(*), 0))::numeric), 2)) DESC
  Sort Method: external merge  Disk: 3192kB
  ->  Finalize HashAggregate  (cost=65136.24..65890.29 rows=30162 width=61) (actual time=6155.245..6222.808 rows=66456 loops=1)
        Group Key: a.city
        Batches: 5  Memory Usage: 8241kB  Disk Usage: 712kB
        ->  Gather  (cost=58349.79..64683.81 rows=60324 width=29) (actual time=5665.199..5756.011 rows=121598 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial HashAggregate  (cost=57349.79..57651.41 rows=30162 width=29) (actual time=3467.911..3482.478 rows=40533 loops=3)
                    Group Key: a.city
                    Batches: 1  Memory Usage: 5649kB
                    Worker 0:  Batches: 1  Memory Usage: 4881kB
                    Worker 1:  Batches: 1  Memory Usage: 4881kB
                    ->  Parallel Hash Join  (cost=34825.67..55683.12 rows=166667 width=21) (actual time=544.493..2824.718 rows=133333 loops=3)
                          Hash Cond: (a.id = o.billing_address_id)
                          ->  Parallel Seq Scan on "Address" a  (cost=0.00..18288.00 rows=500000 width=17) (actual time=11.871..1470.352 rows=400000 loops=3)
                          ->  Parallel Hash  (cost=32742.34..32742.34 rows=166667 width=12) (actual time=524.996..526.196 rows=133333 loops=3)
                                Buckets: 524288  Batches: 1  Memory Usage: 22880kB
                                ->  Hash Join  (cost=24598.16..32742.34 rows=166667 width=12) (actual time=508.765..1278.800 rows=400000 loops=1)
                                      Hash Cond: (o.user_id = u.user_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=4.692..144.083 rows=400000 loops=1)
                                      ->  Hash  (cost=19615.94..19615.94 rows=286577 width=12) (actual time=500.363..500.987 rows=329619 loops=1)
                                            Buckets: 262144  Batches: 4  Memory Usage: 5596kB
                                            ->  Subquery Scan on u  (cost=0.42..19615.94 rows=286577 width=12) (actual time=12.358..409.349 rows=329619 loops=1)
                                                  ->  GroupAggregate  (cost=0.42..16750.17 rows=286577 width=12) (actual time=11.482..376.937 rows=329619 loops=1)
                                                        Group Key: "Order".user_id
                                                        ->  Index Only Scan using idx_order_user_id on "Order"  (cost=0.42..11884.40 rows=400000 width=4) (actual time=6.103..283.449 rows=400000 loops=1)
                                                              Heap Fetches: 50080
Planning Time: 14.338 ms
Execution Time: 6418.556 ms

FINISHED — 2025-11-22 17:14:31.617240
========================================================================================================================
========================================================================================================================
START EXPLAIN RUN — 2025-11-22 17:21:30.233418
========================================================================================================================


==================================================
EXPLAIN ANALYZE — Query 1: Średnia Wartość Zamówienia (AOV) w Ostatnim Miesiącu
==================================================
Aggregate  (cost=4939.45..4939.46 rows=1 width=32) (actual time=882.244..882.246 rows=1 loops=1)
  ->  HashAggregate  (cost=4909.05..4924.25 rows=1216 width=36) (actual time=881.730..882.139 rows=1213 loops=1)
        Group Key: o.id
        Batches: 1  Memory Usage: 577kB
        ->  Hash Join  (cost=4522.47..4902.97 rows=1216 width=10) (actual time=855.881..880.435 rows=1241 loops=1)
              Hash Cond: (oi.order_id = o.id)
              ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.016..10.833 rows=20000 loops=1)
              ->  Hash  (cost=4218.48..4218.48 rows=24319 width=4) (actual time=855.763..855.764 rows=24619 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1122kB
                    ->  Bitmap Heap Scan on "Order" o  (cost=456.90..4218.48 rows=24319 width=4) (actual time=34.484..848.472 rows=24619 loops=1)
                          Recheck Cond: (order_date >= (now() - '1 mon'::interval))
                          Heap Blocks: exact=3333
                          ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..450.82 rows=24319 width=0) (actual time=33.168..33.168 rows=24619 loops=1)
                                Index Cond: (order_date >= (now() - '1 mon'::interval))
Planning Time: 34.518 ms
Execution Time: 883.098 ms


==================================================
EXPLAIN ANALYZE — Query 2: Średnia wartość zamówienia per użytkownik
==================================================
Sort  (cost=16066.87..16115.61 rows=19495 width=50) (actual time=4459.751..4541.709 rows=19296 loops=1)
  Sort Key: (round(avg(order_totals.total_price), 2)) DESC
  Sort Method: quicksort  Memory: 1612kB
  ->  Finalize HashAggregate  (cost=14385.35..14677.77 rows=19495 width=50) (actual time=4372.502..4505.762 rows=19296 loops=1)
        Group Key: u.id
        Batches: 5  Memory Usage: 8241kB  Disk Usage: 216kB
        ->  Gather  (cost=12537.36..14263.50 rows=16246 width=50) (actual time=4187.192..4341.439 rows=19423 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial HashAggregate  (cost=11537.36..11638.90 rows=8123 width=50) (actual time=4171.025..4177.888 rows=6474 loops=3)
                    Group Key: u.id
                    Batches: 1  Memory Usage: 3217kB
                    Worker 0:  Batches: 1  Memory Usage: 2961kB
                    Worker 1:  Batches: 1  Memory Usage: 2961kB
                    ->  Nested Loop  (cost=1110.75..11496.75 rows=8123 width=50) (actual time=162.676..4109.263 rows=6498 loops=3)
                          ->  Hash Join  (cost=1110.33..6550.49 rows=8123 width=36) (actual time=109.637..232.048 rows=6498 loops=3)
                                Hash Cond: (o.id = order_totals.order_id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.006..41.364 rows=133333 loops=3)
                                ->  Hash  (cost=866.64..866.64 rows=19495 width=36) (actual time=107.803..110.364 rows=19495 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1094kB
                                      ->  Subquery Scan on order_totals  (cost=428.00..866.64 rows=19495 width=36) (actual time=89.283..101.018 rows=19495 loops=3)
                                            ->  HashAggregate  (cost=428.00..671.69 rows=19495 width=36) (actual time=89.281..99.157 rows=19495 loops=3)
                                                  Group Key: oi.order_id
                                                  Batches: 1  Memory Usage: 7953kB
                                                  Worker 0:  Batches: 1  Memory Usage: 7953kB
                                                  Worker 1:  Batches: 1  Memory Usage: 7953kB
                                                  ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=2.645..25.951 rows=20000 loops=3)
                          ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.589..0.589 rows=1 loops=19495)
                                Index Cond: (id = o.user_id)
Planning Time: 15.943 ms
Execution Time: 4581.869 ms


==================================================
EXPLAIN ANALYZE — Query 3: Top 10 Najlepiej Sprzedających Się Produktów (wg. Ilości Sprzedanych Jednostek) w Ostatnim Kwartale
==================================================
Limit  (cost=11753.79..11753.82 rows=10 width=46) (actual time=1671.534..1732.131 rows=10 loops=1)
  ->  Sort  (cost=11753.79..11765.24 rows=4579 width=46) (actual time=1671.533..1732.126 rows=10 loops=1)
        Sort Key: (count(*)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=11609.05..11654.84 rows=4579 width=46) (actual time=1668.593..1730.145 rows=3926 loops=1)
              Group Key: p.name, m.name
              Batches: 1  Memory Usage: 721kB
              ->  Gather  (cost=11179.75..11580.43 rows=3816 width=46) (actual time=1630.684..1724.655 rows=4328 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=10179.75..10198.83 rows=1908 width=46) (actual time=1390.218..1391.281 rows=1443 loops=3)
                          Group Key: p.name, m.name
                          Batches: 1  Memory Usage: 369kB
                          Worker 0:  Batches: 1  Memory Usage: 369kB
                          Worker 1:  Batches: 1  Memory Usage: 369kB
                          ->  Hash Join  (cost=2302.55..10165.44 rows=1908 width=38) (actual time=130.915..1368.714 rows=1521 loops=3)
                                Hash Cond: (p.manufacturer_id = m.id)
                                ->  Nested Loop  (cost=2297.17..10154.91 rows=1908 width=17) (actual time=128.986..1364.536 rows=1521 loops=3)
                                      ->  Nested Loop  (cost=2296.89..9525.07 rows=1908 width=4) (actual time=94.997..1230.305 rows=1521 loops=3)
                                            ->  Nested Loop  (cost=2296.60..8925.72 rows=1908 width=4) (actual time=80.714..1116.516 rows=1521 loops=3)
                                                  ->  Hash Join  (cost=2296.17..6557.51 rows=1908 width=4) (actual time=40.534..92.692 rows=1521 loops=3)
                                                        Hash Cond: (o.id = oi.order_id)
                                                        ->  Parallel Bitmap Heap Scan on "Order" o  (cost=1718.17..5721.94 rows=38158 width=4) (actual time=28.771..66.649 rows=30427 loops=3)
                                                              Recheck Cond: (order_date >= (now() - '3 mons'::interval))
                                                              Heap Blocks: exact=1157
                                                              ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..1695.28 rows=91580 width=0) (actual time=67.018..67.018 rows=91282 loops=1)
                                                                    Index Cond: (order_date >= (now() - '3 mons'::interval))
                                                        ->  Hash  (cost=328.00..328.00 rows=20000 width=8) (actual time=6.873..6.874 rows=20000 loops=3)
                                                              Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                                                              ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=8) (actual time=0.585..2.961 rows=20000 loops=3)
                                                  ->  Index Scan using "StockItem_pkey" on "StockItem" si  (cost=0.42..1.24 rows=1 width=8) (actual time=0.666..0.666 rows=1 loops=4562)
                                                        Index Cond: (id = oi.stock_item_id)
                                            ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.31 rows=1 width=8) (actual time=0.070..0.070 rows=1 loops=4562)
                                                  Index Cond: (id = si.variant_id)
                                      ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=21) (actual time=0.083..0.083 rows=1 loops=4562)
                                            Index Cond: (id = v.product_id)
                                ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.730..0.730 rows=150 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 18kB
                                      ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.041..0.058 rows=150 loops=3)
Planning Time: 91.305 ms
Execution Time: 1744.863 ms


==================================================
EXPLAIN ANALYZE — Query 4: Top 5 produktów z najwięcej recenzjami
==================================================
Limit  (cost=1792.59..1792.61 rows=5 width=25) (actual time=62.224..62.228 rows=5 loops=1)
  ->  Sort  (cost=1792.59..1842.59 rows=20000 width=25) (actual time=62.223..62.226 rows=5 loops=1)
        Sort Key: (COALESCE(r.count, '0'::bigint)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Hash Left Join  (cost=969.89..1460.40 rows=20000 width=25) (actual time=50.778..57.849 rows=20000 loops=1)
              Hash Cond: (p.id = r.product_id)
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.013..1.475 rows=20000 loops=1)
              ->  Hash  (cost=812.24..812.24 rows=12612 width=12) (actual time=50.753..50.754 rows=12612 loops=1)
                    Buckets: 16384  Batches: 1  Memory Usage: 670kB
                    ->  Subquery Scan on r  (cost=560.00..812.24 rows=12612 width=12) (actual time=43.321..46.921 rows=12612 loops=1)
                          ->  HashAggregate  (cost=560.00..686.12 rows=12612 width=12) (actual time=43.320..45.740 rows=12612 loops=1)
                                Group Key: "Review".product_id
                                Batches: 1  Memory Usage: 1425kB
                                ->  Seq Scan on "Review"  (cost=0.00..460.00 rows=20000 width=4) (actual time=1.328..36.816 rows=20000 loops=1)
Planning Time: 17.952 ms
Execution Time: 63.350 ms


==================================================
EXPLAIN ANALYZE — Query 5: Całkowity Przychód Pogrupowany Miesięcznie za Ostatni Rok
==================================================
Finalize GroupAggregate  (cost=9719.19..11975.47 rows=17309 width=36) (actual time=140.162..211.224 rows=11 loops=1)
  Group Key: ((date_trunc('month'::text, o.order_date))::date)
  ->  Gather Merge  (cost=9719.19..11564.38 rows=14424 width=36) (actual time=139.904..211.194 rows=33 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=8719.17..8899.47 rows=7212 width=36) (actual time=99.018..100.366 rows=11 loops=3)
              Group Key: ((date_trunc('month'::text, o.order_date))::date)
              ->  Sort  (cost=8719.17..8737.20 rows=7212 width=10) (actual time=98.111..98.634 rows=5760 loops=3)
                    Sort Key: ((date_trunc('month'::text, o.order_date))::date) DESC
                    Sort Method: quicksort  Memory: 425kB
                    Worker 0:  Sort Method: quicksort  Memory: 400kB
                    Worker 1:  Sort Method: quicksort  Memory: 196kB
                    ->  Hash Join  (cost=578.00..8257.02 rows=7212 width=10) (actual time=8.402..96.065 rows=5760 loops=3)
                          Hash Cond: (o.id = oi.order_id)
                          ->  Parallel Seq Scan on "Order" o  (cost=0.00..6669.33 rows=144241 width=12) (actual time=0.015..64.089 rows=115772 loops=3)
                                Filter: (order_date >= (date_trunc('year'::text, now()) - '00:00:00'::interval))
                                Rows Removed by Filter: 17562
                          ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=8.043..8.044 rows=20000 loops=3)
                                Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.020..2.397 rows=20000 loops=3)
Planning Time: 3.985 ms
Execution Time: 215.565 ms


==================================================
EXPLAIN ANALYZE — Query 6: Produkty najczęściej dodawane do ulubionych
==================================================
Limit  (cost=14382.58..14382.60 rows=10 width=25) (actual time=619.408..715.815 rows=10 loops=1)
  ->  Sort  (cost=14382.58..14432.58 rows=20000 width=25) (actual time=618.617..715.020 rows=10 loops=1)
        Sort Key: (count(f.id)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=13750.38..13950.38 rows=20000 width=25) (actual time=610.458..711.195 rows=20000 loops=1)
              Group Key: p.id
              Batches: 1  Memory Usage: 2577kB
              ->  Gather  (cost=9350.38..13550.38 rows=40000 width=25) (actual time=485.231..644.022 rows=59997 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=8350.38..8550.38 rows=20000 width=25) (actual time=445.938..451.604 rows=19999 loops=3)
                          Group Key: p.id
                          Batches: 1  Memory Usage: 2577kB
                          Worker 0:  Batches: 1  Memory Usage: 2577kB
                          Worker 1:  Batches: 1  Memory Usage: 2577kB
                          ->  Hash Join  (cost=688.00..7100.38 rows=250000 width=21) (actual time=9.151..360.263 rows=200000 loops=3)
                                Hash Cond: (f.product_id = p.id)
                                ->  Parallel Seq Scan on "FavoriteProduct" f  (cost=0.00..5756.00 rows=250000 width=8) (actual time=0.476..269.260 rows=200000 loops=3)
                                ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=8.495..9.139 rows=20000 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1215kB
                                      ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.400..3.701 rows=20000 loops=3)
Planning Time: 24.563 ms
Execution Time: 719.376 ms


==================================================
EXPLAIN ANALYZE — Query 7: Dostępny Stan Magazynowy Wariantów Produktu Pogrupowany po Magazynach
==================================================
GroupAggregate  (cost=37640.01..42664.89 rows=223328 width=61) (actual time=1351.326..1712.324 rows=178012 loops=1)
  Group Key: p.name, w.name, v.sku
  ->  Sort  (cost=37640.01..38198.33 rows=223328 width=57) (actual time=1346.957..1611.020 rows=223971 loops=1)
        Sort Key: p.name, w.name, v.sku
        Sort Method: external merge  Disk: 15248kB
        ->  Hash Join  (cost=2189.15..9398.65 rows=223328 width=57) (actual time=29.093..575.755 rows=223971 loops=1)
              Hash Cond: (si.warehouse_id = w.id)
              ->  Hash Join  (cost=2144.50..8766.15 rows=223328 width=44) (actual time=29.071..533.744 rows=223971 loops=1)
                    Hash Cond: (v.product_id = p.id)
                    ->  Hash Join  (cost=1456.50..7491.79 rows=223328 width=35) (actual time=23.134..442.641 rows=223971 loops=1)
                          Hash Cond: (si.variant_id = v.id)
                          ->  Seq Scan on "StockItem" si  (cost=0.00..5449.00 rows=223328 width=12) (actual time=0.015..312.567 rows=223971 loops=1)
                                Filter: (shipment_id IS NULL)
                                Rows Removed by Filter: 96029
                          ->  Hash  (cost=869.00..869.00 rows=47000 width=31) (actual time=23.097..23.990 rows=47000 loops=1)
                                Buckets: 65536  Batches: 1  Memory Usage: 3450kB
                                ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=31) (actual time=0.006..6.726 rows=47000 loops=1)
                    ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=5.927..5.928 rows=20000 loops=1)
                          Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                          ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.005..2.386 rows=20000 loops=1)
              ->  Hash  (cost=25.40..25.40 rows=1540 width=21) (actual time=0.016..0.016 rows=10 loops=1)
                    Buckets: 2048  Batches: 1  Memory Usage: 17kB
                    ->  Seq Scan on "Warehouse" w  (cost=0.00..25.40 rows=1540 width=21) (actual time=0.010..0.012 rows=10 loops=1)
Planning Time: 10.973 ms
Execution Time: 1723.478 ms


==================================================
EXPLAIN ANALYZE — Query 8: Stan magazynowy per produkt
==================================================
Sort  (cost=11494.90..11544.43 rows=19812 width=21) (actual time=305.029..307.749 rows=17916 loops=1)
  Sort Key: (count(si.id)) DESC
  Sort Method: quicksort  Memory: 1482kB
  ->  HashAggregate  (cost=9882.79..10080.91 rows=19812 width=21) (actual time=298.215..302.159 rows=17916 loops=1)
        Group Key: p.name
        Batches: 1  Memory Usage: 2065kB
        ->  Hash Join  (cost=2144.50..8766.15 rows=223328 width=17) (actual time=18.962..216.724 rows=223971 loops=1)
              Hash Cond: (v.product_id = p.id)
              ->  Hash Join  (cost=1456.50..7491.79 rows=223328 width=8) (actual time=12.423..139.278 rows=223971 loops=1)
                    Hash Cond: (si.variant_id = v.id)
                    ->  Seq Scan on "StockItem" si  (cost=0.00..5449.00 rows=223328 width=8) (actual time=0.013..38.019 rows=223971 loops=1)
                          Filter: (shipment_id IS NULL)
                          Rows Removed by Filter: 96029
                    ->  Hash  (cost=869.00..869.00 rows=47000 width=8) (actual time=12.389..12.390 rows=47000 loops=1)
                          Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                          ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=8) (actual time=0.006..5.085 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=6.527..6.529 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.833..3.188 rows=20000 loops=1)
Planning Time: 16.561 ms
Execution Time: 309.426 ms


==================================================
EXPLAIN ANALYZE — Query 9: Najpopularniejsze Kategorie (wg. Całkowitego Przychodu)
==================================================
Limit  (cost=12371.00..12371.02 rows=10 width=44) (actual time=600.122..830.019 rows=10 loops=1)
  ->  Sort  (cost=12371.00..12371.37 rows=150 width=44) (actual time=599.187..828.281 rows=10 loops=1)
        Sort Key: (sum(oi.unit_price)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize GroupAggregate  (cost=12328.63..12367.76 rows=150 width=44) (actual time=598.760..828.228 rows=150 loops=1)
              Group Key: c.name
              ->  Gather Merge  (cost=12328.63..12363.63 rows=300 width=44) (actual time=592.564..821.681 rows=450 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Sort  (cost=11328.61..11328.98 rows=150 width=44) (actual time=324.352..326.994 rows=150 loops=3)
                          Sort Key: c.name
                          Sort Method: quicksort  Memory: 39kB
                          Worker 0:  Sort Method: quicksort  Memory: 39kB
                          Worker 1:  Sort Method: quicksort  Memory: 39kB
                          ->  Partial HashAggregate  (cost=11321.31..11323.19 rows=150 width=44) (actual time=299.043..301.174 rows=150 loops=3)
                                Group Key: c.name
                                Batches: 1  Memory Usage: 96kB
                                Worker 0:  Batches: 1  Memory Usage: 96kB
                                Worker 1:  Batches: 1  Memory Usage: 96kB
                                ->  Hash Join  (cost=8362.48..11112.98 rows=41667 width=18) (actual time=102.292..281.544 rows=33334 loops=3)
                                      Hash Cond: (pc.category_id = c.id)
                                      ->  Parallel Hash Join  (cost=8357.10..10995.13 rows=41667 width=10) (actual time=92.159..264.653 rows=33334 loops=3)
                                            Hash Cond: (pc.product_id = p.id)
                                            ->  Parallel Index Only Scan using uq_prodcat_product_category on "ProductCategory" pc  (cost=0.29..2236.96 rows=41667 width=8) (actual time=42.920..200.527 rows=33333 loops=3)
                                                  Heap Fetches: 0
                                            ->  Parallel Hash  (cost=8209.75..8209.75 rows=11765 width=14) (actual time=42.949..43.376 rows=6667 loops=3)
                                                  Buckets: 32768  Batches: 1  Memory Usage: 1216kB
                                                  ->  Hash Join  (cost=2722.50..8209.75 rows=11765 width=14) (actual time=22.862..113.809 rows=20000 loops=1)
                                                        Hash Cond: (v.product_id = p.id)
                                                        ->  Hash Join  (cost=2034.50..7490.85 rows=11765 width=10) (actual time=17.979..100.823 rows=20000 loops=1)
                                                              Hash Cond: (si.variant_id = v.id)
                                                              ->  Hash Join  (cost=578.00..6003.47 rows=11765 width=10) (actual time=5.493..79.565 rows=20000 loops=1)
                                                                    Hash Cond: (si.id = oi.stock_item_id)
                                                                    ->  Parallel Seq Scan on "StockItem" si  (cost=0.00..4131.35 rows=188235 width=8) (actual time=0.005..23.109 rows=320000 loops=1)
                                                                    ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=5.468..5.469 rows=20000 loops=1)
                                                                          Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                                                          ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.009..2.241 rows=20000 loops=1)
                                                              ->  Hash  (cost=869.00..869.00 rows=47000 width=8) (actual time=12.467..12.468 rows=47000 loops=1)
                                                                    Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                                                    ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=8) (actual time=0.008..5.079 rows=47000 loops=1)
                                                        ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=4.870..4.877 rows=20000 loops=1)
                                                              Buckets: 32768  Batches: 1  Memory Usage: 960kB
                                                              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.013..2.108 rows=20000 loops=1)
                                      ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=8.791..8.792 rows=150 loops=3)
                                            Buckets: 1024  Batches: 1  Memory Usage: 16kB
                                            ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=8.232..8.253 rows=150 loops=3)
Planning Time: 22.760 ms
Execution Time: 838.006 ms


==================================================
EXPLAIN ANALYZE — Query 10: Liczba produktów per kategoria
==================================================
Sort  (cost=2342.22..2342.59 rows=150 width=20) (actual time=211.611..211.621 rows=150 loops=1)
  Sort Key: (count(pc.product_id)) DESC
  Sort Method: quicksort  Memory: 30kB
  ->  HashAggregate  (cost=2335.30..2336.80 rows=150 width=20) (actual time=210.937..210.962 rows=150 loops=1)
        Group Key: c.name
        Batches: 1  Memory Usage: 48kB
        ->  Hash Right Join  (cost=5.38..1835.30 rows=100000 width=16) (actual time=2.466..189.987 rows=100000 loops=1)
              Hash Cond: (pc.category_id = c.id)
              ->  Seq Scan on "ProductCategory" pc  (cost=0.00..1560.00 rows=100000 width=8) (actual time=1.950..167.203 rows=100000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=0.065..0.066 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 16kB
                    ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=0.020..0.038 rows=150 loops=1)
Planning Time: 11.385 ms
Execution Time: 212.275 ms


==================================================
EXPLAIN ANALYZE — Query 11: Liczba zamówień per metoda płatności
==================================================
Sort  (cost=7808.47..7808.49 rows=6 width=50) (actual time=133.990..228.858 rows=6 loops=1)
  Sort Key: (sum(oi.unit_price)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  Finalize GroupAggregate  (cost=7806.80..7808.40 rows=6 width=50) (actual time=132.567..227.447 rows=6 loops=1)
        Group Key: pm.name
        ->  Gather Merge  (cost=7806.80..7808.20 rows=12 width=50) (actual time=132.538..226.274 rows=18 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Sort  (cost=6806.78..6806.79 rows=6 width=50) (actual time=69.165..69.171 rows=6 loops=3)
                    Sort Key: pm.name
                    Sort Method: quicksort  Memory: 25kB
                    Worker 0:  Sort Method: quicksort  Memory: 25kB
                    Worker 1:  Sort Method: quicksort  Memory: 25kB
                    ->  Partial HashAggregate  (cost=6806.62..6806.70 rows=6 width=50) (actual time=64.510..64.518 rows=6 loops=3)
                          Group Key: pm.name
                          Batches: 1  Memory Usage: 24kB
                          Worker 0:  Batches: 1  Memory Usage: 24kB
                          Worker 1:  Batches: 1  Memory Usage: 24kB
                          ->  Hash Join  (cost=579.13..6744.13 rows=8333 width=20) (actual time=14.436..62.482 rows=6667 loops=3)
                                Hash Cond: (o.payment_method_id = pm.id)
                                ->  Hash Join  (cost=578.00..6705.67 rows=8333 width=14) (actual time=12.074..58.759 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.009..19.488 rows=133333 loops=3)
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=11.654..11.654 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.024..2.411 rows=20000 loops=3)
                                ->  Hash  (cost=1.06..1.06 rows=6 width=14) (actual time=2.327..2.328 rows=6 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                      ->  Seq Scan on "PaymentMethod" pm  (cost=0.00..1.06 rows=6 width=14) (actual time=2.315..2.321 rows=6 loops=3)
Planning Time: 9.853 ms
Execution Time: 233.681 ms


==================================================
EXPLAIN ANALYZE — Query 12: Średnia ocena per producent
==================================================
Sort  (cost=1367.54..1367.91 rows=150 width=57) (actual time=36.537..36.549 rows=150 loops=1)
  Sort Key: (round(avg(r.rating), 2)) DESC NULLS LAST
  Sort Method: quicksort  Memory: 32kB
  ->  HashAggregate  (cost=1359.87..1362.12 rows=150 width=57) (actual time=35.830..35.895 rows=150 loops=1)
        Group Key: m.name
        Batches: 1  Memory Usage: 64kB
        ->  Hash Join  (cost=693.38..1259.87 rows=20000 width=29) (actual time=6.271..29.065 rows=27388 loops=1)
              Hash Cond: (p.manufacturer_id = m.id)
              ->  Hash Right Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=5.593..22.965 rows=27388 loops=1)
                    Hash Cond: (r.product_id = p.id)
                    ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=0.022..5.012 rows=20000 loops=1)
                    ->  Hash  (cost=438.00..438.00 rows=20000 width=8) (actual time=5.558..5.559 rows=20000 loops=1)
                          Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                          ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=8) (actual time=0.005..2.353 rows=20000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.058..0.059 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 18kB
                    ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.016..0.033 rows=150 loops=1)
Planning Time: 16.736 ms
Execution Time: 38.075 ms


==================================================
EXPLAIN ANALYZE — Query 13: Aktywne promocje i objęta nimi liczba wariantów
==================================================
Sort  (cost=395.64..395.76 rows=47 width=14) (actual time=5.354..5.358 rows=46 loops=1)
  Sort Key: (count(v.id)) DESC
  Sort Method: quicksort  Memory: 26kB
  ->  HashAggregate  (cost=393.87..394.34 rows=47 width=14) (actual time=5.333..5.341 rows=46 loops=1)
        Group Key: pr.name
        Batches: 1  Memory Usage: 24kB
        ->  Merge Join  (cost=7.63..337.47 rows=11280 width=10) (actual time=0.091..5.023 rows=1340 loops=1)
              Merge Cond: (v.promotion_id = pr.id)
              ->  Index Scan using idx_variant_promotion on "Variant" v  (cost=0.29..2469.28 rows=47000 width=8) (actual time=0.039..4.159 rows=5685 loops=1)
              ->  Sort  (cost=7.34..7.46 rows=48 width=10) (actual time=0.048..0.053 rows=47 loops=1)
                    Sort Key: pr.id
                    Sort Method: quicksort  Memory: 26kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=48 width=10) (actual time=0.014..0.037 rows=47 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 153
Planning Time: 10.146 ms
Execution Time: 5.436 ms


==================================================
EXPLAIN ANALYZE — Query 14: Najczęściej wybierane warianty w koszykach
==================================================
Limit  (cost=224158.84..224158.87 rows=10 width=44) (actual time=9121.278..9121.287 rows=10 loops=1)
  ->  Sort  (cost=224158.84..227908.84 rows=1500000 width=44) (actual time=9120.669..9120.672 rows=10 loops=1)
        Sort Key: (sum(ci.quantity)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  GroupAggregate  (cost=4.24..191744.38 rows=1500000 width=44) (actual time=102.577..9100.571 rows=47000 loops=1)
              Group Key: v.sku, p.name
              ->  Incremental Sort  (cost=4.24..165494.38 rows=1500000 width=40) (actual time=42.719..8798.412 rows=1500000 loops=1)
                    Sort Key: v.sku, p.name
                    Presorted Key: v.sku
                    Full-sort Groups: 31708  Sort Method: quicksort  Average Memory: 27kB  Peak Memory: 27kB
                    Pre-sorted Groups: 6442  Sort Method: quicksort  Average Memory: 26kB  Peak Memory: 26kB
                    ->  Nested Loop  (cost=1.14..108333.20 rows=1500000 width=40) (actual time=4.833..8249.468 rows=1500000 loops=1)
                          ->  Nested Loop  (cost=0.71..8804.70 rows=47000 width=40) (actual time=3.686..235.761 rows=47000 loops=1)
                                ->  Index Scan using "Variant_sku_key" on "Variant" v  (cost=0.41..2051.42 rows=47000 width=31) (actual time=3.646..45.128 rows=47000 loops=1)
                                ->  Memoize  (cost=0.30..0.34 rows=1 width=17) (actual time=0.003..0.003 rows=1 loops=47000)
                                      Cache Key: v.product_id
                                      Cache Mode: logical
                                      Hits: 28889  Misses: 18111  Evictions: 0  Overflows: 0  Memory Usage: 2099kB
                                      ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=17) (actual time=0.004..0.004 rows=1 loops=18111)
                                            Index Cond: (id = v.product_id)
                          ->  Index Scan using idx_cartitem_variant_id on "CartItem" ci  (cost=0.43..1.80 rows=32 width=8) (actual time=0.009..0.166 rows=32 loops=47000)
                                Index Cond: (variant_id = v.id)
Planning Time: 13.946 ms
Execution Time: 9122.790 ms


==================================================
EXPLAIN ANALYZE — Query 15: Produkty z Największą Różnicą Między Ceną Podstawową a Ceną Wariantu
==================================================
Limit  (cost=2813.55..2813.58 rows=10 width=80) (actual time=48.319..48.323 rows=10 loops=1)
  ->  Sort  (cost=2813.55..2931.05 rows=47000 width=80) (actual time=48.318..48.320 rows=10 loops=1)
        Sort Key: v.price_modifier DESC
        Sort Method: top-N heapsort  Memory: 27kB
        ->  Hash Join  (cost=688.00..1797.90 rows=47000 width=80) (actual time=8.929..35.012 rows=47000 loops=1)
              Hash Cond: (v.product_id = p.id)
              ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=33) (actual time=2.576..5.956 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=6.335..6.335 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1381kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.008..2.658 rows=20000 loops=1)
Planning Time: 4.398 ms
Execution Time: 48.378 ms


==================================================
EXPLAIN ANALYZE — Query 16: Konwersja zamówień wg statusu
==================================================
Sort  (cost=7957.56..7962.66 rows=2040 width=48) (actual time=270.693..378.497 rows=7 loops=1)
  Sort Key: (count(o.id)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  WindowAgg  (cost=7824.99..7845.41 rows=2040 width=48) (actual time=270.666..377.452 rows=7 loops=1)
        ->  Finalize HashAggregate  (cost=7779.11..7799.51 rows=2040 width=16) (actual time=265.058..371.852 rows=7 loops=1)
              Group Key: s.name
              Batches: 1  Memory Usage: 121kB
              ->  Gather  (cost=7330.31..7758.71 rows=4080 width=16) (actual time=216.600..369.881 rows=21 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=6330.31..6350.71 rows=2040 width=16) (actual time=70.723..70.740 rows=7 loops=3)
                          Group Key: s.name
                          Batches: 1  Memory Usage: 121kB
                          Worker 0:  Batches: 1  Memory Usage: 121kB
                          Worker 1:  Batches: 1  Memory Usage: 121kB
                          ->  Hash Join  (cost=55.90..5496.98 rows=166667 width=12) (actual time=0.066..41.806 rows=133333 loops=3)
                                Hash Cond: (o.status_id = s.id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.009..11.931 rows=133333 loops=3)
                                ->  Hash  (cost=30.40..30.40 rows=2040 width=12) (actual time=0.027..0.028 rows=7 loops=3)
                                      Buckets: 2048  Batches: 1  Memory Usage: 17kB
                                      ->  Seq Scan on "Status" s  (cost=0.00..30.40 rows=2040 width=12) (actual time=0.022..0.023 rows=7 loops=3)
Planning Time: 9.142 ms
Execution Time: 384.848 ms


==================================================
EXPLAIN ANALYZE — Query 17: Top klienci wg wydatków
==================================================
Limit  (cost=15399.41..15399.44 rows=10 width=50) (actual time=4425.488..4432.578 rows=10 loops=1)
  ->  Sort  (cost=15399.41..15449.41 rows=20000 width=50) (actual time=4425.486..4432.575 rows=10 loops=1)
        Sort Key: (sum(oi.unit_price)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=14717.22..14967.22 rows=20000 width=50) (actual time=4406.922..4423.981 rows=19296 loops=1)
              Group Key: u.id
              Batches: 5  Memory Usage: 8241kB  Disk Usage: 224kB
              ->  Gather  (cost=12821.46..14592.22 rows=16666 width=50) (actual time=3713.207..3929.495 rows=19431 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=11821.46..11925.62 rows=8333 width=50) (actual time=3583.517..3717.231 rows=6477 loops=3)
                          Group Key: u.id
                          Batches: 1  Memory Usage: 3217kB
                          Worker 0:  Batches: 1  Memory Usage: 2961kB
                          Worker 1:  Batches: 1  Memory Usage: 2961kB
                          ->  Nested Loop  (cost=578.42..11779.80 rows=8333 width=24) (actual time=18.731..3490.413 rows=6667 loops=3)
                                ->  Hash Join  (cost=578.00..6705.67 rows=8333 width=10) (actual time=9.383..260.737 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.009..173.747 rows=133333 loops=3)
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=9.051..9.655 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=1.438..3.784 rows=20000 loops=3)
                                ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.475..0.475 rows=1 loops=20000)
                                      Index Cond: (id = o.user_id)
Planning Time: 23.935 ms
Execution Time: 4448.967 ms


==================================================
EXPLAIN ANALYZE — Query 18: Produkty z wariantami objętymi promocją, z końcową ceną
==================================================
Sort  (cost=1983.52..2011.72 rows=11280 width=132) (actual time=79.039..79.188 rows=1340 loops=1)
  Sort Key: (round(((p.price + v.price_modifier) * ('1'::numeric - pr.discount_percentage)), 2))
  Sort Method: quicksort  Memory: 146kB
  ->  Hash Join  (cost=695.63..1224.29 rows=11280 width=132) (actual time=32.951..75.980 rows=1340 loops=1)
        Hash Cond: (v.product_id = p.id)
        ->  Merge Join  (cost=7.63..337.47 rows=11280 width=39) (actual time=1.712..43.057 rows=1340 loops=1)
              Merge Cond: (v.promotion_id = pr.id)
              ->  Index Scan using idx_variant_promotion on "Variant" v  (cost=0.29..2469.28 rows=47000 width=37) (actual time=0.022..40.441 rows=5685 loops=1)
              ->  Sort  (cost=7.34..7.46 rows=48 width=10) (actual time=1.682..1.692 rows=47 loops=1)
                    Sort Key: pr.id
                    Sort Method: quicksort  Memory: 26kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=48 width=10) (actual time=1.640..1.664 rows=47 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 153
        ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=31.217..31.218 rows=20000 loops=1)
              Buckets: 32768  Batches: 1  Memory Usage: 1381kB
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.007..24.115 rows=20000 loops=1)
Planning Time: 52.632 ms
Execution Time: 82.887 ms


==================================================
EXPLAIN ANALYZE — Query 19: Użytkownicy, Którzy Dodali Produkt do Koszyka, Ale Nie Złożyli Zamówienia (Potencjał Odbudowy Koszyka)
==================================================
Hash Join  (cost=45873.97..103632.31 rows=1070130 width=55) (actual time=3459.508..9219.570 rows=1005006 loops=1)
  Hash Cond: (v.product_id = p.id)
  ->  Hash Join  (cost=45185.97..100134.62 rows=1070130 width=46) (actual time=3449.357..8671.928 rows=1005006 loops=1)
        Hash Cond: (ci.variant_id = v.id)
        ->  Hash Join  (cost=43729.47..95868.77 rows=1070130 width=46) (actual time=3433.087..8024.074 rows=1005006 loops=1)
              Hash Cond: (ci.cart_id = c.id)
              ->  Seq Scan on "CartItem" ci  (cost=0.00..23152.00 rows=1500000 width=8) (actual time=0.033..3525.895 rows=1500000 loops=1)
              ->  Hash  (cost=41450.81..41450.81 rows=107013 width=46) (actual time=3425.152..3441.645 rows=100414 loops=1)
                    Buckets: 131072  Batches: 2  Memory Usage: 4929kB
                    ->  Gather  (cost=25017.67..41450.81 rows=107013 width=46) (actual time=3067.860..3147.908 rows=100414 loops=1)
                          Workers Planned: 2
                          Workers Launched: 2
                          ->  Parallel Hash Right Anti Join  (cost=24017.67..29749.51 rows=44589 width=46) (actual time=2518.345..2532.675 rows=33471 loops=3)
                                Hash Cond: (o.user_id = u.id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=4) (actual time=18.851..513.338 rows=133333 loops=3)
                                ->  Parallel Hash  (cost=23236.42..23236.42 rows=62500 width=50) (actual time=1842.357..1843.291 rows=50000 loops=3)
                                      Buckets: 262144  Batches: 1  Memory Usage: 14720kB
                                      ->  Hash Join  (cost=4079.00..23236.42 rows=62500 width=50) (actual time=173.736..1629.355 rows=50000 loops=3)
                                            Hash Cond: (u.id = c.user_id)
                                            ->  Parallel Seq Scan on "User" u  (cost=0.00..18063.67 rows=416667 width=46) (actual time=11.970..1204.483 rows=333333 loops=3)
                                            ->  Hash  (cost=2204.00..2204.00 rows=150000 width=8) (actual time=150.223..150.224 rows=150000 loops=3)
                                                  Buckets: 262144  Batches: 1  Memory Usage: 7908kB
                                                  ->  Seq Scan on "Cart" c  (cost=0.00..2204.00 rows=150000 width=8) (actual time=20.845..83.011 rows=150000 loops=3)
        ->  Hash  (cost=869.00..869.00 rows=47000 width=8) (actual time=15.086..15.086 rows=47000 loops=1)
              Buckets: 65536  Batches: 1  Memory Usage: 2348kB
              ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=8) (actual time=0.012..5.133 rows=47000 loops=1)
  ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=7.264..7.789 rows=20000 loops=1)
        Buckets: 32768  Batches: 1  Memory Usage: 1245kB
        ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=1.516..3.871 rows=20000 loops=1)
Planning Time: 79.589 ms
Execution Time: 9291.071 ms


==================================================
EXPLAIN ANALYZE — Query 20: Wyszukiwanie produktów po nazwie lub opisie (parametryzowane)
==================================================
Bitmap Heap Scan on "Product"  (cost=43.00..57.51 rows=4 width=60) (actual time=7.859..36.118 rows=143 loops=1)
  Recheck Cond: (((name)::text ~~* '%test%'::text) OR (description ~~* '%test%'::text))
  Heap Blocks: exact=106
  ->  BitmapOr  (cost=43.00..43.00 rows=4 width=0) (actual time=7.821..7.822 rows=0 loops=1)
        ->  Bitmap Index Scan on idx_product_name_trgm  (cost=0.00..21.50 rows=2 width=0) (actual time=3.816..3.817 rows=42 loops=1)
              Index Cond: ((name)::text ~~* '%test%'::text)
        ->  Bitmap Index Scan on idx_product_description_trgm  (cost=0.00..21.50 rows=2 width=0) (actual time=3.998..3.999 rows=102 loops=1)
              Index Cond: (description ~~* '%test%'::text)
Planning Time: 122.639 ms
Execution Time: 40.937 ms


==================================================
EXPLAIN ANALYZE — Query 21: Użytkownicy, Którzy Zapisali Konkretny Produkt jako Ulubiony (np. Product ID=350259)
==================================================
Gather  (cost=1000.42..7485.31 rows=30 width=56) (actual time=33.812..494.128 rows=26 loops=1)
  Workers Planned: 2
  Workers Launched: 2
  ->  Nested Loop  (cost=0.42..6482.31 rows=12 width=56) (actual time=34.065..376.373 rows=9 loops=3)
        ->  Parallel Seq Scan on "FavoriteProduct" fp  (cost=0.00..6381.00 rows=12 width=4) (actual time=31.899..369.463 rows=9 loops=3)
              Filter: (product_id = 35)
              Rows Removed by Filter: 199991
        ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..8.44 rows=1 width=60) (actual time=0.791..0.791 rows=1 loops=26)
              Index Cond: (id = fp.user_id)
Planning Time: 16.645 ms
Execution Time: 495.272 ms


==================================================
EXPLAIN ANALYZE — Query 22: Znajdź Magazyny, Które Posiadają Zapasy Konkretnego Wariantu (np. SKU='VR-000000-a637d44b7afd')
==================================================
GroupAggregate  (cost=24.91..25.01 rows=2 width=25) (actual time=7.949..7.951 rows=0 loops=1)
  Group Key: w.name
  Filter: (count(si.id) > 0)
  ->  Sort  (cost=24.91..24.93 rows=5 width=21) (actual time=7.948..7.949 rows=0 loops=1)
        Sort Key: w.name
        Sort Method: quicksort  Memory: 25kB
        ->  Nested Loop  (cost=0.99..24.86 rows=5 width=21) (actual time=6.159..6.160 rows=0 loops=1)
              ->  Nested Loop  (cost=0.84..24.00 rows=5 width=8) (actual time=6.159..6.160 rows=0 loops=1)
                    ->  Index Scan using "Variant_sku_key" on "Variant" v  (cost=0.41..8.43 rows=1 width=4) (actual time=6.158..6.158 rows=0 loops=1)
                          Index Cond: ((sku)::text = 'VR-000001-2704de10f283'::text)
                    ->  Index Scan using idx_stockitem_shipment_variant_warehouse on "StockItem" si  (cost=0.42..15.52 rows=5 width=12) (never executed)
                          Index Cond: ((shipment_id IS NULL) AND (variant_id = v.id))
              ->  Index Scan using "Warehouse_pkey" on "Warehouse" w  (cost=0.15..0.17 rows=1 width=21) (never executed)
                    Index Cond: (id = si.warehouse_id)
Planning Time: 26.381 ms
Execution Time: 11.841 ms


==================================================
EXPLAIN ANALYZE — Query 23: Warianty, Które Wymagają Uzyskania Konkretnej Opcji (np. 'Kolor'='Czerwony')
==================================================
Nested Loop  (cost=6.96..680.20 rows=1 width=36) (actual time=0.023..0.024 rows=0 loops=1)
  ->  Nested Loop  (cost=6.67..679.87 rows=1 width=27) (actual time=0.023..0.023 rows=0 loops=1)
        ->  Nested Loop  (cost=6.38..679.55 rows=1 width=4) (actual time=0.023..0.023 rows=0 loops=1)
              Join Filter: (opt.attribute_id = a.id)
              ->  Index Scan using "Attribute_name_key" on "Attribute" a  (cost=0.15..8.17 rows=1 width=4) (actual time=0.022..0.022 rows=0 loops=1)
                    Index Cond: ((name)::text = 'Attr_49_Century'::text)
              ->  Nested Loop  (cost=6.23..668.26 rows=250 width=8) (never executed)
                    ->  Seq Scan on "Option" opt  (cost=0.00..18.50 rows=1 width=8) (never executed)
                          Filter: ((value)::text = 'do'::text)
                    ->  Bitmap Heap Scan on "VariantOption" vo  (cost=6.23..647.26 rows=250 width=8) (never executed)
                          Recheck Cond: (option_id = opt.id)
                          ->  Bitmap Index Scan on idx_variantoption_option_id  (cost=0.00..6.17 rows=250 width=0) (never executed)
                                Index Cond: (option_id = opt.id)
        ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.32 rows=1 width=31) (never executed)
              Index Cond: (id = vo.variant_id)
  ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=17) (never executed)
        Index Cond: (id = v.product_id)
Planning Time: 47.611 ms
Execution Time: 0.072 ms


==================================================
EXPLAIN ANALYZE — Query 24: Znajdź Zamówienia Użytkownika (np. email='debbie.lane.16786.50af0753@example.com') o Statusie 'Paid'
==================================================
Nested Loop  (cost=1.00..17.09 rows=1 width=20) (actual time=4.762..4.764 rows=0 loops=1)
  ->  Nested Loop  (cost=0.85..16.89 rows=1 width=16) (actual time=4.762..4.763 rows=0 loops=1)
        ->  Index Scan using "User_email_key" on "User" u  (cost=0.42..8.44 rows=1 width=4) (actual time=4.761..4.761 rows=0 loops=1)
              Index Cond: ((email)::text = 'debbie.lane.16786.50af0753@example.com'::text)
        ->  Index Scan using idx_order_user_id on "Order" o  (cost=0.42..8.44 rows=1 width=20) (never executed)
              Index Cond: (user_id = u.id)
  ->  Index Scan using "Status_pkey" on "Status" s  (cost=0.15..0.17 rows=1 width=12) (never executed)
        Index Cond: (id = o.status_id)
        Filter: ((name)::text = 'Paid'::text)
Planning Time: 3.469 ms
Execution Time: 4.800 ms


==================================================
EXPLAIN ANALYZE — Query 25: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
Nested Loop Left Join  (cost=5.45..49.87 rows=16 width=87) (actual time=2.352..10.001 rows=18 loops=1)
  ->  Nested Loop Left Join  (cost=5.30..46.34 rows=16 width=45) (actual time=1.695..9.304 rows=18 loops=1)
        ->  Nested Loop Left Join  (cost=5.02..41.66 rows=16 width=39) (actual time=1.670..7.188 rows=18 loops=1)
              ->  Nested Loop  (cost=4.60..23.91 rows=3 width=39) (actual time=1.016..2.206 rows=4 loops=1)
                    ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..8.30 rows=1 width=10) (actual time=0.008..0.009 rows=1 loops=1)
                          Index Cond: (id = 35)
                    ->  Bitmap Heap Scan on "Variant" v  (cost=4.31..15.57 rows=3 width=37) (actual time=1.004..2.191 rows=4 loops=1)
                          Recheck Cond: (product_id = 35)
                          Heap Blocks: exact=4
                          ->  Bitmap Index Scan on idx_variant_product_id  (cost=0.00..4.31 rows=3 width=0) (actual time=0.016..0.016 rows=4 loops=1)
                                Index Cond: (product_id = 35)
              ->  Index Only Scan using uq_varopt_variant_option on "VariantOption" vo  (cost=0.42..5.86 rows=6 width=8) (actual time=1.242..1.243 rows=4 loops=4)
                    Index Cond: (variant_id = v.id)
                    Heap Fetches: 0
        ->  Index Scan using "Option_pkey" on "Option" opt  (cost=0.28..0.29 rows=1 width=14) (actual time=0.117..0.117 rows=1 loops=18)
              Index Cond: (id = vo.option_id)
  ->  Index Scan using "Attribute_pkey" on "Attribute" a  (cost=0.15..0.22 rows=1 width=18) (actual time=0.002..0.002 rows=1 loops=18)
        Index Cond: (id = opt.attribute_id)
Planning Time: 0.536 ms
Execution Time: 10.048 ms


==================================================
EXPLAIN ANALYZE — Query 26: Lista Wszystkich Dziecięcych Kategorii (Podkategorii) dla Konkretnej Kategorii Nadrzędnej (np. ID=5)
==================================================
Seq Scan on "Category"  (cost=0.00..3.88 rows=3 width=12) (actual time=1.231..2.321 rows=3 loops=1)
  Filter: (parent_id = 5)
  Rows Removed by Filter: 147
Planning Time: 1.361 ms
Execution Time: 2.341 ms


==================================================
EXPLAIN ANALYZE — Query 27: Porównanie Średniej Oceny dla Promowanych i Niepromowanych Produktów
==================================================
HashAggregate  (cost=87850.51..87853.01 rows=200 width=64) (actual time=164.248..164.253 rows=2 loops=1)
  Group Key: CASE WHEN (ANY (p.id = (hashed SubPlan 2).col1)) THEN 'Promowany'::text ELSE 'Niepromowany'::text END
  Batches: 1  Memory Usage: 40kB
  ->  HashAggregate  (cost=1300.51..87550.51 rows=20000 width=68) (actual time=154.543..161.293 rows=12612 loops=1)
        Group Key: p.id
        Batches: 1  Memory Usage: 2577kB
        ->  Hash Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=49.936..131.819 rows=20000 loops=1)
              Hash Cond: (r.product_id = p.id)
              ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=1.271..74.519 rows=20000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=48.451..48.452 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 960kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.009..44.952 rows=20000 loops=1)
        SubPlan 2
          ->  Index Only Scan using idx_variant_product_promotion on "Variant" v2  (cost=0.28..158.09 rows=5739 width=4) (actual time=2.910..9.208 rows=5684 loops=1)
                Heap Fetches: 0
Planning Time: 5.394 ms
Execution Time: 167.328 ms


==================================================
EXPLAIN ANALYZE — Query 28: Top 5 Miast Generujących Największy Przychód (Wg. Adresu Wysyłki)
==================================================
Limit  (cost=15315.16..15315.17 rows=5 width=45) (actual time=3917.575..3942.697 rows=5 loops=1)
  ->  Sort  (cost=15315.16..15365.16 rows=20000 width=45) (actual time=3917.566..3941.375 rows=5 loops=1)
        Sort Key: (sum(oi.unit_price)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=14732.97..14982.97 rows=20000 width=45) (actual time=3906.412..3935.617 rows=12950 loops=1)
              Group Key: a.city
              Batches: 1  Memory Usage: 5905kB
              ->  Gather  (cost=12837.21..14607.97 rows=16666 width=45) (actual time=3716.579..3780.248 rows=16081 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=11837.21..11941.37 rows=8333 width=45) (actual time=3620.762..3626.414 rows=5360 loops=3)
                          Group Key: a.city
                          Batches: 1  Memory Usage: 2449kB
                          Worker 0:  Batches: 1  Memory Usage: 2449kB
                          Worker 1:  Batches: 1  Memory Usage: 2449kB
                          ->  Nested Loop  (cost=578.43..11795.55 rows=8333 width=19) (actual time=26.686..3577.787 rows=6667 loops=3)
                                ->  Hash Join  (cost=578.00..6705.67 rows=8333 width=10) (actual time=24.607..276.343 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.012..164.501 rows=133333 loops=3)
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=24.350..24.566 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.451..19.942 rows=20000 loops=3)
                                ->  Index Scan using "Address_pkey" on "Address" a  (cost=0.43..0.61 rows=1 width=17) (actual time=0.490..0.490 rows=1 loops=20000)
                                      Index Cond: (id = o.shipping_address_id)
Planning Time: 23.362 ms
Execution Time: 3951.190 ms


==================================================
EXPLAIN ANALYZE — Query 29: Porównanie Wolumenu Sprzedaży Produktów Promowanych vs. Niepromowanych (w Ostatnich 30 Dniach)
==================================================
Finalize GroupAggregate  (cost=6359.32..6415.12 rows=200 width=40) (actual time=921.974..1067.681 rows=2 loops=1)
  Group Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
  ->  Gather Merge  (cost=6359.32..6411.12 rows=400 width=40) (actual time=909.008..1062.130 rows=6 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=5359.29..5364.92 rows=200 width=40) (actual time=647.916..650.116 rows=2 loops=3)
              Group Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
              ->  Sort  (cost=5359.29..5360.50 rows=484 width=32) (actual time=639.568..641.575 rows=392 loops=3)
                    Sort Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
                    Sort Method: quicksort  Memory: 25kB
                    Worker 0:  Sort Method: quicksort  Memory: 25kB
                    Worker 1:  Sort Method: quicksort  Memory: 25kB
                    ->  Nested Loop  (cost=1015.06..5337.71 rows=484 width=32) (actual time=29.957..595.472 rows=392 loops=3)
                          ->  Nested Loop  (cost=1014.77..5185.67 rows=484 width=4) (actual time=28.064..503.137 rows=392 loops=3)
                                ->  Hash Join  (cost=1014.35..4584.93 rows=484 width=4) (actual time=23.509..78.431 rows=392 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Bitmap Heap Scan on "Order" o  (cost=436.35..3941.63 rows=9673 width=4) (actual time=6.937..65.688 rows=7838 loops=3)
                                            Recheck Cond: (order_date >= (now() - '30 days'::interval))
                                            Heap Blocks: exact=1297
                                            ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..430.55 rows=23216 width=0) (actual time=12.225..12.225 rows=23515 loops=1)
                                                  Index Cond: (order_date >= (now() - '30 days'::interval))
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=8) (actual time=7.856..7.857 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=8) (actual time=0.929..3.183 rows=20000 loops=3)
                                ->  Index Scan using "StockItem_pkey" on "StockItem" si  (cost=0.42..1.24 rows=1 width=8) (actual time=1.079..1.079 rows=1 loops=1177)
                                      Index Cond: (id = oi.stock_item_id)
                          ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.31 rows=1 width=8) (actual time=0.231..0.231 rows=1 loops=1177)
                                Index Cond: (id = si.variant_id)
Planning Time: 36.484 ms
Execution Time: 1075.381 ms


==================================================
EXPLAIN ANALYZE — Query 30: Wskaźnik Lojalności (Repeat Purchase Rate) Użytkowników z Podziałem na Miasto Adresu Rozliczeniowego
==================================================
Sort  (cost=68134.41..68209.82 rows=30162 width=61) (actual time=5254.862..5279.810 rows=66456 loops=1)
  Sort Key: (round((((count(*) FILTER (WHERE (u.orders_count > 1)))::numeric * 100.0) / (NULLIF(count(*), 0))::numeric), 2)) DESC
  Sort Method: external merge  Disk: 3192kB
  ->  Finalize HashAggregate  (cost=65136.24..65890.29 rows=30162 width=61) (actual time=5121.244..5200.065 rows=66456 loops=1)
        Group Key: a.city
        Batches: 5  Memory Usage: 8241kB  Disk Usage: 712kB
        ->  Gather  (cost=58349.79..64683.81 rows=60324 width=29) (actual time=4598.477..4692.556 rows=122160 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial HashAggregate  (cost=57349.79..57651.41 rows=30162 width=29) (actual time=4384.254..4399.585 rows=40720 loops=3)
                    Group Key: a.city
                    Batches: 1  Memory Usage: 5137kB
                    Worker 0:  Batches: 1  Memory Usage: 5137kB
                    Worker 1:  Batches: 1  Memory Usage: 5137kB
                    ->  Parallel Hash Join  (cost=34825.67..55683.12 rows=166667 width=21) (actual time=1584.378..4036.056 rows=133333 loops=3)
                          Hash Cond: (a.id = o.billing_address_id)
                          ->  Parallel Seq Scan on "Address" a  (cost=0.00..18288.00 rows=500000 width=17) (actual time=12.364..1580.794 rows=400000 loops=3)
                          ->  Parallel Hash  (cost=32742.34..32742.34 rows=166667 width=12) (actual time=1563.872..1565.788 rows=133333 loops=3)
                                Buckets: 524288  Batches: 1  Memory Usage: 22912kB
                                ->  Hash Join  (cost=24598.16..32742.34 rows=166667 width=12) (actual time=785.251..1252.236 rows=133333 loops=3)
                                      Hash Cond: (o.user_id = u.user_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.690..169.741 rows=133333 loops=3)
                                      ->  Hash  (cost=19615.94..19615.94 rows=286577 width=12) (actual time=582.689..584.073 rows=329619 loops=3)
                                            Buckets: 262144  Batches: 4  Memory Usage: 5596kB
                                            ->  Subquery Scan on u  (cost=0.42..19615.94 rows=286577 width=12) (actual time=6.766..410.215 rows=329619 loops=3)
                                                  ->  GroupAggregate  (cost=0.42..16750.17 rows=286577 width=12) (actual time=6.763..368.474 rows=329619 loops=3)
                                                        Group Key: "Order".user_id
                                                        ->  Index Only Scan using idx_order_user_id on "Order"  (cost=0.42..11884.40 rows=400000 width=4) (actual time=6.565..244.916 rows=400000 loops=3)
                                                              Heap Fetches: 150240
Planning Time: 5.611 ms
Execution Time: 5389.091 ms

FINISHED — 2025-11-22 17:22:20.976809
========================================================================================================================
========================================================================================================================
START EXPLAIN RUN — 2025-11-22 17:25:04.463114
========================================================================================================================


==================================================
EXPLAIN ANALYZE — Query 1: Średnia Wartość Zamówienia (AOV) w Ostatnim Miesiącu
==================================================
Aggregate  (cost=4939.34..4939.35 rows=1 width=32) (actual time=990.134..990.137 rows=1 loops=1)
  ->  HashAggregate  (cost=4908.94..4924.14 rows=1216 width=36) (actual time=989.628..990.035 rows=1213 loops=1)
        Group Key: o.id
        Batches: 1  Memory Usage: 577kB
        ->  Hash Join  (cost=4522.36..4902.86 rows=1216 width=10) (actual time=963.330..985.912 rows=1241 loops=1)
              Hash Cond: (oi.order_id = o.id)
              ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.016..10.656 rows=20000 loops=1)
              ->  Hash  (cost=4218.41..4218.41 rows=24316 width=4) (actual time=963.079..963.080 rows=24618 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1122kB
                    ->  Bitmap Heap Scan on "Order" o  (cost=456.88..4218.41 rows=24316 width=4) (actual time=33.370..956.190 rows=24618 loops=1)
                          Recheck Cond: (order_date >= (now() - '1 mon'::interval))
                          Heap Blocks: exact=3333
                          ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..450.80 rows=24316 width=0) (actual time=32.978..32.978 rows=24618 loops=1)
                                Index Cond: (order_date >= (now() - '1 mon'::interval))
Planning Time: 30.578 ms
Execution Time: 1001.570 ms


==================================================
EXPLAIN ANALYZE — Query 2: Średnia wartość zamówienia per użytkownik
==================================================
Sort  (cost=16066.87..16115.61 rows=19495 width=50) (actual time=5158.314..5214.574 rows=19296 loops=1)
  Sort Key: (round(avg(order_totals.total_price), 2)) DESC
  Sort Method: quicksort  Memory: 1612kB
  ->  Finalize HashAggregate  (cost=14385.35..14677.77 rows=19495 width=50) (actual time=5122.640..5197.131 rows=19296 loops=1)
        Group Key: u.id
        Batches: 5  Memory Usage: 8241kB  Disk Usage: 216kB
        ->  Gather  (cost=12537.36..14263.50 rows=16246 width=50) (actual time=4922.812..5074.337 rows=19429 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial HashAggregate  (cost=11537.36..11638.90 rows=8123 width=50) (actual time=4399.138..4411.833 rows=6476 loops=3)
                    Group Key: u.id
                    Batches: 1  Memory Usage: 3217kB
                    Worker 0:  Batches: 1  Memory Usage: 2961kB
                    Worker 1:  Batches: 1  Memory Usage: 2961kB
                    ->  Nested Loop  (cost=1110.75..11496.75 rows=8123 width=50) (actual time=146.609..4324.745 rows=6498 loops=3)
                          ->  Hash Join  (cost=1110.33..6550.49 rows=8123 width=36) (actual time=98.071..321.048 rows=6498 loops=3)
                                Hash Cond: (o.id = order_totals.order_id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=1.758..107.767 rows=133333 loops=3)
                                ->  Hash  (cost=866.64..866.64 rows=19495 width=36) (actual time=92.233..93.649 rows=19495 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1094kB
                                      ->  Subquery Scan on order_totals  (cost=428.00..866.64 rows=19495 width=36) (actual time=75.333..86.243 rows=19495 loops=3)
                                            ->  HashAggregate  (cost=428.00..671.69 rows=19495 width=36) (actual time=74.614..83.099 rows=19495 loops=3)
                                                  Group Key: oi.order_id
                                                  Batches: 1  Memory Usage: 7953kB
                                                  Worker 0:  Batches: 1  Memory Usage: 7953kB
                                                  Worker 1:  Batches: 1  Memory Usage: 7953kB
                                                  ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=3.677..25.651 rows=20000 loops=3)
                          ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.608..0.608 rows=1 loops=19495)
                                Index Cond: (id = o.user_id)
Planning Time: 52.138 ms
Execution Time: 5255.165 ms


==================================================
EXPLAIN ANALYZE — Query 3: Top 10 Najlepiej Sprzedających Się Produktów (wg. Ilości Sprzedanych Jednostek) w Ostatnim Kwartale
==================================================
Limit  (cost=11753.76..11753.79 rows=10 width=46) (actual time=1498.433..1646.609 rows=10 loops=1)
  ->  Sort  (cost=11753.76..11765.21 rows=4579 width=46) (actual time=1497.298..1644.494 rows=10 loops=1)
        Sort Key: (count(*)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=11609.02..11654.81 rows=4579 width=46) (actual time=1494.200..1642.352 rows=3926 loops=1)
              Group Key: p.name, m.name
              Batches: 1  Memory Usage: 721kB
              ->  Gather  (cost=11179.72..11580.40 rows=3816 width=46) (actual time=1413.895..1634.726 rows=4341 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=10179.72..10198.80 rows=1908 width=46) (actual time=1314.063..1315.864 rows=1447 loops=3)
                          Group Key: p.name, m.name
                          Batches: 1  Memory Usage: 369kB
                          Worker 0:  Batches: 1  Memory Usage: 369kB
                          Worker 1:  Batches: 1  Memory Usage: 369kB
                          ->  Hash Join  (cost=2302.53..10165.41 rows=1908 width=38) (actual time=42.586..1292.182 rows=1521 loops=3)
                                Hash Cond: (p.manufacturer_id = m.id)
                                ->  Nested Loop  (cost=2297.16..10154.88 rows=1908 width=17) (actual time=41.697..1285.672 rows=1521 loops=3)
                                      ->  Nested Loop  (cost=2296.87..9525.04 rows=1908 width=4) (actual time=39.899..1191.860 rows=1521 loops=3)
                                            ->  Nested Loop  (cost=2296.58..8925.69 rows=1908 width=4) (actual time=38.310..1076.804 rows=1521 loops=3)
                                                  ->  Hash Join  (cost=2296.16..6557.48 rows=1908 width=4) (actual time=24.531..76.230 rows=1521 loops=3)
                                                        Hash Cond: (o.id = oi.order_id)
                                                        ->  Parallel Bitmap Heap Scan on "Order" o  (cost=1718.16..5721.91 rows=38158 width=4) (actual time=15.441..56.046 rows=30425 loops=3)
                                                              Recheck Cond: (order_date >= (now() - '3 mons'::interval))
                                                              Heap Blocks: exact=1116
                                                              ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..1695.26 rows=91578 width=0) (actual time=44.307..44.307 rows=91276 loops=1)
                                                                    Index Cond: (order_date >= (now() - '3 mons'::interval))
                                                        ->  Hash  (cost=328.00..328.00 rows=20000 width=8) (actual time=6.489..6.490 rows=20000 loops=3)
                                                              Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                                                              ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=8) (actual time=0.024..2.390 rows=20000 loops=3)
                                                  ->  Index Scan using "StockItem_pkey" on "StockItem" si  (cost=0.42..1.24 rows=1 width=8) (actual time=0.655..0.655 rows=1 loops=4562)
                                                        Index Cond: (id = oi.stock_item_id)
                                            ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.31 rows=1 width=8) (actual time=0.073..0.073 rows=1 loops=4562)
                                                  Index Cond: (id = si.variant_id)
                                      ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=21) (actual time=0.058..0.058 rows=1 loops=4562)
                                            Index Cond: (id = v.product_id)
                                ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.646..0.647 rows=150 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 18kB
                                      ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.403..0.422 rows=150 loops=3)
Planning Time: 83.767 ms
Execution Time: 1659.224 ms


==================================================
EXPLAIN ANALYZE — Query 4: Top 5 produktów z najwięcej recenzjami
==================================================
Limit  (cost=1792.59..1792.61 rows=5 width=25) (actual time=137.109..137.113 rows=5 loops=1)
  ->  Sort  (cost=1792.59..1842.59 rows=20000 width=25) (actual time=137.108..137.110 rows=5 loops=1)
        Sort Key: (COALESCE(r.count, '0'::bigint)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Hash Left Join  (cost=969.89..1460.40 rows=20000 width=25) (actual time=126.298..133.350 rows=20000 loops=1)
              Hash Cond: (p.id = r.product_id)
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.012..1.490 rows=20000 loops=1)
              ->  Hash  (cost=812.24..812.24 rows=12612 width=12) (actual time=126.275..126.276 rows=12612 loops=1)
                    Buckets: 16384  Batches: 1  Memory Usage: 670kB
                    ->  Subquery Scan on r  (cost=560.00..812.24 rows=12612 width=12) (actual time=120.012..123.679 rows=12612 loops=1)
                          ->  HashAggregate  (cost=560.00..686.12 rows=12612 width=12) (actual time=120.011..122.492 rows=12612 loops=1)
                                Group Key: "Review".product_id
                                Batches: 1  Memory Usage: 1425kB
                                ->  Seq Scan on "Review"  (cost=0.00..460.00 rows=20000 width=4) (actual time=1.002..113.179 rows=20000 loops=1)
Planning Time: 9.342 ms
Execution Time: 144.370 ms


==================================================
EXPLAIN ANALYZE — Query 5: Całkowity Przychód Pogrupowany Miesięcznie za Ostatni Rok
==================================================
Finalize GroupAggregate  (cost=9719.19..11975.47 rows=17309 width=36) (actual time=196.712..319.565 rows=11 loops=1)
  Group Key: ((date_trunc('month'::text, o.order_date))::date)
  ->  Gather Merge  (cost=9719.19..11564.38 rows=14424 width=36) (actual time=195.724..317.890 rows=33 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=8719.17..8899.47 rows=7212 width=36) (actual time=83.748..85.078 rows=11 loops=3)
              Group Key: ((date_trunc('month'::text, o.order_date))::date)
              ->  Sort  (cost=8719.17..8737.20 rows=7212 width=10) (actual time=82.931..83.446 rows=5760 loops=3)
                    Sort Key: ((date_trunc('month'::text, o.order_date))::date) DESC
                    Sort Method: quicksort  Memory: 887kB
                    Worker 0:  Sort Method: quicksort  Memory: 36kB
                    Worker 1:  Sort Method: quicksort  Memory: 50kB
                    ->  Hash Join  (cost=578.00..8257.02 rows=7212 width=10) (actual time=10.794..78.843 rows=5760 loops=3)
                          Hash Cond: (o.id = oi.order_id)
                          ->  Parallel Seq Scan on "Order" o  (cost=0.00..6669.33 rows=144241 width=12) (actual time=0.015..44.784 rows=115772 loops=3)
                                Filter: (order_date >= (date_trunc('year'::text, now()) - '00:00:00'::interval))
                                Rows Removed by Filter: 17562
                          ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=10.294..10.295 rows=20000 loops=3)
                                Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.028..5.862 rows=20000 loops=3)
Planning Time: 13.099 ms
Execution Time: 327.678 ms


==================================================
EXPLAIN ANALYZE — Query 6: Produkty najczęściej dodawane do ulubionych
==================================================
Limit  (cost=14382.58..14382.60 rows=10 width=25) (actual time=887.040..952.185 rows=10 loops=1)
  ->  Sort  (cost=14382.58..14432.58 rows=20000 width=25) (actual time=887.033..951.112 rows=10 loops=1)
        Sort Key: (count(f.id)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=13750.38..13950.38 rows=20000 width=25) (actual time=878.131..945.300 rows=20000 loops=1)
              Group Key: p.id
              Batches: 1  Memory Usage: 2577kB
              ->  Gather  (cost=9350.38..13550.38 rows=40000 width=25) (actual time=750.743..876.730 rows=59993 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=8350.38..8550.38 rows=20000 width=25) (actual time=647.115..653.431 rows=19998 loops=3)
                          Group Key: p.id
                          Batches: 1  Memory Usage: 2577kB
                          Worker 0:  Batches: 1  Memory Usage: 2577kB
                          Worker 1:  Batches: 1  Memory Usage: 2577kB
                          ->  Hash Join  (cost=688.00..7100.38 rows=250000 width=21) (actual time=19.890..557.944 rows=200000 loops=3)
                                Hash Cond: (f.product_id = p.id)
                                ->  Parallel Seq Scan on "FavoriteProduct" f  (cost=0.00..5756.00 rows=250000 width=8) (actual time=11.213..464.656 rows=200000 loops=3)
                                ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=7.859..7.860 rows=20000 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1215kB
                                      ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.355..3.356 rows=20000 loops=3)
Planning Time: 23.643 ms
Execution Time: 955.416 ms


==================================================
EXPLAIN ANALYZE — Query 7: Dostępny Stan Magazynowy Wariantów Produktu Pogrupowany po Magazynach
==================================================
GroupAggregate  (cost=37640.01..42664.89 rows=223328 width=61) (actual time=1394.652..1721.227 rows=178012 loops=1)
  Group Key: p.name, w.name, v.sku
  ->  Sort  (cost=37640.01..38198.33 rows=223328 width=57) (actual time=1388.900..1614.558 rows=223971 loops=1)
        Sort Key: p.name, w.name, v.sku
        Sort Method: external merge  Disk: 15248kB
        ->  Hash Join  (cost=2189.15..9398.65 rows=223328 width=57) (actual time=29.488..600.590 rows=223971 loops=1)
              Hash Cond: (si.warehouse_id = w.id)
              ->  Hash Join  (cost=2144.50..8766.15 rows=223328 width=44) (actual time=29.468..557.664 rows=223971 loops=1)
                    Hash Cond: (v.product_id = p.id)
                    ->  Hash Join  (cost=1456.50..7491.79 rows=223328 width=35) (actual time=23.706..466.244 rows=223971 loops=1)
                          Hash Cond: (si.variant_id = v.id)
                          ->  Seq Scan on "StockItem" si  (cost=0.00..5449.00 rows=223328 width=12) (actual time=0.013..333.008 rows=223971 loops=1)
                                Filter: (shipment_id IS NULL)
                                Rows Removed by Filter: 96029
                          ->  Hash  (cost=869.00..869.00 rows=47000 width=31) (actual time=23.673..24.667 rows=47000 loops=1)
                                Buckets: 65536  Batches: 1  Memory Usage: 3450kB
                                ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=31) (actual time=0.005..6.835 rows=47000 loops=1)
                    ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=5.752..5.753 rows=20000 loops=1)
                          Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                          ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.005..2.428 rows=20000 loops=1)
              ->  Hash  (cost=25.40..25.40 rows=1540 width=21) (actual time=0.015..0.015 rows=10 loops=1)
                    Buckets: 2048  Batches: 1  Memory Usage: 17kB
                    ->  Seq Scan on "Warehouse" w  (cost=0.00..25.40 rows=1540 width=21) (actual time=0.009..0.010 rows=10 loops=1)
Planning Time: 9.977 ms
Execution Time: 1746.328 ms


==================================================
EXPLAIN ANALYZE — Query 8: Stan magazynowy per produkt
==================================================
Sort  (cost=11494.90..11544.43 rows=19812 width=21) (actual time=307.836..309.539 rows=17916 loops=1)
  Sort Key: (count(si.id)) DESC
  Sort Method: quicksort  Memory: 1482kB
  ->  HashAggregate  (cost=9882.79..10080.91 rows=19812 width=21) (actual time=300.279..304.197 rows=17916 loops=1)
        Group Key: p.name
        Batches: 1  Memory Usage: 2065kB
        ->  Hash Join  (cost=2144.50..8766.15 rows=223328 width=17) (actual time=20.636..219.885 rows=223971 loops=1)
              Hash Cond: (v.product_id = p.id)
              ->  Hash Join  (cost=1456.50..7491.79 rows=223328 width=8) (actual time=12.998..141.208 rows=223971 loops=1)
                    Hash Cond: (si.variant_id = v.id)
                    ->  Seq Scan on "StockItem" si  (cost=0.00..5449.00 rows=223328 width=8) (actual time=0.015..39.222 rows=223971 loops=1)
                          Filter: (shipment_id IS NULL)
                          Rows Removed by Filter: 96029
                    ->  Hash  (cost=869.00..869.00 rows=47000 width=8) (actual time=12.962..12.963 rows=47000 loops=1)
                          Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                          ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=8) (actual time=0.005..5.146 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=7.625..7.626 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=1.935..4.316 rows=20000 loops=1)
Planning Time: 21.105 ms
Execution Time: 311.340 ms


==================================================
EXPLAIN ANALYZE — Query 9: Najpopularniejsze Kategorie (wg. Całkowitego Przychodu)
==================================================
Limit  (cost=12371.00..12371.02 rows=10 width=44) (actual time=626.099..800.695 rows=10 loops=1)
  ->  Sort  (cost=12371.00..12371.37 rows=150 width=44) (actual time=625.381..799.973 rows=10 loops=1)
        Sort Key: (sum(oi.unit_price)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize GroupAggregate  (cost=12328.63..12367.76 rows=150 width=44) (actual time=623.996..798.723 rows=150 loops=1)
              Group Key: c.name
              ->  Gather Merge  (cost=12328.63..12363.63 rows=300 width=44) (actual time=618.610..792.118 rows=150 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Sort  (cost=11328.61..11328.98 rows=150 width=44) (actual time=177.054..178.768 rows=50 loops=3)
                          Sort Key: c.name
                          Sort Method: quicksort  Memory: 39kB
                          Worker 0:  Sort Method: quicksort  Memory: 25kB
                          Worker 1:  Sort Method: quicksort  Memory: 25kB
                          ->  Partial HashAggregate  (cost=11321.31..11323.19 rows=150 width=44) (actual time=171.763..172.744 rows=50 loops=3)
                                Group Key: c.name
                                Batches: 1  Memory Usage: 96kB
                                Worker 0:  Batches: 1  Memory Usage: 40kB
                                Worker 1:  Batches: 1  Memory Usage: 40kB
                                ->  Hash Join  (cost=8362.48..11112.98 rows=41667 width=18) (actual time=57.561..159.332 rows=33334 loops=3)
                                      Hash Cond: (pc.category_id = c.id)
                                      ->  Parallel Hash Join  (cost=8357.10..10995.13 rows=41667 width=10) (actual time=50.079..145.217 rows=33334 loops=3)
                                            Hash Cond: (pc.product_id = p.id)
                                            ->  Parallel Index Only Scan using uq_prodcat_product_category on "ProductCategory" pc  (cost=0.29..2236.96 rows=41667 width=8) (actual time=6.196..258.102 rows=100000 loops=1)
                                                  Heap Fetches: 0
                                            ->  Parallel Hash  (cost=8209.75..8209.75 rows=11765 width=14) (actual time=47.077..47.083 rows=6667 loops=3)
                                                  Buckets: 32768  Batches: 1  Memory Usage: 1216kB
                                                  ->  Hash Join  (cost=2722.50..8209.75 rows=11765 width=14) (actual time=23.183..118.408 rows=20000 loops=1)
                                                        Hash Cond: (v.product_id = p.id)
                                                        ->  Hash Join  (cost=2034.50..7490.85 rows=11765 width=10) (actual time=18.265..104.804 rows=20000 loops=1)
                                                              Hash Cond: (si.variant_id = v.id)
                                                              ->  Hash Join  (cost=578.00..6003.47 rows=11765 width=10) (actual time=5.523..83.139 rows=20000 loops=1)
                                                                    Hash Cond: (si.id = oi.stock_item_id)
                                                                    ->  Parallel Seq Scan on "StockItem" si  (cost=0.00..4131.35 rows=188235 width=8) (actual time=0.005..26.219 rows=320000 loops=1)
                                                                    ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=5.497..5.498 rows=20000 loops=1)
                                                                          Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                                                          ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.010..2.271 rows=20000 loops=1)
                                                              ->  Hash  (cost=869.00..869.00 rows=47000 width=8) (actual time=12.722..12.722 rows=47000 loops=1)
                                                                    Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                                                    ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=8) (actual time=0.009..5.134 rows=47000 loops=1)
                                                        ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=4.904..4.905 rows=20000 loops=1)
                                                              Buckets: 32768  Batches: 1  Memory Usage: 960kB
                                                              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.012..2.129 rows=20000 loops=1)
                                      ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=7.354..7.354 rows=150 loops=3)
                                            Buckets: 1024  Batches: 1  Memory Usage: 16kB
                                            ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=6.296..6.317 rows=150 loops=3)
Planning Time: 41.035 ms
Execution Time: 810.973 ms


==================================================
EXPLAIN ANALYZE — Query 10: Liczba produktów per kategoria
==================================================
Sort  (cost=2342.22..2342.59 rows=150 width=20) (actual time=130.719..131.704 rows=150 loops=1)
  Sort Key: (count(pc.product_id)) DESC
  Sort Method: quicksort  Memory: 30kB
  ->  HashAggregate  (cost=2335.30..2336.80 rows=150 width=20) (actual time=129.311..129.335 rows=150 loops=1)
        Group Key: c.name
        Batches: 1  Memory Usage: 48kB
        ->  Hash Right Join  (cost=5.38..1835.30 rows=100000 width=16) (actual time=3.532..108.697 rows=100000 loops=1)
              Hash Cond: (pc.category_id = c.id)
              ->  Seq Scan on "ProductCategory" pc  (cost=0.00..1560.00 rows=100000 width=8) (actual time=2.010..85.322 rows=100000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=0.080..0.081 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 16kB
                    ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=0.029..0.052 rows=150 loops=1)
Planning Time: 12.967 ms
Execution Time: 133.056 ms


==================================================
EXPLAIN ANALYZE — Query 11: Liczba zamówień per metoda płatności
==================================================
Sort  (cost=7808.47..7808.49 rows=6 width=50) (actual time=219.489..372.611 rows=6 loops=1)
  Sort Key: (sum(oi.unit_price)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  Finalize GroupAggregate  (cost=7806.80..7808.40 rows=6 width=50) (actual time=218.652..371.780 rows=6 loops=1)
        Group Key: pm.name
        ->  Gather Merge  (cost=7806.80..7808.20 rows=12 width=50) (actual time=217.714..369.992 rows=6 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Sort  (cost=6806.78..6806.79 rows=6 width=50) (actual time=47.753..47.759 rows=2 loops=3)
                    Sort Key: pm.name
                    Sort Method: quicksort  Memory: 25kB
                    Worker 0:  Sort Method: quicksort  Memory: 25kB
                    Worker 1:  Sort Method: quicksort  Memory: 25kB
                    ->  Partial HashAggregate  (cost=6806.62..6806.70 rows=6 width=50) (actual time=44.235..44.240 rows=2 loops=3)
                          Group Key: pm.name
                          Batches: 1  Memory Usage: 24kB
                          Worker 0:  Batches: 1  Memory Usage: 24kB
                          Worker 1:  Batches: 1  Memory Usage: 24kB
                          ->  Hash Join  (cost=579.13..6744.13 rows=8333 width=20) (actual time=2.501..40.719 rows=6667 loops=3)
                                Hash Cond: (o.payment_method_id = pm.id)
                                ->  Hash Join  (cost=578.00..6705.67 rows=8333 width=14) (actual time=1.843..38.715 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.002..12.274 rows=133333 loops=3)
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=5.507..5.508 rows=20000 loops=1)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.006..2.281 rows=20000 loops=1)
                                ->  Hash  (cost=1.06..1.06 rows=6 width=14) (actual time=0.568..0.569 rows=6 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                      ->  Seq Scan on "PaymentMethod" pm  (cost=0.00..1.06 rows=6 width=14) (actual time=0.032..0.033 rows=6 loops=3)
Planning Time: 20.556 ms
Execution Time: 376.922 ms


==================================================
EXPLAIN ANALYZE — Query 12: Średnia ocena per producent
==================================================
Sort  (cost=1367.54..1367.91 rows=150 width=57) (actual time=30.773..30.784 rows=150 loops=1)
  Sort Key: (round(avg(r.rating), 2)) DESC NULLS LAST
  Sort Method: quicksort  Memory: 32kB
  ->  HashAggregate  (cost=1359.87..1362.12 rows=150 width=57) (actual time=30.036..30.100 rows=150 loops=1)
        Group Key: m.name
        Batches: 1  Memory Usage: 64kB
        ->  Hash Join  (cost=693.38..1259.87 rows=20000 width=29) (actual time=5.947..23.565 rows=27388 loops=1)
              Hash Cond: (p.manufacturer_id = m.id)
              ->  Hash Right Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=5.878..18.116 rows=27388 loops=1)
                    Hash Cond: (r.product_id = p.id)
                    ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=0.009..2.789 rows=20000 loops=1)
                    ->  Hash  (cost=438.00..438.00 rows=20000 width=8) (actual time=5.274..5.275 rows=20000 loops=1)
                          Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                          ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=8) (actual time=0.005..2.252 rows=20000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.056..0.056 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 18kB
                    ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.015..0.031 rows=150 loops=1)
Planning Time: 7.326 ms
Execution Time: 31.463 ms


==================================================
EXPLAIN ANALYZE — Query 13: Aktywne promocje i objęta nimi liczba wariantów
==================================================
Sort  (cost=395.64..395.76 rows=47 width=14) (actual time=4.285..4.289 rows=46 loops=1)
  Sort Key: (count(v.id)) DESC
  Sort Method: quicksort  Memory: 26kB
  ->  HashAggregate  (cost=393.87..394.34 rows=47 width=14) (actual time=4.264..4.272 rows=46 loops=1)
        Group Key: pr.name
        Batches: 1  Memory Usage: 24kB
        ->  Merge Join  (cost=7.63..337.47 rows=11280 width=10) (actual time=0.077..3.944 rows=1340 loops=1)
              Merge Cond: (v.promotion_id = pr.id)
              ->  Index Scan using idx_variant_promotion on "Variant" v  (cost=0.29..2469.28 rows=47000 width=8) (actual time=0.021..3.073 rows=5685 loops=1)
              ->  Sort  (cost=7.34..7.46 rows=48 width=10) (actual time=0.051..0.056 rows=47 loops=1)
                    Sort Key: pr.id
                    Sort Method: quicksort  Memory: 26kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=48 width=10) (actual time=0.016..0.039 rows=47 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 153
Planning Time: 11.183 ms
Execution Time: 4.371 ms


==================================================
EXPLAIN ANALYZE — Query 14: Najczęściej wybierane warianty w koszykach
==================================================
Limit  (cost=224158.84..224158.87 rows=10 width=44) (actual time=8994.513..8994.518 rows=10 loops=1)
  ->  Sort  (cost=224158.84..227908.84 rows=1500000 width=44) (actual time=8994.512..8994.513 rows=10 loops=1)
        Sort Key: (sum(ci.quantity)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  GroupAggregate  (cost=4.24..191744.38 rows=1500000 width=44) (actual time=86.534..8974.120 rows=47000 loops=1)
              Group Key: v.sku, p.name
              ->  Incremental Sort  (cost=4.24..165494.38 rows=1500000 width=40) (actual time=42.579..8664.174 rows=1500000 loops=1)
                    Sort Key: v.sku, p.name
                    Presorted Key: v.sku
                    Full-sort Groups: 31708  Sort Method: quicksort  Average Memory: 27kB  Peak Memory: 27kB
                    Pre-sorted Groups: 6442  Sort Method: quicksort  Average Memory: 26kB  Peak Memory: 26kB
                    ->  Nested Loop  (cost=1.14..108333.20 rows=1500000 width=40) (actual time=5.763..8128.469 rows=1500000 loops=1)
                          ->  Nested Loop  (cost=0.71..8804.70 rows=47000 width=40) (actual time=4.213..238.773 rows=47000 loops=1)
                                ->  Index Scan using "Variant_sku_key" on "Variant" v  (cost=0.41..2051.42 rows=47000 width=31) (actual time=4.175..45.436 rows=47000 loops=1)
                                ->  Memoize  (cost=0.30..0.34 rows=1 width=17) (actual time=0.003..0.003 rows=1 loops=47000)
                                      Cache Key: v.product_id
                                      Cache Mode: logical
                                      Hits: 28889  Misses: 18111  Evictions: 0  Overflows: 0  Memory Usage: 2099kB
                                      ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=17) (actual time=0.004..0.004 rows=1 loops=18111)
                                            Index Cond: (id = v.product_id)
                          ->  Index Scan using idx_cartitem_variant_id on "CartItem" ci  (cost=0.43..1.80 rows=32 width=8) (actual time=0.009..0.163 rows=32 loops=47000)
                                Index Cond: (variant_id = v.id)
Planning Time: 15.122 ms
Execution Time: 8996.381 ms


==================================================
EXPLAIN ANALYZE — Query 15: Produkty z Największą Różnicą Między Ceną Podstawową a Ceną Wariantu
==================================================
Limit  (cost=2813.55..2813.58 rows=10 width=80) (actual time=49.054..49.849 rows=10 loops=1)
  ->  Sort  (cost=2813.55..2931.05 rows=47000 width=80) (actual time=49.052..49.055 rows=10 loops=1)
        Sort Key: v.price_modifier DESC
        Sort Method: top-N heapsort  Memory: 27kB
        ->  Hash Join  (cost=688.00..1797.90 rows=47000 width=80) (actual time=8.512..34.133 rows=47000 loops=1)
              Hash Cond: (v.product_id = p.id)
              ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=33) (actual time=1.502..4.856 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=6.367..6.368 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1381kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.012..2.678 rows=20000 loops=1)
Planning Time: 20.030 ms
Execution Time: 51.633 ms


==================================================
EXPLAIN ANALYZE — Query 16: Konwersja zamówień wg statusu
==================================================
Sort  (cost=7957.56..7962.66 rows=2040 width=48) (actual time=363.465..925.899 rows=7 loops=1)
  Sort Key: (count(o.id)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  WindowAgg  (cost=7824.99..7845.41 rows=2040 width=48) (actual time=363.443..924.865 rows=7 loops=1)
        ->  Finalize HashAggregate  (cost=7779.11..7799.51 rows=2040 width=16) (actual time=357.571..919.007 rows=7 loops=1)
              Group Key: s.name
              Batches: 1  Memory Usage: 121kB
              ->  Gather  (cost=7330.31..7758.71 rows=4080 width=16) (actual time=230.397..915.945 rows=7 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=6330.31..6350.71 rows=2040 width=16) (actual time=71.770..72.151 rows=2 loops=3)
                          Group Key: s.name
                          Batches: 1  Memory Usage: 121kB
                          Worker 0:  Batches: 1  Memory Usage: 121kB
                          Worker 1:  Batches: 1  Memory Usage: 121kB
                          ->  Hash Join  (cost=55.90..5496.98 rows=166667 width=12) (actual time=0.372..44.764 rows=133333 loops=3)
                                Hash Cond: (o.status_id = s.id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.004..12.833 rows=133333 loops=3)
                                ->  Hash  (cost=30.40..30.40 rows=2040 width=12) (actual time=0.029..0.030 rows=7 loops=1)
                                      Buckets: 2048  Batches: 1  Memory Usage: 17kB
                                      ->  Seq Scan on "Status" s  (cost=0.00..30.40 rows=2040 width=12) (actual time=0.022..0.024 rows=7 loops=1)
Planning Time: 29.652 ms
Execution Time: 932.560 ms


==================================================
EXPLAIN ANALYZE — Query 17: Top klienci wg wydatków
==================================================
Limit  (cost=15399.41..15399.44 rows=10 width=50) (actual time=4108.329..4225.848 rows=10 loops=1)
  ->  Sort  (cost=15399.41..15449.41 rows=20000 width=50) (actual time=4108.328..4225.274 rows=10 loops=1)
        Sort Key: (sum(oi.unit_price)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=14717.22..14967.22 rows=20000 width=50) (actual time=4072.982..4214.392 rows=19296 loops=1)
              Group Key: u.id
              Batches: 5  Memory Usage: 8241kB  Disk Usage: 224kB
              ->  Gather  (cost=12821.46..14592.22 rows=16666 width=50) (actual time=3479.309..3721.689 rows=19427 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=11821.46..11925.62 rows=8333 width=50) (actual time=3324.313..3369.841 rows=6476 loops=3)
                          Group Key: u.id
                          Batches: 1  Memory Usage: 3217kB
                          Worker 0:  Batches: 1  Memory Usage: 2961kB
                          Worker 1:  Batches: 1  Memory Usage: 2961kB
                          ->  Nested Loop  (cost=578.42..11779.80 rows=8333 width=24) (actual time=30.127..3253.587 rows=6667 loops=3)
                                ->  Hash Join  (cost=578.00..6705.67 rows=8333 width=10) (actual time=8.973..243.228 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.008..174.379 rows=133333 loops=3)
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=8.695..9.809 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.321..3.884 rows=20000 loops=3)
                                ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.449..0.449 rows=1 loops=20000)
                                      Index Cond: (id = o.user_id)
Planning Time: 26.692 ms
Execution Time: 4245.675 ms


==================================================
EXPLAIN ANALYZE — Query 18: Produkty z wariantami objętymi promocją, z końcową ceną
==================================================
Sort  (cost=1983.52..2011.72 rows=11280 width=132) (actual time=51.874..52.536 rows=1340 loops=1)
  Sort Key: (round(((p.price + v.price_modifier) * ('1'::numeric - pr.discount_percentage)), 2))
  Sort Method: quicksort  Memory: 146kB
  ->  Hash Join  (cost=695.63..1224.29 rows=11280 width=132) (actual time=28.398..47.576 rows=1340 loops=1)
        Hash Cond: (v.product_id = p.id)
        ->  Merge Join  (cost=7.63..337.47 rows=11280 width=39) (actual time=0.734..18.227 rows=1340 loops=1)
              Merge Cond: (v.promotion_id = pr.id)
              ->  Index Scan using idx_variant_promotion on "Variant" v  (cost=0.29..2469.28 rows=47000 width=37) (actual time=0.022..16.595 rows=5685 loops=1)
              ->  Sort  (cost=7.34..7.46 rows=48 width=10) (actual time=0.707..0.717 rows=47 loops=1)
                    Sort Key: pr.id
                    Sort Method: quicksort  Memory: 26kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=48 width=10) (actual time=0.032..0.055 rows=47 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 153
        ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=27.082..27.084 rows=20000 loops=1)
              Buckets: 32768  Batches: 1  Memory Usage: 1381kB
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.704..20.522 rows=20000 loops=1)
Planning Time: 42.227 ms
Execution Time: 54.510 ms


==================================================
EXPLAIN ANALYZE — Query 19: Użytkownicy, Którzy Dodali Produkt do Koszyka, Ale Nie Złożyli Zamówienia (Potencjał Odbudowy Koszyka)
==================================================
Hash Join  (cost=45873.97..103632.31 rows=1070130 width=55) (actual time=3331.675..9809.554 rows=1005006 loops=1)
  Hash Cond: (v.product_id = p.id)
  ->  Hash Join  (cost=45185.97..100134.62 rows=1070130 width=46) (actual time=3321.082..9224.065 rows=1005006 loops=1)
        Hash Cond: (ci.variant_id = v.id)
        ->  Hash Join  (cost=43729.47..95868.77 rows=1070130 width=46) (actual time=3304.059..8558.012 rows=1005006 loops=1)
              Hash Cond: (ci.cart_id = c.id)
              ->  Seq Scan on "CartItem" ci  (cost=0.00..23152.00 rows=1500000 width=8) (actual time=0.037..4217.547 rows=1500000 loops=1)
              ->  Hash  (cost=41450.81..41450.81 rows=107013 width=46) (actual time=3297.671..3318.009 rows=100414 loops=1)
                    Buckets: 131072  Batches: 2  Memory Usage: 4929kB
                    ->  Gather  (cost=25017.67..41450.81 rows=107013 width=46) (actual time=3068.307..3136.737 rows=100414 loops=1)
                          Workers Planned: 2
                          Workers Launched: 2
                          ->  Parallel Hash Right Anti Join  (cost=24017.67..29749.51 rows=44589 width=46) (actual time=2559.113..2574.144 rows=33471 loops=3)
                                Hash Cond: (o.user_id = u.id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=4) (actual time=20.787..586.575 rows=133333 loops=3)
                                ->  Parallel Hash  (cost=23236.42..23236.42 rows=62500 width=50) (actual time=1740.294..1741.023 rows=50000 loops=3)
                                      Buckets: 262144  Batches: 1  Memory Usage: 14720kB
                                      ->  Hash Join  (cost=4079.00..23236.42 rows=62500 width=50) (actual time=208.867..1573.511 rows=50000 loops=3)
                                            Hash Cond: (u.id = c.user_id)
                                            ->  Parallel Seq Scan on "User" u  (cost=0.00..18063.67 rows=416667 width=46) (actual time=1.066..1121.412 rows=333333 loops=3)
                                            ->  Hash  (cost=2204.00..2204.00 rows=150000 width=8) (actual time=197.138..197.139 rows=150000 loops=3)
                                                  Buckets: 262144  Batches: 1  Memory Usage: 7908kB
                                                  ->  Seq Scan on "Cart" c  (cost=0.00..2204.00 rows=150000 width=8) (actual time=16.244..106.766 rows=150000 loops=3)
        ->  Hash  (cost=869.00..869.00 rows=47000 width=8) (actual time=15.223..15.808 rows=47000 loops=1)
              Buckets: 65536  Batches: 1  Memory Usage: 2348kB
              ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=8) (actual time=0.013..5.143 rows=47000 loops=1)
  ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=7.042..7.043 rows=20000 loops=1)
        Buckets: 32768  Batches: 1  Memory Usage: 1245kB
        ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=1.414..3.757 rows=20000 loops=1)
Planning Time: 79.565 ms
Execution Time: 9884.859 ms


==================================================
EXPLAIN ANALYZE — Query 20: Wyszukiwanie produktów po nazwie lub opisie (parametryzowane)
==================================================
Bitmap Heap Scan on "Product"  (cost=43.00..57.51 rows=4 width=60) (actual time=9.849..30.721 rows=143 loops=1)
  Recheck Cond: (((name)::text ~~* '%test%'::text) OR (description ~~* '%test%'::text))
  Heap Blocks: exact=106
  ->  BitmapOr  (cost=43.00..43.00 rows=4 width=0) (actual time=7.551..7.552 rows=0 loops=1)
        ->  Bitmap Index Scan on idx_product_name_trgm  (cost=0.00..21.50 rows=2 width=0) (actual time=6.821..6.821 rows=42 loops=1)
              Index Cond: ((name)::text ~~* '%test%'::text)
        ->  Bitmap Index Scan on idx_product_description_trgm  (cost=0.00..21.50 rows=2 width=0) (actual time=0.724..0.725 rows=102 loops=1)
              Index Cond: (description ~~* '%test%'::text)
Planning Time: 124.314 ms
Execution Time: 37.311 ms


==================================================
EXPLAIN ANALYZE — Query 21: Użytkownicy, Którzy Zapisali Konkretny Produkt jako Ulubiony (np. Product ID=350259)
==================================================
Nested Loop  (cost=0.85..262.23 rows=30 width=56) (actual time=3.025..15.323 rows=26 loops=1)
  ->  Index Only Scan using idx_favoriteproduct_product_user on "FavoriteProduct" fp  (cost=0.42..8.95 rows=30 width=4) (actual time=1.850..1.858 rows=26 loops=1)
        Index Cond: (product_id = 35)
        Heap Fetches: 0
  ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..8.44 rows=1 width=60) (actual time=0.517..0.517 rows=1 loops=26)
        Index Cond: (id = fp.user_id)
Planning Time: 8.656 ms
Execution Time: 15.357 ms


==================================================
EXPLAIN ANALYZE — Query 22: Znajdź Magazyny, Które Posiadają Zapasy Konkretnego Wariantu (np. SKU='VR-000000-a637d44b7afd')
==================================================
GroupAggregate  (cost=24.91..25.01 rows=2 width=25) (actual time=2.833..2.834 rows=0 loops=1)
  Group Key: w.name
  Filter: (count(si.id) > 0)
  ->  Sort  (cost=24.91..24.93 rows=5 width=21) (actual time=2.832..2.833 rows=0 loops=1)
        Sort Key: w.name
        Sort Method: quicksort  Memory: 25kB
        ->  Nested Loop  (cost=0.99..24.86 rows=5 width=21) (actual time=2.212..2.213 rows=0 loops=1)
              ->  Nested Loop  (cost=0.84..24.00 rows=5 width=8) (actual time=2.211..2.212 rows=0 loops=1)
                    ->  Index Scan using "Variant_sku_key" on "Variant" v  (cost=0.41..8.43 rows=1 width=4) (actual time=2.211..2.211 rows=0 loops=1)
                          Index Cond: ((sku)::text = 'VR-000001-2704de10f283'::text)
                    ->  Index Scan using idx_stockitem_shipment_variant_warehouse on "StockItem" si  (cost=0.42..15.52 rows=5 width=12) (never executed)
                          Index Cond: ((shipment_id IS NULL) AND (variant_id = v.id))
              ->  Index Scan using "Warehouse_pkey" on "Warehouse" w  (cost=0.15..0.17 rows=1 width=21) (never executed)
                    Index Cond: (id = si.warehouse_id)
Planning Time: 9.276 ms
Execution Time: 3.959 ms


==================================================
EXPLAIN ANALYZE — Query 23: Warianty, Które Wymagają Uzyskania Konkretnej Opcji (np. 'Kolor'='Czerwony')
==================================================
Nested Loop  (cost=6.96..680.20 rows=1 width=36) (actual time=0.030..0.031 rows=0 loops=1)
  ->  Nested Loop  (cost=6.67..679.87 rows=1 width=27) (actual time=0.029..0.030 rows=0 loops=1)
        ->  Nested Loop  (cost=6.38..679.55 rows=1 width=4) (actual time=0.029..0.030 rows=0 loops=1)
              Join Filter: (opt.attribute_id = a.id)
              ->  Index Scan using "Attribute_name_key" on "Attribute" a  (cost=0.15..8.17 rows=1 width=4) (actual time=0.029..0.029 rows=0 loops=1)
                    Index Cond: ((name)::text = 'Attr_49_Century'::text)
              ->  Nested Loop  (cost=6.23..668.26 rows=250 width=8) (never executed)
                    ->  Seq Scan on "Option" opt  (cost=0.00..18.50 rows=1 width=8) (never executed)
                          Filter: ((value)::text = 'do'::text)
                    ->  Bitmap Heap Scan on "VariantOption" vo  (cost=6.23..647.26 rows=250 width=8) (never executed)
                          Recheck Cond: (option_id = opt.id)
                          ->  Bitmap Index Scan on idx_variantoption_option_id  (cost=0.00..6.17 rows=250 width=0) (never executed)
                                Index Cond: (option_id = opt.id)
        ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.32 rows=1 width=31) (never executed)
              Index Cond: (id = vo.variant_id)
  ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=17) (never executed)
        Index Cond: (id = v.product_id)
Planning Time: 42.310 ms
Execution Time: 0.079 ms


==================================================
EXPLAIN ANALYZE — Query 24: Znajdź Zamówienia Użytkownika (np. email='debbie.lane.16786.50af0753@example.com') o Statusie 'Paid'
==================================================
Nested Loop  (cost=1.00..17.09 rows=1 width=20) (actual time=2.858..2.860 rows=0 loops=1)
  ->  Nested Loop  (cost=0.85..16.89 rows=1 width=16) (actual time=2.857..2.858 rows=0 loops=1)
        ->  Index Scan using "User_email_key" on "User" u  (cost=0.42..8.44 rows=1 width=4) (actual time=2.856..2.857 rows=0 loops=1)
              Index Cond: ((email)::text = 'debbie.lane.16786.50af0753@example.com'::text)
        ->  Index Scan using idx_order_user_id on "Order" o  (cost=0.42..8.44 rows=1 width=20) (never executed)
              Index Cond: (user_id = u.id)
  ->  Index Scan using "Status_pkey" on "Status" s  (cost=0.15..0.17 rows=1 width=12) (never executed)
        Index Cond: (id = o.status_id)
        Filter: ((name)::text = 'Paid'::text)
Planning Time: 6.810 ms
Execution Time: 2.915 ms


==================================================
EXPLAIN ANALYZE — Query 25: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
Nested Loop Left Join  (cost=5.45..49.87 rows=16 width=87) (actual time=1.184..9.546 rows=18 loops=1)
  ->  Nested Loop Left Join  (cost=5.30..46.34 rows=16 width=45) (actual time=1.138..9.328 rows=18 loops=1)
        ->  Nested Loop Left Join  (cost=5.02..41.66 rows=16 width=39) (actual time=1.070..9.047 rows=18 loops=1)
              ->  Nested Loop  (cost=4.60..23.91 rows=3 width=39) (actual time=0.045..4.015 rows=4 loops=1)
                    ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..8.30 rows=1 width=10) (actual time=0.009..0.010 rows=1 loops=1)
                          Index Cond: (id = 35)
                    ->  Bitmap Heap Scan on "Variant" v  (cost=4.31..15.57 rows=3 width=37) (actual time=0.016..3.978 rows=4 loops=1)
                          Recheck Cond: (product_id = 35)
                          Heap Blocks: exact=4
                          ->  Bitmap Index Scan on idx_variant_product_id  (cost=0.00..4.31 rows=3 width=0) (actual time=0.007..0.007 rows=4 loops=1)
                                Index Cond: (product_id = 35)
              ->  Index Only Scan using uq_varopt_variant_option on "VariantOption" vo  (cost=0.42..5.86 rows=6 width=8) (actual time=1.247..1.250 rows=4 loops=4)
                    Index Cond: (variant_id = v.id)
                    Heap Fetches: 0
        ->  Index Scan using "Option_pkey" on "Option" opt  (cost=0.28..0.29 rows=1 width=14) (actual time=0.013..0.013 rows=1 loops=18)
              Index Cond: (id = vo.option_id)
  ->  Index Scan using "Attribute_pkey" on "Attribute" a  (cost=0.15..0.22 rows=1 width=18) (actual time=0.007..0.007 rows=1 loops=18)
        Index Cond: (id = opt.attribute_id)
Planning Time: 0.685 ms
Execution Time: 9.609 ms


==================================================
EXPLAIN ANALYZE — Query 26: Lista Wszystkich Dziecięcych Kategorii (Podkategorii) dla Konkretnej Kategorii Nadrzędnej (np. ID=5)
==================================================
Seq Scan on "Category"  (cost=0.00..3.88 rows=3 width=12) (actual time=0.662..1.293 rows=3 loops=1)
  Filter: (parent_id = 5)
  Rows Removed by Filter: 147
Planning Time: 1.481 ms
Execution Time: 1.313 ms


==================================================
EXPLAIN ANALYZE — Query 27: Porównanie Średniej Oceny dla Promowanych i Niepromowanych Produktów
==================================================
HashAggregate  (cost=87850.51..87853.01 rows=200 width=64) (actual time=139.616..139.621 rows=2 loops=1)
  Group Key: CASE WHEN (ANY (p.id = (hashed SubPlan 2).col1)) THEN 'Promowany'::text ELSE 'Niepromowany'::text END
  Batches: 1  Memory Usage: 40kB
  ->  HashAggregate  (cost=1300.51..87550.51 rows=20000 width=68) (actual time=129.961..136.658 rows=12612 loops=1)
        Group Key: p.id
        Batches: 1  Memory Usage: 2577kB
        ->  Hash Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=62.447..111.066 rows=20000 loops=1)
              Hash Cond: (r.product_id = p.id)
              ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=1.892..42.623 rows=20000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=60.394..60.395 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 960kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.009..54.816 rows=20000 loops=1)
        SubPlan 2
          ->  Index Only Scan using idx_variant_product_promotion on "Variant" v2  (cost=0.28..158.09 rows=5739 width=4) (actual time=3.510..8.964 rows=5684 loops=1)
                Heap Fetches: 0
Planning Time: 7.825 ms
Execution Time: 141.728 ms


==================================================
EXPLAIN ANALYZE — Query 28: Top 5 Miast Generujących Największy Przychód (Wg. Adresu Wysyłki)
==================================================
Limit  (cost=15315.16..15315.17 rows=5 width=45) (actual time=4117.827..4178.008 rows=5 loops=1)
  ->  Sort  (cost=15315.16..15365.16 rows=20000 width=45) (actual time=4116.931..4175.796 rows=5 loops=1)
        Sort Key: (sum(oi.unit_price)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=14732.97..14982.97 rows=20000 width=45) (actual time=4106.288..4170.569 rows=12950 loops=1)
              Group Key: a.city
              Batches: 1  Memory Usage: 5905kB
              ->  Gather  (cost=12837.21..14607.97 rows=16666 width=45) (actual time=3928.121..4019.235 rows=16148 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=11837.21..11941.37 rows=8333 width=45) (actual time=3821.978..3826.050 rows=5383 loops=3)
                          Group Key: a.city
                          Batches: 1  Memory Usage: 2449kB
                          Worker 0:  Batches: 1  Memory Usage: 2449kB
                          Worker 1:  Batches: 1  Memory Usage: 2449kB
                          ->  Nested Loop  (cost=578.43..11795.55 rows=8333 width=19) (actual time=17.603..3741.603 rows=6667 loops=3)
                                ->  Hash Join  (cost=578.00..6705.67 rows=8333 width=10) (actual time=15.779..207.059 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.007..100.348 rows=133333 loops=3)
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=15.491..15.497 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.718..11.164 rows=20000 loops=3)
                                ->  Index Scan using "Address_pkey" on "Address" a  (cost=0.43..0.61 rows=1 width=17) (actual time=0.526..0.526 rows=1 loops=20000)
                                      Index Cond: (id = o.shipping_address_id)
Planning Time: 27.573 ms
Execution Time: 4190.660 ms


==================================================
EXPLAIN ANALYZE — Query 29: Porównanie Wolumenu Sprzedaży Produktów Promowanych vs. Niepromowanych (w Ostatnich 30 Dniach)
==================================================
Finalize GroupAggregate  (cost=6359.26..6415.06 rows=200 width=40) (actual time=928.005..1079.722 rows=2 loops=1)
  Group Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
  ->  Gather Merge  (cost=6359.26..6411.06 rows=400 width=40) (actual time=927.068..1079.698 rows=6 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=5359.24..5364.87 rows=200 width=40) (actual time=586.508..587.461 rows=2 loops=3)
              Group Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
              ->  Sort  (cost=5359.24..5360.45 rows=484 width=32) (actual time=585.562..586.085 rows=392 loops=3)
                    Sort Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
                    Sort Method: quicksort  Memory: 25kB
                    Worker 0:  Sort Method: quicksort  Memory: 25kB
                    Worker 1:  Sort Method: quicksort  Memory: 25kB
                    ->  Nested Loop  (cost=1015.04..5337.66 rows=484 width=32) (actual time=24.875..559.412 rows=392 loops=3)
                          ->  Nested Loop  (cost=1014.75..5185.62 rows=484 width=4) (actual time=23.751..497.553 rows=392 loops=3)
                                ->  Hash Join  (cost=1014.33..4584.88 rows=484 width=4) (actual time=19.760..41.088 rows=392 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Bitmap Heap Scan on "Order" o  (cost=436.33..3941.59 rows=9672 width=4) (actual time=6.882..24.478 rows=7838 loops=3)
                                            Recheck Cond: (order_date >= (now() - '30 days'::interval))
                                            Heap Blocks: exact=1597
                                            ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..430.52 rows=23213 width=0) (actual time=11.119..11.120 rows=23513 loops=1)
                                                  Index Cond: (order_date >= (now() - '30 days'::interval))
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=8) (actual time=11.324..11.812 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=8) (actual time=4.459..6.693 rows=20000 loops=3)
                                ->  Index Scan using "StockItem_pkey" on "StockItem" si  (cost=0.42..1.24 rows=1 width=8) (actual time=1.162..1.162 rows=1 loops=1177)
                                      Index Cond: (id = oi.stock_item_id)
                          ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.31 rows=1 width=8) (actual time=0.155..0.155 rows=1 loops=1177)
                                Index Cond: (id = si.variant_id)
Planning Time: 38.342 ms
Execution Time: 1093.789 ms


==================================================
EXPLAIN ANALYZE — Query 30: Wskaźnik Lojalności (Repeat Purchase Rate) Użytkowników z Podziałem na Miasto Adresu Rozliczeniowego
==================================================
Sort  (cost=68134.41..68209.82 rows=30162 width=61) (actual time=4498.312..4517.645 rows=66456 loops=1)
  Sort Key: (round((((count(*) FILTER (WHERE (u.orders_count > 1)))::numeric * 100.0) / (NULLIF(count(*), 0))::numeric), 2)) DESC
  Sort Method: external merge  Disk: 3192kB
  ->  Finalize HashAggregate  (cost=65136.24..65890.29 rows=30162 width=61) (actual time=4321.424..4381.232 rows=66456 loops=1)
        Group Key: a.city
        Batches: 5  Memory Usage: 8241kB  Disk Usage: 712kB
        ->  Gather  (cost=58349.79..64683.81 rows=60324 width=29) (actual time=3766.875..3921.034 rows=122294 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial HashAggregate  (cost=57349.79..57651.41 rows=30162 width=29) (actual time=3599.874..3638.830 rows=40765 loops=3)
                    Group Key: a.city
                    Batches: 1  Memory Usage: 5137kB
                    Worker 0:  Batches: 1  Memory Usage: 5137kB
                    Worker 1:  Batches: 1  Memory Usage: 5137kB
                    ->  Parallel Hash Join  (cost=34825.67..55683.12 rows=166667 width=21) (actual time=1189.692..3379.966 rows=133333 loops=3)
                          Hash Cond: (a.id = o.billing_address_id)
                          ->  Parallel Seq Scan on "Address" a  (cost=0.00..18288.00 rows=500000 width=17) (actual time=5.379..1410.536 rows=400000 loops=3)
                          ->  Parallel Hash  (cost=32742.34..32742.34 rows=166667 width=12) (actual time=1180.213..1182.189 rows=133333 loops=3)
                                Buckets: 524288  Batches: 1  Memory Usage: 22912kB
                                ->  Hash Join  (cost=24598.16..32742.34 rows=166667 width=12) (actual time=543.894..912.600 rows=133333 loops=3)
                                      Hash Cond: (o.user_id = u.user_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=2.787..101.174 rows=133333 loops=3)
                                      ->  Hash  (cost=19615.94..19615.94 rows=286577 width=12) (actual time=460.135..460.856 rows=329619 loops=3)
                                            Buckets: 262144  Batches: 4  Memory Usage: 5596kB
                                            ->  Subquery Scan on u  (cost=0.42..19615.94 rows=286577 width=12) (actual time=14.492..327.840 rows=329619 loops=3)
                                                  ->  GroupAggregate  (cost=0.42..16750.17 rows=286577 width=12) (actual time=14.489..294.981 rows=329619 loops=3)
                                                        Group Key: "Order".user_id
                                                        ->  Index Only Scan using idx_order_user_id on "Order"  (cost=0.42..11884.40 rows=400000 width=4) (actual time=13.107..201.968 rows=400000 loops=3)
                                                              Heap Fetches: 150240
Planning Time: 11.447 ms
Execution Time: 4624.068 ms

FINISHED — 2025-11-22 17:25:56.736905
========================================================================================================================
========================================================================================================================
START EXPLAIN RUN — 2025-11-22 18:14:12.149817
========================================================================================================================


==================================================
EXPLAIN ANALYZE — Query 1: Średnia Wartość Zamówienia (AOV) w Ostatnim Miesiącu
==================================================
Aggregate  (cost=4969.13..4969.14 rows=1 width=32) (actual time=167.839..168.849 rows=1 loops=1)
  ->  HashAggregate  (cost=4938.03..4953.58 rows=1244 width=36) (actual time=167.346..167.743 rows=1212 loops=1)
        Group Key: o.id
        Batches: 1  Memory Usage: 577kB
        ->  Hash Join  (cost=4551.31..4931.81 rows=1244 width=10) (actual time=159.128..164.454 rows=1240 loops=1)
              Hash Cond: (oi.order_id = o.id)
              ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.015..1.456 rows=20000 loops=1)
              ->  Hash  (cost=4240.42..4240.42 rows=24871 width=4) (actual time=158.817..158.818 rows=24588 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1121kB
                    ->  Bitmap Heap Scan on "Order" o  (cost=469.18..4240.42 rows=24871 width=4) (actual time=51.096..152.019 rows=24588 loops=1)
                          Recheck Cond: (order_date >= (now() - '1 mon'::interval))
                          Heap Blocks: exact=3333
                          ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..462.96 rows=24871 width=0) (actual time=50.706..50.706 rows=24588 loops=1)
                                Index Cond: (order_date >= (now() - '1 mon'::interval))
Planning Time: 47.018 ms
Execution Time: 170.109 ms


==================================================
EXPLAIN ANALYZE — Query 2: Średnia wartość zamówienia per użytkownik
==================================================
Sort  (cost=16066.87..16115.61 rows=19495 width=50) (actual time=5228.640..5234.819 rows=19296 loops=1)
  Sort Key: (round(avg(order_totals.total_price), 2)) DESC
  Sort Method: quicksort  Memory: 1612kB
  ->  Finalize HashAggregate  (cost=14385.35..14677.77 rows=19495 width=50) (actual time=5200.542..5216.910 rows=19296 loops=1)
        Group Key: u.id
        Batches: 5  Memory Usage: 8241kB  Disk Usage: 224kB
        ->  Gather  (cost=12537.36..14263.50 rows=16246 width=50) (actual time=4814.508..5005.259 rows=19432 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial HashAggregate  (cost=11537.36..11638.90 rows=8123 width=50) (actual time=4565.617..4644.155 rows=6477 loops=3)
                    Group Key: u.id
                    Batches: 1  Memory Usage: 3217kB
                    Worker 0:  Batches: 1  Memory Usage: 3217kB
                    Worker 1:  Batches: 1  Memory Usage: 2961kB
                    ->  Nested Loop  (cost=1110.75..11496.75 rows=8123 width=50) (actual time=337.868..4507.601 rows=6498 loops=3)
                          ->  Hash Join  (cost=1110.33..6550.49 rows=8123 width=36) (actual time=279.617..390.948 rows=6498 loops=3)
                                Hash Cond: (o.id = order_totals.order_id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.010..40.711 rows=133333 loops=3)
                                ->  Hash  (cost=866.64..866.64 rows=19495 width=36) (actual time=277.726..278.135 rows=19495 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1094kB
                                      ->  Subquery Scan on order_totals  (cost=428.00..866.64 rows=19495 width=36) (actual time=262.270..272.358 rows=19495 loops=3)
                                            ->  HashAggregate  (cost=428.00..671.69 rows=19495 width=36) (actual time=262.269..270.158 rows=19495 loops=3)
                                                  Group Key: oi.order_id
                                                  Batches: 1  Memory Usage: 7953kB
                                                  Worker 0:  Batches: 1  Memory Usage: 7953kB
                                                  Worker 1:  Batches: 1  Memory Usage: 7953kB
                                                  ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=2.796..68.368 rows=20000 loops=3)
                          ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.626..0.626 rows=1 loops=19495)
                                Index Cond: (id = o.user_id)
Planning Time: 33.389 ms
Execution Time: 5270.811 ms


==================================================
EXPLAIN ANALYZE — Query 3: Top 10 Najlepiej Sprzedających Się Produktów (wg. Ilości Sprzedanych Jednostek) w Ostatnim Kwartale
==================================================
Limit  (cost=11770.27..11770.29 rows=10 width=46) (actual time=1512.155..1661.370 rows=10 loops=1)
  ->  Sort  (cost=11770.27..11781.74 rows=4589 width=46) (actual time=1512.147..1660.724 rows=10 loops=1)
        Sort Key: (count(*)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=11625.21..11671.10 rows=4589 width=46) (actual time=1508.616..1658.161 rows=3925 loops=1)
              Group Key: p.name, m.name
              Batches: 1  Memory Usage: 721kB
              ->  Gather  (cost=11195.01..11596.53 rows=3824 width=46) (actual time=1428.475..1653.584 rows=4337 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=10195.01..10214.13 rows=1912 width=46) (actual time=1339.339..1340.344 rows=1446 loops=3)
                          Group Key: p.name, m.name
                          Batches: 1  Memory Usage: 369kB
                          Worker 0:  Batches: 1  Memory Usage: 369kB
                          Worker 1:  Batches: 1  Memory Usage: 369kB
                          ->  Hash Join  (cost=2308.14..10180.67 rows=1912 width=38) (actual time=43.961..1333.232 rows=1520 loops=3)
                                Hash Cond: (p.manufacturer_id = m.id)
                                ->  Nested Loop  (cost=2302.77..10170.13 rows=1912 width=17) (actual time=43.106..1330.762 rows=1520 loops=3)
                                      ->  Nested Loop  (cost=2302.48..9538.97 rows=1912 width=4) (actual time=41.828..1240.825 rows=1520 loops=3)
                                            ->  Nested Loop  (cost=2302.19..8938.36 rows=1912 width=4) (actual time=40.820..1151.784 rows=1520 loops=3)
                                                  ->  Hash Join  (cost=2301.77..6565.19 rows=1912 width=4) (actual time=36.294..94.218 rows=1520 loops=3)
                                                        Hash Cond: (o.id = oi.order_id)
                                                        ->  Parallel Bitmap Heap Scan on "Order" o  (cost=1723.77..5729.04 rows=38244 width=4) (actual time=24.091..71.657 rows=30413 loops=3)
                                                              Recheck Cond: (order_date >= (now() - '3 mons'::interval))
                                                              Heap Blocks: exact=1078
                                                              ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..1700.82 rows=91786 width=0) (actual time=71.710..71.711 rows=91239 loops=1)
                                                                    Index Cond: (order_date >= (now() - '3 mons'::interval))
                                                        ->  Hash  (cost=328.00..328.00 rows=20000 width=8) (actual time=9.438..9.439 rows=20000 loops=3)
                                                              Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                                                              ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=8) (actual time=0.382..5.191 rows=20000 loops=3)
                                                  ->  Index Scan using "StockItem_pkey" on "StockItem" si  (cost=0.42..1.24 rows=1 width=8) (actual time=0.695..0.695 rows=1 loops=4561)
                                                        Index Cond: (id = oi.stock_item_id)
                                            ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.31 rows=1 width=8) (actual time=0.057..0.057 rows=1 loops=4561)
                                                  Index Cond: (id = si.variant_id)
                                      ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=21) (actual time=0.058..0.058 rows=1 loops=4561)
                                            Index Cond: (id = v.product_id)
                                ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.630..0.630 rows=150 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 18kB
                                      ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.035..0.053 rows=150 loops=3)
Planning Time: 73.366 ms
Execution Time: 1674.160 ms


==================================================
EXPLAIN ANALYZE — Query 4: Top 5 produktów z najwięcej recenzjami
==================================================
Limit  (cost=1792.59..1792.61 rows=5 width=25) (actual time=129.848..130.716 rows=5 loops=1)
  ->  Sort  (cost=1792.59..1842.59 rows=20000 width=25) (actual time=129.847..129.851 rows=5 loops=1)
        Sort Key: (COALESCE(r.count, '0'::bigint)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Hash Left Join  (cost=969.89..1460.40 rows=20000 width=25) (actual time=118.907..126.128 rows=20000 loops=1)
              Hash Cond: (p.id = r.product_id)
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.011..1.526 rows=20000 loops=1)
              ->  Hash  (cost=812.24..812.24 rows=12612 width=12) (actual time=118.885..118.887 rows=12612 loops=1)
                    Buckets: 16384  Batches: 1  Memory Usage: 670kB
                    ->  Subquery Scan on r  (cost=560.00..812.24 rows=12612 width=12) (actual time=112.452..116.168 rows=12612 loops=1)
                          ->  HashAggregate  (cost=560.00..686.12 rows=12612 width=12) (actual time=112.451..114.974 rows=12612 loops=1)
                                Group Key: "Review".product_id
                                Batches: 1  Memory Usage: 1425kB
                                ->  Seq Scan on "Review"  (cost=0.00..460.00 rows=20000 width=4) (actual time=1.226..105.813 rows=20000 loops=1)
Planning Time: 7.890 ms
Execution Time: 133.458 ms


==================================================
EXPLAIN ANALYZE — Query 5: Całkowity Przychód Pogrupowany Miesięcznie za Ostatni Rok
==================================================
Finalize GroupAggregate  (cost=9617.65..11883.29 rows=17380 width=36) (actual time=204.182..302.735 rows=11 loops=1)
  Group Key: ((date_trunc('month'::text, o.order_date))::date)
  ->  Gather Merge  (cost=9617.65..11470.51 rows=14484 width=36) (actual time=203.658..301.594 rows=11 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=8617.62..8798.67 rows=7242 width=36) (actual time=69.342..70.742 rows=4 loops=3)
              Group Key: ((date_trunc('month'::text, o.order_date))::date)
              ->  Sort  (cost=8617.62..8635.73 rows=7242 width=10) (actual time=68.679..69.274 rows=5760 loops=3)
                    Sort Key: ((date_trunc('month'::text, o.order_date))::date) DESC
                    Sort Method: quicksort  Memory: 1309kB
                    Worker 0:  Sort Method: quicksort  Memory: 25kB
                    Worker 1:  Sort Method: quicksort  Memory: 25kB
                    ->  Parallel Hash Join  (cost=681.00..8153.33 rows=7242 width=10) (actual time=6.904..66.074 rows=5760 loops=3)
                          Hash Cond: (o.id = oi.order_id)
                          ->  Parallel Seq Scan on "Order" o  (cost=0.00..6669.33 rows=144838 width=12) (actual time=2.188..122.336 rows=347315 loops=1)
                                Filter: (order_date >= (date_trunc('year'::text, now()) - '00:00:00'::interval))
                                Rows Removed by Filter: 52685
                          ->  Parallel Hash  (cost=533.93..533.93 rows=11765 width=10) (actual time=5.726..5.727 rows=6667 loops=3)
                                Buckets: 32768  Batches: 1  Memory Usage: 1216kB
                                ->  Parallel Index Only Scan using idx_orderitem_order_price_cover on "OrderItem" oi  (cost=0.29..533.93 rows=11765 width=10) (actual time=0.025..6.039 rows=20000 loops=1)
                                      Heap Fetches: 0
Planning Time: 11.226 ms
Execution Time: 307.072 ms


==================================================
EXPLAIN ANALYZE — Query 6: Produkty najczęściej dodawane do ulubionych
==================================================
Limit  (cost=14382.58..14382.60 rows=10 width=25) (actual time=1006.300..1126.034 rows=10 loops=1)
  ->  Sort  (cost=14382.58..14432.58 rows=20000 width=25) (actual time=1006.293..1126.022 rows=10 loops=1)
        Sort Key: (count(f.id)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=13750.38..13950.38 rows=20000 width=25) (actual time=998.580..1121.357 rows=20000 loops=1)
              Group Key: p.id
              Batches: 1  Memory Usage: 2577kB
              ->  Gather  (cost=9350.38..13550.38 rows=40000 width=25) (actual time=884.120..1051.973 rows=59995 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=8350.38..8550.38 rows=20000 width=25) (actual time=796.271..801.998 rows=19998 loops=3)
                          Group Key: p.id
                          Batches: 1  Memory Usage: 2577kB
                          Worker 0:  Batches: 1  Memory Usage: 2577kB
                          Worker 1:  Batches: 1  Memory Usage: 2577kB
                          ->  Hash Join  (cost=688.00..7100.38 rows=250000 width=21) (actual time=12.129..704.991 rows=200000 loops=3)
                                Hash Cond: (f.product_id = p.id)
                                ->  Parallel Seq Scan on "FavoriteProduct" f  (cost=0.00..5756.00 rows=250000 width=8) (actual time=4.537..609.027 rows=200000 loops=3)
                                ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=7.290..7.655 rows=20000 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1215kB
                                      ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.031..3.246 rows=20000 loops=3)
Planning Time: 19.246 ms
Execution Time: 1127.755 ms


==================================================
EXPLAIN ANALYZE — Query 7: Dostępny Stan Magazynowy Wariantów Produktu Pogrupowany po Magazynach
==================================================
GroupAggregate  (cost=37898.91..42932.68 rows=223723 width=61) (actual time=1397.206..1713.684 rows=178012 loops=1)
  Group Key: p.name, w.name, v.sku
  ->  Sort  (cost=37898.91..38458.22 rows=223723 width=57) (actual time=1391.903..1615.923 rows=223971 loops=1)
        Sort Key: p.name, w.name, v.sku
        Sort Method: external merge  Disk: 15248kB
        ->  Hash Join  (cost=2145.72..9605.61 rows=223723 width=57) (actual time=31.371..619.282 rows=223971 loops=1)
              Hash Cond: (si.warehouse_id = w.id)
              ->  Hash Join  (cost=2144.50..8768.22 rows=223723 width=44) (actual time=30.820..576.697 rows=223971 loops=1)
                    Hash Cond: (v.product_id = p.id)
                    ->  Hash Join  (cost=1456.50..7492.83 rows=223723 width=35) (actual time=24.927..487.463 rows=223971 loops=1)
                          Hash Cond: (si.variant_id = v.id)
                          ->  Seq Scan on "StockItem" si  (cost=0.00..5449.00 rows=223723 width=12) (actual time=0.017..356.486 rows=223971 loops=1)
                                Filter: (shipment_id IS NULL)
                                Rows Removed by Filter: 96029
                          ->  Hash  (cost=869.00..869.00 rows=47000 width=31) (actual time=24.889..26.145 rows=47000 loops=1)
                                Buckets: 65536  Batches: 1  Memory Usage: 3450kB
                                ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=31) (actual time=0.005..10.257 rows=47000 loops=1)
                    ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=5.883..5.884 rows=20000 loops=1)
                          Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                          ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.006..2.457 rows=20000 loops=1)
              ->  Hash  (cost=1.10..1.10 rows=10 width=21) (actual time=0.019..0.020 rows=10 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 9kB
                    ->  Seq Scan on "Warehouse" w  (cost=0.00..1.10 rows=10 width=21) (actual time=0.013..0.015 rows=10 loops=1)
Planning Time: 22.304 ms
Execution Time: 1733.074 ms


==================================================
EXPLAIN ANALYZE — Query 8: Stan magazynowy per produkt
==================================================
Sort  (cost=11498.95..11548.48 rows=19812 width=21) (actual time=308.540..310.377 rows=17916 loops=1)
  Sort Key: (count(si.id)) DESC
  Sort Method: quicksort  Memory: 1482kB
  ->  HashAggregate  (cost=9886.84..10084.96 rows=19812 width=21) (actual time=301.156..305.195 rows=17916 loops=1)
        Group Key: p.name
        Batches: 1  Memory Usage: 2065kB
        ->  Hash Join  (cost=2144.50..8768.22 rows=223723 width=17) (actual time=18.090..219.697 rows=223971 loops=1)
              Hash Cond: (v.product_id = p.id)
              ->  Hash Join  (cost=1456.50..7492.83 rows=223723 width=8) (actual time=12.323..140.412 rows=223971 loops=1)
                    Hash Cond: (si.variant_id = v.id)
                    ->  Seq Scan on "StockItem" si  (cost=0.00..5449.00 rows=223723 width=8) (actual time=0.013..36.942 rows=223971 loops=1)
                          Filter: (shipment_id IS NULL)
                          Rows Removed by Filter: 96029
                    ->  Hash  (cost=869.00..869.00 rows=47000 width=8) (actual time=12.290..12.292 rows=47000 loops=1)
                          Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                          ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=8) (actual time=0.005..5.105 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=5.756..5.757 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.017..2.437 rows=20000 loops=1)
Planning Time: 13.968 ms
Execution Time: 311.624 ms


==================================================
EXPLAIN ANALYZE — Query 9: Najpopularniejsze Kategorie (wg. Całkowitego Przychodu)
==================================================
Limit  (cost=12371.00..12371.02 rows=10 width=44) (actual time=637.088..809.452 rows=10 loops=1)
  ->  Sort  (cost=12371.00..12371.37 rows=150 width=44) (actual time=636.029..808.389 rows=10 loops=1)
        Sort Key: (sum(oi.unit_price)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize GroupAggregate  (cost=12328.63..12367.76 rows=150 width=44) (actual time=633.011..806.256 rows=150 loops=1)
              Group Key: c.name
              ->  Gather Merge  (cost=12328.63..12363.63 rows=300 width=44) (actual time=621.586..798.627 rows=450 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Sort  (cost=11328.61..11328.98 rows=150 width=44) (actual time=308.223..310.420 rows=150 loops=3)
                          Sort Key: c.name
                          Sort Method: quicksort  Memory: 39kB
                          Worker 0:  Sort Method: quicksort  Memory: 39kB
                          Worker 1:  Sort Method: quicksort  Memory: 39kB
                          ->  Partial HashAggregate  (cost=11321.31..11323.18 rows=150 width=44) (actual time=278.196..279.466 rows=150 loops=3)
                                Group Key: c.name
                                Batches: 1  Memory Usage: 96kB
                                Worker 0:  Batches: 1  Memory Usage: 96kB
                                Worker 1:  Batches: 1  Memory Usage: 96kB
                                ->  Hash Join  (cost=8362.48..11112.97 rows=41667 width=18) (actual time=102.872..259.462 rows=33334 loops=3)
                                      Hash Cond: (pc.category_id = c.id)
                                      ->  Parallel Hash Join  (cost=8357.10..10995.13 rows=41667 width=10) (actual time=94.292..242.844 rows=33334 loops=3)
                                            Hash Cond: (pc.product_id = p.id)
                                            ->  Parallel Index Only Scan using uq_prodcat_product_category on "ProductCategory" pc  (cost=0.29..2236.96 rows=41667 width=8) (actual time=45.282..178.572 rows=33333 loops=3)
                                                  Heap Fetches: 0
                                            ->  Parallel Hash  (cost=8209.75..8209.75 rows=11765 width=14) (actual time=44.784..45.474 rows=6667 loops=3)
                                                  Buckets: 32768  Batches: 1  Memory Usage: 1216kB
                                                  ->  Hash Join  (cost=2722.50..8209.75 rows=11765 width=14) (actual time=24.394..114.961 rows=20000 loops=1)
                                                        Hash Cond: (v.product_id = p.id)
                                                        ->  Hash Join  (cost=2034.50..7490.85 rows=11765 width=10) (actual time=19.037..100.852 rows=20000 loops=1)
                                                              Hash Cond: (si.variant_id = v.id)
                                                              ->  Hash Join  (cost=578.00..6003.47 rows=11765 width=10) (actual time=6.532..79.466 rows=20000 loops=1)
                                                                    Hash Cond: (si.id = oi.stock_item_id)
                                                                    ->  Parallel Seq Scan on "StockItem" si  (cost=0.00..4131.35 rows=188235 width=8) (actual time=0.005..23.167 rows=320000 loops=1)
                                                                    ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=6.506..6.510 rows=20000 loops=1)
                                                                          Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                                                          ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.010..3.377 rows=20000 loops=1)
                                                              ->  Hash  (cost=869.00..869.00 rows=47000 width=8) (actual time=12.484..12.485 rows=47000 loops=1)
                                                                    Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                                                    ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=8) (actual time=0.014..5.151 rows=47000 loops=1)
                                                        ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=5.345..6.113 rows=20000 loops=1)
                                                              Buckets: 32768  Batches: 1  Memory Usage: 960kB
                                                              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.010..2.102 rows=20000 loops=1)
                                      ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=8.042..8.043 rows=150 loops=3)
                                            Buckets: 1024  Batches: 1  Memory Usage: 16kB
                                            ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=7.987..8.008 rows=150 loops=3)
Planning Time: 36.507 ms
Execution Time: 816.868 ms


==================================================
EXPLAIN ANALYZE — Query 10: Liczba produktów per kategoria
==================================================
Sort  (cost=2342.22..2342.59 rows=150 width=20) (actual time=160.172..160.187 rows=150 loops=1)
  Sort Key: (count(pc.product_id)) DESC
  Sort Method: quicksort  Memory: 30kB
  ->  HashAggregate  (cost=2335.30..2336.80 rows=150 width=20) (actual time=156.385..156.416 rows=150 loops=1)
        Group Key: c.name
        Batches: 1  Memory Usage: 48kB
        ->  Hash Right Join  (cost=5.38..1835.30 rows=100000 width=16) (actual time=4.292..133.568 rows=100000 loops=1)
              Hash Cond: (pc.category_id = c.id)
              ->  Seq Scan on "ProductCategory" pc  (cost=0.00..1560.00 rows=100000 width=8) (actual time=2.635..110.028 rows=100000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=1.647..1.648 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 16kB
                    ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=1.599..1.619 rows=150 loops=1)
Planning Time: 19.165 ms
Execution Time: 164.577 ms


==================================================
EXPLAIN ANALYZE — Query 11: Liczba zamówień per metoda płatności
==================================================
Sort  (cost=7668.83..7668.84 rows=6 width=50) (actual time=324.842..499.708 rows=6 loops=1)
  Sort Key: (sum(oi.unit_price)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  Finalize GroupAggregate  (cost=7667.15..7668.75 rows=6 width=50) (actual time=324.815..499.688 rows=6 loops=1)
        Group Key: pm.name
        ->  Gather Merge  (cost=7667.15..7668.55 rows=12 width=50) (actual time=319.173..493.040 rows=6 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Sort  (cost=6667.13..6667.15 rows=6 width=50) (actual time=64.059..64.528 rows=2 loops=3)
                    Sort Key: pm.name
                    Sort Method: quicksort  Memory: 25kB
                    Worker 0:  Sort Method: quicksort  Memory: 25kB
                    Worker 1:  Sort Method: quicksort  Memory: 25kB
                    ->  Partial HashAggregate  (cost=6666.98..6667.05 rows=6 width=50) (actual time=61.676..62.144 rows=2 loops=3)
                          Group Key: pm.name
                          Batches: 1  Memory Usage: 24kB
                          Worker 0:  Batches: 1  Memory Usage: 24kB
                          Worker 1:  Batches: 1  Memory Usage: 24kB
                          ->  Hash Join  (cost=682.13..6604.48 rows=8333 width=20) (actual time=10.406..57.874 rows=6667 loops=3)
                                Hash Cond: (o.payment_method_id = pm.id)
                                ->  Parallel Hash Join  (cost=681.00..6566.02 rows=8333 width=14) (actual time=7.111..53.208 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.007..55.443 rows=400000 loops=1)
                                      ->  Parallel Hash  (cost=533.93..533.93 rows=11765 width=10) (actual time=6.395..6.396 rows=6667 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1216kB
                                            ->  Parallel Index Only Scan using idx_orderitem_order_price_cover on "OrderItem" oi  (cost=0.29..533.93 rows=11765 width=10) (actual time=0.019..6.584 rows=20000 loops=1)
                                                  Heap Fetches: 0
                                ->  Hash  (cost=1.06..1.06 rows=6 width=14) (actual time=2.926..2.926 rows=6 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                      ->  Seq Scan on "PaymentMethod" pm  (cost=0.00..1.06 rows=6 width=14) (actual time=2.342..2.343 rows=6 loops=3)
Planning Time: 17.654 ms
Execution Time: 506.945 ms


==================================================
EXPLAIN ANALYZE — Query 12: Średnia ocena per producent
==================================================
Sort  (cost=1367.54..1367.91 rows=150 width=57) (actual time=33.008..33.024 rows=150 loops=1)
  Sort Key: (round(avg(r.rating), 2)) DESC NULLS LAST
  Sort Method: quicksort  Memory: 32kB
  ->  HashAggregate  (cost=1359.87..1362.12 rows=150 width=57) (actual time=32.877..32.940 rows=150 loops=1)
        Group Key: m.name
        Batches: 1  Memory Usage: 64kB
        ->  Hash Join  (cost=693.38..1259.87 rows=20000 width=29) (actual time=5.982..26.368 rows=27388 loops=1)
              Hash Cond: (p.manufacturer_id = m.id)
              ->  Hash Right Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=5.372..20.396 rows=27388 loops=1)
                    Hash Cond: (r.product_id = p.id)
                    ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=0.010..2.991 rows=20000 loops=1)
                    ->  Hash  (cost=438.00..438.00 rows=20000 width=8) (actual time=5.350..5.352 rows=20000 loops=1)
                          Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                          ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=8) (actual time=0.005..2.266 rows=20000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.058..0.058 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 18kB
                    ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.015..0.031 rows=150 loops=1)
Planning Time: 16.448 ms
Execution Time: 33.109 ms


==================================================
EXPLAIN ANALYZE — Query 13: Aktywne promocje i objęta nimi liczba wariantów
==================================================
Sort  (cost=392.83..392.95 rows=47 width=14) (actual time=4.185..4.189 rows=46 loops=1)
  Sort Key: (count(v.id)) DESC
  Sort Method: quicksort  Memory: 26kB
  ->  HashAggregate  (cost=391.06..391.53 rows=47 width=14) (actual time=4.163..4.172 rows=46 loops=1)
        Group Key: pr.name
        Batches: 1  Memory Usage: 24kB
        ->  Merge Join  (cost=7.63..334.66 rows=11280 width=10) (actual time=0.066..3.852 rows=1340 loops=1)
              Merge Cond: (v.promotion_id = pr.id)
              ->  Index Scan using idx_variant_promotion on "Variant" v  (cost=0.29..2469.25 rows=47000 width=8) (actual time=0.017..2.981 rows=5685 loops=1)
              ->  Sort  (cost=7.34..7.46 rows=48 width=10) (actual time=0.045..0.049 rows=47 loops=1)
                    Sort Key: pr.id
                    Sort Method: quicksort  Memory: 26kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=48 width=10) (actual time=0.011..0.034 rows=47 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 153
Planning Time: 10.505 ms
Execution Time: 4.255 ms


==================================================
EXPLAIN ANALYZE — Query 14: Najczęściej wybierane warianty w koszykach
==================================================
Limit  (cost=207261.25..207261.27 rows=10 width=44) (actual time=2963.528..2964.801 rows=10 loops=1)
  ->  Sort  (cost=207261.25..211011.25 rows=1500000 width=44) (actual time=2962.986..2962.990 rows=10 loops=1)
        Sort Key: (sum(ci.quantity)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  GroupAggregate  (cost=3.88..174846.79 rows=1500000 width=44) (actual time=14.477..2953.468 rows=47000 loops=1)
              Group Key: v.sku, p.name
              ->  Incremental Sort  (cost=3.88..148596.79 rows=1500000 width=40) (actual time=6.388..2662.561 rows=1500000 loops=1)
                    Sort Key: v.sku, p.name
                    Presorted Key: v.sku
                    Full-sort Groups: 31708  Sort Method: quicksort  Average Memory: 27kB  Peak Memory: 27kB
                    Pre-sorted Groups: 6442  Sort Method: quicksort  Average Memory: 26kB  Peak Memory: 26kB
                    ->  Nested Loop  (cost=1.14..91435.60 rows=1500000 width=40) (actual time=2.543..2202.126 rows=1500000 loops=1)
                          ->  Nested Loop  (cost=0.71..8782.60 rows=47000 width=40) (actual time=2.531..196.940 rows=47000 loops=1)
                                ->  Index Scan using "Variant_sku_key" on "Variant" v  (cost=0.41..2051.43 rows=47000 width=31) (actual time=2.487..85.244 rows=47000 loops=1)
                                ->  Memoize  (cost=0.30..0.34 rows=1 width=17) (actual time=0.002..0.002 rows=1 loops=47000)
                                      Cache Key: v.product_id
                                      Cache Mode: logical
                                      Hits: 28889  Misses: 18111  Evictions: 0  Overflows: 0  Memory Usage: 2099kB
                                      ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=17) (actual time=0.003..0.003 rows=1 loops=18111)
                                            Index Cond: (id = v.product_id)
                          ->  Index Only Scan using idx_cartitem_variant_quantity_cover on "CartItem" ci  (cost=0.43..1.43 rows=33 width=8) (actual time=0.003..0.039 rows=32 loops=47000)
                                Index Cond: (variant_id = v.id)
                                Heap Fetches: 150055
Planning Time: 13.840 ms
Execution Time: 2993.718 ms


==================================================
EXPLAIN ANALYZE — Query 15: Produkty z Największą Różnicą Między Ceną Podstawową a Ceną Wariantu
==================================================
Limit  (cost=2813.55..2813.58 rows=10 width=80) (actual time=47.062..47.066 rows=10 loops=1)
  ->  Sort  (cost=2813.55..2931.05 rows=47000 width=80) (actual time=47.061..47.063 rows=10 loops=1)
        Sort Key: v.price_modifier DESC
        Sort Method: top-N heapsort  Memory: 27kB
        ->  Hash Join  (cost=688.00..1797.90 rows=47000 width=80) (actual time=8.849..34.536 rows=47000 loops=1)
              Hash Cond: (v.product_id = p.id)
              ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=33) (actual time=1.732..5.113 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=6.321..6.321 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1381kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.015..2.700 rows=20000 loops=1)
Planning Time: 25.065 ms
Execution Time: 48.760 ms


==================================================
EXPLAIN ANALYZE — Query 16: Konwersja zamówień wg statusu
==================================================
Sort  (cost=7541.77..7541.79 rows=7 width=48) (actual time=241.661..369.560 rows=7 loops=1)
  Sort Key: (count(o.id)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  WindowAgg  (cost=7541.33..7541.67 rows=7 width=48) (actual time=241.091..369.000 rows=7 loops=1)
        ->  Finalize GroupAggregate  (cost=7539.74..7541.51 rows=7 width=16) (actual time=236.268..364.182 rows=7 loops=1)
              Group Key: s.name
              ->  Gather Merge  (cost=7539.74..7541.37 rows=14 width=16) (actual time=236.251..362.969 rows=21 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Sort  (cost=6539.71..6539.73 rows=7 width=16) (actual time=85.431..85.983 rows=7 loops=3)
                          Sort Key: s.name
                          Sort Method: quicksort  Memory: 25kB
                          Worker 0:  Sort Method: quicksort  Memory: 25kB
                          Worker 1:  Sort Method: quicksort  Memory: 25kB
                          ->  Partial HashAggregate  (cost=6539.55..6539.62 rows=7 width=16) (actual time=77.307..77.312 rows=7 loops=3)
                                Group Key: s.name
                                Batches: 1  Memory Usage: 24kB
                                Worker 0:  Batches: 1  Memory Usage: 24kB
                                Worker 1:  Batches: 1  Memory Usage: 24kB
                                ->  Hash Join  (cost=1.16..5706.21 rows=166667 width=12) (actual time=5.955..47.251 rows=133333 loops=3)
                                      Hash Cond: (o.status_id = s.id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.762..11.313 rows=133333 loops=3)
                                      ->  Hash  (cost=1.07..1.07 rows=7 width=12) (actual time=4.250..4.251 rows=7 loops=3)
                                            Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                            ->  Seq Scan on "Status" s  (cost=0.00..1.07 rows=7 width=12) (actual time=3.992..3.994 rows=7 loops=3)
Planning Time: 28.646 ms
Execution Time: 386.429 ms


==================================================
EXPLAIN ANALYZE — Query 17: Top klienci wg wydatków
==================================================
Limit  (cost=15259.76..15259.79 rows=10 width=50) (actual time=3820.036..3829.613 rows=10 loops=1)
  ->  Sort  (cost=15259.76..15309.76 rows=20000 width=50) (actual time=3820.035..3829.611 rows=10 loops=1)
        Sort Key: (sum(oi.unit_price)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=14577.57..14827.57 rows=20000 width=50) (actual time=3802.708..3821.988 rows=19296 loops=1)
              Group Key: u.id
              Batches: 5  Memory Usage: 8241kB  Disk Usage: 224kB
              ->  Gather  (cost=12681.81..14452.58 rows=16666 width=50) (actual time=3270.789..3483.677 rows=19428 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=11681.81..11785.98 rows=8333 width=50) (actual time=2945.033..3002.345 rows=6476 loops=3)
                          Group Key: u.id
                          Batches: 1  Memory Usage: 3217kB
                          Worker 0:  Batches: 1  Memory Usage: 2961kB
                          Worker 1:  Batches: 1  Memory Usage: 2961kB
                          ->  Nested Loop  (cost=681.42..11640.15 rows=8333 width=24) (actual time=33.867..2905.169 rows=6667 loops=3)
                                ->  Parallel Hash Join  (cost=681.00..6566.02 rows=8333 width=10) (actual time=8.282..151.312 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.568..76.430 rows=133333 loops=3)
                                      ->  Parallel Hash  (cost=533.93..533.93 rows=11765 width=10) (actual time=6.673..7.592 rows=6667 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1216kB
                                            ->  Parallel Index Only Scan using idx_orderitem_order_price_cover on "OrderItem" oi  (cost=0.29..533.93 rows=11765 width=10) (actual time=0.022..3.362 rows=20000 loops=1)
                                                  Heap Fetches: 0
                                ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.409..0.409 rows=1 loops=20000)
                                      Index Cond: (id = o.user_id)
Planning Time: 16.979 ms
Execution Time: 3849.123 ms


==================================================
EXPLAIN ANALYZE — Query 18: Produkty z wariantami objętymi promocją, z końcową ceną
==================================================
Sort  (cost=1980.71..2008.91 rows=11280 width=132) (actual time=47.423..47.564 rows=1340 loops=1)
  Sort Key: (round(((p.price + v.price_modifier) * ('1'::numeric - pr.discount_percentage)), 2))
  Sort Method: quicksort  Memory: 146kB
  ->  Hash Join  (cost=695.63..1221.48 rows=11280 width=132) (actual time=24.205..45.280 rows=1340 loops=1)
        Hash Cond: (v.product_id = p.id)
        ->  Merge Join  (cost=7.63..334.66 rows=11280 width=39) (actual time=1.507..20.997 rows=1340 loops=1)
              Merge Cond: (v.promotion_id = pr.id)
              ->  Index Scan using idx_variant_promotion on "Variant" v  (cost=0.29..2469.25 rows=47000 width=37) (actual time=0.023..18.234 rows=5685 loops=1)
              ->  Sort  (cost=7.34..7.46 rows=48 width=10) (actual time=1.478..1.486 rows=47 loops=1)
                    Sort Key: pr.id
                    Sort Method: quicksort  Memory: 26kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=48 width=10) (actual time=1.436..1.460 rows=47 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 153
        ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=22.676..22.677 rows=20000 loops=1)
              Buckets: 32768  Batches: 1  Memory Usage: 1381kB
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.008..11.953 rows=20000 loops=1)
Planning Time: 66.897 ms
Execution Time: 49.998 ms


==================================================
EXPLAIN ANALYZE — Query 19: Użytkownicy, Którzy Dodali Produkt do Koszyka, Ale Nie Złożyli Zamówienia (Potencjał Odbudowy Koszyka)
==================================================
Hash Join  (cost=45856.21..103590.81 rows=1068640 width=55) (actual time=3901.842..6471.972 rows=1005006 loops=1)
  Hash Cond: (v.product_id = p.id)
  ->  Hash Join  (cost=45168.21..100097.04 rows=1068640 width=46) (actual time=3891.095..5930.564 rows=1005006 loops=1)
        Hash Cond: (ci.variant_id = v.id)
        ->  Hash Join  (cost=43711.71..95835.11 rows=1068640 width=46) (actual time=3870.550..5221.231 rows=1005006 loops=1)
              Hash Cond: (ci.cart_id = c.id)
              ->  Seq Scan on "CartItem" ci  (cost=0.00..23152.00 rows=1500000 width=8) (actual time=2.094..505.087 rows=1500000 loops=1)
              ->  Hash  (cost=41435.91..41435.91 rows=106864 width=46) (actual time=3858.607..3876.501 rows=100414 loops=1)
                    Buckets: 131072  Batches: 2  Memory Usage: 4929kB
                    ->  Gather  (cost=25017.67..41435.91 rows=106864 width=46) (actual time=3457.226..3540.591 rows=100414 loops=1)
                          Workers Planned: 2
                          Workers Launched: 2
                          ->  Parallel Hash Right Anti Join  (cost=24017.67..29749.51 rows=44527 width=46) (actual time=2853.979..2870.153 rows=33471 loops=3)
                                Hash Cond: (o.user_id = u.id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=4) (actual time=10.465..274.589 rows=133333 loops=3)
                                ->  Parallel Hash  (cost=23236.42..23236.42 rows=62500 width=50) (actual time=2238.508..2239.002 rows=50000 loops=3)
                                      Buckets: 262144  Batches: 1  Memory Usage: 14720kB
                                      ->  Hash Join  (cost=4079.00..23236.42 rows=62500 width=50) (actual time=312.371..2037.401 rows=50000 loops=3)
                                            Hash Cond: (u.id = c.user_id)
                                            ->  Parallel Seq Scan on "User" u  (cost=0.00..18063.67 rows=416667 width=46) (actual time=13.831..1334.622 rows=333333 loops=3)
                                            ->  Hash  (cost=2204.00..2204.00 rows=150000 width=8) (actual time=287.247..287.248 rows=150000 loops=3)
                                                  Buckets: 262144  Batches: 1  Memory Usage: 7908kB
                                                  ->  Seq Scan on "Cart" c  (cost=0.00..2204.00 rows=150000 width=8) (actual time=17.027..172.028 rows=150000 loops=3)
        ->  Hash  (cost=869.00..869.00 rows=47000 width=8) (actual time=18.355..18.915 rows=47000 loops=1)
              Buckets: 65536  Batches: 1  Memory Usage: 2348kB
              ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=8) (actual time=0.017..5.143 rows=47000 loops=1)
  ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=7.768..7.769 rows=20000 loops=1)
        Buckets: 32768  Batches: 1  Memory Usage: 1245kB
        ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=2.029..4.410 rows=20000 loops=1)
Planning Time: 69.776 ms
Execution Time: 6540.342 ms


==================================================
EXPLAIN ANALYZE — Query 20: Wyszukiwanie produktów po nazwie lub opisie (parametryzowane)
==================================================
Bitmap Heap Scan on "Product"  (cost=43.00..57.51 rows=4 width=60) (actual time=8.350..23.614 rows=143 loops=1)
  Recheck Cond: (((name)::text ~~* '%test%'::text) OR (description ~~* '%test%'::text))
  Heap Blocks: exact=106
  ->  BitmapOr  (cost=43.00..43.00 rows=4 width=0) (actual time=8.312..8.314 rows=0 loops=1)
        ->  Bitmap Index Scan on idx_product_name_trgm  (cost=0.00..21.50 rows=2 width=0) (actual time=5.259..5.259 rows=42 loops=1)
              Index Cond: ((name)::text ~~* '%test%'::text)
        ->  Bitmap Index Scan on idx_product_description_trgm  (cost=0.00..21.50 rows=2 width=0) (actual time=3.047..3.047 rows=102 loops=1)
              Index Cond: (description ~~* '%test%'::text)
Planning Time: 133.129 ms
Execution Time: 28.840 ms


==================================================
EXPLAIN ANALYZE — Query 21: Użytkownicy, Którzy Zapisali Konkretny Produkt jako Ulubiony (np. Product ID=350259)
==================================================
Nested Loop  (cost=0.85..262.23 rows=30 width=56) (actual time=4.877..20.066 rows=26 loops=1)
  ->  Index Only Scan using idx_favoriteproduct_product_user on "FavoriteProduct" fp  (cost=0.42..8.95 rows=30 width=4) (actual time=4.271..4.285 rows=26 loops=1)
        Index Cond: (product_id = 35)
        Heap Fetches: 0
  ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..8.44 rows=1 width=60) (actual time=0.605..0.605 rows=1 loops=26)
        Index Cond: (id = fp.user_id)
Planning Time: 12.334 ms
Execution Time: 20.106 ms


==================================================
EXPLAIN ANALYZE — Query 22: Znajdź Magazyny, Które Posiadają Zapasy Konkretnego Wariantu (np. SKU='VR-000000-a637d44b7afd')
==================================================
GroupAggregate  (cost=24.83..24.93 rows=2 width=25) (actual time=4.255..4.257 rows=0 loops=1)
  Group Key: w.name
  Filter: (count(si.id) > 0)
  ->  Sort  (cost=24.83..24.84 rows=5 width=21) (actual time=4.253..4.255 rows=0 loops=1)
        Sort Key: w.name
        Sort Method: quicksort  Memory: 25kB
        ->  Nested Loop  (cost=0.97..24.77 rows=5 width=21) (actual time=3.645..3.646 rows=0 loops=1)
              ->  Nested Loop  (cost=0.84..24.00 rows=5 width=8) (actual time=3.644..3.645 rows=0 loops=1)
                    ->  Index Scan using "Variant_sku_key" on "Variant" v  (cost=0.41..8.43 rows=1 width=4) (actual time=3.644..3.644 rows=0 loops=1)
                          Index Cond: ((sku)::text = 'VR-000001-2704de10f283'::text)
                    ->  Index Scan using idx_stockitem_shipment_variant_warehouse on "StockItem" si  (cost=0.42..15.52 rows=5 width=12) (never executed)
                          Index Cond: ((shipment_id IS NULL) AND (variant_id = v.id))
              ->  Index Scan using "Warehouse_pkey" on "Warehouse" w  (cost=0.14..0.15 rows=1 width=21) (never executed)
                    Index Cond: (id = si.warehouse_id)
Planning Time: 18.571 ms
Execution Time: 4.906 ms


==================================================
EXPLAIN ANALYZE — Query 23: Warianty, Które Wymagają Uzyskania Konkretnej Opcji (np. 'Kolor'='Czerwony')
==================================================
Nested Loop  (cost=6.81..677.93 rows=8 width=36) (actual time=0.024..0.025 rows=0 loops=1)
  ->  Nested Loop  (cost=6.52..675.28 rows=8 width=27) (actual time=0.024..0.024 rows=0 loops=1)
        ->  Nested Loop  (cost=6.23..672.76 rows=8 width=4) (actual time=0.023..0.024 rows=0 loops=1)
              Join Filter: (opt.attribute_id = a.id)
              ->  Seq Scan on "Attribute" a  (cost=0.00..1.38 rows=1 width=4) (actual time=0.023..0.023 rows=0 loops=1)
                    Filter: ((name)::text = 'Attr_49_Century'::text)
                    Rows Removed by Filter: 30
              ->  Nested Loop  (cost=6.23..668.26 rows=250 width=8) (never executed)
                    ->  Seq Scan on "Option" opt  (cost=0.00..18.50 rows=1 width=8) (never executed)
                          Filter: ((value)::text = 'do'::text)
                    ->  Bitmap Heap Scan on "VariantOption" vo  (cost=6.23..647.26 rows=250 width=8) (never executed)
                          Recheck Cond: (option_id = opt.id)
                          ->  Bitmap Index Scan on idx_variantoption_option_id  (cost=0.00..6.17 rows=250 width=0) (never executed)
                                Index Cond: (option_id = opt.id)
        ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.32 rows=1 width=31) (never executed)
              Index Cond: (id = vo.variant_id)
  ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=17) (never executed)
        Index Cond: (id = v.product_id)
Planning Time: 55.386 ms
Execution Time: 0.100 ms


==================================================
EXPLAIN ANALYZE — Query 24: Znajdź Zamówienia Użytkownika (np. email='debbie.lane.16786.50af0753@example.com') o Statusie 'Paid'
==================================================
Nested Loop  (cost=0.98..17.07 rows=1 width=20) (actual time=6.122..6.124 rows=0 loops=1)
  ->  Nested Loop  (cost=0.85..16.89 rows=1 width=16) (actual time=6.122..6.123 rows=0 loops=1)
        ->  Index Scan using "User_email_key" on "User" u  (cost=0.42..8.44 rows=1 width=4) (actual time=6.121..6.121 rows=0 loops=1)
              Index Cond: ((email)::text = 'debbie.lane.16786.50af0753@example.com'::text)
        ->  Index Scan using idx_order_user_id on "Order" o  (cost=0.42..8.44 rows=1 width=20) (never executed)
              Index Cond: (user_id = u.id)
  ->  Index Scan using "Status_pkey" on "Status" s  (cost=0.13..0.15 rows=1 width=12) (never executed)
        Index Cond: (id = o.status_id)
        Filter: ((name)::text = 'Paid'::text)
Planning Time: 8.000 ms
Execution Time: 6.207 ms


==================================================
EXPLAIN ANALYZE — Query 25: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
Hash Left Join  (cost=6.97..48.11 rows=16 width=87) (actual time=3.209..11.977 rows=18 loops=1)
  Hash Cond: (opt.attribute_id = a.id)
  ->  Nested Loop Left Join  (cost=5.30..46.34 rows=16 width=45) (actual time=2.286..10.994 rows=18 loops=1)
        ->  Nested Loop Left Join  (cost=5.02..41.66 rows=16 width=39) (actual time=2.222..8.460 rows=18 loops=1)
              ->  Nested Loop  (cost=4.60..23.91 rows=3 width=39) (actual time=1.247..1.276 rows=4 loops=1)
                    ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..8.30 rows=1 width=10) (actual time=0.029..0.031 rows=1 loops=1)
                          Index Cond: (id = 35)
                    ->  Bitmap Heap Scan on "Variant" v  (cost=4.31..15.57 rows=3 width=37) (actual time=1.212..1.235 rows=4 loops=1)
                          Recheck Cond: (product_id = 35)
                          Heap Blocks: exact=4
                          ->  Bitmap Index Scan on idx_variant_product_id  (cost=0.00..4.31 rows=3 width=0) (actual time=0.008..0.009 rows=4 loops=1)
                                Index Cond: (product_id = 35)
              ->  Index Only Scan using uq_varopt_variant_option on "VariantOption" vo  (cost=0.42..5.86 rows=6 width=8) (actual time=1.785..1.791 rows=4 loops=4)
                    Index Cond: (variant_id = v.id)
                    Heap Fetches: 0
        ->  Index Scan using "Option_pkey" on "Option" opt  (cost=0.28..0.29 rows=1 width=14) (actual time=0.138..0.138 rows=1 loops=18)
              Index Cond: (id = vo.option_id)
  ->  Hash  (cost=1.30..1.30 rows=30 width=18) (actual time=0.038..0.038 rows=30 loops=1)
        Buckets: 1024  Batches: 1  Memory Usage: 10kB
        ->  Seq Scan on "Attribute" a  (cost=0.00..1.30 rows=30 width=18) (actual time=0.024..0.028 rows=30 loops=1)
Planning Time: 0.875 ms
Execution Time: 12.050 ms


==================================================
EXPLAIN ANALYZE — Query 26: Lista Wszystkich Dziecięcych Kategorii (Podkategorii) dla Konkretnej Kategorii Nadrzędnej (np. ID=5)
==================================================
Seq Scan on "Category"  (cost=0.00..3.88 rows=3 width=12) (actual time=0.549..0.559 rows=3 loops=1)
  Filter: (parent_id = 5)
  Rows Removed by Filter: 147
Planning Time: 1.417 ms
Execution Time: 0.579 ms


==================================================
EXPLAIN ANALYZE — Query 27: Porównanie Średniej Oceny dla Promowanych i Niepromowanych Produktów
==================================================
HashAggregate  (cost=87850.51..87853.01 rows=200 width=64) (actual time=194.596..194.600 rows=2 loops=1)
  Group Key: CASE WHEN (ANY (p.id = (hashed SubPlan 2).col1)) THEN 'Promowany'::text ELSE 'Niepromowany'::text END
  Batches: 1  Memory Usage: 40kB
  ->  HashAggregate  (cost=1300.51..87550.51 rows=20000 width=68) (actual time=184.879..191.665 rows=12612 loops=1)
        Group Key: p.id
        Batches: 1  Memory Usage: 2577kB
        ->  Hash Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=39.941..158.566 rows=20000 loops=1)
              Hash Cond: (r.product_id = p.id)
              ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=1.254..111.307 rows=20000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=38.525..38.526 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 960kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.008..35.310 rows=20000 loops=1)
        SubPlan 2
          ->  Index Only Scan using idx_variant_product_promotion on "Variant" v2  (cost=0.28..157.63 rows=5690 width=4) (actual time=5.315..11.722 rows=5684 loops=1)
                Heap Fetches: 0
Planning Time: 4.008 ms
Execution Time: 195.289 ms


==================================================
EXPLAIN ANALYZE — Query 28: Top 5 Miast Generujących Największy Przychód (Wg. Adresu Wysyłki)
==================================================
Limit  (cost=15175.51..15175.53 rows=5 width=45) (actual time=4319.994..4354.527 rows=5 loops=1)
  ->  Sort  (cost=15175.51..15225.51 rows=20000 width=45) (actual time=4319.983..4353.571 rows=5 loops=1)
        Sort Key: (sum(oi.unit_price)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=14593.32..14843.32 rows=20000 width=45) (actual time=4309.747..4348.651 rows=12950 loops=1)
              Group Key: a.city
              Batches: 1  Memory Usage: 5905kB
              ->  Gather  (cost=12697.56..14468.33 rows=16666 width=45) (actual time=4128.835..4211.849 rows=16090 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=11697.56..11801.73 rows=8333 width=45) (actual time=4096.711..4102.701 rows=5363 loops=3)
                          Group Key: a.city
                          Batches: 1  Memory Usage: 2449kB
                          Worker 0:  Batches: 1  Memory Usage: 2449kB
                          Worker 1:  Batches: 1  Memory Usage: 2449kB
                          ->  Nested Loop  (cost=681.42..11655.90 rows=8333 width=19) (actual time=23.474..4055.631 rows=6667 loops=3)
                                ->  Parallel Hash Join  (cost=681.00..6566.02 rows=8333 width=10) (actual time=20.012..295.419 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.009..209.204 rows=133333 loops=3)
                                      ->  Parallel Hash  (cost=533.93..533.93 rows=11765 width=10) (actual time=19.244..20.178 rows=6667 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1248kB
                                            ->  Parallel Index Only Scan using idx_orderitem_order_price_cover on "OrderItem" oi  (cost=0.29..533.93 rows=11765 width=10) (actual time=1.913..16.629 rows=6667 loops=3)
                                                  Heap Fetches: 0
                                ->  Index Scan using "Address_pkey" on "Address" a  (cost=0.43..0.61 rows=1 width=17) (actual time=0.561..0.561 rows=1 loops=20000)
                                      Index Cond: (id = o.shipping_address_id)
Planning Time: 28.326 ms
Execution Time: 4357.944 ms


==================================================
EXPLAIN ANALYZE — Query 29: Porównanie Wolumenu Sprzedaży Produktów Promowanych vs. Niepromowanych (w Ostatnich 30 Dniach)
==================================================
Finalize GroupAggregate  (cost=6389.73..6445.59 rows=200 width=40) (actual time=770.727..909.675 rows=2 loops=1)
  Group Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
  ->  Gather Merge  (cost=6389.73..6441.59 rows=400 width=40) (actual time=770.701..908.548 rows=6 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=5389.70..5395.40 rows=200 width=40) (actual time=649.713..650.499 rows=2 loops=3)
              Group Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
              ->  Sort  (cost=5389.70..5390.94 rows=493 width=32) (actual time=649.431..649.903 rows=391 loops=3)
                    Sort Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
                    Sort Method: quicksort  Memory: 25kB
                    Worker 0:  Sort Method: quicksort  Memory: 25kB
                    Worker 1:  Sort Method: quicksort  Memory: 25kB
                    ->  Nested Loop  (cost=1026.51..5367.65 rows=493 width=32) (actual time=32.689..631.640 rows=391 loops=3)
                          ->  Nested Loop  (cost=1026.22..5212.79 rows=493 width=4) (actual time=31.174..565.523 rows=391 loops=3)
                                ->  Hash Join  (cost=1025.80..4600.88 rows=493 width=4) (actual time=28.697..67.509 rows=391 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Bitmap Heap Scan on "Order" o  (cost=447.80..3956.33 rows=9859 width=4) (actual time=8.186..43.604 rows=7823 loops=3)
                                            Recheck Cond: (order_date >= (now() - '30 days'::interval))
                                            Heap Blocks: exact=1130
                                            ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..441.88 rows=23661 width=0) (actual time=23.998..23.998 rows=23470 loops=1)
                                                  Index Cond: (order_date >= (now() - '30 days'::interval))
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=8) (actual time=20.055..20.499 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=8) (actual time=1.370..15.824 rows=20000 loops=3)
                                ->  Index Scan using "StockItem_pkey" on "StockItem" si  (cost=0.42..1.24 rows=1 width=8) (actual time=1.271..1.271 rows=1 loops=1174)
                                      Index Cond: (id = oi.stock_item_id)
                          ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.31 rows=1 width=8) (actual time=0.167..0.167 rows=1 loops=1174)
                                Index Cond: (id = si.variant_id)
Planning Time: 16.280 ms
Execution Time: 918.077 ms


==================================================
EXPLAIN ANALYZE — Query 30: Wskaźnik Lojalności (Repeat Purchase Rate) Użytkowników z Podziałem na Miasto Adresu Rozliczeniowego
==================================================
Sort  (cost=68002.37..68076.46 rows=29636 width=61) (actual time=4708.265..4731.129 rows=66456 loops=1)
  Sort Key: (round((((count(*) FILTER (WHERE (u.orders_count > 1)))::numeric * 100.0) / (NULLIF(count(*), 0))::numeric), 2)) DESC
  Sort Method: external merge  Disk: 3192kB
  ->  Finalize HashAggregate  (cost=65060.25..65801.15 rows=29636 width=61) (actual time=4481.103..4553.582 rows=66456 loops=1)
        Group Key: a.city
        Batches: 5  Memory Usage: 8241kB  Disk Usage: 712kB
        ->  Gather  (cost=58392.15..64615.71 rows=59272 width=29) (actual time=3981.914..4099.132 rows=122175 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial HashAggregate  (cost=57392.15..57688.51 rows=29636 width=29) (actual time=3656.914..3672.378 rows=40725 loops=3)
                    Group Key: a.city
                    Batches: 1  Memory Usage: 5137kB
                    Worker 0:  Batches: 1  Memory Usage: 5137kB
                    Worker 1:  Batches: 1  Memory Usage: 5137kB
                    ->  Parallel Hash Join  (cost=34868.03..55725.48 rows=166667 width=21) (actual time=1249.982..3309.562 rows=133333 loops=3)
                          Hash Cond: (a.id = o.billing_address_id)
                          ->  Parallel Seq Scan on "Address" a  (cost=0.00..18288.00 rows=500000 width=17) (actual time=10.498..1365.869 rows=400000 loops=3)
                          ->  Parallel Hash  (cost=32784.69..32784.69 rows=166667 width=12) (actual time=1209.487..1210.693 rows=133333 loops=3)
                                Buckets: 524288  Batches: 1  Memory Usage: 22912kB
                                ->  Hash Join  (cost=24635.51..32784.69 rows=166667 width=12) (actual time=652.001..1032.383 rows=133333 loops=3)
                                      Hash Cond: (o.user_id = u.user_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.755..105.059 rows=133333 loops=3)
                                      ->  Hash  (cost=19635.86..19635.86 rows=287572 width=12) (actual time=499.792..500.994 rows=329619 loops=3)
                                            Buckets: 262144  Batches: 4  Memory Usage: 5596kB
                                            ->  Subquery Scan on u  (cost=0.42..19635.86 rows=287572 width=12) (actual time=47.006..349.120 rows=329619 loops=3)
                                                  ->  GroupAggregate  (cost=0.42..16760.14 rows=287572 width=12) (actual time=45.465..310.969 rows=329619 loops=3)
                                                        Group Key: "Order".user_id
                                                        ->  Index Only Scan using idx_order_user_id on "Order"  (cost=0.42..11884.42 rows=400000 width=4) (actual time=41.931..197.608 rows=400000 loops=3)
                                                              Heap Fetches: 150240
Planning Time: 14.956 ms
Execution Time: 4773.188 ms

FINISHED — 2025-11-22 18:14:53.819566
========================================================================================================================
