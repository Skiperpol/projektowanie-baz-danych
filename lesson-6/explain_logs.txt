========================================================================================================================
START EXPLAIN RUN — 2025-11-22 17:00:05.949264
========================================================================================================================


==================================================
EXPLAIN ANALYZE — Query 1: Średnia Wartość Zamówienia (AOV) w Ostatnim Miesiącu
==================================================
Aggregate  (cost=4940.05..4940.06 rows=1 width=32) (actual time=168.783..168.786 rows=1 loops=1)
  ->  HashAggregate  (cost=4909.62..4924.83 rows=1217 width=36) (actual time=168.247..168.676 rows=1215 loops=1)
        Group Key: o.id
        Batches: 1  Memory Usage: 577kB
        ->  Hash Join  (cost=4523.04..4903.54 rows=1217 width=10) (actual time=111.630..165.681 rows=1243 loops=1)
              Hash Cond: (oi.order_id = o.id)
              ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.016..27.913 rows=20000 loops=1)
              ->  Hash  (cost=4218.86..4218.86 rows=24334 width=4) (actual time=111.113..111.115 rows=24630 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1122kB
                    ->  Bitmap Heap Scan on "Order" o  (cost=457.02..4218.86 rows=24334 width=4) (actual time=37.787..105.859 rows=24630 loops=1)
                          Recheck Cond: (order_date >= (now() - '1 mon'::interval))
                          Heap Blocks: exact=3333
                          ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..450.93 rows=24334 width=0) (actual time=37.400..37.400 rows=24630 loops=1)
                                Index Cond: (order_date >= (now() - '1 mon'::interval))
Planning Time: 55.912 ms
Execution Time: 170.710 ms


==================================================
EXPLAIN ANALYZE — Query 2: Średnia wartość zamówienia per użytkownik
==================================================
Sort  (cost=16066.87..16115.61 rows=19495 width=50) (actual time=5561.239..5681.472 rows=19296 loops=1)
  Sort Key: (round(avg(order_totals.total_price), 2)) DESC
  Sort Method: quicksort  Memory: 1612kB
  ->  Finalize HashAggregate  (cost=14385.35..14677.77 rows=19495 width=50) (actual time=5511.782..5654.172 rows=19296 loops=1)
        Group Key: u.id
        Batches: 5  Memory Usage: 8241kB  Disk Usage: 224kB
        ->  Gather  (cost=12537.36..14263.50 rows=16246 width=50) (actual time=5264.828..5477.157 rows=19419 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial HashAggregate  (cost=11537.36..11638.90 rows=8123 width=50) (actual time=4851.104..4865.968 rows=6473 loops=3)
                    Group Key: u.id
                    Batches: 1  Memory Usage: 2961kB
                    Worker 0:  Batches: 1  Memory Usage: 2961kB
                    Worker 1:  Batches: 1  Memory Usage: 2961kB
                    ->  Nested Loop  (cost=1110.75..11496.75 rows=8123 width=50) (actual time=193.574..4812.771 rows=6498 loops=3)
                          ->  Hash Join  (cost=1110.33..6550.49 rows=8123 width=36) (actual time=149.010..256.654 rows=6498 loops=3)
                                Hash Cond: (o.id = order_totals.order_id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.198..39.467 rows=133333 loops=3)
                                ->  Hash  (cost=866.64..866.64 rows=19495 width=36) (actual time=140.807..142.283 rows=19495 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1094kB
                                      ->  Subquery Scan on order_totals  (cost=428.00..866.64 rows=19495 width=36) (actual time=64.940..106.798 rows=19495 loops=3)
                                            ->  HashAggregate  (cost=428.00..671.69 rows=19495 width=36) (actual time=64.938..100.292 rows=19495 loops=3)
                                                  Group Key: oi.order_id
                                                  Batches: 1  Memory Usage: 7953kB
                                                  Worker 0:  Batches: 1  Memory Usage: 7953kB
                                                  Worker 1:  Batches: 1  Memory Usage: 7953kB
                                                  ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=5.073..13.440 rows=20000 loops=3)
                          ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.697..0.697 rows=1 loops=19495)
                                Index Cond: (id = o.user_id)
Planning Time: 36.936 ms
Execution Time: 5719.548 ms


==================================================
EXPLAIN ANALYZE — Query 3: Top 10 Najlepiej Sprzedających Się Produktów (wg. Ilości Sprzedanych Jednostek) w Ostatnim Kwartale
==================================================
Limit  (cost=11754.11..11754.13 rows=10 width=46) (actual time=1967.675..2116.193 rows=10 loops=1)
  ->  Sort  (cost=11754.11..11765.56 rows=4580 width=46) (actual time=1967.670..2114.949 rows=10 loops=1)
        Sort Key: (count(*)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=11609.34..11655.14 rows=4580 width=46) (actual time=1963.840..2112.070 rows=3927 loops=1)
              Group Key: p.name, m.name
              Batches: 1  Memory Usage: 721kB
              ->  Gather  (cost=11180.04..11580.72 rows=3816 width=46) (actual time=1893.635..2106.615 rows=4345 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=10180.04..10199.12 rows=1908 width=46) (actual time=1663.781..1665.365 rows=1448 loops=3)
                          Group Key: p.name, m.name
                          Batches: 1  Memory Usage: 369kB
                          Worker 0:  Batches: 1  Memory Usage: 369kB
                          Worker 1:  Batches: 1  Memory Usage: 369kB
                          ->  Hash Join  (cost=2302.67..10165.73 rows=1908 width=38) (actual time=61.748..1655.268 rows=1521 loops=3)
                                Hash Cond: (p.manufacturer_id = m.id)
                                ->  Nested Loop  (cost=2297.30..10155.20 rows=1908 width=17) (actual time=57.318..1649.101 rows=1521 loops=3)
                                      ->  Nested Loop  (cost=2297.01..9525.36 rows=1908 width=4) (actual time=54.921..1542.169 rows=1521 loops=3)
                                            ->  Nested Loop  (cost=2296.72..8926.00 rows=1908 width=4) (actual time=51.324..1389.922 rows=1521 loops=3)
                                                  ->  Hash Join  (cost=2296.30..6557.80 rows=1908 width=4) (actual time=37.649..130.270 rows=1521 loops=3)
                                                        Hash Cond: (o.id = oi.order_id)
                                                        ->  Parallel Bitmap Heap Scan on "Order" o  (cost=1718.30..5722.18 rows=38165 width=4) (actual time=25.556..106.986 rows=30431 loops=3)
                                                              Recheck Cond: (order_date >= (now() - '3 mons'::interval))
                                                              Heap Blocks: exact=1218
                                                              ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..1695.40 rows=91596 width=0) (actual time=62.528..62.529 rows=91293 loops=1)
                                                                    Index Cond: (order_date >= (now() - '3 mons'::interval))
                                                        ->  Hash  (cost=328.00..328.00 rows=20000 width=8) (actual time=7.255..7.256 rows=20000 loops=3)
                                                              Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                                                              ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=8) (actual time=0.033..3.224 rows=20000 loops=3)
                                                  ->  Index Scan using "StockItem_pkey" on "StockItem" si  (cost=0.42..1.24 rows=1 width=8) (actual time=0.827..0.827 rows=1 loops=4563)
                                                        Index Cond: (id = oi.stock_item_id)
                                            ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.31 rows=1 width=8) (actual time=0.098..0.098 rows=1 loops=4563)
                                                  Index Cond: (id = si.variant_id)
                                      ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=21) (actual time=0.069..0.069 rows=1 loops=4563)
                                            Index Cond: (id = v.product_id)
                                ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=4.171..4.172 rows=150 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 18kB
                                      ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=3.409..3.428 rows=150 loops=3)
Planning Time: 85.762 ms
Execution Time: 2127.807 ms


==================================================
EXPLAIN ANALYZE — Query 4: Top 5 produktów z najwięcej recenzjami
==================================================
Limit  (cost=1792.59..1792.61 rows=5 width=25) (actual time=220.129..220.133 rows=5 loops=1)
  ->  Sort  (cost=1792.59..1842.59 rows=20000 width=25) (actual time=220.128..220.131 rows=5 loops=1)
        Sort Key: (COALESCE(r.count, '0'::bigint)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Hash Left Join  (cost=969.89..1460.40 rows=20000 width=25) (actual time=209.652..216.862 rows=20000 loops=1)
              Hash Cond: (p.id = r.product_id)
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.012..1.556 rows=20000 loops=1)
              ->  Hash  (cost=812.24..812.24 rows=12612 width=12) (actual time=209.628..209.630 rows=12612 loops=1)
                    Buckets: 16384  Batches: 1  Memory Usage: 670kB
                    ->  Subquery Scan on r  (cost=560.00..812.24 rows=12612 width=12) (actual time=201.941..205.737 rows=12612 loops=1)
                          ->  HashAggregate  (cost=560.00..686.12 rows=12612 width=12) (actual time=201.941..204.542 rows=12612 loops=1)
                                Group Key: "Review".product_id
                                Batches: 1  Memory Usage: 1425kB
                                ->  Seq Scan on "Review"  (cost=0.00..460.00 rows=20000 width=4) (actual time=1.816..194.505 rows=20000 loops=1)
Planning Time: 19.445 ms
Execution Time: 220.214 ms


==================================================
EXPLAIN ANALYZE — Query 5: Całkowity Przychód Pogrupowany Miesięcznie za Ostatni Rok
==================================================
Finalize GroupAggregate  (cost=9719.19..11975.47 rows=17309 width=36) (actual time=173.835..268.582 rows=11 loops=1)
  Group Key: ((date_trunc('month'::text, o.order_date))::date)
  ->  Gather Merge  (cost=9719.19..11564.38 rows=14424 width=36) (actual time=172.769..266.866 rows=33 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=8719.17..8899.47 rows=7212 width=36) (actual time=84.805..86.163 rows=11 loops=3)
              Group Key: ((date_trunc('month'::text, o.order_date))::date)
              ->  Sort  (cost=8719.17..8737.20 rows=7212 width=10) (actual time=83.148..83.690 rows=5760 loops=3)
                    Sort Key: ((date_trunc('month'::text, o.order_date))::date) DESC
                    Sort Method: quicksort  Memory: 851kB
                    Worker 0:  Sort Method: quicksort  Memory: 50kB
                    Worker 1:  Sort Method: quicksort  Memory: 96kB
                    ->  Hash Join  (cost=578.00..8257.02 rows=7212 width=10) (actual time=11.948..81.334 rows=5760 loops=3)
                          Hash Cond: (o.id = oi.order_id)
                          ->  Parallel Seq Scan on "Order" o  (cost=0.00..6669.33 rows=144241 width=12) (actual time=0.014..47.383 rows=115772 loops=3)
                                Filter: (order_date >= (date_trunc('year'::text, now()) - '00:00:00'::interval))
                                Rows Removed by Filter: 17562
                          ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=11.066..11.067 rows=20000 loops=3)
                                Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.024..4.921 rows=20000 loops=3)
Planning Time: 6.131 ms
Execution Time: 279.011 ms


==================================================
EXPLAIN ANALYZE — Query 6: Produkty najczęściej dodawane do ulubionych
==================================================
Limit  (cost=14382.58..14382.60 rows=10 width=25) (actual time=1288.846..1334.372 rows=10 loops=1)
  ->  Sort  (cost=14382.58..14432.58 rows=20000 width=25) (actual time=1288.837..1333.099 rows=10 loops=1)
        Sort Key: (count(f.id)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=13750.38..13950.38 rows=20000 width=25) (actual time=1278.770..1326.100 rows=20000 loops=1)
              Group Key: p.id
              Batches: 1  Memory Usage: 2577kB
              ->  Gather  (cost=9350.38..13550.38 rows=40000 width=25) (actual time=849.665..1096.151 rows=59999 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=8350.38..8550.38 rows=20000 width=25) (actual time=789.890..825.622 rows=20000 loops=3)
                          Group Key: p.id
                          Batches: 1  Memory Usage: 2577kB
                          Worker 0:  Batches: 1  Memory Usage: 2577kB
                          Worker 1:  Batches: 1  Memory Usage: 2577kB
                          ->  Hash Join  (cost=688.00..7100.38 rows=250000 width=21) (actual time=13.927..688.526 rows=200000 loops=3)
                                Hash Cond: (f.product_id = p.id)
                                ->  Parallel Seq Scan on "FavoriteProduct" f  (cost=0.00..5756.00 rows=250000 width=8) (actual time=5.613..582.242 rows=200000 loops=3)
                                ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=7.913..8.627 rows=20000 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1215kB
                                      ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.042..3.113 rows=20000 loops=3)
Planning Time: 29.298 ms
Execution Time: 1337.308 ms


==================================================
EXPLAIN ANALYZE — Query 7: Dostępny Stan Magazynowy Wariantów Produktu Pogrupowany po Magazynach
==================================================
GroupAggregate  (cost=37640.01..42664.89 rows=223328 width=61) (actual time=1355.942..1674.264 rows=178012 loops=1)
  Group Key: p.name, w.name, v.sku
  ->  Sort  (cost=37640.01..38198.33 rows=223328 width=57) (actual time=1352.277..1574.732 rows=223971 loops=1)
        Sort Key: p.name, w.name, v.sku
        Sort Method: external merge  Disk: 15248kB
        ->  Hash Join  (cost=2189.15..9398.65 rows=223328 width=57) (actual time=31.636..572.287 rows=223971 loops=1)
              Hash Cond: (si.warehouse_id = w.id)
              ->  Hash Join  (cost=2144.50..8766.15 rows=223328 width=44) (actual time=31.119..530.029 rows=223971 loops=1)
                    Hash Cond: (v.product_id = p.id)
                    ->  Hash Join  (cost=1456.50..7491.79 rows=223328 width=35) (actual time=24.588..439.689 rows=223971 loops=1)
                          Hash Cond: (si.variant_id = v.id)
                          ->  Seq Scan on "StockItem" si  (cost=0.00..5449.00 rows=223328 width=12) (actual time=0.016..307.939 rows=223971 loops=1)
                                Filter: (shipment_id IS NULL)
                                Rows Removed by Filter: 96029
                          ->  Hash  (cost=869.00..869.00 rows=47000 width=31) (actual time=24.551..25.601 rows=47000 loops=1)
                                Buckets: 65536  Batches: 1  Memory Usage: 3450kB
                                ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=31) (actual time=0.005..6.569 rows=47000 loops=1)
                    ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=6.520..6.520 rows=20000 loops=1)
                          Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                          ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.006..2.486 rows=20000 loops=1)
              ->  Hash  (cost=25.40..25.40 rows=1540 width=21) (actual time=0.511..0.511 rows=10 loops=1)
                    Buckets: 2048  Batches: 1  Memory Usage: 17kB
                    ->  Seq Scan on "Warehouse" w  (cost=0.00..25.40 rows=1540 width=21) (actual time=0.012..0.014 rows=10 loops=1)
Planning Time: 12.410 ms
Execution Time: 1694.315 ms


==================================================
EXPLAIN ANALYZE — Query 8: Stan magazynowy per produkt
==================================================
Sort  (cost=11494.90..11544.43 rows=19812 width=21) (actual time=297.073..298.822 rows=17916 loops=1)
  Sort Key: (count(si.id)) DESC
  Sort Method: quicksort  Memory: 1482kB
  ->  HashAggregate  (cost=9882.79..10080.91 rows=19812 width=21) (actual time=289.609..293.597 rows=17916 loops=1)
        Group Key: p.name
        Batches: 1  Memory Usage: 2065kB
        ->  Hash Join  (cost=2144.50..8766.15 rows=223328 width=17) (actual time=18.555..211.377 rows=223971 loops=1)
              Hash Cond: (v.product_id = p.id)
              ->  Hash Join  (cost=1456.50..7491.79 rows=223328 width=8) (actual time=12.280..137.017 rows=223971 loops=1)
                    Hash Cond: (si.variant_id = v.id)
                    ->  Seq Scan on "StockItem" si  (cost=0.00..5449.00 rows=223328 width=8) (actual time=0.014..37.888 rows=223971 loops=1)
                          Filter: (shipment_id IS NULL)
                          Rows Removed by Filter: 96029
                    ->  Hash  (cost=869.00..869.00 rows=47000 width=8) (actual time=12.245..12.246 rows=47000 loops=1)
                          Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                          ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=8) (actual time=0.005..5.118 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=6.263..6.264 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.599..2.980 rows=20000 loops=1)
Planning Time: 15.937 ms
Execution Time: 300.335 ms


==================================================
EXPLAIN ANALYZE — Query 9: Najpopularniejsze Kategorie (wg. Całkowitego Przychodu)
==================================================
Limit  (cost=12371.00..12371.02 rows=10 width=44) (actual time=642.366..873.014 rows=10 loops=1)
  ->  Sort  (cost=12371.00..12371.37 rows=150 width=44) (actual time=641.606..871.176 rows=10 loops=1)
        Sort Key: (sum(oi.unit_price)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize GroupAggregate  (cost=12328.63..12367.76 rows=150 width=44) (actual time=636.523..867.601 rows=150 loops=1)
              Group Key: c.name
              ->  Gather Merge  (cost=12328.63..12363.63 rows=300 width=44) (actual time=625.518..860.430 rows=428 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Sort  (cost=11328.61..11328.98 rows=150 width=44) (actual time=300.360..303.231 rows=143 loops=3)
                          Sort Key: c.name
                          Sort Method: quicksort  Memory: 39kB
                          Worker 0:  Sort Method: quicksort  Memory: 37kB
                          Worker 1:  Sort Method: quicksort  Memory: 38kB
                          ->  Partial HashAggregate  (cost=11321.31..11323.19 rows=150 width=44) (actual time=266.800..268.980 rows=143 loops=3)
                                Group Key: c.name
                                Batches: 1  Memory Usage: 96kB
                                Worker 0:  Batches: 1  Memory Usage: 96kB
                                Worker 1:  Batches: 1  Memory Usage: 96kB
                                ->  Hash Join  (cost=8362.48..11112.98 rows=41667 width=18) (actual time=112.481..251.650 rows=33334 loops=3)
                                      Hash Cond: (pc.category_id = c.id)
                                      ->  Parallel Hash Join  (cost=8357.10..10995.13 rows=41667 width=10) (actual time=104.771..237.158 rows=33334 loops=3)
                                            Hash Cond: (pc.product_id = p.id)
                                            ->  Parallel Index Only Scan using uq_prodcat_product_category on "ProductCategory" pc  (cost=0.29..2236.96 rows=41667 width=8) (actual time=48.134..168.312 rows=33333 loops=3)
                                                  Heap Fetches: 0
                                            ->  Parallel Hash  (cost=8209.75..8209.75 rows=11765 width=14) (actual time=45.726..46.874 rows=6667 loops=3)
                                                  Buckets: 32768  Batches: 1  Memory Usage: 1216kB
                                                  ->  Hash Join  (cost=2722.50..8209.75 rows=11765 width=14) (actual time=24.237..117.918 rows=20000 loops=1)
                                                        Hash Cond: (v.product_id = p.id)
                                                        ->  Hash Join  (cost=2034.50..7490.85 rows=11765 width=10) (actual time=18.869..103.555 rows=20000 loops=1)
                                                              Hash Cond: (si.variant_id = v.id)
                                                              ->  Hash Join  (cost=578.00..6003.47 rows=11765 width=10) (actual time=6.091..81.746 rows=20000 loops=1)
                                                                    Hash Cond: (si.id = oi.stock_item_id)
                                                                    ->  Parallel Seq Scan on "StockItem" si  (cost=0.00..4131.35 rows=188235 width=8) (actual time=0.005..23.122 rows=320000 loops=1)
                                                                    ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=5.537..6.237 rows=20000 loops=1)
                                                                          Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                                                          ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.014..2.292 rows=20000 loops=1)
                                                              ->  Hash  (cost=869.00..869.00 rows=47000 width=8) (actual time=12.758..12.758 rows=47000 loops=1)
                                                                    Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                                                    ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=8) (actual time=0.009..5.195 rows=47000 loops=1)
                                                        ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=5.356..6.199 rows=20000 loops=1)
                                                              Buckets: 32768  Batches: 1  Memory Usage: 960kB
                                                              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.010..2.082 rows=20000 loops=1)
                                      ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=6.462..6.463 rows=150 loops=3)
                                            Buckets: 1024  Batches: 1  Memory Usage: 16kB
                                            ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=6.404..6.425 rows=150 loops=3)
Planning Time: 22.436 ms
Execution Time: 877.213 ms


==================================================
EXPLAIN ANALYZE — Query 10: Liczba produktów per kategoria
==================================================
Sort  (cost=2342.22..2342.59 rows=150 width=20) (actual time=197.214..197.225 rows=150 loops=1)
  Sort Key: (count(pc.product_id)) DESC
  Sort Method: quicksort  Memory: 30kB
  ->  HashAggregate  (cost=2335.30..2336.80 rows=150 width=20) (actual time=196.586..196.611 rows=150 loops=1)
        Group Key: c.name
        Batches: 1  Memory Usage: 48kB
        ->  Hash Right Join  (cost=5.38..1835.30 rows=100000 width=16) (actual time=2.080..176.021 rows=100000 loops=1)
              Hash Cond: (pc.category_id = c.id)
              ->  Seq Scan on "ProductCategory" pc  (cost=0.00..1560.00 rows=100000 width=8) (actual time=1.417..153.560 rows=100000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=0.063..0.065 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 16kB
                    ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=0.013..0.036 rows=150 loops=1)
Planning Time: 0.230 ms
Execution Time: 197.293 ms


==================================================
EXPLAIN ANALYZE — Query 11: Liczba zamówień per metoda płatności
==================================================
Sort  (cost=7808.47..7808.49 rows=6 width=50) (actual time=192.926..310.019 rows=6 loops=1)
  Sort Key: (sum(oi.unit_price)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  Finalize GroupAggregate  (cost=7806.80..7808.40 rows=6 width=50) (actual time=192.271..309.371 rows=6 loops=1)
        Group Key: pm.name
        ->  Gather Merge  (cost=7806.80..7808.20 rows=12 width=50) (actual time=186.203..302.154 rows=6 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Sort  (cost=6806.78..6806.79 rows=6 width=50) (actual time=55.958..55.963 rows=2 loops=3)
                    Sort Key: pm.name
                    Sort Method: quicksort  Memory: 25kB
                    Worker 0:  Sort Method: quicksort  Memory: 25kB
                    Worker 1:  Sort Method: quicksort  Memory: 25kB
                    ->  Partial HashAggregate  (cost=6806.62..6806.70 rows=6 width=50) (actual time=52.963..52.969 rows=2 loops=3)
                          Group Key: pm.name
                          Batches: 1  Memory Usage: 24kB
                          Worker 0:  Batches: 1  Memory Usage: 24kB
                          Worker 1:  Batches: 1  Memory Usage: 24kB
                          ->  Hash Join  (cost=579.13..6744.13 rows=8333 width=20) (actual time=7.098..49.965 rows=6667 loops=3)
                                Hash Cond: (o.payment_method_id = pm.id)
                                ->  Hash Join  (cost=578.00..6705.67 rows=8333 width=14) (actual time=1.853..43.296 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.002..14.114 rows=133333 loops=3)
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=5.534..5.535 rows=20000 loops=1)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.006..2.316 rows=20000 loops=1)
                                ->  Hash  (cost=1.06..1.06 rows=6 width=14) (actual time=4.781..4.782 rows=6 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                      ->  Seq Scan on "PaymentMethod" pm  (cost=0.00..1.06 rows=6 width=14) (actual time=3.701..3.703 rows=6 loops=3)
Planning Time: 21.743 ms
Execution Time: 319.795 ms


==================================================
EXPLAIN ANALYZE — Query 12: Średnia ocena per producent
==================================================
Sort  (cost=1367.54..1367.91 rows=150 width=57) (actual time=36.754..36.764 rows=150 loops=1)
  Sort Key: (round(avg(r.rating), 2)) DESC NULLS LAST
  Sort Method: quicksort  Memory: 32kB
  ->  HashAggregate  (cost=1359.87..1362.12 rows=150 width=57) (actual time=35.458..35.529 rows=150 loops=1)
        Group Key: m.name
        Batches: 1  Memory Usage: 64kB
        ->  Hash Join  (cost=693.38..1259.87 rows=20000 width=29) (actual time=8.624..28.471 rows=27388 loops=1)
              Hash Cond: (p.manufacturer_id = m.id)
              ->  Hash Right Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=5.971..20.170 rows=27388 loops=1)
                    Hash Cond: (r.product_id = p.id)
                    ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=0.016..2.214 rows=20000 loops=1)
                    ->  Hash  (cost=438.00..438.00 rows=20000 width=8) (actual time=5.939..5.940 rows=20000 loops=1)
                          Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                          ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=8) (actual time=0.008..2.871 rows=20000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=2.001..2.002 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 18kB
                    ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=1.957..1.973 rows=150 loops=1)
Planning Time: 13.683 ms
Execution Time: 38.098 ms


==================================================
EXPLAIN ANALYZE — Query 13: Aktywne promocje i objęta nimi liczba wariantów
==================================================
Sort  (cost=395.64..395.76 rows=47 width=14) (actual time=13.984..15.093 rows=46 loops=1)
  Sort Key: (count(v.id)) DESC
  Sort Method: quicksort  Memory: 26kB
  ->  HashAggregate  (cost=393.87..394.34 rows=47 width=14) (actual time=13.954..13.963 rows=46 loops=1)
        Group Key: pr.name
        Batches: 1  Memory Usage: 24kB
        ->  Merge Join  (cost=7.63..337.47 rows=11280 width=10) (actual time=4.678..11.655 rows=1340 loops=1)
              Merge Cond: (v.promotion_id = pr.id)
              ->  Index Scan using idx_variant_promotion on "Variant" v  (cost=0.29..2469.28 rows=47000 width=8) (actual time=0.028..6.180 rows=5685 loops=1)
              ->  Sort  (cost=7.34..7.46 rows=48 width=10) (actual time=3.382..3.389 rows=47 loops=1)
                    Sort Key: pr.id
                    Sort Method: quicksort  Memory: 26kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=48 width=10) (actual time=2.496..2.521 rows=47 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 153
Planning Time: 53.157 ms
Execution Time: 44.257 ms


==================================================
EXPLAIN ANALYZE — Query 14: Najczęściej wybierane warianty w koszykach
==================================================
Limit  (cost=224158.84..224158.87 rows=10 width=44) (actual time=8395.718..8395.723 rows=10 loops=1)
  ->  Sort  (cost=224158.84..227908.84 rows=1500000 width=44) (actual time=8395.717..8395.719 rows=10 loops=1)
        Sort Key: (sum(ci.quantity)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  GroupAggregate  (cost=4.24..191744.38 rows=1500000 width=44) (actual time=112.478..8384.609 rows=47000 loops=1)
              Group Key: v.sku, p.name
              ->  Incremental Sort  (cost=4.24..165494.38 rows=1500000 width=40) (actual time=53.589..8087.029 rows=1500000 loops=1)
                    Sort Key: v.sku, p.name
                    Presorted Key: v.sku
                    Full-sort Groups: 31708  Sort Method: quicksort  Average Memory: 27kB  Peak Memory: 27kB
                    Pre-sorted Groups: 6442  Sort Method: quicksort  Average Memory: 26kB  Peak Memory: 26kB
                    ->  Nested Loop  (cost=1.14..108333.20 rows=1500000 width=40) (actual time=12.567..7596.743 rows=1500000 loops=1)
                          ->  Nested Loop  (cost=0.71..8804.70 rows=47000 width=40) (actual time=11.333..189.158 rows=47000 loops=1)
                                ->  Index Scan using "Variant_sku_key" on "Variant" v  (cost=0.41..2051.42 rows=47000 width=31) (actual time=9.076..38.401 rows=47000 loops=1)
                                ->  Memoize  (cost=0.30..0.34 rows=1 width=17) (actual time=0.003..0.003 rows=1 loops=47000)
                                      Cache Key: v.product_id
                                      Cache Mode: logical
                                      Hits: 28889  Misses: 18111  Evictions: 0  Overflows: 0  Memory Usage: 2099kB
                                      ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=17) (actual time=0.004..0.004 rows=1 loops=18111)
                                            Index Cond: (id = v.product_id)
                          ->  Index Scan using idx_cartitem_variant_id on "CartItem" ci  (cost=0.43..1.80 rows=32 width=8) (actual time=0.008..0.153 rows=32 loops=47000)
                                Index Cond: (variant_id = v.id)
Planning Time: 117.098 ms
Execution Time: 8410.873 ms


==================================================
EXPLAIN ANALYZE — Query 15: Produkty z Największą Różnicą Między Ceną Podstawową a Ceną Wariantu
==================================================
Limit  (cost=2813.55..2813.58 rows=10 width=80) (actual time=47.660..48.580 rows=10 loops=1)
  ->  Sort  (cost=2813.55..2931.05 rows=47000 width=80) (actual time=47.658..47.661 rows=10 loops=1)
        Sort Key: v.price_modifier DESC
        Sort Method: top-N heapsort  Memory: 27kB
        ->  Hash Join  (cost=688.00..1797.90 rows=47000 width=80) (actual time=7.150..32.619 rows=47000 loops=1)
              Hash Cond: (v.product_id = p.id)
              ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=33) (actual time=0.805..4.140 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=6.324..6.326 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1381kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.019..2.725 rows=20000 loops=1)
Planning Time: 27.571 ms
Execution Time: 50.936 ms


==================================================
EXPLAIN ANALYZE — Query 16: Konwersja zamówień wg statusu
==================================================
Sort  (cost=7957.56..7962.66 rows=2040 width=48) (actual time=463.739..1221.764 rows=7 loops=1)
  Sort Key: (count(o.id)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  WindowAgg  (cost=7824.99..7845.41 rows=2040 width=48) (actual time=463.724..1221.112 rows=7 loops=1)
        ->  Finalize HashAggregate  (cost=7779.11..7799.51 rows=2040 width=16) (actual time=459.024..1216.424 rows=7 loops=1)
              Group Key: s.name
              Batches: 1  Memory Usage: 121kB
              ->  Gather  (cost=7330.31..7758.71 rows=4080 width=16) (actual time=237.806..1213.864 rows=7 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=6330.31..6350.71 rows=2040 width=16) (actual time=73.558..73.566 rows=2 loops=3)
                          Group Key: s.name
                          Batches: 1  Memory Usage: 121kB
                          Worker 0:  Batches: 1  Memory Usage: 121kB
                          Worker 1:  Batches: 1  Memory Usage: 121kB
                          ->  Hash Join  (cost=55.90..5496.98 rows=166667 width=12) (actual time=0.018..44.950 rows=133333 loops=3)
                                Hash Cond: (o.status_id = s.id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.004..12.279 rows=133333 loops=3)
                                ->  Hash  (cost=30.40..30.40 rows=2040 width=12) (actual time=0.022..0.023 rows=7 loops=1)
                                      Buckets: 2048  Batches: 1  Memory Usage: 17kB
                                      ->  Seq Scan on "Status" s  (cost=0.00..30.40 rows=2040 width=12) (actual time=0.015..0.017 rows=7 loops=1)
Planning Time: 39.393 ms
Execution Time: 1229.176 ms


==================================================
EXPLAIN ANALYZE — Query 17: Top klienci wg wydatków
==================================================
Limit  (cost=15399.41..15399.44 rows=10 width=50) (actual time=4386.847..4438.332 rows=10 loops=1)
  ->  Sort  (cost=15399.41..15449.41 rows=20000 width=50) (actual time=4386.847..4438.329 rows=10 loops=1)
        Sort Key: (sum(oi.unit_price)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=14717.22..14967.22 rows=20000 width=50) (actual time=4341.931..4426.191 rows=19296 loops=1)
              Group Key: u.id
              Batches: 5  Memory Usage: 8241kB  Disk Usage: 216kB
              ->  Gather  (cost=12821.46..14592.22 rows=16666 width=50) (actual time=3710.241..3984.428 rows=19416 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=11821.46..11925.62 rows=8333 width=50) (actual time=3576.921..3660.292 rows=6472 loops=3)
                          Group Key: u.id
                          Batches: 1  Memory Usage: 3217kB
                          Worker 0:  Batches: 1  Memory Usage: 2961kB
                          Worker 1:  Batches: 1  Memory Usage: 2961kB
                          ->  Nested Loop  (cost=578.42..11779.80 rows=8333 width=24) (actual time=27.369..3484.023 rows=6667 loops=3)
                                ->  Hash Join  (cost=578.00..6705.67 rows=8333 width=10) (actual time=7.753..225.201 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.009..145.058 rows=133333 loops=3)
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=7.503..8.140 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.468..2.971 rows=20000 loops=3)
                                ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.479..0.479 rows=1 loops=20000)
                                      Index Cond: (id = o.user_id)
Planning Time: 24.907 ms
Execution Time: 4460.907 ms


==================================================
EXPLAIN ANALYZE — Query 18: Produkty z wariantami objętymi promocją, z końcową ceną
==================================================
Sort  (cost=1983.52..2011.72 rows=11280 width=132) (actual time=62.745..62.885 rows=1340 loops=1)
  Sort Key: (round(((p.price + v.price_modifier) * ('1'::numeric - pr.discount_percentage)), 2))
  Sort Method: quicksort  Memory: 146kB
  ->  Hash Join  (cost=695.63..1224.29 rows=11280 width=132) (actual time=32.321..60.390 rows=1340 loops=1)
        Hash Cond: (v.product_id = p.id)
        ->  Merge Join  (cost=7.63..337.47 rows=11280 width=39) (actual time=0.687..27.165 rows=1340 loops=1)
              Merge Cond: (v.promotion_id = pr.id)
              ->  Index Scan using idx_variant_promotion on "Variant" v  (cost=0.29..2469.28 rows=47000 width=37) (actual time=0.023..25.619 rows=5685 loops=1)
              ->  Sort  (cost=7.34..7.46 rows=48 width=10) (actual time=0.660..0.670 rows=47 loops=1)
                    Sort Key: pr.id
                    Sort Method: quicksort  Memory: 26kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=48 width=10) (actual time=0.021..0.045 rows=47 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 153
        ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=30.999..31.000 rows=20000 loops=1)
              Buckets: 32768  Batches: 1  Memory Usage: 1381kB
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.478..15.165 rows=20000 loops=1)
Planning Time: 37.238 ms
Execution Time: 64.169 ms


==================================================
EXPLAIN ANALYZE — Query 19: Użytkownicy, Którzy Dodali Produkt do Koszyka, Ale Nie Złożyli Zamówienia (Potencjał Odbudowy Koszyka)
==================================================
Hash Join  (cost=45873.97..103632.31 rows=1070130 width=55) (actual time=4715.973..10804.769 rows=1005006 loops=1)
  Hash Cond: (v.product_id = p.id)
  ->  Hash Join  (cost=45185.97..100134.62 rows=1070130 width=46) (actual time=4706.871..10203.411 rows=1005006 loops=1)
        Hash Cond: (ci.variant_id = v.id)
        ->  Hash Join  (cost=43729.47..95868.77 rows=1070130 width=46) (actual time=4689.572..9513.960 rows=1005006 loops=1)
              Hash Cond: (ci.cart_id = c.id)
              ->  Seq Scan on "CartItem" ci  (cost=0.00..23152.00 rows=1500000 width=8) (actual time=1.286..3794.586 rows=1500000 loops=1)
              ->  Hash  (cost=41450.81..41450.81 rows=107013 width=46) (actual time=4682.205..4693.775 rows=100414 loops=1)
                    Buckets: 131072  Batches: 2  Memory Usage: 4929kB
                    ->  Gather  (cost=25017.67..41450.81 rows=107013 width=46) (actual time=4344.656..4411.264 rows=100414 loops=1)
                          Workers Planned: 2
                          Workers Launched: 2
                          ->  Parallel Hash Right Anti Join  (cost=24017.67..29749.51 rows=44589 width=46) (actual time=3689.608..3716.659 rows=33471 loops=3)
                                Hash Cond: (o.user_id = u.id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=4) (actual time=7.598..633.759 rows=133333 loops=3)
                                ->  Parallel Hash  (cost=23236.42..23236.42 rows=62500 width=50) (actual time=2570.403..2570.790 rows=50000 loops=3)
                                      Buckets: 262144  Batches: 1  Memory Usage: 14720kB
                                      ->  Hash Join  (cost=4079.00..23236.42 rows=62500 width=50) (actual time=291.642..2245.986 rows=50000 loops=3)
                                            Hash Cond: (u.id = c.user_id)
                                            ->  Parallel Seq Scan on "User" u  (cost=0.00..18063.67 rows=416667 width=46) (actual time=1.011..1538.538 rows=333333 loops=3)
                                            ->  Hash  (cost=2204.00..2204.00 rows=150000 width=8) (actual time=284.038..284.039 rows=150000 loops=3)
                                                  Buckets: 262144  Batches: 1  Memory Usage: 7908kB
                                                  ->  Seq Scan on "Cart" c  (cost=0.00..2204.00 rows=150000 width=8) (actual time=5.124..147.487 rows=150000 loops=3)
        ->  Hash  (cost=869.00..869.00 rows=47000 width=8) (actual time=13.885..13.886 rows=47000 loops=1)
              Buckets: 65536  Batches: 1  Memory Usage: 2348kB
              ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=8) (actual time=0.012..5.111 rows=47000 loops=1)
  ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=5.713..5.714 rows=20000 loops=1)
        Buckets: 32768  Batches: 1  Memory Usage: 1245kB
        ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.015..2.371 rows=20000 loops=1)
Planning Time: 58.499 ms
Execution Time: 10938.107 ms


==================================================
EXPLAIN ANALYZE — Query 20: Wyszukiwanie produktów po nazwie lub opisie (parametryzowane)
==================================================
Bitmap Heap Scan on "Product"  (cost=43.00..57.51 rows=4 width=60) (actual time=4.072..35.648 rows=143 loops=1)
  Recheck Cond: (((name)::text ~~* '%test%'::text) OR (description ~~* '%test%'::text))
  Heap Blocks: exact=106
  ->  BitmapOr  (cost=43.00..43.00 rows=4 width=0) (actual time=2.935..2.936 rows=0 loops=1)
        ->  Bitmap Index Scan on idx_product_name_trgm  (cost=0.00..21.50 rows=2 width=0) (actual time=1.745..1.746 rows=42 loops=1)
              Index Cond: ((name)::text ~~* '%test%'::text)
        ->  Bitmap Index Scan on idx_product_description_trgm  (cost=0.00..21.50 rows=2 width=0) (actual time=1.184..1.184 rows=102 loops=1)
              Index Cond: (description ~~* '%test%'::text)
Planning Time: 136.540 ms
Execution Time: 42.813 ms


==================================================
EXPLAIN ANALYZE — Query 21: Użytkownicy, Którzy Zapisali Konkretny Produkt jako Ulubiony (np. Product ID=350259)
==================================================
Nested Loop  (cost=0.85..262.23 rows=30 width=56) (actual time=4.465..26.181 rows=26 loops=1)
  ->  Index Only Scan using idx_favoriteproduct_product_user on "FavoriteProduct" fp  (cost=0.42..8.95 rows=30 width=4) (actual time=3.896..3.907 rows=26 loops=1)
        Index Cond: (product_id = 35)
        Heap Fetches: 0
  ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..8.44 rows=1 width=60) (actual time=0.856..0.856 rows=1 loops=26)
        Index Cond: (id = fp.user_id)
Planning Time: 13.601 ms
Execution Time: 26.218 ms


==================================================
EXPLAIN ANALYZE — Query 22: Znajdź Magazyny, Które Posiadają Zapasy Konkretnego Wariantu (np. SKU='VR-000000-a637d44b7afd')
==================================================
GroupAggregate  (cost=24.91..25.01 rows=2 width=25) (actual time=3.077..3.078 rows=0 loops=1)
  Group Key: w.name
  Filter: (count(si.id) > 0)
  ->  Sort  (cost=24.91..24.93 rows=5 width=21) (actual time=3.075..3.077 rows=0 loops=1)
        Sort Key: w.name
        Sort Method: quicksort  Memory: 25kB
        ->  Nested Loop  (cost=0.99..24.86 rows=5 width=21) (actual time=2.483..2.484 rows=0 loops=1)
              ->  Nested Loop  (cost=0.84..24.00 rows=5 width=8) (actual time=2.482..2.483 rows=0 loops=1)
                    ->  Index Scan using "Variant_sku_key" on "Variant" v  (cost=0.41..8.43 rows=1 width=4) (actual time=2.481..2.482 rows=0 loops=1)
                          Index Cond: ((sku)::text = 'VR-000001-2704de10f283'::text)
                    ->  Index Scan using idx_stockitem_shipment_variant_warehouse on "StockItem" si  (cost=0.42..15.52 rows=5 width=12) (never executed)
                          Index Cond: ((shipment_id IS NULL) AND (variant_id = v.id))
              ->  Index Scan using "Warehouse_pkey" on "Warehouse" w  (cost=0.15..0.17 rows=1 width=21) (never executed)
                    Index Cond: (id = si.warehouse_id)
Planning Time: 20.000 ms
Execution Time: 3.757 ms


==================================================
EXPLAIN ANALYZE — Query 23: Warianty, Które Wymagają Uzyskania Konkretnej Opcji (np. 'Kolor'='Czerwony')
==================================================
Nested Loop  (cost=6.96..680.20 rows=1 width=36) (actual time=0.616..0.616 rows=0 loops=1)
  ->  Nested Loop  (cost=6.67..679.87 rows=1 width=27) (actual time=0.615..0.616 rows=0 loops=1)
        ->  Nested Loop  (cost=6.38..679.55 rows=1 width=4) (actual time=0.615..0.616 rows=0 loops=1)
              Join Filter: (opt.attribute_id = a.id)
              ->  Index Scan using "Attribute_name_key" on "Attribute" a  (cost=0.15..8.17 rows=1 width=4) (actual time=0.615..0.615 rows=0 loops=1)
                    Index Cond: ((name)::text = 'Attr_49_Century'::text)
              ->  Nested Loop  (cost=6.23..668.26 rows=250 width=8) (never executed)
                    ->  Seq Scan on "Option" opt  (cost=0.00..18.50 rows=1 width=8) (never executed)
                          Filter: ((value)::text = 'do'::text)
                    ->  Bitmap Heap Scan on "VariantOption" vo  (cost=6.23..647.26 rows=250 width=8) (never executed)
                          Recheck Cond: (option_id = opt.id)
                          ->  Bitmap Index Scan on idx_variantoption_option_id  (cost=0.00..6.17 rows=250 width=0) (never executed)
                                Index Cond: (option_id = opt.id)
        ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.32 rows=1 width=31) (never executed)
              Index Cond: (id = vo.variant_id)
  ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=17) (never executed)
        Index Cond: (id = v.product_id)
Planning Time: 51.265 ms
Execution Time: 0.668 ms


==================================================
EXPLAIN ANALYZE — Query 24: Znajdź Zamówienia Użytkownika (np. email='debbie.lane.16786.50af0753@example.com') o Statusie 'Paid'
==================================================
Nested Loop  (cost=1.00..17.09 rows=1 width=20) (actual time=3.551..3.552 rows=0 loops=1)
  ->  Nested Loop  (cost=0.85..16.89 rows=1 width=16) (actual time=3.550..3.551 rows=0 loops=1)
        ->  Index Scan using "User_email_key" on "User" u  (cost=0.42..8.44 rows=1 width=4) (actual time=3.550..3.550 rows=0 loops=1)
              Index Cond: ((email)::text = 'debbie.lane.16786.50af0753@example.com'::text)
        ->  Index Scan using idx_order_user_id on "Order" o  (cost=0.42..8.44 rows=1 width=20) (never executed)
              Index Cond: (user_id = u.id)
  ->  Index Scan using "Status_pkey" on "Status" s  (cost=0.15..0.17 rows=1 width=12) (never executed)
        Index Cond: (id = o.status_id)
        Filter: ((name)::text = 'Paid'::text)
Planning Time: 8.171 ms
Execution Time: 3.592 ms


==================================================
EXPLAIN ANALYZE — Query 25: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
Nested Loop Left Join  (cost=5.45..49.87 rows=16 width=87) (actual time=3.601..9.670 rows=18 loops=1)
  ->  Nested Loop Left Join  (cost=5.30..46.34 rows=16 width=45) (actual time=2.744..8.780 rows=18 loops=1)
        ->  Nested Loop Left Join  (cost=5.02..41.66 rows=16 width=39) (actual time=2.710..7.550 rows=18 loops=1)
              ->  Nested Loop  (cost=4.60..23.91 rows=3 width=39) (actual time=0.034..1.244 rows=4 loops=1)
                    ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..8.30 rows=1 width=10) (actual time=0.008..0.010 rows=1 loops=1)
                          Index Cond: (id = 35)
                    ->  Bitmap Heap Scan on "Variant" v  (cost=4.31..15.57 rows=3 width=37) (actual time=0.021..1.227 rows=4 loops=1)
                          Recheck Cond: (product_id = 35)
                          Heap Blocks: exact=4
                          ->  Bitmap Index Scan on idx_variant_product_id  (cost=0.00..4.31 rows=3 width=0) (actual time=0.007..0.007 rows=4 loops=1)
                                Index Cond: (product_id = 35)
              ->  Index Only Scan using uq_varopt_variant_option on "VariantOption" vo  (cost=0.42..5.86 rows=6 width=8) (actual time=1.573..1.575 rows=4 loops=4)
                    Index Cond: (variant_id = v.id)
                    Heap Fetches: 0
        ->  Index Scan using "Option_pkey" on "Option" opt  (cost=0.28..0.29 rows=1 width=14) (actual time=0.068..0.068 rows=1 loops=18)
              Index Cond: (id = vo.option_id)
  ->  Index Scan using "Attribute_pkey" on "Attribute" a  (cost=0.15..0.22 rows=1 width=18) (actual time=0.001..0.001 rows=1 loops=18)
        Index Cond: (id = opt.attribute_id)
Planning Time: 0.545 ms
Execution Time: 9.719 ms


==================================================
EXPLAIN ANALYZE — Query 26: Lista Wszystkich Dziecięcych Kategorii (Podkategorii) dla Konkretnej Kategorii Nadrzędnej (np. ID=5)
==================================================
Seq Scan on "Category"  (cost=0.00..3.88 rows=3 width=12) (actual time=1.292..1.930 rows=3 loops=1)
  Filter: (parent_id = 5)
  Rows Removed by Filter: 147
Planning Time: 1.364 ms
Execution Time: 1.951 ms


==================================================
EXPLAIN ANALYZE — Query 27: Porównanie Średniej Oceny dla Promowanych i Niepromowanych Produktów
==================================================
HashAggregate  (cost=87850.51..87853.01 rows=200 width=64) (actual time=154.403..154.407 rows=2 loops=1)
  Group Key: CASE WHEN (ANY (p.id = (hashed SubPlan 2).col1)) THEN 'Promowany'::text ELSE 'Niepromowany'::text END
  Batches: 1  Memory Usage: 40kB
  ->  HashAggregate  (cost=1300.51..87550.51 rows=20000 width=68) (actual time=144.504..151.386 rows=12612 loops=1)
        Group Key: p.id
        Batches: 1  Memory Usage: 2577kB
        ->  Hash Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=58.523..127.448 rows=20000 loops=1)
              Hash Cond: (r.product_id = p.id)
              ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=1.307..61.858 rows=20000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=54.671..54.672 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 960kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.013..51.056 rows=20000 loops=1)
        SubPlan 2
          ->  Index Only Scan using idx_variant_product_promotion on "Variant" v2  (cost=0.28..158.09 rows=5739 width=4) (actual time=2.126..6.234 rows=5684 loops=1)
                Heap Fetches: 0
Planning Time: 7.895 ms
Execution Time: 157.204 ms


==================================================
EXPLAIN ANALYZE — Query 28: Top 5 Miast Generujących Największy Przychód (Wg. Adresu Wysyłki)
==================================================
Limit  (cost=15315.16..15315.17 rows=5 width=45) (actual time=3910.969..3958.469 rows=5 loops=1)
  ->  Sort  (cost=15315.16..15365.16 rows=20000 width=45) (actual time=3910.081..3957.578 rows=5 loops=1)
        Sort Key: (sum(oi.unit_price)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=14732.97..14982.97 rows=20000 width=45) (actual time=3900.863..3953.702 rows=12950 loops=1)
              Group Key: a.city
              Batches: 1  Memory Usage: 5905kB
              ->  Gather  (cost=12837.21..14607.97 rows=16666 width=45) (actual time=3673.037..3804.890 rows=16154 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=11837.21..11941.37 rows=8333 width=45) (actual time=3630.203..3637.711 rows=5385 loops=3)
                          Group Key: a.city
                          Batches: 1  Memory Usage: 2705kB
                          Worker 0:  Batches: 1  Memory Usage: 2449kB
                          Worker 1:  Batches: 1  Memory Usage: 2449kB
                          ->  Nested Loop  (cost=578.43..11795.55 rows=8333 width=19) (actual time=16.320..3603.941 rows=6667 loops=3)
                                ->  Hash Join  (cost=578.00..6705.67 rows=8333 width=10) (actual time=12.678..211.149 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.008..130.205 rows=133333 loops=3)
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=12.341..12.659 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.696..8.183 rows=20000 loops=3)
                                ->  Index Scan using "Address_pkey" on "Address" a  (cost=0.43..0.61 rows=1 width=17) (actual time=0.508..0.508 rows=1 loops=20000)
                                      Index Cond: (id = o.shipping_address_id)
Planning Time: 22.151 ms
Execution Time: 3967.894 ms


==================================================
EXPLAIN ANALYZE — Query 29: Porównanie Wolumenu Sprzedaży Produktów Promowanych vs. Niepromowanych (w Ostatnich 30 Dniach)
==================================================
Finalize GroupAggregate  (cost=6359.60..6415.40 rows=200 width=40) (actual time=1053.620..1199.300 rows=2 loops=1)
  Group Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
  ->  Gather Merge  (cost=6359.60..6411.40 rows=400 width=40) (actual time=1045.493..1195.763 rows=6 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=5359.58..5365.21 rows=200 width=40) (actual time=625.533..626.976 rows=2 loops=3)
              Group Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
              ->  Sort  (cost=5359.58..5360.79 rows=484 width=32) (actual time=612.755..614.718 rows=393 loops=3)
                    Sort Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
                    Sort Method: quicksort  Memory: 25kB
                    Worker 0:  Sort Method: quicksort  Memory: 25kB
                    Worker 1:  Sort Method: quicksort  Memory: 25kB
                    ->  Nested Loop  (cost=1015.19..5337.99 rows=484 width=32) (actual time=20.198..575.266 rows=393 loops=3)
                          ->  Nested Loop  (cost=1014.90..5185.96 rows=484 width=4) (actual time=19.068..499.275 rows=393 loops=3)
                                ->  Hash Join  (cost=1014.48..4585.22 rows=484 width=4) (actual time=16.819..43.261 rows=393 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Bitmap Heap Scan on "Order" o  (cost=436.48..3941.88 rows=9680 width=4) (actual time=8.101..31.704 rows=7846 loops=3)
                                            Recheck Cond: (order_date >= (now() - '30 days'::interval))
                                            Heap Blocks: exact=1723
                                            ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..430.67 rows=23232 width=0) (actual time=14.965..14.966 rows=23538 loops=1)
                                                  Index Cond: (order_date >= (now() - '30 days'::interval))
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=8) (actual time=7.245..7.249 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=8) (actual time=0.448..2.720 rows=20000 loops=3)
                                ->  Index Scan using "StockItem_pkey" on "StockItem" si  (cost=0.42..1.24 rows=1 width=8) (actual time=1.158..1.158 rows=1 loops=1180)
                                      Index Cond: (id = oi.stock_item_id)
                          ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.31 rows=1 width=8) (actual time=0.190..0.190 rows=1 loops=1180)
                                Index Cond: (id = si.variant_id)
Planning Time: 36.077 ms
Execution Time: 1203.565 ms


==================================================
EXPLAIN ANALYZE — Query 30: Wskaźnik Lojalności (Repeat Purchase Rate) Użytkowników z Podziałem na Miasto Adresu Rozliczeniowego
==================================================
Sort  (cost=68134.41..68209.82 rows=30162 width=61) (actual time=5204.024..5228.981 rows=66456 loops=1)
  Sort Key: (round((((count(*) FILTER (WHERE (u.orders_count > 1)))::numeric * 100.0) / (NULLIF(count(*), 0))::numeric), 2)) DESC
  Sort Method: external merge  Disk: 3192kB
  ->  Finalize HashAggregate  (cost=65136.24..65890.29 rows=30162 width=61) (actual time=5053.364..5116.889 rows=66456 loops=1)
        Group Key: a.city
        Batches: 5  Memory Usage: 8241kB  Disk Usage: 712kB
        ->  Gather  (cost=58349.79..64683.81 rows=60324 width=29) (actual time=4645.973..4758.429 rows=121979 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial HashAggregate  (cost=57349.79..57651.41 rows=30162 width=29) (actual time=4442.528..4456.427 rows=40660 loops=3)
                    Group Key: a.city
                    Batches: 1  Memory Usage: 5393kB
                    Worker 0:  Batches: 1  Memory Usage: 5137kB
                    Worker 1:  Batches: 1  Memory Usage: 5137kB
                    ->  Parallel Hash Join  (cost=34825.67..55683.12 rows=166667 width=21) (actual time=1368.726..3880.865 rows=133333 loops=3)
                          Hash Cond: (a.id = o.billing_address_id)
                          ->  Parallel Seq Scan on "Address" a  (cost=0.00..18288.00 rows=500000 width=17) (actual time=7.164..1570.665 rows=400000 loops=3)
                          ->  Parallel Hash  (cost=32742.34..32742.34 rows=166667 width=12) (actual time=1358.545..1360.569 rows=133333 loops=3)
                                Buckets: 524288  Batches: 1  Memory Usage: 22912kB
                                ->  Hash Join  (cost=24598.16..32742.34 rows=166667 width=12) (actual time=677.006..1082.948 rows=133333 loops=3)
                                      Hash Cond: (o.user_id = u.user_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.426..141.960 rows=133333 loops=3)
                                      ->  Hash  (cost=19615.94..19615.94 rows=286577 width=12) (actual time=551.457..553.016 rows=329619 loops=3)
                                            Buckets: 262144  Batches: 4  Memory Usage: 5596kB
                                            ->  Subquery Scan on u  (cost=0.42..19615.94 rows=286577 width=12) (actual time=10.994..404.571 rows=329619 loops=3)
                                                  ->  GroupAggregate  (cost=0.42..16750.17 rows=286577 width=12) (actual time=10.993..358.358 rows=329619 loops=3)
                                                        Group Key: "Order".user_id
                                                        ->  Index Only Scan using idx_order_user_id on "Order"  (cost=0.42..11884.40 rows=400000 width=4) (actual time=10.260..232.282 rows=400000 loops=3)
                                                              Heap Fetches: 150240
Planning Time: 19.245 ms
Execution Time: 5313.600 ms

FINISHED — 2025-11-22 17:01:00.416043
========================================================================================================================
========================================================================================================================
START EXPLAIN RUN — 2025-11-22 17:13:38.192002
========================================================================================================================


==================================================
EXPLAIN ANALYZE — Query 1: Średnia Wartość Zamówienia (AOV) w Ostatnim Miesiącu
==================================================
Aggregate  (cost=4939.64..4939.65 rows=1 width=32) (actual time=862.942..862.944 rows=1 loops=1)
  ->  HashAggregate  (cost=4909.24..4924.44 rows=1216 width=36) (actual time=862.419..862.845 rows=1213 loops=1)
        Group Key: o.id
        Batches: 1  Memory Usage: 577kB
        ->  Hash Join  (cost=4522.66..4903.16 rows=1216 width=10) (actual time=829.466..859.604 rows=1241 loops=1)
              Hash Cond: (oi.order_id = o.id)
              ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.582..13.336 rows=20000 loops=1)
              ->  Hash  (cost=4218.61..4218.61 rows=24324 width=4) (actual time=828.178..828.179 rows=24622 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1122kB
                    ->  Bitmap Heap Scan on "Order" o  (cost=456.94..4218.61 rows=24324 width=4) (actual time=32.676..820.182 rows=24622 loops=1)
                          Recheck Cond: (order_date >= (now() - '1 mon'::interval))
                          Heap Blocks: exact=3333
                          ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..450.86 rows=24324 width=0) (actual time=32.279..32.279 rows=24622 loops=1)
                                Index Cond: (order_date >= (now() - '1 mon'::interval))
Planning Time: 39.699 ms
Execution Time: 863.817 ms


==================================================
EXPLAIN ANALYZE — Query 2: Średnia wartość zamówienia per użytkownik
==================================================
Sort  (cost=16066.87..16115.61 rows=19495 width=50) (actual time=4961.825..5031.753 rows=19296 loops=1)
  Sort Key: (round(avg(order_totals.total_price), 2)) DESC
  Sort Method: quicksort  Memory: 1612kB
  ->  Finalize HashAggregate  (cost=14385.35..14677.77 rows=19495 width=50) (actual time=4926.081..5011.744 rows=19296 loops=1)
        Group Key: u.id
        Batches: 5  Memory Usage: 8241kB  Disk Usage: 224kB
        ->  Gather  (cost=12537.36..14263.50 rows=16246 width=50) (actual time=4794.781..4921.565 rows=19425 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial HashAggregate  (cost=11537.36..11638.90 rows=8123 width=50) (actual time=4343.477..4350.826 rows=6475 loops=3)
                    Group Key: u.id
                    Batches: 1  Memory Usage: 3217kB
                    Worker 0:  Batches: 1  Memory Usage: 2961kB
                    Worker 1:  Batches: 1  Memory Usage: 2961kB
                    ->  Nested Loop  (cost=1110.75..11496.75 rows=8123 width=50) (actual time=179.143..4282.509 rows=6498 loops=3)
                          ->  Hash Join  (cost=1110.33..6550.49 rows=8123 width=36) (actual time=118.861..372.730 rows=6498 loops=3)
                                Hash Cond: (o.id = order_totals.order_id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.016..128.701 rows=133333 loops=3)
                                ->  Hash  (cost=866.64..866.64 rows=19495 width=36) (actual time=112.926..114.299 rows=19495 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1094kB
                                      ->  Subquery Scan on order_totals  (cost=428.00..866.64 rows=19495 width=36) (actual time=96.610..106.974 rows=19495 loops=3)
                                            ->  HashAggregate  (cost=428.00..671.69 rows=19495 width=36) (actual time=96.125..104.308 rows=19495 loops=3)
                                                  Group Key: oi.order_id
                                                  Batches: 1  Memory Usage: 7953kB
                                                  Worker 0:  Batches: 1  Memory Usage: 7953kB
                                                  Worker 1:  Batches: 1  Memory Usage: 7953kB
                                                  ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=6.921..29.520 rows=20000 loops=3)
                          ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.594..0.594 rows=1 loops=19495)
                                Index Cond: (id = o.user_id)
Planning Time: 26.482 ms
Execution Time: 5073.759 ms


==================================================
EXPLAIN ANALYZE — Query 3: Top 10 Najlepiej Sprzedających Się Produktów (wg. Ilości Sprzedanych Jednostek) w Ostatnim Kwartale
==================================================
Limit  (cost=11753.90..11753.93 rows=10 width=46) (actual time=1633.327..1849.461 rows=10 loops=1)
  ->  Sort  (cost=11753.90..11765.35 rows=4579 width=46) (actual time=1633.322..1848.867 rows=10 loops=1)
        Sort Key: (count(*)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=11609.16..11654.95 rows=4579 width=46) (actual time=1630.282..1846.759 rows=3927 loops=1)
              Group Key: p.name, m.name
              Batches: 1  Memory Usage: 721kB
              ->  Gather  (cost=11179.86..11580.54 rows=3816 width=46) (actual time=1557.516..1842.756 rows=4336 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=10179.86..10198.94 rows=1908 width=46) (actual time=1479.700..1481.043 rows=1445 loops=3)
                          Group Key: p.name, m.name
                          Batches: 1  Memory Usage: 369kB
                          Worker 0:  Batches: 1  Memory Usage: 369kB
                          Worker 1:  Batches: 1  Memory Usage: 369kB
                          ->  Hash Join  (cost=2302.59..10165.55 rows=1908 width=38) (actual time=32.580..1467.101 rows=1521 loops=3)
                                Hash Cond: (p.manufacturer_id = m.id)
                                ->  Nested Loop  (cost=2297.22..10155.02 rows=1908 width=17) (actual time=31.331..1463.483 rows=1521 loops=3)
                                      ->  Nested Loop  (cost=2296.93..9525.18 rows=1908 width=4) (actual time=29.794..1369.323 rows=1521 loops=3)
                                            ->  Nested Loop  (cost=2296.64..8925.83 rows=1908 width=4) (actual time=28.704..1259.192 rows=1521 loops=3)
                                                  ->  Hash Join  (cost=2296.22..6557.62 rows=1908 width=4) (actual time=22.435..158.683 rows=1521 loops=3)
                                                        Hash Cond: (o.id = oi.order_id)
                                                        ->  Parallel Bitmap Heap Scan on "Order" o  (cost=1718.22..5722.03 rows=38161 width=4) (actual time=12.683..130.948 rows=30429 loops=3)
                                                              Recheck Cond: (order_date >= (now() - '3 mons'::interval))
                                                              Heap Blocks: exact=1181
                                                              ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..1695.32 rows=91586 width=0) (actual time=37.480..37.480 rows=91287 loops=1)
                                                                    Index Cond: (order_date >= (now() - '3 mons'::interval))
                                                        ->  Hash  (cost=328.00..328.00 rows=20000 width=8) (actual time=6.656..6.657 rows=20000 loops=3)
                                                              Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                                                              ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=8) (actual time=0.407..2.653 rows=20000 loops=3)
                                                  ->  Index Scan using "StockItem_pkey" on "StockItem" si  (cost=0.42..1.24 rows=1 width=8) (actual time=0.722..0.722 rows=1 loops=4563)
                                                        Index Cond: (id = oi.stock_item_id)
                                            ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.31 rows=1 width=8) (actual time=0.071..0.071 rows=1 loops=4563)
                                                  Index Cond: (id = si.variant_id)
                                      ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=21) (actual time=0.060..0.060 rows=1 loops=4563)
                                            Index Cond: (id = v.product_id)
                                ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.821..0.821 rows=150 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 18kB
                                      ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.035..0.053 rows=150 loops=3)
Planning Time: 96.254 ms
Execution Time: 1862.050 ms


==================================================
EXPLAIN ANALYZE — Query 4: Top 5 produktów z najwięcej recenzjami
==================================================
Limit  (cost=1792.59..1792.61 rows=5 width=25) (actual time=142.168..143.180 rows=5 loops=1)
  ->  Sort  (cost=1792.59..1842.59 rows=20000 width=25) (actual time=141.114..141.118 rows=5 loops=1)
        Sort Key: (COALESCE(r.count, '0'::bigint)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Hash Left Join  (cost=969.89..1460.40 rows=20000 width=25) (actual time=130.195..137.301 rows=20000 loops=1)
              Hash Cond: (p.id = r.product_id)
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.011..1.493 rows=20000 loops=1)
              ->  Hash  (cost=812.24..812.24 rows=12612 width=12) (actual time=130.172..130.173 rows=12612 loops=1)
                    Buckets: 16384  Batches: 1  Memory Usage: 670kB
                    ->  Subquery Scan on r  (cost=560.00..812.24 rows=12612 width=12) (actual time=123.286..127.006 rows=12612 loops=1)
                          ->  HashAggregate  (cost=560.00..686.12 rows=12612 width=12) (actual time=123.285..125.830 rows=12612 loops=1)
                                Group Key: "Review".product_id
                                Batches: 1  Memory Usage: 1425kB
                                ->  Seq Scan on "Review"  (cost=0.00..460.00 rows=20000 width=4) (actual time=1.908..116.292 rows=20000 loops=1)
Planning Time: 16.822 ms
Execution Time: 145.559 ms


==================================================
EXPLAIN ANALYZE — Query 5: Całkowity Przychód Pogrupowany Miesięcznie za Ostatni Rok
==================================================
Finalize GroupAggregate  (cost=9719.19..11975.47 rows=17309 width=36) (actual time=181.047..287.308 rows=11 loops=1)
  Group Key: ((date_trunc('month'::text, o.order_date))::date)
  ->  Gather Merge  (cost=9719.19..11564.38 rows=14424 width=36) (actual time=180.570..286.297 rows=33 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=8719.17..8899.47 rows=7212 width=36) (actual time=84.427..85.790 rows=11 loops=3)
              Group Key: ((date_trunc('month'::text, o.order_date))::date)
              ->  Sort  (cost=8719.17..8737.20 rows=7212 width=10) (actual time=82.835..83.387 rows=5760 loops=3)
                    Sort Key: ((date_trunc('month'::text, o.order_date))::date) DESC
                    Sort Method: quicksort  Memory: 864kB
                    Worker 0:  Sort Method: quicksort  Memory: 45kB
                    Worker 1:  Sort Method: quicksort  Memory: 89kB
                    ->  Hash Join  (cost=578.00..8257.02 rows=7212 width=10) (actual time=6.837..77.722 rows=5760 loops=3)
                          Hash Cond: (o.id = oi.order_id)
                          ->  Parallel Seq Scan on "Order" o  (cost=0.00..6669.33 rows=144241 width=12) (actual time=0.014..51.575 rows=115772 loops=3)
                                Filter: (order_date >= (date_trunc('year'::text, now()) - '00:00:00'::interval))
                                Rows Removed by Filter: 17562
                          ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=6.536..6.537 rows=20000 loops=3)
                                Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.027..2.651 rows=20000 loops=3)
Planning Time: 3.781 ms
Execution Time: 294.774 ms


==================================================
EXPLAIN ANALYZE — Query 6: Produkty najczęściej dodawane do ulubionych
==================================================
Limit  (cost=14382.58..14382.60 rows=10 width=25) (actual time=1070.334..1220.649 rows=10 loops=1)
  ->  Sort  (cost=14382.58..14432.58 rows=20000 width=25) (actual time=1070.327..1219.245 rows=10 loops=1)
        Sort Key: (count(f.id)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=13750.38..13950.38 rows=20000 width=25) (actual time=1058.698..1210.862 rows=20000 loops=1)
              Group Key: p.id
              Batches: 1  Memory Usage: 2577kB
              ->  Gather  (cost=9350.38..13550.38 rows=40000 width=25) (actual time=924.664..1133.487 rows=59996 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=8350.38..8550.38 rows=20000 width=25) (actual time=838.245..844.732 rows=19999 loops=3)
                          Group Key: p.id
                          Batches: 1  Memory Usage: 2577kB
                          Worker 0:  Batches: 1  Memory Usage: 2577kB
                          Worker 1:  Batches: 1  Memory Usage: 2577kB
                          ->  Hash Join  (cost=688.00..7100.38 rows=250000 width=21) (actual time=13.867..744.719 rows=200000 loops=3)
                                Hash Cond: (f.product_id = p.id)
                                ->  Parallel Seq Scan on "FavoriteProduct" f  (cost=0.00..5756.00 rows=250000 width=8) (actual time=5.835..646.143 rows=200000 loops=3)
                                ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=7.668..8.113 rows=20000 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1215kB
                                      ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.299..3.348 rows=20000 loops=3)
Planning Time: 39.580 ms
Execution Time: 1225.386 ms


==================================================
EXPLAIN ANALYZE — Query 7: Dostępny Stan Magazynowy Wariantów Produktu Pogrupowany po Magazynach
==================================================
GroupAggregate  (cost=37640.01..42664.89 rows=223328 width=61) (actual time=1381.697..1682.704 rows=178012 loops=1)
  Group Key: p.name, w.name, v.sku
  ->  Sort  (cost=37640.01..38198.33 rows=223328 width=57) (actual time=1381.669..1590.120 rows=223971 loops=1)
        Sort Key: p.name, w.name, v.sku
        Sort Method: external merge  Disk: 15248kB
        ->  Hash Join  (cost=2189.15..9398.65 rows=223328 width=57) (actual time=29.323..589.759 rows=223971 loops=1)
              Hash Cond: (si.warehouse_id = w.id)
              ->  Hash Join  (cost=2144.50..8766.15 rows=223328 width=44) (actual time=29.304..548.134 rows=223971 loops=1)
                    Hash Cond: (v.product_id = p.id)
                    ->  Hash Join  (cost=1456.50..7491.79 rows=223328 width=35) (actual time=22.497..459.094 rows=223971 loops=1)
                          Hash Cond: (si.variant_id = v.id)
                          ->  Seq Scan on "StockItem" si  (cost=0.00..5449.00 rows=223328 width=12) (actual time=0.015..332.023 rows=223971 loops=1)
                                Filter: (shipment_id IS NULL)
                                Rows Removed by Filter: 96029
                          ->  Hash  (cost=869.00..869.00 rows=47000 width=31) (actual time=22.460..23.523 rows=47000 loops=1)
                                Buckets: 65536  Batches: 1  Memory Usage: 3450kB
                                ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=31) (actual time=0.006..8.209 rows=47000 loops=1)
                    ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=6.797..6.798 rows=20000 loops=1)
                          Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                          ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.005..2.372 rows=20000 loops=1)
              ->  Hash  (cost=25.40..25.40 rows=1540 width=21) (actual time=0.014..0.015 rows=10 loops=1)
                    Buckets: 2048  Batches: 1  Memory Usage: 17kB
                    ->  Seq Scan on "Warehouse" w  (cost=0.00..25.40 rows=1540 width=21) (actual time=0.009..0.010 rows=10 loops=1)
Planning Time: 16.907 ms
Execution Time: 1703.200 ms


==================================================
EXPLAIN ANALYZE — Query 8: Stan magazynowy per produkt
==================================================
Sort  (cost=11494.90..11544.43 rows=19812 width=21) (actual time=300.622..302.234 rows=17916 loops=1)
  Sort Key: (count(si.id)) DESC
  Sort Method: quicksort  Memory: 1482kB
  ->  HashAggregate  (cost=9882.79..10080.91 rows=19812 width=21) (actual time=293.280..297.075 rows=17916 loops=1)
        Group Key: p.name
        Batches: 1  Memory Usage: 2065kB
        ->  Hash Join  (cost=2144.50..8766.15 rows=223328 width=17) (actual time=20.502..214.867 rows=223971 loops=1)
              Hash Cond: (v.product_id = p.id)
              ->  Hash Join  (cost=1456.50..7491.79 rows=223328 width=8) (actual time=12.636..138.627 rows=223971 loops=1)
                    Hash Cond: (si.variant_id = v.id)
                    ->  Seq Scan on "StockItem" si  (cost=0.00..5449.00 rows=223328 width=8) (actual time=0.018..39.149 rows=223971 loops=1)
                          Filter: (shipment_id IS NULL)
                          Rows Removed by Filter: 96029
                    ->  Hash  (cost=869.00..869.00 rows=47000 width=8) (actual time=12.596..12.598 rows=47000 loops=1)
                          Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                          ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=8) (actual time=0.005..5.225 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=7.853..7.853 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.019..3.503 rows=20000 loops=1)
Planning Time: 15.274 ms
Execution Time: 303.877 ms


==================================================
EXPLAIN ANALYZE — Query 9: Najpopularniejsze Kategorie (wg. Całkowitego Przychodu)
==================================================
Limit  (cost=12371.00..12371.02 rows=10 width=44) (actual time=1136.437..1286.393 rows=10 loops=1)
  ->  Sort  (cost=12371.00..12371.37 rows=150 width=44) (actual time=1135.629..1284.473 rows=10 loops=1)
        Sort Key: (sum(oi.unit_price)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize GroupAggregate  (cost=12328.63..12367.76 rows=150 width=44) (actual time=1134.453..1283.435 rows=150 loops=1)
              Group Key: c.name
              ->  Gather Merge  (cost=12328.63..12363.63 rows=300 width=44) (actual time=1126.445..1275.325 rows=150 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Sort  (cost=11328.61..11328.98 rows=150 width=44) (actual time=200.315..201.933 rows=50 loops=3)
                          Sort Key: c.name
                          Sort Method: quicksort  Memory: 39kB
                          Worker 0:  Sort Method: quicksort  Memory: 25kB
                          Worker 1:  Sort Method: quicksort  Memory: 25kB
                          ->  Partial HashAggregate  (cost=11321.31..11323.19 rows=150 width=44) (actual time=191.898..193.370 rows=50 loops=3)
                                Group Key: c.name
                                Batches: 1  Memory Usage: 96kB
                                Worker 0:  Batches: 1  Memory Usage: 40kB
                                Worker 1:  Batches: 1  Memory Usage: 40kB
                                ->  Hash Join  (cost=8362.48..11112.98 rows=41667 width=18) (actual time=68.941..179.443 rows=33334 loops=3)
                                      Hash Cond: (pc.category_id = c.id)
                                      ->  Parallel Hash Join  (cost=8357.10..10995.13 rows=41667 width=10) (actual time=54.089..157.853 rows=33334 loops=3)
                                            Hash Cond: (pc.product_id = p.id)
                                            ->  Parallel Index Only Scan using uq_prodcat_product_category on "ProductCategory" pc  (cost=0.29..2236.96 rows=41667 width=8) (actual time=8.499..284.567 rows=100000 loops=1)
                                                  Heap Fetches: 0
                                            ->  Parallel Hash  (cost=8209.75..8209.75 rows=11765 width=14) (actual time=47.699..48.248 rows=6667 loops=3)
                                                  Buckets: 32768  Batches: 1  Memory Usage: 1216kB
                                                  ->  Hash Join  (cost=2722.50..8209.75 rows=11765 width=14) (actual time=23.041..114.745 rows=20000 loops=1)
                                                        Hash Cond: (v.product_id = p.id)
                                                        ->  Hash Join  (cost=2034.50..7490.85 rows=11765 width=10) (actual time=18.055..101.656 rows=20000 loops=1)
                                                              Hash Cond: (si.variant_id = v.id)
                                                              ->  Hash Join  (cost=578.00..6003.47 rows=11765 width=10) (actual time=5.509..80.188 rows=20000 loops=1)
                                                                    Hash Cond: (si.id = oi.stock_item_id)
                                                                    ->  Parallel Seq Scan on "StockItem" si  (cost=0.00..4131.35 rows=188235 width=8) (actual time=0.005..23.547 rows=320000 loops=1)
                                                                    ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=5.485..6.111 rows=20000 loops=1)
                                                                          Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                                                          ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.010..2.335 rows=20000 loops=1)
                                                              ->  Hash  (cost=869.00..869.00 rows=47000 width=8) (actual time=12.526..12.527 rows=47000 loops=1)
                                                                    Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                                                    ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=8) (actual time=0.011..5.205 rows=47000 loops=1)
                                                        ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=4.973..4.973 rows=20000 loops=1)
                                                              Buckets: 32768  Batches: 1  Memory Usage: 960kB
                                                              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.037..2.148 rows=20000 loops=1)
                                      ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=13.653..13.654 rows=150 loops=3)
                                            Buckets: 1024  Batches: 1  Memory Usage: 16kB
                                            ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=11.706..11.729 rows=150 loops=3)
Planning Time: 22.199 ms
Execution Time: 1312.041 ms


==================================================
EXPLAIN ANALYZE — Query 10: Liczba produktów per kategoria
==================================================
Sort  (cost=2342.22..2342.59 rows=150 width=20) (actual time=225.946..225.956 rows=150 loops=1)
  Sort Key: (count(pc.product_id)) DESC
  Sort Method: quicksort  Memory: 30kB
  ->  HashAggregate  (cost=2335.30..2336.80 rows=150 width=20) (actual time=225.854..225.882 rows=150 loops=1)
        Group Key: c.name
        Batches: 1  Memory Usage: 48kB
        ->  Hash Right Join  (cost=5.38..1835.30 rows=100000 width=16) (actual time=1.927..204.810 rows=100000 loops=1)
              Hash Cond: (pc.category_id = c.id)
              ->  Seq Scan on "ProductCategory" pc  (cost=0.00..1560.00 rows=100000 width=8) (actual time=1.226..181.784 rows=100000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=0.070..0.071 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 16kB
                    ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=0.022..0.043 rows=150 loops=1)
Planning Time: 0.785 ms
Execution Time: 226.628 ms


==================================================
EXPLAIN ANALYZE — Query 11: Liczba zamówień per metoda płatności
==================================================
Sort  (cost=7808.47..7808.49 rows=6 width=50) (actual time=136.286..204.311 rows=6 loops=1)
  Sort Key: (sum(oi.unit_price)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  Finalize GroupAggregate  (cost=7806.80..7808.40 rows=6 width=50) (actual time=134.866..202.902 rows=6 loops=1)
        Group Key: pm.name
        ->  Gather Merge  (cost=7806.80..7808.20 rows=12 width=50) (actual time=134.851..202.880 rows=18 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Sort  (cost=6806.78..6806.79 rows=6 width=50) (actual time=61.789..61.793 rows=6 loops=3)
                    Sort Key: pm.name
                    Sort Method: quicksort  Memory: 25kB
                    Worker 0:  Sort Method: quicksort  Memory: 25kB
                    Worker 1:  Sort Method: quicksort  Memory: 25kB
                    ->  Partial HashAggregate  (cost=6806.62..6806.70 rows=6 width=50) (actual time=58.119..58.124 rows=6 loops=3)
                          Group Key: pm.name
                          Batches: 1  Memory Usage: 24kB
                          Worker 0:  Batches: 1  Memory Usage: 24kB
                          Worker 1:  Batches: 1  Memory Usage: 24kB
                          ->  Hash Join  (cost=579.13..6744.13 rows=8333 width=20) (actual time=14.015..56.142 rows=6667 loops=3)
                                Hash Cond: (o.payment_method_id = pm.id)
                                ->  Hash Join  (cost=578.00..6705.67 rows=8333 width=14) (actual time=13.188..53.979 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.003..16.225 rows=133333 loops=3)
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=12.918..12.918 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.014..5.742 rows=20000 loops=3)
                                ->  Hash  (cost=1.06..1.06 rows=6 width=14) (actual time=0.198..0.199 rows=6 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                      ->  Seq Scan on "PaymentMethod" pm  (cost=0.00..1.06 rows=6 width=14) (actual time=0.026..0.028 rows=6 loops=3)
Planning Time: 12.651 ms
Execution Time: 206.288 ms


==================================================
EXPLAIN ANALYZE — Query 12: Średnia ocena per producent
==================================================
Sort  (cost=1367.54..1367.91 rows=150 width=57) (actual time=36.318..36.329 rows=150 loops=1)
  Sort Key: (round(avg(r.rating), 2)) DESC NULLS LAST
  Sort Method: quicksort  Memory: 32kB
  ->  HashAggregate  (cost=1359.87..1362.12 rows=150 width=57) (actual time=34.802..34.872 rows=150 loops=1)
        Group Key: m.name
        Batches: 1  Memory Usage: 64kB
        ->  Hash Join  (cost=693.38..1259.87 rows=20000 width=29) (actual time=8.471..26.987 rows=27388 loops=1)
              Hash Cond: (p.manufacturer_id = m.id)
              ->  Hash Right Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=6.462..19.606 rows=27388 loops=1)
                    Hash Cond: (r.product_id = p.id)
                    ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=0.012..3.428 rows=20000 loops=1)
                    ->  Hash  (cost=438.00..438.00 rows=20000 width=8) (actual time=6.435..6.436 rows=20000 loops=1)
                          Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                          ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=8) (actual time=0.006..2.335 rows=20000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=1.286..1.287 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 18kB
                    ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=1.243..1.259 rows=150 loops=1)
Planning Time: 28.757 ms
Execution Time: 37.659 ms


==================================================
EXPLAIN ANALYZE — Query 13: Aktywne promocje i objęta nimi liczba wariantów
==================================================
Sort  (cost=395.64..395.76 rows=47 width=14) (actual time=5.023..5.026 rows=46 loops=1)
  Sort Key: (count(v.id)) DESC
  Sort Method: quicksort  Memory: 26kB
  ->  HashAggregate  (cost=393.87..394.34 rows=47 width=14) (actual time=5.001..5.009 rows=46 loops=1)
        Group Key: pr.name
        Batches: 1  Memory Usage: 24kB
        ->  Merge Join  (cost=7.63..337.47 rows=11280 width=10) (actual time=0.066..4.689 rows=1340 loops=1)
              Merge Cond: (v.promotion_id = pr.id)
              ->  Index Scan using idx_variant_promotion on "Variant" v  (cost=0.29..2469.28 rows=47000 width=8) (actual time=0.013..3.823 rows=5685 loops=1)
              ->  Sort  (cost=7.34..7.46 rows=48 width=10) (actual time=0.048..0.053 rows=47 loops=1)
                    Sort Key: pr.id
                    Sort Method: quicksort  Memory: 26kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=48 width=10) (actual time=0.014..0.038 rows=47 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 153
Planning Time: 13.783 ms
Execution Time: 5.106 ms


==================================================
EXPLAIN ANALYZE — Query 14: Najczęściej wybierane warianty w koszykach
==================================================
Limit  (cost=224158.84..224158.87 rows=10 width=44) (actual time=8545.682..8545.690 rows=10 loops=1)
  ->  Sort  (cost=224158.84..227908.84 rows=1500000 width=44) (actual time=8545.037..8545.039 rows=10 loops=1)
        Sort Key: (sum(ci.quantity)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  GroupAggregate  (cost=4.24..191744.38 rows=1500000 width=44) (actual time=111.359..8534.694 rows=47000 loops=1)
              Group Key: v.sku, p.name
              ->  Incremental Sort  (cost=4.24..165494.38 rows=1500000 width=40) (actual time=51.198..8235.298 rows=1500000 loops=1)
                    Sort Key: v.sku, p.name
                    Presorted Key: v.sku
                    Full-sort Groups: 31708  Sort Method: quicksort  Average Memory: 27kB  Peak Memory: 27kB
                    Pre-sorted Groups: 6442  Sort Method: quicksort  Average Memory: 26kB  Peak Memory: 26kB
                    ->  Nested Loop  (cost=1.14..108333.20 rows=1500000 width=40) (actual time=7.200..7748.930 rows=1500000 loops=1)
                          ->  Nested Loop  (cost=0.71..8804.70 rows=47000 width=40) (actual time=5.360..184.815 rows=47000 loops=1)
                                ->  Index Scan using "Variant_sku_key" on "Variant" v  (cost=0.41..2051.42 rows=47000 width=31) (actual time=4.687..38.230 rows=47000 loops=1)
                                ->  Memoize  (cost=0.30..0.34 rows=1 width=17) (actual time=0.003..0.003 rows=1 loops=47000)
                                      Cache Key: v.product_id
                                      Cache Mode: logical
                                      Hits: 28889  Misses: 18111  Evictions: 0  Overflows: 0  Memory Usage: 2099kB
                                      ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=17) (actual time=0.003..0.003 rows=1 loops=18111)
                                            Index Cond: (id = v.product_id)
                          ->  Index Scan using idx_cartitem_variant_id on "CartItem" ci  (cost=0.43..1.80 rows=32 width=8) (actual time=0.008..0.156 rows=32 loops=47000)
                                Index Cond: (variant_id = v.id)
Planning Time: 16.324 ms
Execution Time: 8547.286 ms


==================================================
EXPLAIN ANALYZE — Query 15: Produkty z Największą Różnicą Między Ceną Podstawową a Ceną Wariantu
==================================================
Limit  (cost=2813.55..2813.58 rows=10 width=80) (actual time=48.612..48.616 rows=10 loops=1)
  ->  Sort  (cost=2813.55..2931.05 rows=47000 width=80) (actual time=48.610..48.613 rows=10 loops=1)
        Sort Key: v.price_modifier DESC
        Sort Method: top-N heapsort  Memory: 27kB
        ->  Hash Join  (cost=688.00..1797.90 rows=47000 width=80) (actual time=7.829..34.305 rows=47000 loops=1)
              Hash Cond: (v.product_id = p.id)
              ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=33) (actual time=1.483..4.862 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=6.327..6.328 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1381kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.009..2.663 rows=20000 loops=1)
Planning Time: 25.590 ms
Execution Time: 50.999 ms


==================================================
EXPLAIN ANALYZE — Query 16: Konwersja zamówień wg statusu
==================================================
Sort  (cost=7957.56..7962.66 rows=2040 width=48) (actual time=702.610..790.976 rows=7 loops=1)
  Sort Key: (count(o.id)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  WindowAgg  (cost=7824.99..7845.41 rows=2040 width=48) (actual time=697.853..785.215 rows=7 loops=1)
        ->  Finalize HashAggregate  (cost=7779.11..7799.51 rows=2040 width=16) (actual time=689.835..777.205 rows=7 loops=1)
              Group Key: s.name
              Batches: 1  Memory Usage: 121kB
              ->  Gather  (cost=7330.31..7758.71 rows=4080 width=16) (actual time=258.047..773.620 rows=7 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=6330.31..6350.71 rows=2040 width=16) (actual time=71.184..71.197 rows=2 loops=3)
                          Group Key: s.name
                          Batches: 1  Memory Usage: 121kB
                          Worker 0:  Batches: 1  Memory Usage: 121kB
                          Worker 1:  Batches: 1  Memory Usage: 121kB
                          ->  Hash Join  (cost=55.90..5496.98 rows=166667 width=12) (actual time=3.480..42.098 rows=133333 loops=3)
                                Hash Cond: (o.status_id = s.id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=1.893..11.581 rows=133333 loops=3)
                                ->  Hash  (cost=30.40..30.40 rows=2040 width=12) (actual time=1.865..1.880 rows=7 loops=1)
                                      Buckets: 2048  Batches: 1  Memory Usage: 17kB
                                      ->  Seq Scan on "Status" s  (cost=0.00..30.40 rows=2040 width=12) (actual time=0.762..0.765 rows=7 loops=1)
Planning Time: 75.663 ms
Execution Time: 812.592 ms


==================================================
EXPLAIN ANALYZE — Query 17: Top klienci wg wydatków
==================================================
Limit  (cost=15399.41..15399.44 rows=10 width=50) (actual time=3967.911..3972.734 rows=10 loops=1)
  ->  Sort  (cost=15399.41..15449.41 rows=20000 width=50) (actual time=3967.910..3972.731 rows=10 loops=1)
        Sort Key: (sum(oi.unit_price)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=14717.22..14967.22 rows=20000 width=50) (actual time=3951.657..3965.520 rows=19296 loops=1)
              Group Key: u.id
              Batches: 5  Memory Usage: 8241kB  Disk Usage: 224kB
              ->  Gather  (cost=12821.46..14592.22 rows=16666 width=50) (actual time=3418.907..3594.201 rows=19431 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=11821.46..11925.62 rows=8333 width=50) (actual time=3318.723..3401.523 rows=6477 loops=3)
                          Group Key: u.id
                          Batches: 1  Memory Usage: 3217kB
                          Worker 0:  Batches: 1  Memory Usage: 2961kB
                          Worker 1:  Batches: 1  Memory Usage: 2961kB
                          ->  Nested Loop  (cost=578.42..11779.80 rows=8333 width=24) (actual time=9.147..3267.573 rows=6667 loops=3)
                                ->  Hash Join  (cost=578.00..6705.67 rows=8333 width=10) (actual time=6.673..273.268 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.008..196.013 rows=133333 loops=3)
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=6.394..7.044 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.028..2.375 rows=20000 loops=3)
                                ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.447..0.447 rows=1 loops=20000)
                                      Index Cond: (id = o.user_id)
Planning Time: 25.606 ms
Execution Time: 3989.569 ms


==================================================
EXPLAIN ANALYZE — Query 18: Produkty z wariantami objętymi promocją, z końcową ceną
==================================================
Sort  (cost=1983.52..2011.72 rows=11280 width=132) (actual time=45.121..46.215 rows=1340 loops=1)
  Sort Key: (round(((p.price + v.price_modifier) * ('1'::numeric - pr.discount_percentage)), 2))
  Sort Method: quicksort  Memory: 146kB
  ->  Hash Join  (cost=695.63..1224.29 rows=11280 width=132) (actual time=23.712..42.645 rows=1340 loops=1)
        Hash Cond: (v.product_id = p.id)
        ->  Merge Join  (cost=7.63..337.47 rows=11280 width=39) (actual time=2.892..20.271 rows=1340 loops=1)
              Merge Cond: (v.promotion_id = pr.id)
              ->  Index Scan using idx_variant_promotion on "Variant" v  (cost=0.29..2469.28 rows=47000 width=37) (actual time=0.019..16.529 rows=5685 loops=1)
              ->  Sort  (cost=7.34..7.46 rows=48 width=10) (actual time=2.868..2.878 rows=47 loops=1)
                    Sort Key: pr.id
                    Sort Method: quicksort  Memory: 26kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=48 width=10) (actual time=2.268..2.292 rows=47 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 153
        ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=19.483..19.484 rows=20000 loops=1)
              Buckets: 32768  Batches: 1  Memory Usage: 1381kB
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.008..14.099 rows=20000 loops=1)
Planning Time: 53.675 ms
Execution Time: 61.031 ms


==================================================
EXPLAIN ANALYZE — Query 19: Użytkownicy, Którzy Dodali Produkt do Koszyka, Ale Nie Złożyli Zamówienia (Potencjał Odbudowy Koszyka)
==================================================
Hash Join  (cost=45873.97..103632.31 rows=1070130 width=55) (actual time=3209.456..9863.097 rows=1005006 loops=1)
  Hash Cond: (v.product_id = p.id)
  ->  Hash Join  (cost=45185.97..100134.62 rows=1070130 width=46) (actual time=3199.872..9258.740 rows=1005006 loops=1)
        Hash Cond: (ci.variant_id = v.id)
        ->  Hash Join  (cost=43729.47..95868.77 rows=1070130 width=46) (actual time=3184.329..8465.611 rows=1005006 loops=1)
              Hash Cond: (ci.cart_id = c.id)
              ->  Seq Scan on "CartItem" ci  (cost=0.00..23152.00 rows=1500000 width=8) (actual time=0.035..4076.583 rows=1500000 loops=1)
              ->  Hash  (cost=41450.81..41450.81 rows=107013 width=46) (actual time=3173.218..3191.719 rows=100414 loops=1)
                    Buckets: 131072  Batches: 2  Memory Usage: 4929kB
                    ->  Gather  (cost=25017.67..41450.81 rows=107013 width=46) (actual time=2816.522..2892.605 rows=100414 loops=1)
                          Workers Planned: 2
                          Workers Launched: 2
                          ->  Parallel Hash Right Anti Join  (cost=24017.67..29749.51 rows=44589 width=46) (actual time=2295.597..2311.822 rows=33471 loops=3)
                                Hash Cond: (o.user_id = u.id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=4) (actual time=14.828..466.630 rows=133333 loops=3)
                                ->  Parallel Hash  (cost=23236.42..23236.42 rows=62500 width=50) (actual time=1664.047..1664.567 rows=50000 loops=3)
                                      Buckets: 262144  Batches: 1  Memory Usage: 14720kB
                                      ->  Hash Join  (cost=4079.00..23236.42 rows=62500 width=50) (actual time=164.967..1469.483 rows=50000 loops=3)
                                            Hash Cond: (u.id = c.user_id)
                                            ->  Parallel Seq Scan on "User" u  (cost=0.00..18063.67 rows=416667 width=46) (actual time=5.840..1064.780 rows=333333 loops=3)
                                            ->  Hash  (cost=2204.00..2204.00 rows=150000 width=8) (actual time=140.447..140.452 rows=150000 loops=3)
                                                  Buckets: 262144  Batches: 1  Memory Usage: 7908kB
                                                  ->  Seq Scan on "Cart" c  (cost=0.00..2204.00 rows=150000 width=8) (actual time=24.671..76.296 rows=150000 loops=3)
        ->  Hash  (cost=869.00..869.00 rows=47000 width=8) (actual time=13.280..13.281 rows=47000 loops=1)
              Buckets: 65536  Batches: 1  Memory Usage: 2348kB
              ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=8) (actual time=0.015..5.159 rows=47000 loops=1)
  ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=7.383..7.384 rows=20000 loops=1)
        Buckets: 32768  Batches: 1  Memory Usage: 1245kB
        ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=1.773..4.129 rows=20000 loops=1)
Planning Time: 138.303 ms
Execution Time: 9971.295 ms


==================================================
EXPLAIN ANALYZE — Query 20: Wyszukiwanie produktów po nazwie lub opisie (parametryzowane)
==================================================
Bitmap Heap Scan on "Product"  (cost=43.00..57.51 rows=4 width=60) (actual time=6.687..37.154 rows=143 loops=1)
  Recheck Cond: (((name)::text ~~* '%test%'::text) OR (description ~~* '%test%'::text))
  Heap Blocks: exact=106
  ->  BitmapOr  (cost=43.00..43.00 rows=4 width=0) (actual time=6.661..6.662 rows=0 loops=1)
        ->  Bitmap Index Scan on idx_product_name_trgm  (cost=0.00..21.50 rows=2 width=0) (actual time=2.285..2.285 rows=42 loops=1)
              Index Cond: ((name)::text ~~* '%test%'::text)
        ->  Bitmap Index Scan on idx_product_description_trgm  (cost=0.00..21.50 rows=2 width=0) (actual time=4.371..4.371 rows=102 loops=1)
              Index Cond: (description ~~* '%test%'::text)
Planning Time: 70.539 ms
Execution Time: 39.963 ms


==================================================
EXPLAIN ANALYZE — Query 21: Użytkownicy, Którzy Zapisali Konkretny Produkt jako Ulubiony (np. Product ID=350259)
==================================================
Nested Loop  (cost=0.85..262.23 rows=30 width=56) (actual time=4.095..22.221 rows=26 loops=1)
  ->  Index Only Scan using idx_favoriteproduct_product_user on "FavoriteProduct" fp  (cost=0.42..8.95 rows=30 width=4) (actual time=3.628..3.642 rows=26 loops=1)
        Index Cond: (product_id = 35)
        Heap Fetches: 0
  ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..8.44 rows=1 width=60) (actual time=0.713..0.713 rows=1 loops=26)
        Index Cond: (id = fp.user_id)
Planning Time: 16.092 ms
Execution Time: 22.275 ms


==================================================
EXPLAIN ANALYZE — Query 22: Znajdź Magazyny, Które Posiadają Zapasy Konkretnego Wariantu (np. SKU='VR-000000-a637d44b7afd')
==================================================
GroupAggregate  (cost=24.91..25.01 rows=2 width=25) (actual time=3.542..3.544 rows=0 loops=1)
  Group Key: w.name
  Filter: (count(si.id) > 0)
  ->  Sort  (cost=24.91..24.93 rows=5 width=21) (actual time=3.540..3.541 rows=0 loops=1)
        Sort Key: w.name
        Sort Method: quicksort  Memory: 25kB
        ->  Nested Loop  (cost=0.99..24.86 rows=5 width=21) (actual time=2.469..2.470 rows=0 loops=1)
              ->  Nested Loop  (cost=0.84..24.00 rows=5 width=8) (actual time=2.468..2.469 rows=0 loops=1)
                    ->  Index Scan using "Variant_sku_key" on "Variant" v  (cost=0.41..8.43 rows=1 width=4) (actual time=2.467..2.468 rows=0 loops=1)
                          Index Cond: ((sku)::text = 'VR-000001-2704de10f283'::text)
                    ->  Index Scan using idx_stockitem_shipment_variant_warehouse on "StockItem" si  (cost=0.42..15.52 rows=5 width=12) (never executed)
                          Index Cond: ((shipment_id IS NULL) AND (variant_id = v.id))
              ->  Index Scan using "Warehouse_pkey" on "Warehouse" w  (cost=0.15..0.17 rows=1 width=21) (never executed)
                    Index Cond: (id = si.warehouse_id)
Planning Time: 12.980 ms
Execution Time: 5.263 ms


==================================================
EXPLAIN ANALYZE — Query 23: Warianty, Które Wymagają Uzyskania Konkretnej Opcji (np. 'Kolor'='Czerwony')
==================================================
Nested Loop  (cost=6.96..680.20 rows=1 width=36) (actual time=0.026..0.027 rows=0 loops=1)
  ->  Nested Loop  (cost=6.67..679.87 rows=1 width=27) (actual time=0.025..0.026 rows=0 loops=1)
        ->  Nested Loop  (cost=6.38..679.55 rows=1 width=4) (actual time=0.025..0.026 rows=0 loops=1)
              Join Filter: (opt.attribute_id = a.id)
              ->  Index Scan using "Attribute_name_key" on "Attribute" a  (cost=0.15..8.17 rows=1 width=4) (actual time=0.025..0.025 rows=0 loops=1)
                    Index Cond: ((name)::text = 'Attr_49_Century'::text)
              ->  Nested Loop  (cost=6.23..668.26 rows=250 width=8) (never executed)
                    ->  Seq Scan on "Option" opt  (cost=0.00..18.50 rows=1 width=8) (never executed)
                          Filter: ((value)::text = 'do'::text)
                    ->  Bitmap Heap Scan on "VariantOption" vo  (cost=6.23..647.26 rows=250 width=8) (never executed)
                          Recheck Cond: (option_id = opt.id)
                          ->  Bitmap Index Scan on idx_variantoption_option_id  (cost=0.00..6.17 rows=250 width=0) (never executed)
                                Index Cond: (option_id = opt.id)
        ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.32 rows=1 width=31) (never executed)
              Index Cond: (id = vo.variant_id)
  ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=17) (never executed)
        Index Cond: (id = v.product_id)
Planning Time: 40.259 ms
Execution Time: 0.074 ms


==================================================
EXPLAIN ANALYZE — Query 24: Znajdź Zamówienia Użytkownika (np. email='debbie.lane.16786.50af0753@example.com') o Statusie 'Paid'
==================================================
Nested Loop  (cost=1.00..17.09 rows=1 width=20) (actual time=3.045..3.046 rows=0 loops=1)
  ->  Nested Loop  (cost=0.85..16.89 rows=1 width=16) (actual time=3.044..3.045 rows=0 loops=1)
        ->  Index Scan using "User_email_key" on "User" u  (cost=0.42..8.44 rows=1 width=4) (actual time=3.044..3.044 rows=0 loops=1)
              Index Cond: ((email)::text = 'debbie.lane.16786.50af0753@example.com'::text)
        ->  Index Scan using idx_order_user_id on "Order" o  (cost=0.42..8.44 rows=1 width=20) (never executed)
              Index Cond: (user_id = u.id)
  ->  Index Scan using "Status_pkey" on "Status" s  (cost=0.15..0.17 rows=1 width=12) (never executed)
        Index Cond: (id = o.status_id)
        Filter: ((name)::text = 'Paid'::text)
Planning Time: 7.991 ms
Execution Time: 3.087 ms


==================================================
EXPLAIN ANALYZE — Query 25: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
Nested Loop Left Join  (cost=5.45..49.87 rows=16 width=87) (actual time=1.957..4.591 rows=18 loops=1)
  ->  Nested Loop Left Join  (cost=5.30..46.34 rows=16 width=45) (actual time=1.929..4.534 rows=18 loops=1)
        ->  Nested Loop Left Join  (cost=5.02..41.66 rows=16 width=39) (actual time=0.741..3.274 rows=18 loops=1)
              ->  Nested Loop  (cost=4.60..23.91 rows=3 width=39) (actual time=0.038..0.061 rows=4 loops=1)
                    ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..8.30 rows=1 width=10) (actual time=0.008..0.009 rows=1 loops=1)
                          Index Cond: (id = 35)
                    ->  Bitmap Heap Scan on "Variant" v  (cost=4.31..15.57 rows=3 width=37) (actual time=0.026..0.047 rows=4 loops=1)
                          Recheck Cond: (product_id = 35)
                          Heap Blocks: exact=4
                          ->  Bitmap Index Scan on idx_variant_product_id  (cost=0.00..4.31 rows=3 width=0) (actual time=0.006..0.006 rows=4 loops=1)
                                Index Cond: (product_id = 35)
              ->  Index Only Scan using uq_varopt_variant_option on "VariantOption" vo  (cost=0.42..5.86 rows=6 width=8) (actual time=0.800..0.801 rows=4 loops=4)
                    Index Cond: (variant_id = v.id)
                    Heap Fetches: 0
        ->  Index Scan using "Option_pkey" on "Option" opt  (cost=0.28..0.29 rows=1 width=14) (actual time=0.069..0.069 rows=1 loops=18)
              Index Cond: (id = vo.option_id)
  ->  Index Scan using "Attribute_pkey" on "Attribute" a  (cost=0.15..0.22 rows=1 width=18) (actual time=0.001..0.001 rows=1 loops=18)
        Index Cond: (id = opt.attribute_id)
Planning Time: 0.612 ms
Execution Time: 4.644 ms


==================================================
EXPLAIN ANALYZE — Query 26: Lista Wszystkich Dziecięcych Kategorii (Podkategorii) dla Konkretnej Kategorii Nadrzędnej (np. ID=5)
==================================================
Seq Scan on "Category"  (cost=0.00..3.88 rows=3 width=12) (actual time=0.643..0.655 rows=3 loops=1)
  Filter: (parent_id = 5)
  Rows Removed by Filter: 147
Planning Time: 1.316 ms
Execution Time: 0.674 ms


==================================================
EXPLAIN ANALYZE — Query 27: Porównanie Średniej Oceny dla Promowanych i Niepromowanych Produktów
==================================================
HashAggregate  (cost=87850.51..87853.01 rows=200 width=64) (actual time=128.987..128.991 rows=2 loops=1)
  Group Key: CASE WHEN (ANY (p.id = (hashed SubPlan 2).col1)) THEN 'Promowany'::text ELSE 'Niepromowany'::text END
  Batches: 1  Memory Usage: 40kB
  ->  HashAggregate  (cost=1300.51..87550.51 rows=20000 width=68) (actual time=119.288..126.050 rows=12612 loops=1)
        Group Key: p.id
        Batches: 1  Memory Usage: 2577kB
        ->  Hash Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=58.361..104.377 rows=20000 loops=1)
              Hash Cond: (r.product_id = p.id)
              ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=1.404..39.100 rows=20000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=54.940..54.941 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 960kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.018..50.381 rows=20000 loops=1)
        SubPlan 2
          ->  Index Only Scan using idx_variant_product_promotion on "Variant" v2  (cost=0.28..158.09 rows=5739 width=4) (actual time=2.447..5.169 rows=5684 loops=1)
                Heap Fetches: 0
Planning Time: 3.702 ms
Execution Time: 131.533 ms


==================================================
EXPLAIN ANALYZE — Query 28: Top 5 Miast Generujących Największy Przychód (Wg. Adresu Wysyłki)
==================================================
Limit  (cost=15315.16..15315.17 rows=5 width=45) (actual time=4184.485..4221.801 rows=5 loops=1)
  ->  Sort  (cost=15315.16..15365.16 rows=20000 width=45) (actual time=4184.477..4221.788 rows=5 loops=1)
        Sort Key: (sum(oi.unit_price)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=14732.97..14982.97 rows=20000 width=45) (actual time=4175.354..4218.098 rows=12950 loops=1)
              Group Key: a.city
              Batches: 1  Memory Usage: 5905kB
              ->  Gather  (cost=12837.21..14607.97 rows=16666 width=45) (actual time=4004.279..4071.541 rows=16089 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=11837.21..11941.37 rows=8333 width=45) (actual time=3963.961..3980.534 rows=5363 loops=3)
                          Group Key: a.city
                          Batches: 1  Memory Usage: 2449kB
                          Worker 0:  Batches: 1  Memory Usage: 2449kB
                          Worker 1:  Batches: 1  Memory Usage: 2449kB
                          ->  Nested Loop  (cost=578.43..11795.55 rows=8333 width=19) (actual time=37.734..3892.903 rows=6667 loops=3)
                                ->  Hash Join  (cost=578.00..6705.67 rows=8333 width=10) (actual time=34.607..290.764 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.190..159.268 rows=133333 loops=3)
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=33.087..33.326 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.366..28.506 rows=20000 loops=3)
                                ->  Index Scan using "Address_pkey" on "Address" a  (cost=0.43..0.61 rows=1 width=17) (actual time=0.536..0.536 rows=1 loops=20000)
                                      Index Cond: (id = o.shipping_address_id)
Planning Time: 21.536 ms
Execution Time: 4229.472 ms


==================================================
EXPLAIN ANALYZE — Query 29: Porównanie Wolumenu Sprzedaży Produktów Promowanych vs. Niepromowanych (w Ostatnich 30 Dniach)
==================================================
Finalize GroupAggregate  (cost=6359.42..6415.22 rows=200 width=40) (actual time=787.665..951.232 rows=2 loops=1)
  Group Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
  ->  Gather Merge  (cost=6359.42..6411.22 rows=400 width=40) (actual time=779.575..946.870 rows=6 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=5359.40..5365.03 rows=200 width=40) (actual time=602.708..604.169 rows=2 loops=3)
              Group Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
              ->  Sort  (cost=5359.40..5360.61 rows=484 width=32) (actual time=598.806..599.050 rows=393 loops=3)
                    Sort Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
                    Sort Method: quicksort  Memory: 25kB
                    Worker 0:  Sort Method: quicksort  Memory: 25kB
                    Worker 1:  Sort Method: quicksort  Memory: 25kB
                    ->  Nested Loop  (cost=1015.11..5337.82 rows=484 width=32) (actual time=20.862..575.000 rows=393 loops=3)
                          ->  Nested Loop  (cost=1014.82..5185.78 rows=484 width=4) (actual time=19.347..507.868 rows=393 loops=3)
                                ->  Hash Join  (cost=1014.40..4585.04 rows=484 width=4) (actual time=11.853..36.321 rows=393 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Bitmap Heap Scan on "Order" o  (cost=436.40..3941.73 rows=9676 width=4) (actual time=4.842..26.211 rows=7842 loops=3)
                                            Recheck Cond: (order_date >= (now() - '30 days'::interval))
                                            Heap Blocks: exact=1329
                                            ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..430.59 rows=23222 width=0) (actual time=10.334..10.334 rows=23526 loops=1)
                                                  Index Cond: (order_date >= (now() - '30 days'::interval))
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=8) (actual time=6.235..6.238 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=8) (actual time=0.041..2.342 rows=20000 loops=3)
                                ->  Index Scan using "StockItem_pkey" on "StockItem" si  (cost=0.42..1.24 rows=1 width=8) (actual time=1.198..1.198 rows=1 loops=1179)
                                      Index Cond: (id = oi.stock_item_id)
                          ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.31 rows=1 width=8) (actual time=0.168..0.168 rows=1 loops=1179)
                                Index Cond: (id = si.variant_id)
Planning Time: 32.971 ms
Execution Time: 960.327 ms


==================================================
EXPLAIN ANALYZE — Query 30: Wskaźnik Lojalności (Repeat Purchase Rate) Użytkowników z Podziałem na Miasto Adresu Rozliczeniowego
==================================================
Sort  (cost=68134.41..68209.82 rows=30162 width=61) (actual time=6329.610..6350.510 rows=66456 loops=1)
  Sort Key: (round((((count(*) FILTER (WHERE (u.orders_count > 1)))::numeric * 100.0) / (NULLIF(count(*), 0))::numeric), 2)) DESC
  Sort Method: external merge  Disk: 3192kB
  ->  Finalize HashAggregate  (cost=65136.24..65890.29 rows=30162 width=61) (actual time=6155.245..6222.808 rows=66456 loops=1)
        Group Key: a.city
        Batches: 5  Memory Usage: 8241kB  Disk Usage: 712kB
        ->  Gather  (cost=58349.79..64683.81 rows=60324 width=29) (actual time=5665.199..5756.011 rows=121598 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial HashAggregate  (cost=57349.79..57651.41 rows=30162 width=29) (actual time=3467.911..3482.478 rows=40533 loops=3)
                    Group Key: a.city
                    Batches: 1  Memory Usage: 5649kB
                    Worker 0:  Batches: 1  Memory Usage: 4881kB
                    Worker 1:  Batches: 1  Memory Usage: 4881kB
                    ->  Parallel Hash Join  (cost=34825.67..55683.12 rows=166667 width=21) (actual time=544.493..2824.718 rows=133333 loops=3)
                          Hash Cond: (a.id = o.billing_address_id)
                          ->  Parallel Seq Scan on "Address" a  (cost=0.00..18288.00 rows=500000 width=17) (actual time=11.871..1470.352 rows=400000 loops=3)
                          ->  Parallel Hash  (cost=32742.34..32742.34 rows=166667 width=12) (actual time=524.996..526.196 rows=133333 loops=3)
                                Buckets: 524288  Batches: 1  Memory Usage: 22880kB
                                ->  Hash Join  (cost=24598.16..32742.34 rows=166667 width=12) (actual time=508.765..1278.800 rows=400000 loops=1)
                                      Hash Cond: (o.user_id = u.user_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=4.692..144.083 rows=400000 loops=1)
                                      ->  Hash  (cost=19615.94..19615.94 rows=286577 width=12) (actual time=500.363..500.987 rows=329619 loops=1)
                                            Buckets: 262144  Batches: 4  Memory Usage: 5596kB
                                            ->  Subquery Scan on u  (cost=0.42..19615.94 rows=286577 width=12) (actual time=12.358..409.349 rows=329619 loops=1)
                                                  ->  GroupAggregate  (cost=0.42..16750.17 rows=286577 width=12) (actual time=11.482..376.937 rows=329619 loops=1)
                                                        Group Key: "Order".user_id
                                                        ->  Index Only Scan using idx_order_user_id on "Order"  (cost=0.42..11884.40 rows=400000 width=4) (actual time=6.103..283.449 rows=400000 loops=1)
                                                              Heap Fetches: 50080
Planning Time: 14.338 ms
Execution Time: 6418.556 ms

FINISHED — 2025-11-22 17:14:31.617240
========================================================================================================================
========================================================================================================================
START EXPLAIN RUN — 2025-11-22 17:21:30.233418
========================================================================================================================


==================================================
EXPLAIN ANALYZE — Query 1: Średnia Wartość Zamówienia (AOV) w Ostatnim Miesiącu
==================================================
Aggregate  (cost=4939.45..4939.46 rows=1 width=32) (actual time=882.244..882.246 rows=1 loops=1)
  ->  HashAggregate  (cost=4909.05..4924.25 rows=1216 width=36) (actual time=881.730..882.139 rows=1213 loops=1)
        Group Key: o.id
        Batches: 1  Memory Usage: 577kB
        ->  Hash Join  (cost=4522.47..4902.97 rows=1216 width=10) (actual time=855.881..880.435 rows=1241 loops=1)
              Hash Cond: (oi.order_id = o.id)
              ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.016..10.833 rows=20000 loops=1)
              ->  Hash  (cost=4218.48..4218.48 rows=24319 width=4) (actual time=855.763..855.764 rows=24619 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1122kB
                    ->  Bitmap Heap Scan on "Order" o  (cost=456.90..4218.48 rows=24319 width=4) (actual time=34.484..848.472 rows=24619 loops=1)
                          Recheck Cond: (order_date >= (now() - '1 mon'::interval))
                          Heap Blocks: exact=3333
                          ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..450.82 rows=24319 width=0) (actual time=33.168..33.168 rows=24619 loops=1)
                                Index Cond: (order_date >= (now() - '1 mon'::interval))
Planning Time: 34.518 ms
Execution Time: 883.098 ms


==================================================
EXPLAIN ANALYZE — Query 2: Średnia wartość zamówienia per użytkownik
==================================================
Sort  (cost=16066.87..16115.61 rows=19495 width=50) (actual time=4459.751..4541.709 rows=19296 loops=1)
  Sort Key: (round(avg(order_totals.total_price), 2)) DESC
  Sort Method: quicksort  Memory: 1612kB
  ->  Finalize HashAggregate  (cost=14385.35..14677.77 rows=19495 width=50) (actual time=4372.502..4505.762 rows=19296 loops=1)
        Group Key: u.id
        Batches: 5  Memory Usage: 8241kB  Disk Usage: 216kB
        ->  Gather  (cost=12537.36..14263.50 rows=16246 width=50) (actual time=4187.192..4341.439 rows=19423 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial HashAggregate  (cost=11537.36..11638.90 rows=8123 width=50) (actual time=4171.025..4177.888 rows=6474 loops=3)
                    Group Key: u.id
                    Batches: 1  Memory Usage: 3217kB
                    Worker 0:  Batches: 1  Memory Usage: 2961kB
                    Worker 1:  Batches: 1  Memory Usage: 2961kB
                    ->  Nested Loop  (cost=1110.75..11496.75 rows=8123 width=50) (actual time=162.676..4109.263 rows=6498 loops=3)
                          ->  Hash Join  (cost=1110.33..6550.49 rows=8123 width=36) (actual time=109.637..232.048 rows=6498 loops=3)
                                Hash Cond: (o.id = order_totals.order_id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.006..41.364 rows=133333 loops=3)
                                ->  Hash  (cost=866.64..866.64 rows=19495 width=36) (actual time=107.803..110.364 rows=19495 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1094kB
                                      ->  Subquery Scan on order_totals  (cost=428.00..866.64 rows=19495 width=36) (actual time=89.283..101.018 rows=19495 loops=3)
                                            ->  HashAggregate  (cost=428.00..671.69 rows=19495 width=36) (actual time=89.281..99.157 rows=19495 loops=3)
                                                  Group Key: oi.order_id
                                                  Batches: 1  Memory Usage: 7953kB
                                                  Worker 0:  Batches: 1  Memory Usage: 7953kB
                                                  Worker 1:  Batches: 1  Memory Usage: 7953kB
                                                  ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=2.645..25.951 rows=20000 loops=3)
                          ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.589..0.589 rows=1 loops=19495)
                                Index Cond: (id = o.user_id)
Planning Time: 15.943 ms
Execution Time: 4581.869 ms


==================================================
EXPLAIN ANALYZE — Query 3: Top 10 Najlepiej Sprzedających Się Produktów (wg. Ilości Sprzedanych Jednostek) w Ostatnim Kwartale
==================================================
Limit  (cost=11753.79..11753.82 rows=10 width=46) (actual time=1671.534..1732.131 rows=10 loops=1)
  ->  Sort  (cost=11753.79..11765.24 rows=4579 width=46) (actual time=1671.533..1732.126 rows=10 loops=1)
        Sort Key: (count(*)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=11609.05..11654.84 rows=4579 width=46) (actual time=1668.593..1730.145 rows=3926 loops=1)
              Group Key: p.name, m.name
              Batches: 1  Memory Usage: 721kB
              ->  Gather  (cost=11179.75..11580.43 rows=3816 width=46) (actual time=1630.684..1724.655 rows=4328 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=10179.75..10198.83 rows=1908 width=46) (actual time=1390.218..1391.281 rows=1443 loops=3)
                          Group Key: p.name, m.name
                          Batches: 1  Memory Usage: 369kB
                          Worker 0:  Batches: 1  Memory Usage: 369kB
                          Worker 1:  Batches: 1  Memory Usage: 369kB
                          ->  Hash Join  (cost=2302.55..10165.44 rows=1908 width=38) (actual time=130.915..1368.714 rows=1521 loops=3)
                                Hash Cond: (p.manufacturer_id = m.id)
                                ->  Nested Loop  (cost=2297.17..10154.91 rows=1908 width=17) (actual time=128.986..1364.536 rows=1521 loops=3)
                                      ->  Nested Loop  (cost=2296.89..9525.07 rows=1908 width=4) (actual time=94.997..1230.305 rows=1521 loops=3)
                                            ->  Nested Loop  (cost=2296.60..8925.72 rows=1908 width=4) (actual time=80.714..1116.516 rows=1521 loops=3)
                                                  ->  Hash Join  (cost=2296.17..6557.51 rows=1908 width=4) (actual time=40.534..92.692 rows=1521 loops=3)
                                                        Hash Cond: (o.id = oi.order_id)
                                                        ->  Parallel Bitmap Heap Scan on "Order" o  (cost=1718.17..5721.94 rows=38158 width=4) (actual time=28.771..66.649 rows=30427 loops=3)
                                                              Recheck Cond: (order_date >= (now() - '3 mons'::interval))
                                                              Heap Blocks: exact=1157
                                                              ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..1695.28 rows=91580 width=0) (actual time=67.018..67.018 rows=91282 loops=1)
                                                                    Index Cond: (order_date >= (now() - '3 mons'::interval))
                                                        ->  Hash  (cost=328.00..328.00 rows=20000 width=8) (actual time=6.873..6.874 rows=20000 loops=3)
                                                              Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                                                              ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=8) (actual time=0.585..2.961 rows=20000 loops=3)
                                                  ->  Index Scan using "StockItem_pkey" on "StockItem" si  (cost=0.42..1.24 rows=1 width=8) (actual time=0.666..0.666 rows=1 loops=4562)
                                                        Index Cond: (id = oi.stock_item_id)
                                            ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.31 rows=1 width=8) (actual time=0.070..0.070 rows=1 loops=4562)
                                                  Index Cond: (id = si.variant_id)
                                      ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=21) (actual time=0.083..0.083 rows=1 loops=4562)
                                            Index Cond: (id = v.product_id)
                                ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.730..0.730 rows=150 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 18kB
                                      ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.041..0.058 rows=150 loops=3)
Planning Time: 91.305 ms
Execution Time: 1744.863 ms


==================================================
EXPLAIN ANALYZE — Query 4: Top 5 produktów z najwięcej recenzjami
==================================================
Limit  (cost=1792.59..1792.61 rows=5 width=25) (actual time=62.224..62.228 rows=5 loops=1)
  ->  Sort  (cost=1792.59..1842.59 rows=20000 width=25) (actual time=62.223..62.226 rows=5 loops=1)
        Sort Key: (COALESCE(r.count, '0'::bigint)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Hash Left Join  (cost=969.89..1460.40 rows=20000 width=25) (actual time=50.778..57.849 rows=20000 loops=1)
              Hash Cond: (p.id = r.product_id)
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.013..1.475 rows=20000 loops=1)
              ->  Hash  (cost=812.24..812.24 rows=12612 width=12) (actual time=50.753..50.754 rows=12612 loops=1)
                    Buckets: 16384  Batches: 1  Memory Usage: 670kB
                    ->  Subquery Scan on r  (cost=560.00..812.24 rows=12612 width=12) (actual time=43.321..46.921 rows=12612 loops=1)
                          ->  HashAggregate  (cost=560.00..686.12 rows=12612 width=12) (actual time=43.320..45.740 rows=12612 loops=1)
                                Group Key: "Review".product_id
                                Batches: 1  Memory Usage: 1425kB
                                ->  Seq Scan on "Review"  (cost=0.00..460.00 rows=20000 width=4) (actual time=1.328..36.816 rows=20000 loops=1)
Planning Time: 17.952 ms
Execution Time: 63.350 ms


==================================================
EXPLAIN ANALYZE — Query 5: Całkowity Przychód Pogrupowany Miesięcznie za Ostatni Rok
==================================================
Finalize GroupAggregate  (cost=9719.19..11975.47 rows=17309 width=36) (actual time=140.162..211.224 rows=11 loops=1)
  Group Key: ((date_trunc('month'::text, o.order_date))::date)
  ->  Gather Merge  (cost=9719.19..11564.38 rows=14424 width=36) (actual time=139.904..211.194 rows=33 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=8719.17..8899.47 rows=7212 width=36) (actual time=99.018..100.366 rows=11 loops=3)
              Group Key: ((date_trunc('month'::text, o.order_date))::date)
              ->  Sort  (cost=8719.17..8737.20 rows=7212 width=10) (actual time=98.111..98.634 rows=5760 loops=3)
                    Sort Key: ((date_trunc('month'::text, o.order_date))::date) DESC
                    Sort Method: quicksort  Memory: 425kB
                    Worker 0:  Sort Method: quicksort  Memory: 400kB
                    Worker 1:  Sort Method: quicksort  Memory: 196kB
                    ->  Hash Join  (cost=578.00..8257.02 rows=7212 width=10) (actual time=8.402..96.065 rows=5760 loops=3)
                          Hash Cond: (o.id = oi.order_id)
                          ->  Parallel Seq Scan on "Order" o  (cost=0.00..6669.33 rows=144241 width=12) (actual time=0.015..64.089 rows=115772 loops=3)
                                Filter: (order_date >= (date_trunc('year'::text, now()) - '00:00:00'::interval))
                                Rows Removed by Filter: 17562
                          ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=8.043..8.044 rows=20000 loops=3)
                                Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.020..2.397 rows=20000 loops=3)
Planning Time: 3.985 ms
Execution Time: 215.565 ms


==================================================
EXPLAIN ANALYZE — Query 6: Produkty najczęściej dodawane do ulubionych
==================================================
Limit  (cost=14382.58..14382.60 rows=10 width=25) (actual time=619.408..715.815 rows=10 loops=1)
  ->  Sort  (cost=14382.58..14432.58 rows=20000 width=25) (actual time=618.617..715.020 rows=10 loops=1)
        Sort Key: (count(f.id)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=13750.38..13950.38 rows=20000 width=25) (actual time=610.458..711.195 rows=20000 loops=1)
              Group Key: p.id
              Batches: 1  Memory Usage: 2577kB
              ->  Gather  (cost=9350.38..13550.38 rows=40000 width=25) (actual time=485.231..644.022 rows=59997 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=8350.38..8550.38 rows=20000 width=25) (actual time=445.938..451.604 rows=19999 loops=3)
                          Group Key: p.id
                          Batches: 1  Memory Usage: 2577kB
                          Worker 0:  Batches: 1  Memory Usage: 2577kB
                          Worker 1:  Batches: 1  Memory Usage: 2577kB
                          ->  Hash Join  (cost=688.00..7100.38 rows=250000 width=21) (actual time=9.151..360.263 rows=200000 loops=3)
                                Hash Cond: (f.product_id = p.id)
                                ->  Parallel Seq Scan on "FavoriteProduct" f  (cost=0.00..5756.00 rows=250000 width=8) (actual time=0.476..269.260 rows=200000 loops=3)
                                ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=8.495..9.139 rows=20000 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1215kB
                                      ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.400..3.701 rows=20000 loops=3)
Planning Time: 24.563 ms
Execution Time: 719.376 ms


==================================================
EXPLAIN ANALYZE — Query 7: Dostępny Stan Magazynowy Wariantów Produktu Pogrupowany po Magazynach
==================================================
GroupAggregate  (cost=37640.01..42664.89 rows=223328 width=61) (actual time=1351.326..1712.324 rows=178012 loops=1)
  Group Key: p.name, w.name, v.sku
  ->  Sort  (cost=37640.01..38198.33 rows=223328 width=57) (actual time=1346.957..1611.020 rows=223971 loops=1)
        Sort Key: p.name, w.name, v.sku
        Sort Method: external merge  Disk: 15248kB
        ->  Hash Join  (cost=2189.15..9398.65 rows=223328 width=57) (actual time=29.093..575.755 rows=223971 loops=1)
              Hash Cond: (si.warehouse_id = w.id)
              ->  Hash Join  (cost=2144.50..8766.15 rows=223328 width=44) (actual time=29.071..533.744 rows=223971 loops=1)
                    Hash Cond: (v.product_id = p.id)
                    ->  Hash Join  (cost=1456.50..7491.79 rows=223328 width=35) (actual time=23.134..442.641 rows=223971 loops=1)
                          Hash Cond: (si.variant_id = v.id)
                          ->  Seq Scan on "StockItem" si  (cost=0.00..5449.00 rows=223328 width=12) (actual time=0.015..312.567 rows=223971 loops=1)
                                Filter: (shipment_id IS NULL)
                                Rows Removed by Filter: 96029
                          ->  Hash  (cost=869.00..869.00 rows=47000 width=31) (actual time=23.097..23.990 rows=47000 loops=1)
                                Buckets: 65536  Batches: 1  Memory Usage: 3450kB
                                ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=31) (actual time=0.006..6.726 rows=47000 loops=1)
                    ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=5.927..5.928 rows=20000 loops=1)
                          Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                          ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.005..2.386 rows=20000 loops=1)
              ->  Hash  (cost=25.40..25.40 rows=1540 width=21) (actual time=0.016..0.016 rows=10 loops=1)
                    Buckets: 2048  Batches: 1  Memory Usage: 17kB
                    ->  Seq Scan on "Warehouse" w  (cost=0.00..25.40 rows=1540 width=21) (actual time=0.010..0.012 rows=10 loops=1)
Planning Time: 10.973 ms
Execution Time: 1723.478 ms


==================================================
EXPLAIN ANALYZE — Query 8: Stan magazynowy per produkt
==================================================
Sort  (cost=11494.90..11544.43 rows=19812 width=21) (actual time=305.029..307.749 rows=17916 loops=1)
  Sort Key: (count(si.id)) DESC
  Sort Method: quicksort  Memory: 1482kB
  ->  HashAggregate  (cost=9882.79..10080.91 rows=19812 width=21) (actual time=298.215..302.159 rows=17916 loops=1)
        Group Key: p.name
        Batches: 1  Memory Usage: 2065kB
        ->  Hash Join  (cost=2144.50..8766.15 rows=223328 width=17) (actual time=18.962..216.724 rows=223971 loops=1)
              Hash Cond: (v.product_id = p.id)
              ->  Hash Join  (cost=1456.50..7491.79 rows=223328 width=8) (actual time=12.423..139.278 rows=223971 loops=1)
                    Hash Cond: (si.variant_id = v.id)
                    ->  Seq Scan on "StockItem" si  (cost=0.00..5449.00 rows=223328 width=8) (actual time=0.013..38.019 rows=223971 loops=1)
                          Filter: (shipment_id IS NULL)
                          Rows Removed by Filter: 96029
                    ->  Hash  (cost=869.00..869.00 rows=47000 width=8) (actual time=12.389..12.390 rows=47000 loops=1)
                          Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                          ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=8) (actual time=0.006..5.085 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=6.527..6.529 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.833..3.188 rows=20000 loops=1)
Planning Time: 16.561 ms
Execution Time: 309.426 ms


==================================================
EXPLAIN ANALYZE — Query 9: Najpopularniejsze Kategorie (wg. Całkowitego Przychodu)
==================================================
Limit  (cost=12371.00..12371.02 rows=10 width=44) (actual time=600.122..830.019 rows=10 loops=1)
  ->  Sort  (cost=12371.00..12371.37 rows=150 width=44) (actual time=599.187..828.281 rows=10 loops=1)
        Sort Key: (sum(oi.unit_price)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize GroupAggregate  (cost=12328.63..12367.76 rows=150 width=44) (actual time=598.760..828.228 rows=150 loops=1)
              Group Key: c.name
              ->  Gather Merge  (cost=12328.63..12363.63 rows=300 width=44) (actual time=592.564..821.681 rows=450 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Sort  (cost=11328.61..11328.98 rows=150 width=44) (actual time=324.352..326.994 rows=150 loops=3)
                          Sort Key: c.name
                          Sort Method: quicksort  Memory: 39kB
                          Worker 0:  Sort Method: quicksort  Memory: 39kB
                          Worker 1:  Sort Method: quicksort  Memory: 39kB
                          ->  Partial HashAggregate  (cost=11321.31..11323.19 rows=150 width=44) (actual time=299.043..301.174 rows=150 loops=3)
                                Group Key: c.name
                                Batches: 1  Memory Usage: 96kB
                                Worker 0:  Batches: 1  Memory Usage: 96kB
                                Worker 1:  Batches: 1  Memory Usage: 96kB
                                ->  Hash Join  (cost=8362.48..11112.98 rows=41667 width=18) (actual time=102.292..281.544 rows=33334 loops=3)
                                      Hash Cond: (pc.category_id = c.id)
                                      ->  Parallel Hash Join  (cost=8357.10..10995.13 rows=41667 width=10) (actual time=92.159..264.653 rows=33334 loops=3)
                                            Hash Cond: (pc.product_id = p.id)
                                            ->  Parallel Index Only Scan using uq_prodcat_product_category on "ProductCategory" pc  (cost=0.29..2236.96 rows=41667 width=8) (actual time=42.920..200.527 rows=33333 loops=3)
                                                  Heap Fetches: 0
                                            ->  Parallel Hash  (cost=8209.75..8209.75 rows=11765 width=14) (actual time=42.949..43.376 rows=6667 loops=3)
                                                  Buckets: 32768  Batches: 1  Memory Usage: 1216kB
                                                  ->  Hash Join  (cost=2722.50..8209.75 rows=11765 width=14) (actual time=22.862..113.809 rows=20000 loops=1)
                                                        Hash Cond: (v.product_id = p.id)
                                                        ->  Hash Join  (cost=2034.50..7490.85 rows=11765 width=10) (actual time=17.979..100.823 rows=20000 loops=1)
                                                              Hash Cond: (si.variant_id = v.id)
                                                              ->  Hash Join  (cost=578.00..6003.47 rows=11765 width=10) (actual time=5.493..79.565 rows=20000 loops=1)
                                                                    Hash Cond: (si.id = oi.stock_item_id)
                                                                    ->  Parallel Seq Scan on "StockItem" si  (cost=0.00..4131.35 rows=188235 width=8) (actual time=0.005..23.109 rows=320000 loops=1)
                                                                    ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=5.468..5.469 rows=20000 loops=1)
                                                                          Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                                                          ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.009..2.241 rows=20000 loops=1)
                                                              ->  Hash  (cost=869.00..869.00 rows=47000 width=8) (actual time=12.467..12.468 rows=47000 loops=1)
                                                                    Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                                                    ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=8) (actual time=0.008..5.079 rows=47000 loops=1)
                                                        ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=4.870..4.877 rows=20000 loops=1)
                                                              Buckets: 32768  Batches: 1  Memory Usage: 960kB
                                                              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.013..2.108 rows=20000 loops=1)
                                      ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=8.791..8.792 rows=150 loops=3)
                                            Buckets: 1024  Batches: 1  Memory Usage: 16kB
                                            ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=8.232..8.253 rows=150 loops=3)
Planning Time: 22.760 ms
Execution Time: 838.006 ms


==================================================
EXPLAIN ANALYZE — Query 10: Liczba produktów per kategoria
==================================================
Sort  (cost=2342.22..2342.59 rows=150 width=20) (actual time=211.611..211.621 rows=150 loops=1)
  Sort Key: (count(pc.product_id)) DESC
  Sort Method: quicksort  Memory: 30kB
  ->  HashAggregate  (cost=2335.30..2336.80 rows=150 width=20) (actual time=210.937..210.962 rows=150 loops=1)
        Group Key: c.name
        Batches: 1  Memory Usage: 48kB
        ->  Hash Right Join  (cost=5.38..1835.30 rows=100000 width=16) (actual time=2.466..189.987 rows=100000 loops=1)
              Hash Cond: (pc.category_id = c.id)
              ->  Seq Scan on "ProductCategory" pc  (cost=0.00..1560.00 rows=100000 width=8) (actual time=1.950..167.203 rows=100000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=0.065..0.066 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 16kB
                    ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=0.020..0.038 rows=150 loops=1)
Planning Time: 11.385 ms
Execution Time: 212.275 ms


==================================================
EXPLAIN ANALYZE — Query 11: Liczba zamówień per metoda płatności
==================================================
Sort  (cost=7808.47..7808.49 rows=6 width=50) (actual time=133.990..228.858 rows=6 loops=1)
  Sort Key: (sum(oi.unit_price)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  Finalize GroupAggregate  (cost=7806.80..7808.40 rows=6 width=50) (actual time=132.567..227.447 rows=6 loops=1)
        Group Key: pm.name
        ->  Gather Merge  (cost=7806.80..7808.20 rows=12 width=50) (actual time=132.538..226.274 rows=18 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Sort  (cost=6806.78..6806.79 rows=6 width=50) (actual time=69.165..69.171 rows=6 loops=3)
                    Sort Key: pm.name
                    Sort Method: quicksort  Memory: 25kB
                    Worker 0:  Sort Method: quicksort  Memory: 25kB
                    Worker 1:  Sort Method: quicksort  Memory: 25kB
                    ->  Partial HashAggregate  (cost=6806.62..6806.70 rows=6 width=50) (actual time=64.510..64.518 rows=6 loops=3)
                          Group Key: pm.name
                          Batches: 1  Memory Usage: 24kB
                          Worker 0:  Batches: 1  Memory Usage: 24kB
                          Worker 1:  Batches: 1  Memory Usage: 24kB
                          ->  Hash Join  (cost=579.13..6744.13 rows=8333 width=20) (actual time=14.436..62.482 rows=6667 loops=3)
                                Hash Cond: (o.payment_method_id = pm.id)
                                ->  Hash Join  (cost=578.00..6705.67 rows=8333 width=14) (actual time=12.074..58.759 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.009..19.488 rows=133333 loops=3)
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=11.654..11.654 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.024..2.411 rows=20000 loops=3)
                                ->  Hash  (cost=1.06..1.06 rows=6 width=14) (actual time=2.327..2.328 rows=6 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                      ->  Seq Scan on "PaymentMethod" pm  (cost=0.00..1.06 rows=6 width=14) (actual time=2.315..2.321 rows=6 loops=3)
Planning Time: 9.853 ms
Execution Time: 233.681 ms


==================================================
EXPLAIN ANALYZE — Query 12: Średnia ocena per producent
==================================================
Sort  (cost=1367.54..1367.91 rows=150 width=57) (actual time=36.537..36.549 rows=150 loops=1)
  Sort Key: (round(avg(r.rating), 2)) DESC NULLS LAST
  Sort Method: quicksort  Memory: 32kB
  ->  HashAggregate  (cost=1359.87..1362.12 rows=150 width=57) (actual time=35.830..35.895 rows=150 loops=1)
        Group Key: m.name
        Batches: 1  Memory Usage: 64kB
        ->  Hash Join  (cost=693.38..1259.87 rows=20000 width=29) (actual time=6.271..29.065 rows=27388 loops=1)
              Hash Cond: (p.manufacturer_id = m.id)
              ->  Hash Right Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=5.593..22.965 rows=27388 loops=1)
                    Hash Cond: (r.product_id = p.id)
                    ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=0.022..5.012 rows=20000 loops=1)
                    ->  Hash  (cost=438.00..438.00 rows=20000 width=8) (actual time=5.558..5.559 rows=20000 loops=1)
                          Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                          ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=8) (actual time=0.005..2.353 rows=20000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.058..0.059 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 18kB
                    ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.016..0.033 rows=150 loops=1)
Planning Time: 16.736 ms
Execution Time: 38.075 ms


==================================================
EXPLAIN ANALYZE — Query 13: Aktywne promocje i objęta nimi liczba wariantów
==================================================
Sort  (cost=395.64..395.76 rows=47 width=14) (actual time=5.354..5.358 rows=46 loops=1)
  Sort Key: (count(v.id)) DESC
  Sort Method: quicksort  Memory: 26kB
  ->  HashAggregate  (cost=393.87..394.34 rows=47 width=14) (actual time=5.333..5.341 rows=46 loops=1)
        Group Key: pr.name
        Batches: 1  Memory Usage: 24kB
        ->  Merge Join  (cost=7.63..337.47 rows=11280 width=10) (actual time=0.091..5.023 rows=1340 loops=1)
              Merge Cond: (v.promotion_id = pr.id)
              ->  Index Scan using idx_variant_promotion on "Variant" v  (cost=0.29..2469.28 rows=47000 width=8) (actual time=0.039..4.159 rows=5685 loops=1)
              ->  Sort  (cost=7.34..7.46 rows=48 width=10) (actual time=0.048..0.053 rows=47 loops=1)
                    Sort Key: pr.id
                    Sort Method: quicksort  Memory: 26kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=48 width=10) (actual time=0.014..0.037 rows=47 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 153
Planning Time: 10.146 ms
Execution Time: 5.436 ms


==================================================
EXPLAIN ANALYZE — Query 14: Najczęściej wybierane warianty w koszykach
==================================================
Limit  (cost=224158.84..224158.87 rows=10 width=44) (actual time=9121.278..9121.287 rows=10 loops=1)
  ->  Sort  (cost=224158.84..227908.84 rows=1500000 width=44) (actual time=9120.669..9120.672 rows=10 loops=1)
        Sort Key: (sum(ci.quantity)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  GroupAggregate  (cost=4.24..191744.38 rows=1500000 width=44) (actual time=102.577..9100.571 rows=47000 loops=1)
              Group Key: v.sku, p.name
              ->  Incremental Sort  (cost=4.24..165494.38 rows=1500000 width=40) (actual time=42.719..8798.412 rows=1500000 loops=1)
                    Sort Key: v.sku, p.name
                    Presorted Key: v.sku
                    Full-sort Groups: 31708  Sort Method: quicksort  Average Memory: 27kB  Peak Memory: 27kB
                    Pre-sorted Groups: 6442  Sort Method: quicksort  Average Memory: 26kB  Peak Memory: 26kB
                    ->  Nested Loop  (cost=1.14..108333.20 rows=1500000 width=40) (actual time=4.833..8249.468 rows=1500000 loops=1)
                          ->  Nested Loop  (cost=0.71..8804.70 rows=47000 width=40) (actual time=3.686..235.761 rows=47000 loops=1)
                                ->  Index Scan using "Variant_sku_key" on "Variant" v  (cost=0.41..2051.42 rows=47000 width=31) (actual time=3.646..45.128 rows=47000 loops=1)
                                ->  Memoize  (cost=0.30..0.34 rows=1 width=17) (actual time=0.003..0.003 rows=1 loops=47000)
                                      Cache Key: v.product_id
                                      Cache Mode: logical
                                      Hits: 28889  Misses: 18111  Evictions: 0  Overflows: 0  Memory Usage: 2099kB
                                      ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=17) (actual time=0.004..0.004 rows=1 loops=18111)
                                            Index Cond: (id = v.product_id)
                          ->  Index Scan using idx_cartitem_variant_id on "CartItem" ci  (cost=0.43..1.80 rows=32 width=8) (actual time=0.009..0.166 rows=32 loops=47000)
                                Index Cond: (variant_id = v.id)
Planning Time: 13.946 ms
Execution Time: 9122.790 ms


==================================================
EXPLAIN ANALYZE — Query 15: Produkty z Największą Różnicą Między Ceną Podstawową a Ceną Wariantu
==================================================
Limit  (cost=2813.55..2813.58 rows=10 width=80) (actual time=48.319..48.323 rows=10 loops=1)
  ->  Sort  (cost=2813.55..2931.05 rows=47000 width=80) (actual time=48.318..48.320 rows=10 loops=1)
        Sort Key: v.price_modifier DESC
        Sort Method: top-N heapsort  Memory: 27kB
        ->  Hash Join  (cost=688.00..1797.90 rows=47000 width=80) (actual time=8.929..35.012 rows=47000 loops=1)
              Hash Cond: (v.product_id = p.id)
              ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=33) (actual time=2.576..5.956 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=6.335..6.335 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1381kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.008..2.658 rows=20000 loops=1)
Planning Time: 4.398 ms
Execution Time: 48.378 ms


==================================================
EXPLAIN ANALYZE — Query 16: Konwersja zamówień wg statusu
==================================================
Sort  (cost=7957.56..7962.66 rows=2040 width=48) (actual time=270.693..378.497 rows=7 loops=1)
  Sort Key: (count(o.id)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  WindowAgg  (cost=7824.99..7845.41 rows=2040 width=48) (actual time=270.666..377.452 rows=7 loops=1)
        ->  Finalize HashAggregate  (cost=7779.11..7799.51 rows=2040 width=16) (actual time=265.058..371.852 rows=7 loops=1)
              Group Key: s.name
              Batches: 1  Memory Usage: 121kB
              ->  Gather  (cost=7330.31..7758.71 rows=4080 width=16) (actual time=216.600..369.881 rows=21 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=6330.31..6350.71 rows=2040 width=16) (actual time=70.723..70.740 rows=7 loops=3)
                          Group Key: s.name
                          Batches: 1  Memory Usage: 121kB
                          Worker 0:  Batches: 1  Memory Usage: 121kB
                          Worker 1:  Batches: 1  Memory Usage: 121kB
                          ->  Hash Join  (cost=55.90..5496.98 rows=166667 width=12) (actual time=0.066..41.806 rows=133333 loops=3)
                                Hash Cond: (o.status_id = s.id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.009..11.931 rows=133333 loops=3)
                                ->  Hash  (cost=30.40..30.40 rows=2040 width=12) (actual time=0.027..0.028 rows=7 loops=3)
                                      Buckets: 2048  Batches: 1  Memory Usage: 17kB
                                      ->  Seq Scan on "Status" s  (cost=0.00..30.40 rows=2040 width=12) (actual time=0.022..0.023 rows=7 loops=3)
Planning Time: 9.142 ms
Execution Time: 384.848 ms


==================================================
EXPLAIN ANALYZE — Query 17: Top klienci wg wydatków
==================================================
Limit  (cost=15399.41..15399.44 rows=10 width=50) (actual time=4425.488..4432.578 rows=10 loops=1)
  ->  Sort  (cost=15399.41..15449.41 rows=20000 width=50) (actual time=4425.486..4432.575 rows=10 loops=1)
        Sort Key: (sum(oi.unit_price)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=14717.22..14967.22 rows=20000 width=50) (actual time=4406.922..4423.981 rows=19296 loops=1)
              Group Key: u.id
              Batches: 5  Memory Usage: 8241kB  Disk Usage: 224kB
              ->  Gather  (cost=12821.46..14592.22 rows=16666 width=50) (actual time=3713.207..3929.495 rows=19431 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=11821.46..11925.62 rows=8333 width=50) (actual time=3583.517..3717.231 rows=6477 loops=3)
                          Group Key: u.id
                          Batches: 1  Memory Usage: 3217kB
                          Worker 0:  Batches: 1  Memory Usage: 2961kB
                          Worker 1:  Batches: 1  Memory Usage: 2961kB
                          ->  Nested Loop  (cost=578.42..11779.80 rows=8333 width=24) (actual time=18.731..3490.413 rows=6667 loops=3)
                                ->  Hash Join  (cost=578.00..6705.67 rows=8333 width=10) (actual time=9.383..260.737 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.009..173.747 rows=133333 loops=3)
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=9.051..9.655 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=1.438..3.784 rows=20000 loops=3)
                                ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.475..0.475 rows=1 loops=20000)
                                      Index Cond: (id = o.user_id)
Planning Time: 23.935 ms
Execution Time: 4448.967 ms


==================================================
EXPLAIN ANALYZE — Query 18: Produkty z wariantami objętymi promocją, z końcową ceną
==================================================
Sort  (cost=1983.52..2011.72 rows=11280 width=132) (actual time=79.039..79.188 rows=1340 loops=1)
  Sort Key: (round(((p.price + v.price_modifier) * ('1'::numeric - pr.discount_percentage)), 2))
  Sort Method: quicksort  Memory: 146kB
  ->  Hash Join  (cost=695.63..1224.29 rows=11280 width=132) (actual time=32.951..75.980 rows=1340 loops=1)
        Hash Cond: (v.product_id = p.id)
        ->  Merge Join  (cost=7.63..337.47 rows=11280 width=39) (actual time=1.712..43.057 rows=1340 loops=1)
              Merge Cond: (v.promotion_id = pr.id)
              ->  Index Scan using idx_variant_promotion on "Variant" v  (cost=0.29..2469.28 rows=47000 width=37) (actual time=0.022..40.441 rows=5685 loops=1)
              ->  Sort  (cost=7.34..7.46 rows=48 width=10) (actual time=1.682..1.692 rows=47 loops=1)
                    Sort Key: pr.id
                    Sort Method: quicksort  Memory: 26kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=48 width=10) (actual time=1.640..1.664 rows=47 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 153
        ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=31.217..31.218 rows=20000 loops=1)
              Buckets: 32768  Batches: 1  Memory Usage: 1381kB
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.007..24.115 rows=20000 loops=1)
Planning Time: 52.632 ms
Execution Time: 82.887 ms


==================================================
EXPLAIN ANALYZE — Query 19: Użytkownicy, Którzy Dodali Produkt do Koszyka, Ale Nie Złożyli Zamówienia (Potencjał Odbudowy Koszyka)
==================================================
Hash Join  (cost=45873.97..103632.31 rows=1070130 width=55) (actual time=3459.508..9219.570 rows=1005006 loops=1)
  Hash Cond: (v.product_id = p.id)
  ->  Hash Join  (cost=45185.97..100134.62 rows=1070130 width=46) (actual time=3449.357..8671.928 rows=1005006 loops=1)
        Hash Cond: (ci.variant_id = v.id)
        ->  Hash Join  (cost=43729.47..95868.77 rows=1070130 width=46) (actual time=3433.087..8024.074 rows=1005006 loops=1)
              Hash Cond: (ci.cart_id = c.id)
              ->  Seq Scan on "CartItem" ci  (cost=0.00..23152.00 rows=1500000 width=8) (actual time=0.033..3525.895 rows=1500000 loops=1)
              ->  Hash  (cost=41450.81..41450.81 rows=107013 width=46) (actual time=3425.152..3441.645 rows=100414 loops=1)
                    Buckets: 131072  Batches: 2  Memory Usage: 4929kB
                    ->  Gather  (cost=25017.67..41450.81 rows=107013 width=46) (actual time=3067.860..3147.908 rows=100414 loops=1)
                          Workers Planned: 2
                          Workers Launched: 2
                          ->  Parallel Hash Right Anti Join  (cost=24017.67..29749.51 rows=44589 width=46) (actual time=2518.345..2532.675 rows=33471 loops=3)
                                Hash Cond: (o.user_id = u.id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=4) (actual time=18.851..513.338 rows=133333 loops=3)
                                ->  Parallel Hash  (cost=23236.42..23236.42 rows=62500 width=50) (actual time=1842.357..1843.291 rows=50000 loops=3)
                                      Buckets: 262144  Batches: 1  Memory Usage: 14720kB
                                      ->  Hash Join  (cost=4079.00..23236.42 rows=62500 width=50) (actual time=173.736..1629.355 rows=50000 loops=3)
                                            Hash Cond: (u.id = c.user_id)
                                            ->  Parallel Seq Scan on "User" u  (cost=0.00..18063.67 rows=416667 width=46) (actual time=11.970..1204.483 rows=333333 loops=3)
                                            ->  Hash  (cost=2204.00..2204.00 rows=150000 width=8) (actual time=150.223..150.224 rows=150000 loops=3)
                                                  Buckets: 262144  Batches: 1  Memory Usage: 7908kB
                                                  ->  Seq Scan on "Cart" c  (cost=0.00..2204.00 rows=150000 width=8) (actual time=20.845..83.011 rows=150000 loops=3)
        ->  Hash  (cost=869.00..869.00 rows=47000 width=8) (actual time=15.086..15.086 rows=47000 loops=1)
              Buckets: 65536  Batches: 1  Memory Usage: 2348kB
              ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=8) (actual time=0.012..5.133 rows=47000 loops=1)
  ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=7.264..7.789 rows=20000 loops=1)
        Buckets: 32768  Batches: 1  Memory Usage: 1245kB
        ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=1.516..3.871 rows=20000 loops=1)
Planning Time: 79.589 ms
Execution Time: 9291.071 ms


==================================================
EXPLAIN ANALYZE — Query 20: Wyszukiwanie produktów po nazwie lub opisie (parametryzowane)
==================================================
Bitmap Heap Scan on "Product"  (cost=43.00..57.51 rows=4 width=60) (actual time=7.859..36.118 rows=143 loops=1)
  Recheck Cond: (((name)::text ~~* '%test%'::text) OR (description ~~* '%test%'::text))
  Heap Blocks: exact=106
  ->  BitmapOr  (cost=43.00..43.00 rows=4 width=0) (actual time=7.821..7.822 rows=0 loops=1)
        ->  Bitmap Index Scan on idx_product_name_trgm  (cost=0.00..21.50 rows=2 width=0) (actual time=3.816..3.817 rows=42 loops=1)
              Index Cond: ((name)::text ~~* '%test%'::text)
        ->  Bitmap Index Scan on idx_product_description_trgm  (cost=0.00..21.50 rows=2 width=0) (actual time=3.998..3.999 rows=102 loops=1)
              Index Cond: (description ~~* '%test%'::text)
Planning Time: 122.639 ms
Execution Time: 40.937 ms


==================================================
EXPLAIN ANALYZE — Query 21: Użytkownicy, Którzy Zapisali Konkretny Produkt jako Ulubiony (np. Product ID=350259)
==================================================
Gather  (cost=1000.42..7485.31 rows=30 width=56) (actual time=33.812..494.128 rows=26 loops=1)
  Workers Planned: 2
  Workers Launched: 2
  ->  Nested Loop  (cost=0.42..6482.31 rows=12 width=56) (actual time=34.065..376.373 rows=9 loops=3)
        ->  Parallel Seq Scan on "FavoriteProduct" fp  (cost=0.00..6381.00 rows=12 width=4) (actual time=31.899..369.463 rows=9 loops=3)
              Filter: (product_id = 35)
              Rows Removed by Filter: 199991
        ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..8.44 rows=1 width=60) (actual time=0.791..0.791 rows=1 loops=26)
              Index Cond: (id = fp.user_id)
Planning Time: 16.645 ms
Execution Time: 495.272 ms


==================================================
EXPLAIN ANALYZE — Query 22: Znajdź Magazyny, Które Posiadają Zapasy Konkretnego Wariantu (np. SKU='VR-000000-a637d44b7afd')
==================================================
GroupAggregate  (cost=24.91..25.01 rows=2 width=25) (actual time=7.949..7.951 rows=0 loops=1)
  Group Key: w.name
  Filter: (count(si.id) > 0)
  ->  Sort  (cost=24.91..24.93 rows=5 width=21) (actual time=7.948..7.949 rows=0 loops=1)
        Sort Key: w.name
        Sort Method: quicksort  Memory: 25kB
        ->  Nested Loop  (cost=0.99..24.86 rows=5 width=21) (actual time=6.159..6.160 rows=0 loops=1)
              ->  Nested Loop  (cost=0.84..24.00 rows=5 width=8) (actual time=6.159..6.160 rows=0 loops=1)
                    ->  Index Scan using "Variant_sku_key" on "Variant" v  (cost=0.41..8.43 rows=1 width=4) (actual time=6.158..6.158 rows=0 loops=1)
                          Index Cond: ((sku)::text = 'VR-000001-2704de10f283'::text)
                    ->  Index Scan using idx_stockitem_shipment_variant_warehouse on "StockItem" si  (cost=0.42..15.52 rows=5 width=12) (never executed)
                          Index Cond: ((shipment_id IS NULL) AND (variant_id = v.id))
              ->  Index Scan using "Warehouse_pkey" on "Warehouse" w  (cost=0.15..0.17 rows=1 width=21) (never executed)
                    Index Cond: (id = si.warehouse_id)
Planning Time: 26.381 ms
Execution Time: 11.841 ms


==================================================
EXPLAIN ANALYZE — Query 23: Warianty, Które Wymagają Uzyskania Konkretnej Opcji (np. 'Kolor'='Czerwony')
==================================================
Nested Loop  (cost=6.96..680.20 rows=1 width=36) (actual time=0.023..0.024 rows=0 loops=1)
  ->  Nested Loop  (cost=6.67..679.87 rows=1 width=27) (actual time=0.023..0.023 rows=0 loops=1)
        ->  Nested Loop  (cost=6.38..679.55 rows=1 width=4) (actual time=0.023..0.023 rows=0 loops=1)
              Join Filter: (opt.attribute_id = a.id)
              ->  Index Scan using "Attribute_name_key" on "Attribute" a  (cost=0.15..8.17 rows=1 width=4) (actual time=0.022..0.022 rows=0 loops=1)
                    Index Cond: ((name)::text = 'Attr_49_Century'::text)
              ->  Nested Loop  (cost=6.23..668.26 rows=250 width=8) (never executed)
                    ->  Seq Scan on "Option" opt  (cost=0.00..18.50 rows=1 width=8) (never executed)
                          Filter: ((value)::text = 'do'::text)
                    ->  Bitmap Heap Scan on "VariantOption" vo  (cost=6.23..647.26 rows=250 width=8) (never executed)
                          Recheck Cond: (option_id = opt.id)
                          ->  Bitmap Index Scan on idx_variantoption_option_id  (cost=0.00..6.17 rows=250 width=0) (never executed)
                                Index Cond: (option_id = opt.id)
        ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.32 rows=1 width=31) (never executed)
              Index Cond: (id = vo.variant_id)
  ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=17) (never executed)
        Index Cond: (id = v.product_id)
Planning Time: 47.611 ms
Execution Time: 0.072 ms


==================================================
EXPLAIN ANALYZE — Query 24: Znajdź Zamówienia Użytkownika (np. email='debbie.lane.16786.50af0753@example.com') o Statusie 'Paid'
==================================================
Nested Loop  (cost=1.00..17.09 rows=1 width=20) (actual time=4.762..4.764 rows=0 loops=1)
  ->  Nested Loop  (cost=0.85..16.89 rows=1 width=16) (actual time=4.762..4.763 rows=0 loops=1)
        ->  Index Scan using "User_email_key" on "User" u  (cost=0.42..8.44 rows=1 width=4) (actual time=4.761..4.761 rows=0 loops=1)
              Index Cond: ((email)::text = 'debbie.lane.16786.50af0753@example.com'::text)
        ->  Index Scan using idx_order_user_id on "Order" o  (cost=0.42..8.44 rows=1 width=20) (never executed)
              Index Cond: (user_id = u.id)
  ->  Index Scan using "Status_pkey" on "Status" s  (cost=0.15..0.17 rows=1 width=12) (never executed)
        Index Cond: (id = o.status_id)
        Filter: ((name)::text = 'Paid'::text)
Planning Time: 3.469 ms
Execution Time: 4.800 ms


==================================================
EXPLAIN ANALYZE — Query 25: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
Nested Loop Left Join  (cost=5.45..49.87 rows=16 width=87) (actual time=2.352..10.001 rows=18 loops=1)
  ->  Nested Loop Left Join  (cost=5.30..46.34 rows=16 width=45) (actual time=1.695..9.304 rows=18 loops=1)
        ->  Nested Loop Left Join  (cost=5.02..41.66 rows=16 width=39) (actual time=1.670..7.188 rows=18 loops=1)
              ->  Nested Loop  (cost=4.60..23.91 rows=3 width=39) (actual time=1.016..2.206 rows=4 loops=1)
                    ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..8.30 rows=1 width=10) (actual time=0.008..0.009 rows=1 loops=1)
                          Index Cond: (id = 35)
                    ->  Bitmap Heap Scan on "Variant" v  (cost=4.31..15.57 rows=3 width=37) (actual time=1.004..2.191 rows=4 loops=1)
                          Recheck Cond: (product_id = 35)
                          Heap Blocks: exact=4
                          ->  Bitmap Index Scan on idx_variant_product_id  (cost=0.00..4.31 rows=3 width=0) (actual time=0.016..0.016 rows=4 loops=1)
                                Index Cond: (product_id = 35)
              ->  Index Only Scan using uq_varopt_variant_option on "VariantOption" vo  (cost=0.42..5.86 rows=6 width=8) (actual time=1.242..1.243 rows=4 loops=4)
                    Index Cond: (variant_id = v.id)
                    Heap Fetches: 0
        ->  Index Scan using "Option_pkey" on "Option" opt  (cost=0.28..0.29 rows=1 width=14) (actual time=0.117..0.117 rows=1 loops=18)
              Index Cond: (id = vo.option_id)
  ->  Index Scan using "Attribute_pkey" on "Attribute" a  (cost=0.15..0.22 rows=1 width=18) (actual time=0.002..0.002 rows=1 loops=18)
        Index Cond: (id = opt.attribute_id)
Planning Time: 0.536 ms
Execution Time: 10.048 ms


==================================================
EXPLAIN ANALYZE — Query 26: Lista Wszystkich Dziecięcych Kategorii (Podkategorii) dla Konkretnej Kategorii Nadrzędnej (np. ID=5)
==================================================
Seq Scan on "Category"  (cost=0.00..3.88 rows=3 width=12) (actual time=1.231..2.321 rows=3 loops=1)
  Filter: (parent_id = 5)
  Rows Removed by Filter: 147
Planning Time: 1.361 ms
Execution Time: 2.341 ms


==================================================
EXPLAIN ANALYZE — Query 27: Porównanie Średniej Oceny dla Promowanych i Niepromowanych Produktów
==================================================
HashAggregate  (cost=87850.51..87853.01 rows=200 width=64) (actual time=164.248..164.253 rows=2 loops=1)
  Group Key: CASE WHEN (ANY (p.id = (hashed SubPlan 2).col1)) THEN 'Promowany'::text ELSE 'Niepromowany'::text END
  Batches: 1  Memory Usage: 40kB
  ->  HashAggregate  (cost=1300.51..87550.51 rows=20000 width=68) (actual time=154.543..161.293 rows=12612 loops=1)
        Group Key: p.id
        Batches: 1  Memory Usage: 2577kB
        ->  Hash Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=49.936..131.819 rows=20000 loops=1)
              Hash Cond: (r.product_id = p.id)
              ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=1.271..74.519 rows=20000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=48.451..48.452 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 960kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.009..44.952 rows=20000 loops=1)
        SubPlan 2
          ->  Index Only Scan using idx_variant_product_promotion on "Variant" v2  (cost=0.28..158.09 rows=5739 width=4) (actual time=2.910..9.208 rows=5684 loops=1)
                Heap Fetches: 0
Planning Time: 5.394 ms
Execution Time: 167.328 ms


==================================================
EXPLAIN ANALYZE — Query 28: Top 5 Miast Generujących Największy Przychód (Wg. Adresu Wysyłki)
==================================================
Limit  (cost=15315.16..15315.17 rows=5 width=45) (actual time=3917.575..3942.697 rows=5 loops=1)
  ->  Sort  (cost=15315.16..15365.16 rows=20000 width=45) (actual time=3917.566..3941.375 rows=5 loops=1)
        Sort Key: (sum(oi.unit_price)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=14732.97..14982.97 rows=20000 width=45) (actual time=3906.412..3935.617 rows=12950 loops=1)
              Group Key: a.city
              Batches: 1  Memory Usage: 5905kB
              ->  Gather  (cost=12837.21..14607.97 rows=16666 width=45) (actual time=3716.579..3780.248 rows=16081 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=11837.21..11941.37 rows=8333 width=45) (actual time=3620.762..3626.414 rows=5360 loops=3)
                          Group Key: a.city
                          Batches: 1  Memory Usage: 2449kB
                          Worker 0:  Batches: 1  Memory Usage: 2449kB
                          Worker 1:  Batches: 1  Memory Usage: 2449kB
                          ->  Nested Loop  (cost=578.43..11795.55 rows=8333 width=19) (actual time=26.686..3577.787 rows=6667 loops=3)
                                ->  Hash Join  (cost=578.00..6705.67 rows=8333 width=10) (actual time=24.607..276.343 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.012..164.501 rows=133333 loops=3)
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=24.350..24.566 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.451..19.942 rows=20000 loops=3)
                                ->  Index Scan using "Address_pkey" on "Address" a  (cost=0.43..0.61 rows=1 width=17) (actual time=0.490..0.490 rows=1 loops=20000)
                                      Index Cond: (id = o.shipping_address_id)
Planning Time: 23.362 ms
Execution Time: 3951.190 ms


==================================================
EXPLAIN ANALYZE — Query 29: Porównanie Wolumenu Sprzedaży Produktów Promowanych vs. Niepromowanych (w Ostatnich 30 Dniach)
==================================================
Finalize GroupAggregate  (cost=6359.32..6415.12 rows=200 width=40) (actual time=921.974..1067.681 rows=2 loops=1)
  Group Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
  ->  Gather Merge  (cost=6359.32..6411.12 rows=400 width=40) (actual time=909.008..1062.130 rows=6 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=5359.29..5364.92 rows=200 width=40) (actual time=647.916..650.116 rows=2 loops=3)
              Group Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
              ->  Sort  (cost=5359.29..5360.50 rows=484 width=32) (actual time=639.568..641.575 rows=392 loops=3)
                    Sort Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
                    Sort Method: quicksort  Memory: 25kB
                    Worker 0:  Sort Method: quicksort  Memory: 25kB
                    Worker 1:  Sort Method: quicksort  Memory: 25kB
                    ->  Nested Loop  (cost=1015.06..5337.71 rows=484 width=32) (actual time=29.957..595.472 rows=392 loops=3)
                          ->  Nested Loop  (cost=1014.77..5185.67 rows=484 width=4) (actual time=28.064..503.137 rows=392 loops=3)
                                ->  Hash Join  (cost=1014.35..4584.93 rows=484 width=4) (actual time=23.509..78.431 rows=392 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Bitmap Heap Scan on "Order" o  (cost=436.35..3941.63 rows=9673 width=4) (actual time=6.937..65.688 rows=7838 loops=3)
                                            Recheck Cond: (order_date >= (now() - '30 days'::interval))
                                            Heap Blocks: exact=1297
                                            ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..430.55 rows=23216 width=0) (actual time=12.225..12.225 rows=23515 loops=1)
                                                  Index Cond: (order_date >= (now() - '30 days'::interval))
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=8) (actual time=7.856..7.857 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=8) (actual time=0.929..3.183 rows=20000 loops=3)
                                ->  Index Scan using "StockItem_pkey" on "StockItem" si  (cost=0.42..1.24 rows=1 width=8) (actual time=1.079..1.079 rows=1 loops=1177)
                                      Index Cond: (id = oi.stock_item_id)
                          ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.31 rows=1 width=8) (actual time=0.231..0.231 rows=1 loops=1177)
                                Index Cond: (id = si.variant_id)
Planning Time: 36.484 ms
Execution Time: 1075.381 ms


==================================================
EXPLAIN ANALYZE — Query 30: Wskaźnik Lojalności (Repeat Purchase Rate) Użytkowników z Podziałem na Miasto Adresu Rozliczeniowego
==================================================
Sort  (cost=68134.41..68209.82 rows=30162 width=61) (actual time=5254.862..5279.810 rows=66456 loops=1)
  Sort Key: (round((((count(*) FILTER (WHERE (u.orders_count > 1)))::numeric * 100.0) / (NULLIF(count(*), 0))::numeric), 2)) DESC
  Sort Method: external merge  Disk: 3192kB
  ->  Finalize HashAggregate  (cost=65136.24..65890.29 rows=30162 width=61) (actual time=5121.244..5200.065 rows=66456 loops=1)
        Group Key: a.city
        Batches: 5  Memory Usage: 8241kB  Disk Usage: 712kB
        ->  Gather  (cost=58349.79..64683.81 rows=60324 width=29) (actual time=4598.477..4692.556 rows=122160 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial HashAggregate  (cost=57349.79..57651.41 rows=30162 width=29) (actual time=4384.254..4399.585 rows=40720 loops=3)
                    Group Key: a.city
                    Batches: 1  Memory Usage: 5137kB
                    Worker 0:  Batches: 1  Memory Usage: 5137kB
                    Worker 1:  Batches: 1  Memory Usage: 5137kB
                    ->  Parallel Hash Join  (cost=34825.67..55683.12 rows=166667 width=21) (actual time=1584.378..4036.056 rows=133333 loops=3)
                          Hash Cond: (a.id = o.billing_address_id)
                          ->  Parallel Seq Scan on "Address" a  (cost=0.00..18288.00 rows=500000 width=17) (actual time=12.364..1580.794 rows=400000 loops=3)
                          ->  Parallel Hash  (cost=32742.34..32742.34 rows=166667 width=12) (actual time=1563.872..1565.788 rows=133333 loops=3)
                                Buckets: 524288  Batches: 1  Memory Usage: 22912kB
                                ->  Hash Join  (cost=24598.16..32742.34 rows=166667 width=12) (actual time=785.251..1252.236 rows=133333 loops=3)
                                      Hash Cond: (o.user_id = u.user_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.690..169.741 rows=133333 loops=3)
                                      ->  Hash  (cost=19615.94..19615.94 rows=286577 width=12) (actual time=582.689..584.073 rows=329619 loops=3)
                                            Buckets: 262144  Batches: 4  Memory Usage: 5596kB
                                            ->  Subquery Scan on u  (cost=0.42..19615.94 rows=286577 width=12) (actual time=6.766..410.215 rows=329619 loops=3)
                                                  ->  GroupAggregate  (cost=0.42..16750.17 rows=286577 width=12) (actual time=6.763..368.474 rows=329619 loops=3)
                                                        Group Key: "Order".user_id
                                                        ->  Index Only Scan using idx_order_user_id on "Order"  (cost=0.42..11884.40 rows=400000 width=4) (actual time=6.565..244.916 rows=400000 loops=3)
                                                              Heap Fetches: 150240
Planning Time: 5.611 ms
Execution Time: 5389.091 ms

FINISHED — 2025-11-22 17:22:20.976809
========================================================================================================================
========================================================================================================================
START EXPLAIN RUN — 2025-11-22 17:25:04.463114
========================================================================================================================


==================================================
EXPLAIN ANALYZE — Query 1: Średnia Wartość Zamówienia (AOV) w Ostatnim Miesiącu
==================================================
Aggregate  (cost=4939.34..4939.35 rows=1 width=32) (actual time=990.134..990.137 rows=1 loops=1)
  ->  HashAggregate  (cost=4908.94..4924.14 rows=1216 width=36) (actual time=989.628..990.035 rows=1213 loops=1)
        Group Key: o.id
        Batches: 1  Memory Usage: 577kB
        ->  Hash Join  (cost=4522.36..4902.86 rows=1216 width=10) (actual time=963.330..985.912 rows=1241 loops=1)
              Hash Cond: (oi.order_id = o.id)
              ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.016..10.656 rows=20000 loops=1)
              ->  Hash  (cost=4218.41..4218.41 rows=24316 width=4) (actual time=963.079..963.080 rows=24618 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1122kB
                    ->  Bitmap Heap Scan on "Order" o  (cost=456.88..4218.41 rows=24316 width=4) (actual time=33.370..956.190 rows=24618 loops=1)
                          Recheck Cond: (order_date >= (now() - '1 mon'::interval))
                          Heap Blocks: exact=3333
                          ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..450.80 rows=24316 width=0) (actual time=32.978..32.978 rows=24618 loops=1)
                                Index Cond: (order_date >= (now() - '1 mon'::interval))
Planning Time: 30.578 ms
Execution Time: 1001.570 ms


==================================================
EXPLAIN ANALYZE — Query 2: Średnia wartość zamówienia per użytkownik
==================================================
Sort  (cost=16066.87..16115.61 rows=19495 width=50) (actual time=5158.314..5214.574 rows=19296 loops=1)
  Sort Key: (round(avg(order_totals.total_price), 2)) DESC
  Sort Method: quicksort  Memory: 1612kB
  ->  Finalize HashAggregate  (cost=14385.35..14677.77 rows=19495 width=50) (actual time=5122.640..5197.131 rows=19296 loops=1)
        Group Key: u.id
        Batches: 5  Memory Usage: 8241kB  Disk Usage: 216kB
        ->  Gather  (cost=12537.36..14263.50 rows=16246 width=50) (actual time=4922.812..5074.337 rows=19429 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial HashAggregate  (cost=11537.36..11638.90 rows=8123 width=50) (actual time=4399.138..4411.833 rows=6476 loops=3)
                    Group Key: u.id
                    Batches: 1  Memory Usage: 3217kB
                    Worker 0:  Batches: 1  Memory Usage: 2961kB
                    Worker 1:  Batches: 1  Memory Usage: 2961kB
                    ->  Nested Loop  (cost=1110.75..11496.75 rows=8123 width=50) (actual time=146.609..4324.745 rows=6498 loops=3)
                          ->  Hash Join  (cost=1110.33..6550.49 rows=8123 width=36) (actual time=98.071..321.048 rows=6498 loops=3)
                                Hash Cond: (o.id = order_totals.order_id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=1.758..107.767 rows=133333 loops=3)
                                ->  Hash  (cost=866.64..866.64 rows=19495 width=36) (actual time=92.233..93.649 rows=19495 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1094kB
                                      ->  Subquery Scan on order_totals  (cost=428.00..866.64 rows=19495 width=36) (actual time=75.333..86.243 rows=19495 loops=3)
                                            ->  HashAggregate  (cost=428.00..671.69 rows=19495 width=36) (actual time=74.614..83.099 rows=19495 loops=3)
                                                  Group Key: oi.order_id
                                                  Batches: 1  Memory Usage: 7953kB
                                                  Worker 0:  Batches: 1  Memory Usage: 7953kB
                                                  Worker 1:  Batches: 1  Memory Usage: 7953kB
                                                  ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=3.677..25.651 rows=20000 loops=3)
                          ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.608..0.608 rows=1 loops=19495)
                                Index Cond: (id = o.user_id)
Planning Time: 52.138 ms
Execution Time: 5255.165 ms


==================================================
EXPLAIN ANALYZE — Query 3: Top 10 Najlepiej Sprzedających Się Produktów (wg. Ilości Sprzedanych Jednostek) w Ostatnim Kwartale
==================================================
Limit  (cost=11753.76..11753.79 rows=10 width=46) (actual time=1498.433..1646.609 rows=10 loops=1)
  ->  Sort  (cost=11753.76..11765.21 rows=4579 width=46) (actual time=1497.298..1644.494 rows=10 loops=1)
        Sort Key: (count(*)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=11609.02..11654.81 rows=4579 width=46) (actual time=1494.200..1642.352 rows=3926 loops=1)
              Group Key: p.name, m.name
              Batches: 1  Memory Usage: 721kB
              ->  Gather  (cost=11179.72..11580.40 rows=3816 width=46) (actual time=1413.895..1634.726 rows=4341 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=10179.72..10198.80 rows=1908 width=46) (actual time=1314.063..1315.864 rows=1447 loops=3)
                          Group Key: p.name, m.name
                          Batches: 1  Memory Usage: 369kB
                          Worker 0:  Batches: 1  Memory Usage: 369kB
                          Worker 1:  Batches: 1  Memory Usage: 369kB
                          ->  Hash Join  (cost=2302.53..10165.41 rows=1908 width=38) (actual time=42.586..1292.182 rows=1521 loops=3)
                                Hash Cond: (p.manufacturer_id = m.id)
                                ->  Nested Loop  (cost=2297.16..10154.88 rows=1908 width=17) (actual time=41.697..1285.672 rows=1521 loops=3)
                                      ->  Nested Loop  (cost=2296.87..9525.04 rows=1908 width=4) (actual time=39.899..1191.860 rows=1521 loops=3)
                                            ->  Nested Loop  (cost=2296.58..8925.69 rows=1908 width=4) (actual time=38.310..1076.804 rows=1521 loops=3)
                                                  ->  Hash Join  (cost=2296.16..6557.48 rows=1908 width=4) (actual time=24.531..76.230 rows=1521 loops=3)
                                                        Hash Cond: (o.id = oi.order_id)
                                                        ->  Parallel Bitmap Heap Scan on "Order" o  (cost=1718.16..5721.91 rows=38158 width=4) (actual time=15.441..56.046 rows=30425 loops=3)
                                                              Recheck Cond: (order_date >= (now() - '3 mons'::interval))
                                                              Heap Blocks: exact=1116
                                                              ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..1695.26 rows=91578 width=0) (actual time=44.307..44.307 rows=91276 loops=1)
                                                                    Index Cond: (order_date >= (now() - '3 mons'::interval))
                                                        ->  Hash  (cost=328.00..328.00 rows=20000 width=8) (actual time=6.489..6.490 rows=20000 loops=3)
                                                              Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                                                              ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=8) (actual time=0.024..2.390 rows=20000 loops=3)
                                                  ->  Index Scan using "StockItem_pkey" on "StockItem" si  (cost=0.42..1.24 rows=1 width=8) (actual time=0.655..0.655 rows=1 loops=4562)
                                                        Index Cond: (id = oi.stock_item_id)
                                            ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.31 rows=1 width=8) (actual time=0.073..0.073 rows=1 loops=4562)
                                                  Index Cond: (id = si.variant_id)
                                      ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=21) (actual time=0.058..0.058 rows=1 loops=4562)
                                            Index Cond: (id = v.product_id)
                                ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.646..0.647 rows=150 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 18kB
                                      ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.403..0.422 rows=150 loops=3)
Planning Time: 83.767 ms
Execution Time: 1659.224 ms


==================================================
EXPLAIN ANALYZE — Query 4: Top 5 produktów z najwięcej recenzjami
==================================================
Limit  (cost=1792.59..1792.61 rows=5 width=25) (actual time=137.109..137.113 rows=5 loops=1)
  ->  Sort  (cost=1792.59..1842.59 rows=20000 width=25) (actual time=137.108..137.110 rows=5 loops=1)
        Sort Key: (COALESCE(r.count, '0'::bigint)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Hash Left Join  (cost=969.89..1460.40 rows=20000 width=25) (actual time=126.298..133.350 rows=20000 loops=1)
              Hash Cond: (p.id = r.product_id)
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.012..1.490 rows=20000 loops=1)
              ->  Hash  (cost=812.24..812.24 rows=12612 width=12) (actual time=126.275..126.276 rows=12612 loops=1)
                    Buckets: 16384  Batches: 1  Memory Usage: 670kB
                    ->  Subquery Scan on r  (cost=560.00..812.24 rows=12612 width=12) (actual time=120.012..123.679 rows=12612 loops=1)
                          ->  HashAggregate  (cost=560.00..686.12 rows=12612 width=12) (actual time=120.011..122.492 rows=12612 loops=1)
                                Group Key: "Review".product_id
                                Batches: 1  Memory Usage: 1425kB
                                ->  Seq Scan on "Review"  (cost=0.00..460.00 rows=20000 width=4) (actual time=1.002..113.179 rows=20000 loops=1)
Planning Time: 9.342 ms
Execution Time: 144.370 ms


==================================================
EXPLAIN ANALYZE — Query 5: Całkowity Przychód Pogrupowany Miesięcznie za Ostatni Rok
==================================================
Finalize GroupAggregate  (cost=9719.19..11975.47 rows=17309 width=36) (actual time=196.712..319.565 rows=11 loops=1)
  Group Key: ((date_trunc('month'::text, o.order_date))::date)
  ->  Gather Merge  (cost=9719.19..11564.38 rows=14424 width=36) (actual time=195.724..317.890 rows=33 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=8719.17..8899.47 rows=7212 width=36) (actual time=83.748..85.078 rows=11 loops=3)
              Group Key: ((date_trunc('month'::text, o.order_date))::date)
              ->  Sort  (cost=8719.17..8737.20 rows=7212 width=10) (actual time=82.931..83.446 rows=5760 loops=3)
                    Sort Key: ((date_trunc('month'::text, o.order_date))::date) DESC
                    Sort Method: quicksort  Memory: 887kB
                    Worker 0:  Sort Method: quicksort  Memory: 36kB
                    Worker 1:  Sort Method: quicksort  Memory: 50kB
                    ->  Hash Join  (cost=578.00..8257.02 rows=7212 width=10) (actual time=10.794..78.843 rows=5760 loops=3)
                          Hash Cond: (o.id = oi.order_id)
                          ->  Parallel Seq Scan on "Order" o  (cost=0.00..6669.33 rows=144241 width=12) (actual time=0.015..44.784 rows=115772 loops=3)
                                Filter: (order_date >= (date_trunc('year'::text, now()) - '00:00:00'::interval))
                                Rows Removed by Filter: 17562
                          ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=10.294..10.295 rows=20000 loops=3)
                                Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.028..5.862 rows=20000 loops=3)
Planning Time: 13.099 ms
Execution Time: 327.678 ms


==================================================
EXPLAIN ANALYZE — Query 6: Produkty najczęściej dodawane do ulubionych
==================================================
Limit  (cost=14382.58..14382.60 rows=10 width=25) (actual time=887.040..952.185 rows=10 loops=1)
  ->  Sort  (cost=14382.58..14432.58 rows=20000 width=25) (actual time=887.033..951.112 rows=10 loops=1)
        Sort Key: (count(f.id)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=13750.38..13950.38 rows=20000 width=25) (actual time=878.131..945.300 rows=20000 loops=1)
              Group Key: p.id
              Batches: 1  Memory Usage: 2577kB
              ->  Gather  (cost=9350.38..13550.38 rows=40000 width=25) (actual time=750.743..876.730 rows=59993 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=8350.38..8550.38 rows=20000 width=25) (actual time=647.115..653.431 rows=19998 loops=3)
                          Group Key: p.id
                          Batches: 1  Memory Usage: 2577kB
                          Worker 0:  Batches: 1  Memory Usage: 2577kB
                          Worker 1:  Batches: 1  Memory Usage: 2577kB
                          ->  Hash Join  (cost=688.00..7100.38 rows=250000 width=21) (actual time=19.890..557.944 rows=200000 loops=3)
                                Hash Cond: (f.product_id = p.id)
                                ->  Parallel Seq Scan on "FavoriteProduct" f  (cost=0.00..5756.00 rows=250000 width=8) (actual time=11.213..464.656 rows=200000 loops=3)
                                ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=7.859..7.860 rows=20000 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1215kB
                                      ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.355..3.356 rows=20000 loops=3)
Planning Time: 23.643 ms
Execution Time: 955.416 ms


==================================================
EXPLAIN ANALYZE — Query 7: Dostępny Stan Magazynowy Wariantów Produktu Pogrupowany po Magazynach
==================================================
GroupAggregate  (cost=37640.01..42664.89 rows=223328 width=61) (actual time=1394.652..1721.227 rows=178012 loops=1)
  Group Key: p.name, w.name, v.sku
  ->  Sort  (cost=37640.01..38198.33 rows=223328 width=57) (actual time=1388.900..1614.558 rows=223971 loops=1)
        Sort Key: p.name, w.name, v.sku
        Sort Method: external merge  Disk: 15248kB
        ->  Hash Join  (cost=2189.15..9398.65 rows=223328 width=57) (actual time=29.488..600.590 rows=223971 loops=1)
              Hash Cond: (si.warehouse_id = w.id)
              ->  Hash Join  (cost=2144.50..8766.15 rows=223328 width=44) (actual time=29.468..557.664 rows=223971 loops=1)
                    Hash Cond: (v.product_id = p.id)
                    ->  Hash Join  (cost=1456.50..7491.79 rows=223328 width=35) (actual time=23.706..466.244 rows=223971 loops=1)
                          Hash Cond: (si.variant_id = v.id)
                          ->  Seq Scan on "StockItem" si  (cost=0.00..5449.00 rows=223328 width=12) (actual time=0.013..333.008 rows=223971 loops=1)
                                Filter: (shipment_id IS NULL)
                                Rows Removed by Filter: 96029
                          ->  Hash  (cost=869.00..869.00 rows=47000 width=31) (actual time=23.673..24.667 rows=47000 loops=1)
                                Buckets: 65536  Batches: 1  Memory Usage: 3450kB
                                ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=31) (actual time=0.005..6.835 rows=47000 loops=1)
                    ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=5.752..5.753 rows=20000 loops=1)
                          Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                          ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.005..2.428 rows=20000 loops=1)
              ->  Hash  (cost=25.40..25.40 rows=1540 width=21) (actual time=0.015..0.015 rows=10 loops=1)
                    Buckets: 2048  Batches: 1  Memory Usage: 17kB
                    ->  Seq Scan on "Warehouse" w  (cost=0.00..25.40 rows=1540 width=21) (actual time=0.009..0.010 rows=10 loops=1)
Planning Time: 9.977 ms
Execution Time: 1746.328 ms


==================================================
EXPLAIN ANALYZE — Query 8: Stan magazynowy per produkt
==================================================
Sort  (cost=11494.90..11544.43 rows=19812 width=21) (actual time=307.836..309.539 rows=17916 loops=1)
  Sort Key: (count(si.id)) DESC
  Sort Method: quicksort  Memory: 1482kB
  ->  HashAggregate  (cost=9882.79..10080.91 rows=19812 width=21) (actual time=300.279..304.197 rows=17916 loops=1)
        Group Key: p.name
        Batches: 1  Memory Usage: 2065kB
        ->  Hash Join  (cost=2144.50..8766.15 rows=223328 width=17) (actual time=20.636..219.885 rows=223971 loops=1)
              Hash Cond: (v.product_id = p.id)
              ->  Hash Join  (cost=1456.50..7491.79 rows=223328 width=8) (actual time=12.998..141.208 rows=223971 loops=1)
                    Hash Cond: (si.variant_id = v.id)
                    ->  Seq Scan on "StockItem" si  (cost=0.00..5449.00 rows=223328 width=8) (actual time=0.015..39.222 rows=223971 loops=1)
                          Filter: (shipment_id IS NULL)
                          Rows Removed by Filter: 96029
                    ->  Hash  (cost=869.00..869.00 rows=47000 width=8) (actual time=12.962..12.963 rows=47000 loops=1)
                          Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                          ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=8) (actual time=0.005..5.146 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=7.625..7.626 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=1.935..4.316 rows=20000 loops=1)
Planning Time: 21.105 ms
Execution Time: 311.340 ms


==================================================
EXPLAIN ANALYZE — Query 9: Najpopularniejsze Kategorie (wg. Całkowitego Przychodu)
==================================================
Limit  (cost=12371.00..12371.02 rows=10 width=44) (actual time=626.099..800.695 rows=10 loops=1)
  ->  Sort  (cost=12371.00..12371.37 rows=150 width=44) (actual time=625.381..799.973 rows=10 loops=1)
        Sort Key: (sum(oi.unit_price)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize GroupAggregate  (cost=12328.63..12367.76 rows=150 width=44) (actual time=623.996..798.723 rows=150 loops=1)
              Group Key: c.name
              ->  Gather Merge  (cost=12328.63..12363.63 rows=300 width=44) (actual time=618.610..792.118 rows=150 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Sort  (cost=11328.61..11328.98 rows=150 width=44) (actual time=177.054..178.768 rows=50 loops=3)
                          Sort Key: c.name
                          Sort Method: quicksort  Memory: 39kB
                          Worker 0:  Sort Method: quicksort  Memory: 25kB
                          Worker 1:  Sort Method: quicksort  Memory: 25kB
                          ->  Partial HashAggregate  (cost=11321.31..11323.19 rows=150 width=44) (actual time=171.763..172.744 rows=50 loops=3)
                                Group Key: c.name
                                Batches: 1  Memory Usage: 96kB
                                Worker 0:  Batches: 1  Memory Usage: 40kB
                                Worker 1:  Batches: 1  Memory Usage: 40kB
                                ->  Hash Join  (cost=8362.48..11112.98 rows=41667 width=18) (actual time=57.561..159.332 rows=33334 loops=3)
                                      Hash Cond: (pc.category_id = c.id)
                                      ->  Parallel Hash Join  (cost=8357.10..10995.13 rows=41667 width=10) (actual time=50.079..145.217 rows=33334 loops=3)
                                            Hash Cond: (pc.product_id = p.id)
                                            ->  Parallel Index Only Scan using uq_prodcat_product_category on "ProductCategory" pc  (cost=0.29..2236.96 rows=41667 width=8) (actual time=6.196..258.102 rows=100000 loops=1)
                                                  Heap Fetches: 0
                                            ->  Parallel Hash  (cost=8209.75..8209.75 rows=11765 width=14) (actual time=47.077..47.083 rows=6667 loops=3)
                                                  Buckets: 32768  Batches: 1  Memory Usage: 1216kB
                                                  ->  Hash Join  (cost=2722.50..8209.75 rows=11765 width=14) (actual time=23.183..118.408 rows=20000 loops=1)
                                                        Hash Cond: (v.product_id = p.id)
                                                        ->  Hash Join  (cost=2034.50..7490.85 rows=11765 width=10) (actual time=18.265..104.804 rows=20000 loops=1)
                                                              Hash Cond: (si.variant_id = v.id)
                                                              ->  Hash Join  (cost=578.00..6003.47 rows=11765 width=10) (actual time=5.523..83.139 rows=20000 loops=1)
                                                                    Hash Cond: (si.id = oi.stock_item_id)
                                                                    ->  Parallel Seq Scan on "StockItem" si  (cost=0.00..4131.35 rows=188235 width=8) (actual time=0.005..26.219 rows=320000 loops=1)
                                                                    ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=5.497..5.498 rows=20000 loops=1)
                                                                          Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                                                          ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.010..2.271 rows=20000 loops=1)
                                                              ->  Hash  (cost=869.00..869.00 rows=47000 width=8) (actual time=12.722..12.722 rows=47000 loops=1)
                                                                    Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                                                    ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=8) (actual time=0.009..5.134 rows=47000 loops=1)
                                                        ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=4.904..4.905 rows=20000 loops=1)
                                                              Buckets: 32768  Batches: 1  Memory Usage: 960kB
                                                              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.012..2.129 rows=20000 loops=1)
                                      ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=7.354..7.354 rows=150 loops=3)
                                            Buckets: 1024  Batches: 1  Memory Usage: 16kB
                                            ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=6.296..6.317 rows=150 loops=3)
Planning Time: 41.035 ms
Execution Time: 810.973 ms


==================================================
EXPLAIN ANALYZE — Query 10: Liczba produktów per kategoria
==================================================
Sort  (cost=2342.22..2342.59 rows=150 width=20) (actual time=130.719..131.704 rows=150 loops=1)
  Sort Key: (count(pc.product_id)) DESC
  Sort Method: quicksort  Memory: 30kB
  ->  HashAggregate  (cost=2335.30..2336.80 rows=150 width=20) (actual time=129.311..129.335 rows=150 loops=1)
        Group Key: c.name
        Batches: 1  Memory Usage: 48kB
        ->  Hash Right Join  (cost=5.38..1835.30 rows=100000 width=16) (actual time=3.532..108.697 rows=100000 loops=1)
              Hash Cond: (pc.category_id = c.id)
              ->  Seq Scan on "ProductCategory" pc  (cost=0.00..1560.00 rows=100000 width=8) (actual time=2.010..85.322 rows=100000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=0.080..0.081 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 16kB
                    ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=0.029..0.052 rows=150 loops=1)
Planning Time: 12.967 ms
Execution Time: 133.056 ms


==================================================
EXPLAIN ANALYZE — Query 11: Liczba zamówień per metoda płatności
==================================================
Sort  (cost=7808.47..7808.49 rows=6 width=50) (actual time=219.489..372.611 rows=6 loops=1)
  Sort Key: (sum(oi.unit_price)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  Finalize GroupAggregate  (cost=7806.80..7808.40 rows=6 width=50) (actual time=218.652..371.780 rows=6 loops=1)
        Group Key: pm.name
        ->  Gather Merge  (cost=7806.80..7808.20 rows=12 width=50) (actual time=217.714..369.992 rows=6 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Sort  (cost=6806.78..6806.79 rows=6 width=50) (actual time=47.753..47.759 rows=2 loops=3)
                    Sort Key: pm.name
                    Sort Method: quicksort  Memory: 25kB
                    Worker 0:  Sort Method: quicksort  Memory: 25kB
                    Worker 1:  Sort Method: quicksort  Memory: 25kB
                    ->  Partial HashAggregate  (cost=6806.62..6806.70 rows=6 width=50) (actual time=44.235..44.240 rows=2 loops=3)
                          Group Key: pm.name
                          Batches: 1  Memory Usage: 24kB
                          Worker 0:  Batches: 1  Memory Usage: 24kB
                          Worker 1:  Batches: 1  Memory Usage: 24kB
                          ->  Hash Join  (cost=579.13..6744.13 rows=8333 width=20) (actual time=2.501..40.719 rows=6667 loops=3)
                                Hash Cond: (o.payment_method_id = pm.id)
                                ->  Hash Join  (cost=578.00..6705.67 rows=8333 width=14) (actual time=1.843..38.715 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.002..12.274 rows=133333 loops=3)
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=5.507..5.508 rows=20000 loops=1)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.006..2.281 rows=20000 loops=1)
                                ->  Hash  (cost=1.06..1.06 rows=6 width=14) (actual time=0.568..0.569 rows=6 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                      ->  Seq Scan on "PaymentMethod" pm  (cost=0.00..1.06 rows=6 width=14) (actual time=0.032..0.033 rows=6 loops=3)
Planning Time: 20.556 ms
Execution Time: 376.922 ms


==================================================
EXPLAIN ANALYZE — Query 12: Średnia ocena per producent
==================================================
Sort  (cost=1367.54..1367.91 rows=150 width=57) (actual time=30.773..30.784 rows=150 loops=1)
  Sort Key: (round(avg(r.rating), 2)) DESC NULLS LAST
  Sort Method: quicksort  Memory: 32kB
  ->  HashAggregate  (cost=1359.87..1362.12 rows=150 width=57) (actual time=30.036..30.100 rows=150 loops=1)
        Group Key: m.name
        Batches: 1  Memory Usage: 64kB
        ->  Hash Join  (cost=693.38..1259.87 rows=20000 width=29) (actual time=5.947..23.565 rows=27388 loops=1)
              Hash Cond: (p.manufacturer_id = m.id)
              ->  Hash Right Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=5.878..18.116 rows=27388 loops=1)
                    Hash Cond: (r.product_id = p.id)
                    ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=0.009..2.789 rows=20000 loops=1)
                    ->  Hash  (cost=438.00..438.00 rows=20000 width=8) (actual time=5.274..5.275 rows=20000 loops=1)
                          Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                          ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=8) (actual time=0.005..2.252 rows=20000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.056..0.056 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 18kB
                    ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.015..0.031 rows=150 loops=1)
Planning Time: 7.326 ms
Execution Time: 31.463 ms


==================================================
EXPLAIN ANALYZE — Query 13: Aktywne promocje i objęta nimi liczba wariantów
==================================================
Sort  (cost=395.64..395.76 rows=47 width=14) (actual time=4.285..4.289 rows=46 loops=1)
  Sort Key: (count(v.id)) DESC
  Sort Method: quicksort  Memory: 26kB
  ->  HashAggregate  (cost=393.87..394.34 rows=47 width=14) (actual time=4.264..4.272 rows=46 loops=1)
        Group Key: pr.name
        Batches: 1  Memory Usage: 24kB
        ->  Merge Join  (cost=7.63..337.47 rows=11280 width=10) (actual time=0.077..3.944 rows=1340 loops=1)
              Merge Cond: (v.promotion_id = pr.id)
              ->  Index Scan using idx_variant_promotion on "Variant" v  (cost=0.29..2469.28 rows=47000 width=8) (actual time=0.021..3.073 rows=5685 loops=1)
              ->  Sort  (cost=7.34..7.46 rows=48 width=10) (actual time=0.051..0.056 rows=47 loops=1)
                    Sort Key: pr.id
                    Sort Method: quicksort  Memory: 26kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=48 width=10) (actual time=0.016..0.039 rows=47 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 153
Planning Time: 11.183 ms
Execution Time: 4.371 ms


==================================================
EXPLAIN ANALYZE — Query 14: Najczęściej wybierane warianty w koszykach
==================================================
Limit  (cost=224158.84..224158.87 rows=10 width=44) (actual time=8994.513..8994.518 rows=10 loops=1)
  ->  Sort  (cost=224158.84..227908.84 rows=1500000 width=44) (actual time=8994.512..8994.513 rows=10 loops=1)
        Sort Key: (sum(ci.quantity)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  GroupAggregate  (cost=4.24..191744.38 rows=1500000 width=44) (actual time=86.534..8974.120 rows=47000 loops=1)
              Group Key: v.sku, p.name
              ->  Incremental Sort  (cost=4.24..165494.38 rows=1500000 width=40) (actual time=42.579..8664.174 rows=1500000 loops=1)
                    Sort Key: v.sku, p.name
                    Presorted Key: v.sku
                    Full-sort Groups: 31708  Sort Method: quicksort  Average Memory: 27kB  Peak Memory: 27kB
                    Pre-sorted Groups: 6442  Sort Method: quicksort  Average Memory: 26kB  Peak Memory: 26kB
                    ->  Nested Loop  (cost=1.14..108333.20 rows=1500000 width=40) (actual time=5.763..8128.469 rows=1500000 loops=1)
                          ->  Nested Loop  (cost=0.71..8804.70 rows=47000 width=40) (actual time=4.213..238.773 rows=47000 loops=1)
                                ->  Index Scan using "Variant_sku_key" on "Variant" v  (cost=0.41..2051.42 rows=47000 width=31) (actual time=4.175..45.436 rows=47000 loops=1)
                                ->  Memoize  (cost=0.30..0.34 rows=1 width=17) (actual time=0.003..0.003 rows=1 loops=47000)
                                      Cache Key: v.product_id
                                      Cache Mode: logical
                                      Hits: 28889  Misses: 18111  Evictions: 0  Overflows: 0  Memory Usage: 2099kB
                                      ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=17) (actual time=0.004..0.004 rows=1 loops=18111)
                                            Index Cond: (id = v.product_id)
                          ->  Index Scan using idx_cartitem_variant_id on "CartItem" ci  (cost=0.43..1.80 rows=32 width=8) (actual time=0.009..0.163 rows=32 loops=47000)
                                Index Cond: (variant_id = v.id)
Planning Time: 15.122 ms
Execution Time: 8996.381 ms


==================================================
EXPLAIN ANALYZE — Query 15: Produkty z Największą Różnicą Między Ceną Podstawową a Ceną Wariantu
==================================================
Limit  (cost=2813.55..2813.58 rows=10 width=80) (actual time=49.054..49.849 rows=10 loops=1)
  ->  Sort  (cost=2813.55..2931.05 rows=47000 width=80) (actual time=49.052..49.055 rows=10 loops=1)
        Sort Key: v.price_modifier DESC
        Sort Method: top-N heapsort  Memory: 27kB
        ->  Hash Join  (cost=688.00..1797.90 rows=47000 width=80) (actual time=8.512..34.133 rows=47000 loops=1)
              Hash Cond: (v.product_id = p.id)
              ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=33) (actual time=1.502..4.856 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=6.367..6.368 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1381kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.012..2.678 rows=20000 loops=1)
Planning Time: 20.030 ms
Execution Time: 51.633 ms


==================================================
EXPLAIN ANALYZE — Query 16: Konwersja zamówień wg statusu
==================================================
Sort  (cost=7957.56..7962.66 rows=2040 width=48) (actual time=363.465..925.899 rows=7 loops=1)
  Sort Key: (count(o.id)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  WindowAgg  (cost=7824.99..7845.41 rows=2040 width=48) (actual time=363.443..924.865 rows=7 loops=1)
        ->  Finalize HashAggregate  (cost=7779.11..7799.51 rows=2040 width=16) (actual time=357.571..919.007 rows=7 loops=1)
              Group Key: s.name
              Batches: 1  Memory Usage: 121kB
              ->  Gather  (cost=7330.31..7758.71 rows=4080 width=16) (actual time=230.397..915.945 rows=7 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=6330.31..6350.71 rows=2040 width=16) (actual time=71.770..72.151 rows=2 loops=3)
                          Group Key: s.name
                          Batches: 1  Memory Usage: 121kB
                          Worker 0:  Batches: 1  Memory Usage: 121kB
                          Worker 1:  Batches: 1  Memory Usage: 121kB
                          ->  Hash Join  (cost=55.90..5496.98 rows=166667 width=12) (actual time=0.372..44.764 rows=133333 loops=3)
                                Hash Cond: (o.status_id = s.id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.004..12.833 rows=133333 loops=3)
                                ->  Hash  (cost=30.40..30.40 rows=2040 width=12) (actual time=0.029..0.030 rows=7 loops=1)
                                      Buckets: 2048  Batches: 1  Memory Usage: 17kB
                                      ->  Seq Scan on "Status" s  (cost=0.00..30.40 rows=2040 width=12) (actual time=0.022..0.024 rows=7 loops=1)
Planning Time: 29.652 ms
Execution Time: 932.560 ms


==================================================
EXPLAIN ANALYZE — Query 17: Top klienci wg wydatków
==================================================
Limit  (cost=15399.41..15399.44 rows=10 width=50) (actual time=4108.329..4225.848 rows=10 loops=1)
  ->  Sort  (cost=15399.41..15449.41 rows=20000 width=50) (actual time=4108.328..4225.274 rows=10 loops=1)
        Sort Key: (sum(oi.unit_price)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=14717.22..14967.22 rows=20000 width=50) (actual time=4072.982..4214.392 rows=19296 loops=1)
              Group Key: u.id
              Batches: 5  Memory Usage: 8241kB  Disk Usage: 224kB
              ->  Gather  (cost=12821.46..14592.22 rows=16666 width=50) (actual time=3479.309..3721.689 rows=19427 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=11821.46..11925.62 rows=8333 width=50) (actual time=3324.313..3369.841 rows=6476 loops=3)
                          Group Key: u.id
                          Batches: 1  Memory Usage: 3217kB
                          Worker 0:  Batches: 1  Memory Usage: 2961kB
                          Worker 1:  Batches: 1  Memory Usage: 2961kB
                          ->  Nested Loop  (cost=578.42..11779.80 rows=8333 width=24) (actual time=30.127..3253.587 rows=6667 loops=3)
                                ->  Hash Join  (cost=578.00..6705.67 rows=8333 width=10) (actual time=8.973..243.228 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.008..174.379 rows=133333 loops=3)
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=8.695..9.809 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.321..3.884 rows=20000 loops=3)
                                ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.449..0.449 rows=1 loops=20000)
                                      Index Cond: (id = o.user_id)
Planning Time: 26.692 ms
Execution Time: 4245.675 ms


==================================================
EXPLAIN ANALYZE — Query 18: Produkty z wariantami objętymi promocją, z końcową ceną
==================================================
Sort  (cost=1983.52..2011.72 rows=11280 width=132) (actual time=51.874..52.536 rows=1340 loops=1)
  Sort Key: (round(((p.price + v.price_modifier) * ('1'::numeric - pr.discount_percentage)), 2))
  Sort Method: quicksort  Memory: 146kB
  ->  Hash Join  (cost=695.63..1224.29 rows=11280 width=132) (actual time=28.398..47.576 rows=1340 loops=1)
        Hash Cond: (v.product_id = p.id)
        ->  Merge Join  (cost=7.63..337.47 rows=11280 width=39) (actual time=0.734..18.227 rows=1340 loops=1)
              Merge Cond: (v.promotion_id = pr.id)
              ->  Index Scan using idx_variant_promotion on "Variant" v  (cost=0.29..2469.28 rows=47000 width=37) (actual time=0.022..16.595 rows=5685 loops=1)
              ->  Sort  (cost=7.34..7.46 rows=48 width=10) (actual time=0.707..0.717 rows=47 loops=1)
                    Sort Key: pr.id
                    Sort Method: quicksort  Memory: 26kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=48 width=10) (actual time=0.032..0.055 rows=47 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 153
        ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=27.082..27.084 rows=20000 loops=1)
              Buckets: 32768  Batches: 1  Memory Usage: 1381kB
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.704..20.522 rows=20000 loops=1)
Planning Time: 42.227 ms
Execution Time: 54.510 ms


==================================================
EXPLAIN ANALYZE — Query 19: Użytkownicy, Którzy Dodali Produkt do Koszyka, Ale Nie Złożyli Zamówienia (Potencjał Odbudowy Koszyka)
==================================================
Hash Join  (cost=45873.97..103632.31 rows=1070130 width=55) (actual time=3331.675..9809.554 rows=1005006 loops=1)
  Hash Cond: (v.product_id = p.id)
  ->  Hash Join  (cost=45185.97..100134.62 rows=1070130 width=46) (actual time=3321.082..9224.065 rows=1005006 loops=1)
        Hash Cond: (ci.variant_id = v.id)
        ->  Hash Join  (cost=43729.47..95868.77 rows=1070130 width=46) (actual time=3304.059..8558.012 rows=1005006 loops=1)
              Hash Cond: (ci.cart_id = c.id)
              ->  Seq Scan on "CartItem" ci  (cost=0.00..23152.00 rows=1500000 width=8) (actual time=0.037..4217.547 rows=1500000 loops=1)
              ->  Hash  (cost=41450.81..41450.81 rows=107013 width=46) (actual time=3297.671..3318.009 rows=100414 loops=1)
                    Buckets: 131072  Batches: 2  Memory Usage: 4929kB
                    ->  Gather  (cost=25017.67..41450.81 rows=107013 width=46) (actual time=3068.307..3136.737 rows=100414 loops=1)
                          Workers Planned: 2
                          Workers Launched: 2
                          ->  Parallel Hash Right Anti Join  (cost=24017.67..29749.51 rows=44589 width=46) (actual time=2559.113..2574.144 rows=33471 loops=3)
                                Hash Cond: (o.user_id = u.id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=4) (actual time=20.787..586.575 rows=133333 loops=3)
                                ->  Parallel Hash  (cost=23236.42..23236.42 rows=62500 width=50) (actual time=1740.294..1741.023 rows=50000 loops=3)
                                      Buckets: 262144  Batches: 1  Memory Usage: 14720kB
                                      ->  Hash Join  (cost=4079.00..23236.42 rows=62500 width=50) (actual time=208.867..1573.511 rows=50000 loops=3)
                                            Hash Cond: (u.id = c.user_id)
                                            ->  Parallel Seq Scan on "User" u  (cost=0.00..18063.67 rows=416667 width=46) (actual time=1.066..1121.412 rows=333333 loops=3)
                                            ->  Hash  (cost=2204.00..2204.00 rows=150000 width=8) (actual time=197.138..197.139 rows=150000 loops=3)
                                                  Buckets: 262144  Batches: 1  Memory Usage: 7908kB
                                                  ->  Seq Scan on "Cart" c  (cost=0.00..2204.00 rows=150000 width=8) (actual time=16.244..106.766 rows=150000 loops=3)
        ->  Hash  (cost=869.00..869.00 rows=47000 width=8) (actual time=15.223..15.808 rows=47000 loops=1)
              Buckets: 65536  Batches: 1  Memory Usage: 2348kB
              ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=8) (actual time=0.013..5.143 rows=47000 loops=1)
  ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=7.042..7.043 rows=20000 loops=1)
        Buckets: 32768  Batches: 1  Memory Usage: 1245kB
        ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=1.414..3.757 rows=20000 loops=1)
Planning Time: 79.565 ms
Execution Time: 9884.859 ms


==================================================
EXPLAIN ANALYZE — Query 20: Wyszukiwanie produktów po nazwie lub opisie (parametryzowane)
==================================================
Bitmap Heap Scan on "Product"  (cost=43.00..57.51 rows=4 width=60) (actual time=9.849..30.721 rows=143 loops=1)
  Recheck Cond: (((name)::text ~~* '%test%'::text) OR (description ~~* '%test%'::text))
  Heap Blocks: exact=106
  ->  BitmapOr  (cost=43.00..43.00 rows=4 width=0) (actual time=7.551..7.552 rows=0 loops=1)
        ->  Bitmap Index Scan on idx_product_name_trgm  (cost=0.00..21.50 rows=2 width=0) (actual time=6.821..6.821 rows=42 loops=1)
              Index Cond: ((name)::text ~~* '%test%'::text)
        ->  Bitmap Index Scan on idx_product_description_trgm  (cost=0.00..21.50 rows=2 width=0) (actual time=0.724..0.725 rows=102 loops=1)
              Index Cond: (description ~~* '%test%'::text)
Planning Time: 124.314 ms
Execution Time: 37.311 ms


==================================================
EXPLAIN ANALYZE — Query 21: Użytkownicy, Którzy Zapisali Konkretny Produkt jako Ulubiony (np. Product ID=350259)
==================================================
Nested Loop  (cost=0.85..262.23 rows=30 width=56) (actual time=3.025..15.323 rows=26 loops=1)
  ->  Index Only Scan using idx_favoriteproduct_product_user on "FavoriteProduct" fp  (cost=0.42..8.95 rows=30 width=4) (actual time=1.850..1.858 rows=26 loops=1)
        Index Cond: (product_id = 35)
        Heap Fetches: 0
  ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..8.44 rows=1 width=60) (actual time=0.517..0.517 rows=1 loops=26)
        Index Cond: (id = fp.user_id)
Planning Time: 8.656 ms
Execution Time: 15.357 ms


==================================================
EXPLAIN ANALYZE — Query 22: Znajdź Magazyny, Które Posiadają Zapasy Konkretnego Wariantu (np. SKU='VR-000000-a637d44b7afd')
==================================================
GroupAggregate  (cost=24.91..25.01 rows=2 width=25) (actual time=2.833..2.834 rows=0 loops=1)
  Group Key: w.name
  Filter: (count(si.id) > 0)
  ->  Sort  (cost=24.91..24.93 rows=5 width=21) (actual time=2.832..2.833 rows=0 loops=1)
        Sort Key: w.name
        Sort Method: quicksort  Memory: 25kB
        ->  Nested Loop  (cost=0.99..24.86 rows=5 width=21) (actual time=2.212..2.213 rows=0 loops=1)
              ->  Nested Loop  (cost=0.84..24.00 rows=5 width=8) (actual time=2.211..2.212 rows=0 loops=1)
                    ->  Index Scan using "Variant_sku_key" on "Variant" v  (cost=0.41..8.43 rows=1 width=4) (actual time=2.211..2.211 rows=0 loops=1)
                          Index Cond: ((sku)::text = 'VR-000001-2704de10f283'::text)
                    ->  Index Scan using idx_stockitem_shipment_variant_warehouse on "StockItem" si  (cost=0.42..15.52 rows=5 width=12) (never executed)
                          Index Cond: ((shipment_id IS NULL) AND (variant_id = v.id))
              ->  Index Scan using "Warehouse_pkey" on "Warehouse" w  (cost=0.15..0.17 rows=1 width=21) (never executed)
                    Index Cond: (id = si.warehouse_id)
Planning Time: 9.276 ms
Execution Time: 3.959 ms


==================================================
EXPLAIN ANALYZE — Query 23: Warianty, Które Wymagają Uzyskania Konkretnej Opcji (np. 'Kolor'='Czerwony')
==================================================
Nested Loop  (cost=6.96..680.20 rows=1 width=36) (actual time=0.030..0.031 rows=0 loops=1)
  ->  Nested Loop  (cost=6.67..679.87 rows=1 width=27) (actual time=0.029..0.030 rows=0 loops=1)
        ->  Nested Loop  (cost=6.38..679.55 rows=1 width=4) (actual time=0.029..0.030 rows=0 loops=1)
              Join Filter: (opt.attribute_id = a.id)
              ->  Index Scan using "Attribute_name_key" on "Attribute" a  (cost=0.15..8.17 rows=1 width=4) (actual time=0.029..0.029 rows=0 loops=1)
                    Index Cond: ((name)::text = 'Attr_49_Century'::text)
              ->  Nested Loop  (cost=6.23..668.26 rows=250 width=8) (never executed)
                    ->  Seq Scan on "Option" opt  (cost=0.00..18.50 rows=1 width=8) (never executed)
                          Filter: ((value)::text = 'do'::text)
                    ->  Bitmap Heap Scan on "VariantOption" vo  (cost=6.23..647.26 rows=250 width=8) (never executed)
                          Recheck Cond: (option_id = opt.id)
                          ->  Bitmap Index Scan on idx_variantoption_option_id  (cost=0.00..6.17 rows=250 width=0) (never executed)
                                Index Cond: (option_id = opt.id)
        ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.32 rows=1 width=31) (never executed)
              Index Cond: (id = vo.variant_id)
  ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=17) (never executed)
        Index Cond: (id = v.product_id)
Planning Time: 42.310 ms
Execution Time: 0.079 ms


==================================================
EXPLAIN ANALYZE — Query 24: Znajdź Zamówienia Użytkownika (np. email='debbie.lane.16786.50af0753@example.com') o Statusie 'Paid'
==================================================
Nested Loop  (cost=1.00..17.09 rows=1 width=20) (actual time=2.858..2.860 rows=0 loops=1)
  ->  Nested Loop  (cost=0.85..16.89 rows=1 width=16) (actual time=2.857..2.858 rows=0 loops=1)
        ->  Index Scan using "User_email_key" on "User" u  (cost=0.42..8.44 rows=1 width=4) (actual time=2.856..2.857 rows=0 loops=1)
              Index Cond: ((email)::text = 'debbie.lane.16786.50af0753@example.com'::text)
        ->  Index Scan using idx_order_user_id on "Order" o  (cost=0.42..8.44 rows=1 width=20) (never executed)
              Index Cond: (user_id = u.id)
  ->  Index Scan using "Status_pkey" on "Status" s  (cost=0.15..0.17 rows=1 width=12) (never executed)
        Index Cond: (id = o.status_id)
        Filter: ((name)::text = 'Paid'::text)
Planning Time: 6.810 ms
Execution Time: 2.915 ms


==================================================
EXPLAIN ANALYZE — Query 25: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
Nested Loop Left Join  (cost=5.45..49.87 rows=16 width=87) (actual time=1.184..9.546 rows=18 loops=1)
  ->  Nested Loop Left Join  (cost=5.30..46.34 rows=16 width=45) (actual time=1.138..9.328 rows=18 loops=1)
        ->  Nested Loop Left Join  (cost=5.02..41.66 rows=16 width=39) (actual time=1.070..9.047 rows=18 loops=1)
              ->  Nested Loop  (cost=4.60..23.91 rows=3 width=39) (actual time=0.045..4.015 rows=4 loops=1)
                    ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..8.30 rows=1 width=10) (actual time=0.009..0.010 rows=1 loops=1)
                          Index Cond: (id = 35)
                    ->  Bitmap Heap Scan on "Variant" v  (cost=4.31..15.57 rows=3 width=37) (actual time=0.016..3.978 rows=4 loops=1)
                          Recheck Cond: (product_id = 35)
                          Heap Blocks: exact=4
                          ->  Bitmap Index Scan on idx_variant_product_id  (cost=0.00..4.31 rows=3 width=0) (actual time=0.007..0.007 rows=4 loops=1)
                                Index Cond: (product_id = 35)
              ->  Index Only Scan using uq_varopt_variant_option on "VariantOption" vo  (cost=0.42..5.86 rows=6 width=8) (actual time=1.247..1.250 rows=4 loops=4)
                    Index Cond: (variant_id = v.id)
                    Heap Fetches: 0
        ->  Index Scan using "Option_pkey" on "Option" opt  (cost=0.28..0.29 rows=1 width=14) (actual time=0.013..0.013 rows=1 loops=18)
              Index Cond: (id = vo.option_id)
  ->  Index Scan using "Attribute_pkey" on "Attribute" a  (cost=0.15..0.22 rows=1 width=18) (actual time=0.007..0.007 rows=1 loops=18)
        Index Cond: (id = opt.attribute_id)
Planning Time: 0.685 ms
Execution Time: 9.609 ms


==================================================
EXPLAIN ANALYZE — Query 26: Lista Wszystkich Dziecięcych Kategorii (Podkategorii) dla Konkretnej Kategorii Nadrzędnej (np. ID=5)
==================================================
Seq Scan on "Category"  (cost=0.00..3.88 rows=3 width=12) (actual time=0.662..1.293 rows=3 loops=1)
  Filter: (parent_id = 5)
  Rows Removed by Filter: 147
Planning Time: 1.481 ms
Execution Time: 1.313 ms


==================================================
EXPLAIN ANALYZE — Query 27: Porównanie Średniej Oceny dla Promowanych i Niepromowanych Produktów
==================================================
HashAggregate  (cost=87850.51..87853.01 rows=200 width=64) (actual time=139.616..139.621 rows=2 loops=1)
  Group Key: CASE WHEN (ANY (p.id = (hashed SubPlan 2).col1)) THEN 'Promowany'::text ELSE 'Niepromowany'::text END
  Batches: 1  Memory Usage: 40kB
  ->  HashAggregate  (cost=1300.51..87550.51 rows=20000 width=68) (actual time=129.961..136.658 rows=12612 loops=1)
        Group Key: p.id
        Batches: 1  Memory Usage: 2577kB
        ->  Hash Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=62.447..111.066 rows=20000 loops=1)
              Hash Cond: (r.product_id = p.id)
              ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=1.892..42.623 rows=20000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=60.394..60.395 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 960kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.009..54.816 rows=20000 loops=1)
        SubPlan 2
          ->  Index Only Scan using idx_variant_product_promotion on "Variant" v2  (cost=0.28..158.09 rows=5739 width=4) (actual time=3.510..8.964 rows=5684 loops=1)
                Heap Fetches: 0
Planning Time: 7.825 ms
Execution Time: 141.728 ms


==================================================
EXPLAIN ANALYZE — Query 28: Top 5 Miast Generujących Największy Przychód (Wg. Adresu Wysyłki)
==================================================
Limit  (cost=15315.16..15315.17 rows=5 width=45) (actual time=4117.827..4178.008 rows=5 loops=1)
  ->  Sort  (cost=15315.16..15365.16 rows=20000 width=45) (actual time=4116.931..4175.796 rows=5 loops=1)
        Sort Key: (sum(oi.unit_price)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=14732.97..14982.97 rows=20000 width=45) (actual time=4106.288..4170.569 rows=12950 loops=1)
              Group Key: a.city
              Batches: 1  Memory Usage: 5905kB
              ->  Gather  (cost=12837.21..14607.97 rows=16666 width=45) (actual time=3928.121..4019.235 rows=16148 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=11837.21..11941.37 rows=8333 width=45) (actual time=3821.978..3826.050 rows=5383 loops=3)
                          Group Key: a.city
                          Batches: 1  Memory Usage: 2449kB
                          Worker 0:  Batches: 1  Memory Usage: 2449kB
                          Worker 1:  Batches: 1  Memory Usage: 2449kB
                          ->  Nested Loop  (cost=578.43..11795.55 rows=8333 width=19) (actual time=17.603..3741.603 rows=6667 loops=3)
                                ->  Hash Join  (cost=578.00..6705.67 rows=8333 width=10) (actual time=15.779..207.059 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.007..100.348 rows=133333 loops=3)
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=15.491..15.497 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.718..11.164 rows=20000 loops=3)
                                ->  Index Scan using "Address_pkey" on "Address" a  (cost=0.43..0.61 rows=1 width=17) (actual time=0.526..0.526 rows=1 loops=20000)
                                      Index Cond: (id = o.shipping_address_id)
Planning Time: 27.573 ms
Execution Time: 4190.660 ms


==================================================
EXPLAIN ANALYZE — Query 29: Porównanie Wolumenu Sprzedaży Produktów Promowanych vs. Niepromowanych (w Ostatnich 30 Dniach)
==================================================
Finalize GroupAggregate  (cost=6359.26..6415.06 rows=200 width=40) (actual time=928.005..1079.722 rows=2 loops=1)
  Group Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
  ->  Gather Merge  (cost=6359.26..6411.06 rows=400 width=40) (actual time=927.068..1079.698 rows=6 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=5359.24..5364.87 rows=200 width=40) (actual time=586.508..587.461 rows=2 loops=3)
              Group Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
              ->  Sort  (cost=5359.24..5360.45 rows=484 width=32) (actual time=585.562..586.085 rows=392 loops=3)
                    Sort Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
                    Sort Method: quicksort  Memory: 25kB
                    Worker 0:  Sort Method: quicksort  Memory: 25kB
                    Worker 1:  Sort Method: quicksort  Memory: 25kB
                    ->  Nested Loop  (cost=1015.04..5337.66 rows=484 width=32) (actual time=24.875..559.412 rows=392 loops=3)
                          ->  Nested Loop  (cost=1014.75..5185.62 rows=484 width=4) (actual time=23.751..497.553 rows=392 loops=3)
                                ->  Hash Join  (cost=1014.33..4584.88 rows=484 width=4) (actual time=19.760..41.088 rows=392 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Bitmap Heap Scan on "Order" o  (cost=436.33..3941.59 rows=9672 width=4) (actual time=6.882..24.478 rows=7838 loops=3)
                                            Recheck Cond: (order_date >= (now() - '30 days'::interval))
                                            Heap Blocks: exact=1597
                                            ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..430.52 rows=23213 width=0) (actual time=11.119..11.120 rows=23513 loops=1)
                                                  Index Cond: (order_date >= (now() - '30 days'::interval))
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=8) (actual time=11.324..11.812 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=8) (actual time=4.459..6.693 rows=20000 loops=3)
                                ->  Index Scan using "StockItem_pkey" on "StockItem" si  (cost=0.42..1.24 rows=1 width=8) (actual time=1.162..1.162 rows=1 loops=1177)
                                      Index Cond: (id = oi.stock_item_id)
                          ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.31 rows=1 width=8) (actual time=0.155..0.155 rows=1 loops=1177)
                                Index Cond: (id = si.variant_id)
Planning Time: 38.342 ms
Execution Time: 1093.789 ms


==================================================
EXPLAIN ANALYZE — Query 30: Wskaźnik Lojalności (Repeat Purchase Rate) Użytkowników z Podziałem na Miasto Adresu Rozliczeniowego
==================================================
Sort  (cost=68134.41..68209.82 rows=30162 width=61) (actual time=4498.312..4517.645 rows=66456 loops=1)
  Sort Key: (round((((count(*) FILTER (WHERE (u.orders_count > 1)))::numeric * 100.0) / (NULLIF(count(*), 0))::numeric), 2)) DESC
  Sort Method: external merge  Disk: 3192kB
  ->  Finalize HashAggregate  (cost=65136.24..65890.29 rows=30162 width=61) (actual time=4321.424..4381.232 rows=66456 loops=1)
        Group Key: a.city
        Batches: 5  Memory Usage: 8241kB  Disk Usage: 712kB
        ->  Gather  (cost=58349.79..64683.81 rows=60324 width=29) (actual time=3766.875..3921.034 rows=122294 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial HashAggregate  (cost=57349.79..57651.41 rows=30162 width=29) (actual time=3599.874..3638.830 rows=40765 loops=3)
                    Group Key: a.city
                    Batches: 1  Memory Usage: 5137kB
                    Worker 0:  Batches: 1  Memory Usage: 5137kB
                    Worker 1:  Batches: 1  Memory Usage: 5137kB
                    ->  Parallel Hash Join  (cost=34825.67..55683.12 rows=166667 width=21) (actual time=1189.692..3379.966 rows=133333 loops=3)
                          Hash Cond: (a.id = o.billing_address_id)
                          ->  Parallel Seq Scan on "Address" a  (cost=0.00..18288.00 rows=500000 width=17) (actual time=5.379..1410.536 rows=400000 loops=3)
                          ->  Parallel Hash  (cost=32742.34..32742.34 rows=166667 width=12) (actual time=1180.213..1182.189 rows=133333 loops=3)
                                Buckets: 524288  Batches: 1  Memory Usage: 22912kB
                                ->  Hash Join  (cost=24598.16..32742.34 rows=166667 width=12) (actual time=543.894..912.600 rows=133333 loops=3)
                                      Hash Cond: (o.user_id = u.user_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=2.787..101.174 rows=133333 loops=3)
                                      ->  Hash  (cost=19615.94..19615.94 rows=286577 width=12) (actual time=460.135..460.856 rows=329619 loops=3)
                                            Buckets: 262144  Batches: 4  Memory Usage: 5596kB
                                            ->  Subquery Scan on u  (cost=0.42..19615.94 rows=286577 width=12) (actual time=14.492..327.840 rows=329619 loops=3)
                                                  ->  GroupAggregate  (cost=0.42..16750.17 rows=286577 width=12) (actual time=14.489..294.981 rows=329619 loops=3)
                                                        Group Key: "Order".user_id
                                                        ->  Index Only Scan using idx_order_user_id on "Order"  (cost=0.42..11884.40 rows=400000 width=4) (actual time=13.107..201.968 rows=400000 loops=3)
                                                              Heap Fetches: 150240
Planning Time: 11.447 ms
Execution Time: 4624.068 ms

FINISHED — 2025-11-22 17:25:56.736905
========================================================================================================================
========================================================================================================================
START EXPLAIN RUN — 2025-11-22 18:14:12.149817
========================================================================================================================


==================================================
EXPLAIN ANALYZE — Query 1: Średnia Wartość Zamówienia (AOV) w Ostatnim Miesiącu
==================================================
Aggregate  (cost=4969.13..4969.14 rows=1 width=32) (actual time=167.839..168.849 rows=1 loops=1)
  ->  HashAggregate  (cost=4938.03..4953.58 rows=1244 width=36) (actual time=167.346..167.743 rows=1212 loops=1)
        Group Key: o.id
        Batches: 1  Memory Usage: 577kB
        ->  Hash Join  (cost=4551.31..4931.81 rows=1244 width=10) (actual time=159.128..164.454 rows=1240 loops=1)
              Hash Cond: (oi.order_id = o.id)
              ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.015..1.456 rows=20000 loops=1)
              ->  Hash  (cost=4240.42..4240.42 rows=24871 width=4) (actual time=158.817..158.818 rows=24588 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1121kB
                    ->  Bitmap Heap Scan on "Order" o  (cost=469.18..4240.42 rows=24871 width=4) (actual time=51.096..152.019 rows=24588 loops=1)
                          Recheck Cond: (order_date >= (now() - '1 mon'::interval))
                          Heap Blocks: exact=3333
                          ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..462.96 rows=24871 width=0) (actual time=50.706..50.706 rows=24588 loops=1)
                                Index Cond: (order_date >= (now() - '1 mon'::interval))
Planning Time: 47.018 ms
Execution Time: 170.109 ms


==================================================
EXPLAIN ANALYZE — Query 2: Średnia wartość zamówienia per użytkownik
==================================================
Sort  (cost=16066.87..16115.61 rows=19495 width=50) (actual time=5228.640..5234.819 rows=19296 loops=1)
  Sort Key: (round(avg(order_totals.total_price), 2)) DESC
  Sort Method: quicksort  Memory: 1612kB
  ->  Finalize HashAggregate  (cost=14385.35..14677.77 rows=19495 width=50) (actual time=5200.542..5216.910 rows=19296 loops=1)
        Group Key: u.id
        Batches: 5  Memory Usage: 8241kB  Disk Usage: 224kB
        ->  Gather  (cost=12537.36..14263.50 rows=16246 width=50) (actual time=4814.508..5005.259 rows=19432 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial HashAggregate  (cost=11537.36..11638.90 rows=8123 width=50) (actual time=4565.617..4644.155 rows=6477 loops=3)
                    Group Key: u.id
                    Batches: 1  Memory Usage: 3217kB
                    Worker 0:  Batches: 1  Memory Usage: 3217kB
                    Worker 1:  Batches: 1  Memory Usage: 2961kB
                    ->  Nested Loop  (cost=1110.75..11496.75 rows=8123 width=50) (actual time=337.868..4507.601 rows=6498 loops=3)
                          ->  Hash Join  (cost=1110.33..6550.49 rows=8123 width=36) (actual time=279.617..390.948 rows=6498 loops=3)
                                Hash Cond: (o.id = order_totals.order_id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.010..40.711 rows=133333 loops=3)
                                ->  Hash  (cost=866.64..866.64 rows=19495 width=36) (actual time=277.726..278.135 rows=19495 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1094kB
                                      ->  Subquery Scan on order_totals  (cost=428.00..866.64 rows=19495 width=36) (actual time=262.270..272.358 rows=19495 loops=3)
                                            ->  HashAggregate  (cost=428.00..671.69 rows=19495 width=36) (actual time=262.269..270.158 rows=19495 loops=3)
                                                  Group Key: oi.order_id
                                                  Batches: 1  Memory Usage: 7953kB
                                                  Worker 0:  Batches: 1  Memory Usage: 7953kB
                                                  Worker 1:  Batches: 1  Memory Usage: 7953kB
                                                  ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=2.796..68.368 rows=20000 loops=3)
                          ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.626..0.626 rows=1 loops=19495)
                                Index Cond: (id = o.user_id)
Planning Time: 33.389 ms
Execution Time: 5270.811 ms


==================================================
EXPLAIN ANALYZE — Query 3: Top 10 Najlepiej Sprzedających Się Produktów (wg. Ilości Sprzedanych Jednostek) w Ostatnim Kwartale
==================================================
Limit  (cost=11770.27..11770.29 rows=10 width=46) (actual time=1512.155..1661.370 rows=10 loops=1)
  ->  Sort  (cost=11770.27..11781.74 rows=4589 width=46) (actual time=1512.147..1660.724 rows=10 loops=1)
        Sort Key: (count(*)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=11625.21..11671.10 rows=4589 width=46) (actual time=1508.616..1658.161 rows=3925 loops=1)
              Group Key: p.name, m.name
              Batches: 1  Memory Usage: 721kB
              ->  Gather  (cost=11195.01..11596.53 rows=3824 width=46) (actual time=1428.475..1653.584 rows=4337 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=10195.01..10214.13 rows=1912 width=46) (actual time=1339.339..1340.344 rows=1446 loops=3)
                          Group Key: p.name, m.name
                          Batches: 1  Memory Usage: 369kB
                          Worker 0:  Batches: 1  Memory Usage: 369kB
                          Worker 1:  Batches: 1  Memory Usage: 369kB
                          ->  Hash Join  (cost=2308.14..10180.67 rows=1912 width=38) (actual time=43.961..1333.232 rows=1520 loops=3)
                                Hash Cond: (p.manufacturer_id = m.id)
                                ->  Nested Loop  (cost=2302.77..10170.13 rows=1912 width=17) (actual time=43.106..1330.762 rows=1520 loops=3)
                                      ->  Nested Loop  (cost=2302.48..9538.97 rows=1912 width=4) (actual time=41.828..1240.825 rows=1520 loops=3)
                                            ->  Nested Loop  (cost=2302.19..8938.36 rows=1912 width=4) (actual time=40.820..1151.784 rows=1520 loops=3)
                                                  ->  Hash Join  (cost=2301.77..6565.19 rows=1912 width=4) (actual time=36.294..94.218 rows=1520 loops=3)
                                                        Hash Cond: (o.id = oi.order_id)
                                                        ->  Parallel Bitmap Heap Scan on "Order" o  (cost=1723.77..5729.04 rows=38244 width=4) (actual time=24.091..71.657 rows=30413 loops=3)
                                                              Recheck Cond: (order_date >= (now() - '3 mons'::interval))
                                                              Heap Blocks: exact=1078
                                                              ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..1700.82 rows=91786 width=0) (actual time=71.710..71.711 rows=91239 loops=1)
                                                                    Index Cond: (order_date >= (now() - '3 mons'::interval))
                                                        ->  Hash  (cost=328.00..328.00 rows=20000 width=8) (actual time=9.438..9.439 rows=20000 loops=3)
                                                              Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                                                              ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=8) (actual time=0.382..5.191 rows=20000 loops=3)
                                                  ->  Index Scan using "StockItem_pkey" on "StockItem" si  (cost=0.42..1.24 rows=1 width=8) (actual time=0.695..0.695 rows=1 loops=4561)
                                                        Index Cond: (id = oi.stock_item_id)
                                            ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.31 rows=1 width=8) (actual time=0.057..0.057 rows=1 loops=4561)
                                                  Index Cond: (id = si.variant_id)
                                      ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=21) (actual time=0.058..0.058 rows=1 loops=4561)
                                            Index Cond: (id = v.product_id)
                                ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.630..0.630 rows=150 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 18kB
                                      ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.035..0.053 rows=150 loops=3)
Planning Time: 73.366 ms
Execution Time: 1674.160 ms


==================================================
EXPLAIN ANALYZE — Query 4: Top 5 produktów z najwięcej recenzjami
==================================================
Limit  (cost=1792.59..1792.61 rows=5 width=25) (actual time=129.848..130.716 rows=5 loops=1)
  ->  Sort  (cost=1792.59..1842.59 rows=20000 width=25) (actual time=129.847..129.851 rows=5 loops=1)
        Sort Key: (COALESCE(r.count, '0'::bigint)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Hash Left Join  (cost=969.89..1460.40 rows=20000 width=25) (actual time=118.907..126.128 rows=20000 loops=1)
              Hash Cond: (p.id = r.product_id)
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.011..1.526 rows=20000 loops=1)
              ->  Hash  (cost=812.24..812.24 rows=12612 width=12) (actual time=118.885..118.887 rows=12612 loops=1)
                    Buckets: 16384  Batches: 1  Memory Usage: 670kB
                    ->  Subquery Scan on r  (cost=560.00..812.24 rows=12612 width=12) (actual time=112.452..116.168 rows=12612 loops=1)
                          ->  HashAggregate  (cost=560.00..686.12 rows=12612 width=12) (actual time=112.451..114.974 rows=12612 loops=1)
                                Group Key: "Review".product_id
                                Batches: 1  Memory Usage: 1425kB
                                ->  Seq Scan on "Review"  (cost=0.00..460.00 rows=20000 width=4) (actual time=1.226..105.813 rows=20000 loops=1)
Planning Time: 7.890 ms
Execution Time: 133.458 ms


==================================================
EXPLAIN ANALYZE — Query 5: Całkowity Przychód Pogrupowany Miesięcznie za Ostatni Rok
==================================================
Finalize GroupAggregate  (cost=9617.65..11883.29 rows=17380 width=36) (actual time=204.182..302.735 rows=11 loops=1)
  Group Key: ((date_trunc('month'::text, o.order_date))::date)
  ->  Gather Merge  (cost=9617.65..11470.51 rows=14484 width=36) (actual time=203.658..301.594 rows=11 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=8617.62..8798.67 rows=7242 width=36) (actual time=69.342..70.742 rows=4 loops=3)
              Group Key: ((date_trunc('month'::text, o.order_date))::date)
              ->  Sort  (cost=8617.62..8635.73 rows=7242 width=10) (actual time=68.679..69.274 rows=5760 loops=3)
                    Sort Key: ((date_trunc('month'::text, o.order_date))::date) DESC
                    Sort Method: quicksort  Memory: 1309kB
                    Worker 0:  Sort Method: quicksort  Memory: 25kB
                    Worker 1:  Sort Method: quicksort  Memory: 25kB
                    ->  Parallel Hash Join  (cost=681.00..8153.33 rows=7242 width=10) (actual time=6.904..66.074 rows=5760 loops=3)
                          Hash Cond: (o.id = oi.order_id)
                          ->  Parallel Seq Scan on "Order" o  (cost=0.00..6669.33 rows=144838 width=12) (actual time=2.188..122.336 rows=347315 loops=1)
                                Filter: (order_date >= (date_trunc('year'::text, now()) - '00:00:00'::interval))
                                Rows Removed by Filter: 52685
                          ->  Parallel Hash  (cost=533.93..533.93 rows=11765 width=10) (actual time=5.726..5.727 rows=6667 loops=3)
                                Buckets: 32768  Batches: 1  Memory Usage: 1216kB
                                ->  Parallel Index Only Scan using idx_orderitem_order_price_cover on "OrderItem" oi  (cost=0.29..533.93 rows=11765 width=10) (actual time=0.025..6.039 rows=20000 loops=1)
                                      Heap Fetches: 0
Planning Time: 11.226 ms
Execution Time: 307.072 ms


==================================================
EXPLAIN ANALYZE — Query 6: Produkty najczęściej dodawane do ulubionych
==================================================
Limit  (cost=14382.58..14382.60 rows=10 width=25) (actual time=1006.300..1126.034 rows=10 loops=1)
  ->  Sort  (cost=14382.58..14432.58 rows=20000 width=25) (actual time=1006.293..1126.022 rows=10 loops=1)
        Sort Key: (count(f.id)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=13750.38..13950.38 rows=20000 width=25) (actual time=998.580..1121.357 rows=20000 loops=1)
              Group Key: p.id
              Batches: 1  Memory Usage: 2577kB
              ->  Gather  (cost=9350.38..13550.38 rows=40000 width=25) (actual time=884.120..1051.973 rows=59995 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=8350.38..8550.38 rows=20000 width=25) (actual time=796.271..801.998 rows=19998 loops=3)
                          Group Key: p.id
                          Batches: 1  Memory Usage: 2577kB
                          Worker 0:  Batches: 1  Memory Usage: 2577kB
                          Worker 1:  Batches: 1  Memory Usage: 2577kB
                          ->  Hash Join  (cost=688.00..7100.38 rows=250000 width=21) (actual time=12.129..704.991 rows=200000 loops=3)
                                Hash Cond: (f.product_id = p.id)
                                ->  Parallel Seq Scan on "FavoriteProduct" f  (cost=0.00..5756.00 rows=250000 width=8) (actual time=4.537..609.027 rows=200000 loops=3)
                                ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=7.290..7.655 rows=20000 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1215kB
                                      ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.031..3.246 rows=20000 loops=3)
Planning Time: 19.246 ms
Execution Time: 1127.755 ms


==================================================
EXPLAIN ANALYZE — Query 7: Dostępny Stan Magazynowy Wariantów Produktu Pogrupowany po Magazynach
==================================================
GroupAggregate  (cost=37898.91..42932.68 rows=223723 width=61) (actual time=1397.206..1713.684 rows=178012 loops=1)
  Group Key: p.name, w.name, v.sku
  ->  Sort  (cost=37898.91..38458.22 rows=223723 width=57) (actual time=1391.903..1615.923 rows=223971 loops=1)
        Sort Key: p.name, w.name, v.sku
        Sort Method: external merge  Disk: 15248kB
        ->  Hash Join  (cost=2145.72..9605.61 rows=223723 width=57) (actual time=31.371..619.282 rows=223971 loops=1)
              Hash Cond: (si.warehouse_id = w.id)
              ->  Hash Join  (cost=2144.50..8768.22 rows=223723 width=44) (actual time=30.820..576.697 rows=223971 loops=1)
                    Hash Cond: (v.product_id = p.id)
                    ->  Hash Join  (cost=1456.50..7492.83 rows=223723 width=35) (actual time=24.927..487.463 rows=223971 loops=1)
                          Hash Cond: (si.variant_id = v.id)
                          ->  Seq Scan on "StockItem" si  (cost=0.00..5449.00 rows=223723 width=12) (actual time=0.017..356.486 rows=223971 loops=1)
                                Filter: (shipment_id IS NULL)
                                Rows Removed by Filter: 96029
                          ->  Hash  (cost=869.00..869.00 rows=47000 width=31) (actual time=24.889..26.145 rows=47000 loops=1)
                                Buckets: 65536  Batches: 1  Memory Usage: 3450kB
                                ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=31) (actual time=0.005..10.257 rows=47000 loops=1)
                    ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=5.883..5.884 rows=20000 loops=1)
                          Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                          ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.006..2.457 rows=20000 loops=1)
              ->  Hash  (cost=1.10..1.10 rows=10 width=21) (actual time=0.019..0.020 rows=10 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 9kB
                    ->  Seq Scan on "Warehouse" w  (cost=0.00..1.10 rows=10 width=21) (actual time=0.013..0.015 rows=10 loops=1)
Planning Time: 22.304 ms
Execution Time: 1733.074 ms


==================================================
EXPLAIN ANALYZE — Query 8: Stan magazynowy per produkt
==================================================
Sort  (cost=11498.95..11548.48 rows=19812 width=21) (actual time=308.540..310.377 rows=17916 loops=1)
  Sort Key: (count(si.id)) DESC
  Sort Method: quicksort  Memory: 1482kB
  ->  HashAggregate  (cost=9886.84..10084.96 rows=19812 width=21) (actual time=301.156..305.195 rows=17916 loops=1)
        Group Key: p.name
        Batches: 1  Memory Usage: 2065kB
        ->  Hash Join  (cost=2144.50..8768.22 rows=223723 width=17) (actual time=18.090..219.697 rows=223971 loops=1)
              Hash Cond: (v.product_id = p.id)
              ->  Hash Join  (cost=1456.50..7492.83 rows=223723 width=8) (actual time=12.323..140.412 rows=223971 loops=1)
                    Hash Cond: (si.variant_id = v.id)
                    ->  Seq Scan on "StockItem" si  (cost=0.00..5449.00 rows=223723 width=8) (actual time=0.013..36.942 rows=223971 loops=1)
                          Filter: (shipment_id IS NULL)
                          Rows Removed by Filter: 96029
                    ->  Hash  (cost=869.00..869.00 rows=47000 width=8) (actual time=12.290..12.292 rows=47000 loops=1)
                          Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                          ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=8) (actual time=0.005..5.105 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=5.756..5.757 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.017..2.437 rows=20000 loops=1)
Planning Time: 13.968 ms
Execution Time: 311.624 ms


==================================================
EXPLAIN ANALYZE — Query 9: Najpopularniejsze Kategorie (wg. Całkowitego Przychodu)
==================================================
Limit  (cost=12371.00..12371.02 rows=10 width=44) (actual time=637.088..809.452 rows=10 loops=1)
  ->  Sort  (cost=12371.00..12371.37 rows=150 width=44) (actual time=636.029..808.389 rows=10 loops=1)
        Sort Key: (sum(oi.unit_price)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize GroupAggregate  (cost=12328.63..12367.76 rows=150 width=44) (actual time=633.011..806.256 rows=150 loops=1)
              Group Key: c.name
              ->  Gather Merge  (cost=12328.63..12363.63 rows=300 width=44) (actual time=621.586..798.627 rows=450 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Sort  (cost=11328.61..11328.98 rows=150 width=44) (actual time=308.223..310.420 rows=150 loops=3)
                          Sort Key: c.name
                          Sort Method: quicksort  Memory: 39kB
                          Worker 0:  Sort Method: quicksort  Memory: 39kB
                          Worker 1:  Sort Method: quicksort  Memory: 39kB
                          ->  Partial HashAggregate  (cost=11321.31..11323.18 rows=150 width=44) (actual time=278.196..279.466 rows=150 loops=3)
                                Group Key: c.name
                                Batches: 1  Memory Usage: 96kB
                                Worker 0:  Batches: 1  Memory Usage: 96kB
                                Worker 1:  Batches: 1  Memory Usage: 96kB
                                ->  Hash Join  (cost=8362.48..11112.97 rows=41667 width=18) (actual time=102.872..259.462 rows=33334 loops=3)
                                      Hash Cond: (pc.category_id = c.id)
                                      ->  Parallel Hash Join  (cost=8357.10..10995.13 rows=41667 width=10) (actual time=94.292..242.844 rows=33334 loops=3)
                                            Hash Cond: (pc.product_id = p.id)
                                            ->  Parallel Index Only Scan using uq_prodcat_product_category on "ProductCategory" pc  (cost=0.29..2236.96 rows=41667 width=8) (actual time=45.282..178.572 rows=33333 loops=3)
                                                  Heap Fetches: 0
                                            ->  Parallel Hash  (cost=8209.75..8209.75 rows=11765 width=14) (actual time=44.784..45.474 rows=6667 loops=3)
                                                  Buckets: 32768  Batches: 1  Memory Usage: 1216kB
                                                  ->  Hash Join  (cost=2722.50..8209.75 rows=11765 width=14) (actual time=24.394..114.961 rows=20000 loops=1)
                                                        Hash Cond: (v.product_id = p.id)
                                                        ->  Hash Join  (cost=2034.50..7490.85 rows=11765 width=10) (actual time=19.037..100.852 rows=20000 loops=1)
                                                              Hash Cond: (si.variant_id = v.id)
                                                              ->  Hash Join  (cost=578.00..6003.47 rows=11765 width=10) (actual time=6.532..79.466 rows=20000 loops=1)
                                                                    Hash Cond: (si.id = oi.stock_item_id)
                                                                    ->  Parallel Seq Scan on "StockItem" si  (cost=0.00..4131.35 rows=188235 width=8) (actual time=0.005..23.167 rows=320000 loops=1)
                                                                    ->  Hash  (cost=328.00..328.00 rows=20000 width=10) (actual time=6.506..6.510 rows=20000 loops=1)
                                                                          Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                                                          ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.010..3.377 rows=20000 loops=1)
                                                              ->  Hash  (cost=869.00..869.00 rows=47000 width=8) (actual time=12.484..12.485 rows=47000 loops=1)
                                                                    Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                                                    ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=8) (actual time=0.014..5.151 rows=47000 loops=1)
                                                        ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=5.345..6.113 rows=20000 loops=1)
                                                              Buckets: 32768  Batches: 1  Memory Usage: 960kB
                                                              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.010..2.102 rows=20000 loops=1)
                                      ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=8.042..8.043 rows=150 loops=3)
                                            Buckets: 1024  Batches: 1  Memory Usage: 16kB
                                            ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=7.987..8.008 rows=150 loops=3)
Planning Time: 36.507 ms
Execution Time: 816.868 ms


==================================================
EXPLAIN ANALYZE — Query 10: Liczba produktów per kategoria
==================================================
Sort  (cost=2342.22..2342.59 rows=150 width=20) (actual time=160.172..160.187 rows=150 loops=1)
  Sort Key: (count(pc.product_id)) DESC
  Sort Method: quicksort  Memory: 30kB
  ->  HashAggregate  (cost=2335.30..2336.80 rows=150 width=20) (actual time=156.385..156.416 rows=150 loops=1)
        Group Key: c.name
        Batches: 1  Memory Usage: 48kB
        ->  Hash Right Join  (cost=5.38..1835.30 rows=100000 width=16) (actual time=4.292..133.568 rows=100000 loops=1)
              Hash Cond: (pc.category_id = c.id)
              ->  Seq Scan on "ProductCategory" pc  (cost=0.00..1560.00 rows=100000 width=8) (actual time=2.635..110.028 rows=100000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=1.647..1.648 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 16kB
                    ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=1.599..1.619 rows=150 loops=1)
Planning Time: 19.165 ms
Execution Time: 164.577 ms


==================================================
EXPLAIN ANALYZE — Query 11: Liczba zamówień per metoda płatności
==================================================
Sort  (cost=7668.83..7668.84 rows=6 width=50) (actual time=324.842..499.708 rows=6 loops=1)
  Sort Key: (sum(oi.unit_price)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  Finalize GroupAggregate  (cost=7667.15..7668.75 rows=6 width=50) (actual time=324.815..499.688 rows=6 loops=1)
        Group Key: pm.name
        ->  Gather Merge  (cost=7667.15..7668.55 rows=12 width=50) (actual time=319.173..493.040 rows=6 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Sort  (cost=6667.13..6667.15 rows=6 width=50) (actual time=64.059..64.528 rows=2 loops=3)
                    Sort Key: pm.name
                    Sort Method: quicksort  Memory: 25kB
                    Worker 0:  Sort Method: quicksort  Memory: 25kB
                    Worker 1:  Sort Method: quicksort  Memory: 25kB
                    ->  Partial HashAggregate  (cost=6666.98..6667.05 rows=6 width=50) (actual time=61.676..62.144 rows=2 loops=3)
                          Group Key: pm.name
                          Batches: 1  Memory Usage: 24kB
                          Worker 0:  Batches: 1  Memory Usage: 24kB
                          Worker 1:  Batches: 1  Memory Usage: 24kB
                          ->  Hash Join  (cost=682.13..6604.48 rows=8333 width=20) (actual time=10.406..57.874 rows=6667 loops=3)
                                Hash Cond: (o.payment_method_id = pm.id)
                                ->  Parallel Hash Join  (cost=681.00..6566.02 rows=8333 width=14) (actual time=7.111..53.208 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.007..55.443 rows=400000 loops=1)
                                      ->  Parallel Hash  (cost=533.93..533.93 rows=11765 width=10) (actual time=6.395..6.396 rows=6667 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1216kB
                                            ->  Parallel Index Only Scan using idx_orderitem_order_price_cover on "OrderItem" oi  (cost=0.29..533.93 rows=11765 width=10) (actual time=0.019..6.584 rows=20000 loops=1)
                                                  Heap Fetches: 0
                                ->  Hash  (cost=1.06..1.06 rows=6 width=14) (actual time=2.926..2.926 rows=6 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                      ->  Seq Scan on "PaymentMethod" pm  (cost=0.00..1.06 rows=6 width=14) (actual time=2.342..2.343 rows=6 loops=3)
Planning Time: 17.654 ms
Execution Time: 506.945 ms


==================================================
EXPLAIN ANALYZE — Query 12: Średnia ocena per producent
==================================================
Sort  (cost=1367.54..1367.91 rows=150 width=57) (actual time=33.008..33.024 rows=150 loops=1)
  Sort Key: (round(avg(r.rating), 2)) DESC NULLS LAST
  Sort Method: quicksort  Memory: 32kB
  ->  HashAggregate  (cost=1359.87..1362.12 rows=150 width=57) (actual time=32.877..32.940 rows=150 loops=1)
        Group Key: m.name
        Batches: 1  Memory Usage: 64kB
        ->  Hash Join  (cost=693.38..1259.87 rows=20000 width=29) (actual time=5.982..26.368 rows=27388 loops=1)
              Hash Cond: (p.manufacturer_id = m.id)
              ->  Hash Right Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=5.372..20.396 rows=27388 loops=1)
                    Hash Cond: (r.product_id = p.id)
                    ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=0.010..2.991 rows=20000 loops=1)
                    ->  Hash  (cost=438.00..438.00 rows=20000 width=8) (actual time=5.350..5.352 rows=20000 loops=1)
                          Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                          ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=8) (actual time=0.005..2.266 rows=20000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.058..0.058 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 18kB
                    ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.015..0.031 rows=150 loops=1)
Planning Time: 16.448 ms
Execution Time: 33.109 ms


==================================================
EXPLAIN ANALYZE — Query 13: Aktywne promocje i objęta nimi liczba wariantów
==================================================
Sort  (cost=392.83..392.95 rows=47 width=14) (actual time=4.185..4.189 rows=46 loops=1)
  Sort Key: (count(v.id)) DESC
  Sort Method: quicksort  Memory: 26kB
  ->  HashAggregate  (cost=391.06..391.53 rows=47 width=14) (actual time=4.163..4.172 rows=46 loops=1)
        Group Key: pr.name
        Batches: 1  Memory Usage: 24kB
        ->  Merge Join  (cost=7.63..334.66 rows=11280 width=10) (actual time=0.066..3.852 rows=1340 loops=1)
              Merge Cond: (v.promotion_id = pr.id)
              ->  Index Scan using idx_variant_promotion on "Variant" v  (cost=0.29..2469.25 rows=47000 width=8) (actual time=0.017..2.981 rows=5685 loops=1)
              ->  Sort  (cost=7.34..7.46 rows=48 width=10) (actual time=0.045..0.049 rows=47 loops=1)
                    Sort Key: pr.id
                    Sort Method: quicksort  Memory: 26kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=48 width=10) (actual time=0.011..0.034 rows=47 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 153
Planning Time: 10.505 ms
Execution Time: 4.255 ms


==================================================
EXPLAIN ANALYZE — Query 14: Najczęściej wybierane warianty w koszykach
==================================================
Limit  (cost=207261.25..207261.27 rows=10 width=44) (actual time=2963.528..2964.801 rows=10 loops=1)
  ->  Sort  (cost=207261.25..211011.25 rows=1500000 width=44) (actual time=2962.986..2962.990 rows=10 loops=1)
        Sort Key: (sum(ci.quantity)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  GroupAggregate  (cost=3.88..174846.79 rows=1500000 width=44) (actual time=14.477..2953.468 rows=47000 loops=1)
              Group Key: v.sku, p.name
              ->  Incremental Sort  (cost=3.88..148596.79 rows=1500000 width=40) (actual time=6.388..2662.561 rows=1500000 loops=1)
                    Sort Key: v.sku, p.name
                    Presorted Key: v.sku
                    Full-sort Groups: 31708  Sort Method: quicksort  Average Memory: 27kB  Peak Memory: 27kB
                    Pre-sorted Groups: 6442  Sort Method: quicksort  Average Memory: 26kB  Peak Memory: 26kB
                    ->  Nested Loop  (cost=1.14..91435.60 rows=1500000 width=40) (actual time=2.543..2202.126 rows=1500000 loops=1)
                          ->  Nested Loop  (cost=0.71..8782.60 rows=47000 width=40) (actual time=2.531..196.940 rows=47000 loops=1)
                                ->  Index Scan using "Variant_sku_key" on "Variant" v  (cost=0.41..2051.43 rows=47000 width=31) (actual time=2.487..85.244 rows=47000 loops=1)
                                ->  Memoize  (cost=0.30..0.34 rows=1 width=17) (actual time=0.002..0.002 rows=1 loops=47000)
                                      Cache Key: v.product_id
                                      Cache Mode: logical
                                      Hits: 28889  Misses: 18111  Evictions: 0  Overflows: 0  Memory Usage: 2099kB
                                      ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=17) (actual time=0.003..0.003 rows=1 loops=18111)
                                            Index Cond: (id = v.product_id)
                          ->  Index Only Scan using idx_cartitem_variant_quantity_cover on "CartItem" ci  (cost=0.43..1.43 rows=33 width=8) (actual time=0.003..0.039 rows=32 loops=47000)
                                Index Cond: (variant_id = v.id)
                                Heap Fetches: 150055
Planning Time: 13.840 ms
Execution Time: 2993.718 ms


==================================================
EXPLAIN ANALYZE — Query 15: Produkty z Największą Różnicą Między Ceną Podstawową a Ceną Wariantu
==================================================
Limit  (cost=2813.55..2813.58 rows=10 width=80) (actual time=47.062..47.066 rows=10 loops=1)
  ->  Sort  (cost=2813.55..2931.05 rows=47000 width=80) (actual time=47.061..47.063 rows=10 loops=1)
        Sort Key: v.price_modifier DESC
        Sort Method: top-N heapsort  Memory: 27kB
        ->  Hash Join  (cost=688.00..1797.90 rows=47000 width=80) (actual time=8.849..34.536 rows=47000 loops=1)
              Hash Cond: (v.product_id = p.id)
              ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=33) (actual time=1.732..5.113 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=6.321..6.321 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1381kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.015..2.700 rows=20000 loops=1)
Planning Time: 25.065 ms
Execution Time: 48.760 ms


==================================================
EXPLAIN ANALYZE — Query 16: Konwersja zamówień wg statusu
==================================================
Sort  (cost=7541.77..7541.79 rows=7 width=48) (actual time=241.661..369.560 rows=7 loops=1)
  Sort Key: (count(o.id)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  WindowAgg  (cost=7541.33..7541.67 rows=7 width=48) (actual time=241.091..369.000 rows=7 loops=1)
        ->  Finalize GroupAggregate  (cost=7539.74..7541.51 rows=7 width=16) (actual time=236.268..364.182 rows=7 loops=1)
              Group Key: s.name
              ->  Gather Merge  (cost=7539.74..7541.37 rows=14 width=16) (actual time=236.251..362.969 rows=21 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Sort  (cost=6539.71..6539.73 rows=7 width=16) (actual time=85.431..85.983 rows=7 loops=3)
                          Sort Key: s.name
                          Sort Method: quicksort  Memory: 25kB
                          Worker 0:  Sort Method: quicksort  Memory: 25kB
                          Worker 1:  Sort Method: quicksort  Memory: 25kB
                          ->  Partial HashAggregate  (cost=6539.55..6539.62 rows=7 width=16) (actual time=77.307..77.312 rows=7 loops=3)
                                Group Key: s.name
                                Batches: 1  Memory Usage: 24kB
                                Worker 0:  Batches: 1  Memory Usage: 24kB
                                Worker 1:  Batches: 1  Memory Usage: 24kB
                                ->  Hash Join  (cost=1.16..5706.21 rows=166667 width=12) (actual time=5.955..47.251 rows=133333 loops=3)
                                      Hash Cond: (o.status_id = s.id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.762..11.313 rows=133333 loops=3)
                                      ->  Hash  (cost=1.07..1.07 rows=7 width=12) (actual time=4.250..4.251 rows=7 loops=3)
                                            Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                            ->  Seq Scan on "Status" s  (cost=0.00..1.07 rows=7 width=12) (actual time=3.992..3.994 rows=7 loops=3)
Planning Time: 28.646 ms
Execution Time: 386.429 ms


==================================================
EXPLAIN ANALYZE — Query 17: Top klienci wg wydatków
==================================================
Limit  (cost=15259.76..15259.79 rows=10 width=50) (actual time=3820.036..3829.613 rows=10 loops=1)
  ->  Sort  (cost=15259.76..15309.76 rows=20000 width=50) (actual time=3820.035..3829.611 rows=10 loops=1)
        Sort Key: (sum(oi.unit_price)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=14577.57..14827.57 rows=20000 width=50) (actual time=3802.708..3821.988 rows=19296 loops=1)
              Group Key: u.id
              Batches: 5  Memory Usage: 8241kB  Disk Usage: 224kB
              ->  Gather  (cost=12681.81..14452.58 rows=16666 width=50) (actual time=3270.789..3483.677 rows=19428 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=11681.81..11785.98 rows=8333 width=50) (actual time=2945.033..3002.345 rows=6476 loops=3)
                          Group Key: u.id
                          Batches: 1  Memory Usage: 3217kB
                          Worker 0:  Batches: 1  Memory Usage: 2961kB
                          Worker 1:  Batches: 1  Memory Usage: 2961kB
                          ->  Nested Loop  (cost=681.42..11640.15 rows=8333 width=24) (actual time=33.867..2905.169 rows=6667 loops=3)
                                ->  Parallel Hash Join  (cost=681.00..6566.02 rows=8333 width=10) (actual time=8.282..151.312 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.568..76.430 rows=133333 loops=3)
                                      ->  Parallel Hash  (cost=533.93..533.93 rows=11765 width=10) (actual time=6.673..7.592 rows=6667 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1216kB
                                            ->  Parallel Index Only Scan using idx_orderitem_order_price_cover on "OrderItem" oi  (cost=0.29..533.93 rows=11765 width=10) (actual time=0.022..3.362 rows=20000 loops=1)
                                                  Heap Fetches: 0
                                ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.409..0.409 rows=1 loops=20000)
                                      Index Cond: (id = o.user_id)
Planning Time: 16.979 ms
Execution Time: 3849.123 ms


==================================================
EXPLAIN ANALYZE — Query 18: Produkty z wariantami objętymi promocją, z końcową ceną
==================================================
Sort  (cost=1980.71..2008.91 rows=11280 width=132) (actual time=47.423..47.564 rows=1340 loops=1)
  Sort Key: (round(((p.price + v.price_modifier) * ('1'::numeric - pr.discount_percentage)), 2))
  Sort Method: quicksort  Memory: 146kB
  ->  Hash Join  (cost=695.63..1221.48 rows=11280 width=132) (actual time=24.205..45.280 rows=1340 loops=1)
        Hash Cond: (v.product_id = p.id)
        ->  Merge Join  (cost=7.63..334.66 rows=11280 width=39) (actual time=1.507..20.997 rows=1340 loops=1)
              Merge Cond: (v.promotion_id = pr.id)
              ->  Index Scan using idx_variant_promotion on "Variant" v  (cost=0.29..2469.25 rows=47000 width=37) (actual time=0.023..18.234 rows=5685 loops=1)
              ->  Sort  (cost=7.34..7.46 rows=48 width=10) (actual time=1.478..1.486 rows=47 loops=1)
                    Sort Key: pr.id
                    Sort Method: quicksort  Memory: 26kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=48 width=10) (actual time=1.436..1.460 rows=47 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 153
        ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=22.676..22.677 rows=20000 loops=1)
              Buckets: 32768  Batches: 1  Memory Usage: 1381kB
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.008..11.953 rows=20000 loops=1)
Planning Time: 66.897 ms
Execution Time: 49.998 ms


==================================================
EXPLAIN ANALYZE — Query 19: Użytkownicy, Którzy Dodali Produkt do Koszyka, Ale Nie Złożyli Zamówienia (Potencjał Odbudowy Koszyka)
==================================================
Hash Join  (cost=45856.21..103590.81 rows=1068640 width=55) (actual time=3901.842..6471.972 rows=1005006 loops=1)
  Hash Cond: (v.product_id = p.id)
  ->  Hash Join  (cost=45168.21..100097.04 rows=1068640 width=46) (actual time=3891.095..5930.564 rows=1005006 loops=1)
        Hash Cond: (ci.variant_id = v.id)
        ->  Hash Join  (cost=43711.71..95835.11 rows=1068640 width=46) (actual time=3870.550..5221.231 rows=1005006 loops=1)
              Hash Cond: (ci.cart_id = c.id)
              ->  Seq Scan on "CartItem" ci  (cost=0.00..23152.00 rows=1500000 width=8) (actual time=2.094..505.087 rows=1500000 loops=1)
              ->  Hash  (cost=41435.91..41435.91 rows=106864 width=46) (actual time=3858.607..3876.501 rows=100414 loops=1)
                    Buckets: 131072  Batches: 2  Memory Usage: 4929kB
                    ->  Gather  (cost=25017.67..41435.91 rows=106864 width=46) (actual time=3457.226..3540.591 rows=100414 loops=1)
                          Workers Planned: 2
                          Workers Launched: 2
                          ->  Parallel Hash Right Anti Join  (cost=24017.67..29749.51 rows=44527 width=46) (actual time=2853.979..2870.153 rows=33471 loops=3)
                                Hash Cond: (o.user_id = u.id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=4) (actual time=10.465..274.589 rows=133333 loops=3)
                                ->  Parallel Hash  (cost=23236.42..23236.42 rows=62500 width=50) (actual time=2238.508..2239.002 rows=50000 loops=3)
                                      Buckets: 262144  Batches: 1  Memory Usage: 14720kB
                                      ->  Hash Join  (cost=4079.00..23236.42 rows=62500 width=50) (actual time=312.371..2037.401 rows=50000 loops=3)
                                            Hash Cond: (u.id = c.user_id)
                                            ->  Parallel Seq Scan on "User" u  (cost=0.00..18063.67 rows=416667 width=46) (actual time=13.831..1334.622 rows=333333 loops=3)
                                            ->  Hash  (cost=2204.00..2204.00 rows=150000 width=8) (actual time=287.247..287.248 rows=150000 loops=3)
                                                  Buckets: 262144  Batches: 1  Memory Usage: 7908kB
                                                  ->  Seq Scan on "Cart" c  (cost=0.00..2204.00 rows=150000 width=8) (actual time=17.027..172.028 rows=150000 loops=3)
        ->  Hash  (cost=869.00..869.00 rows=47000 width=8) (actual time=18.355..18.915 rows=47000 loops=1)
              Buckets: 65536  Batches: 1  Memory Usage: 2348kB
              ->  Seq Scan on "Variant" v  (cost=0.00..869.00 rows=47000 width=8) (actual time=0.017..5.143 rows=47000 loops=1)
  ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=7.768..7.769 rows=20000 loops=1)
        Buckets: 32768  Batches: 1  Memory Usage: 1245kB
        ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=2.029..4.410 rows=20000 loops=1)
Planning Time: 69.776 ms
Execution Time: 6540.342 ms


==================================================
EXPLAIN ANALYZE — Query 20: Wyszukiwanie produktów po nazwie lub opisie (parametryzowane)
==================================================
Bitmap Heap Scan on "Product"  (cost=43.00..57.51 rows=4 width=60) (actual time=8.350..23.614 rows=143 loops=1)
  Recheck Cond: (((name)::text ~~* '%test%'::text) OR (description ~~* '%test%'::text))
  Heap Blocks: exact=106
  ->  BitmapOr  (cost=43.00..43.00 rows=4 width=0) (actual time=8.312..8.314 rows=0 loops=1)
        ->  Bitmap Index Scan on idx_product_name_trgm  (cost=0.00..21.50 rows=2 width=0) (actual time=5.259..5.259 rows=42 loops=1)
              Index Cond: ((name)::text ~~* '%test%'::text)
        ->  Bitmap Index Scan on idx_product_description_trgm  (cost=0.00..21.50 rows=2 width=0) (actual time=3.047..3.047 rows=102 loops=1)
              Index Cond: (description ~~* '%test%'::text)
Planning Time: 133.129 ms
Execution Time: 28.840 ms


==================================================
EXPLAIN ANALYZE — Query 21: Użytkownicy, Którzy Zapisali Konkretny Produkt jako Ulubiony (np. Product ID=350259)
==================================================
Nested Loop  (cost=0.85..262.23 rows=30 width=56) (actual time=4.877..20.066 rows=26 loops=1)
  ->  Index Only Scan using idx_favoriteproduct_product_user on "FavoriteProduct" fp  (cost=0.42..8.95 rows=30 width=4) (actual time=4.271..4.285 rows=26 loops=1)
        Index Cond: (product_id = 35)
        Heap Fetches: 0
  ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..8.44 rows=1 width=60) (actual time=0.605..0.605 rows=1 loops=26)
        Index Cond: (id = fp.user_id)
Planning Time: 12.334 ms
Execution Time: 20.106 ms


==================================================
EXPLAIN ANALYZE — Query 22: Znajdź Magazyny, Które Posiadają Zapasy Konkretnego Wariantu (np. SKU='VR-000000-a637d44b7afd')
==================================================
GroupAggregate  (cost=24.83..24.93 rows=2 width=25) (actual time=4.255..4.257 rows=0 loops=1)
  Group Key: w.name
  Filter: (count(si.id) > 0)
  ->  Sort  (cost=24.83..24.84 rows=5 width=21) (actual time=4.253..4.255 rows=0 loops=1)
        Sort Key: w.name
        Sort Method: quicksort  Memory: 25kB
        ->  Nested Loop  (cost=0.97..24.77 rows=5 width=21) (actual time=3.645..3.646 rows=0 loops=1)
              ->  Nested Loop  (cost=0.84..24.00 rows=5 width=8) (actual time=3.644..3.645 rows=0 loops=1)
                    ->  Index Scan using "Variant_sku_key" on "Variant" v  (cost=0.41..8.43 rows=1 width=4) (actual time=3.644..3.644 rows=0 loops=1)
                          Index Cond: ((sku)::text = 'VR-000001-2704de10f283'::text)
                    ->  Index Scan using idx_stockitem_shipment_variant_warehouse on "StockItem" si  (cost=0.42..15.52 rows=5 width=12) (never executed)
                          Index Cond: ((shipment_id IS NULL) AND (variant_id = v.id))
              ->  Index Scan using "Warehouse_pkey" on "Warehouse" w  (cost=0.14..0.15 rows=1 width=21) (never executed)
                    Index Cond: (id = si.warehouse_id)
Planning Time: 18.571 ms
Execution Time: 4.906 ms


==================================================
EXPLAIN ANALYZE — Query 23: Warianty, Które Wymagają Uzyskania Konkretnej Opcji (np. 'Kolor'='Czerwony')
==================================================
Nested Loop  (cost=6.81..677.93 rows=8 width=36) (actual time=0.024..0.025 rows=0 loops=1)
  ->  Nested Loop  (cost=6.52..675.28 rows=8 width=27) (actual time=0.024..0.024 rows=0 loops=1)
        ->  Nested Loop  (cost=6.23..672.76 rows=8 width=4) (actual time=0.023..0.024 rows=0 loops=1)
              Join Filter: (opt.attribute_id = a.id)
              ->  Seq Scan on "Attribute" a  (cost=0.00..1.38 rows=1 width=4) (actual time=0.023..0.023 rows=0 loops=1)
                    Filter: ((name)::text = 'Attr_49_Century'::text)
                    Rows Removed by Filter: 30
              ->  Nested Loop  (cost=6.23..668.26 rows=250 width=8) (never executed)
                    ->  Seq Scan on "Option" opt  (cost=0.00..18.50 rows=1 width=8) (never executed)
                          Filter: ((value)::text = 'do'::text)
                    ->  Bitmap Heap Scan on "VariantOption" vo  (cost=6.23..647.26 rows=250 width=8) (never executed)
                          Recheck Cond: (option_id = opt.id)
                          ->  Bitmap Index Scan on idx_variantoption_option_id  (cost=0.00..6.17 rows=250 width=0) (never executed)
                                Index Cond: (option_id = opt.id)
        ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.32 rows=1 width=31) (never executed)
              Index Cond: (id = vo.variant_id)
  ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=17) (never executed)
        Index Cond: (id = v.product_id)
Planning Time: 55.386 ms
Execution Time: 0.100 ms


==================================================
EXPLAIN ANALYZE — Query 24: Znajdź Zamówienia Użytkownika (np. email='debbie.lane.16786.50af0753@example.com') o Statusie 'Paid'
==================================================
Nested Loop  (cost=0.98..17.07 rows=1 width=20) (actual time=6.122..6.124 rows=0 loops=1)
  ->  Nested Loop  (cost=0.85..16.89 rows=1 width=16) (actual time=6.122..6.123 rows=0 loops=1)
        ->  Index Scan using "User_email_key" on "User" u  (cost=0.42..8.44 rows=1 width=4) (actual time=6.121..6.121 rows=0 loops=1)
              Index Cond: ((email)::text = 'debbie.lane.16786.50af0753@example.com'::text)
        ->  Index Scan using idx_order_user_id on "Order" o  (cost=0.42..8.44 rows=1 width=20) (never executed)
              Index Cond: (user_id = u.id)
  ->  Index Scan using "Status_pkey" on "Status" s  (cost=0.13..0.15 rows=1 width=12) (never executed)
        Index Cond: (id = o.status_id)
        Filter: ((name)::text = 'Paid'::text)
Planning Time: 8.000 ms
Execution Time: 6.207 ms


==================================================
EXPLAIN ANALYZE — Query 25: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
Hash Left Join  (cost=6.97..48.11 rows=16 width=87) (actual time=3.209..11.977 rows=18 loops=1)
  Hash Cond: (opt.attribute_id = a.id)
  ->  Nested Loop Left Join  (cost=5.30..46.34 rows=16 width=45) (actual time=2.286..10.994 rows=18 loops=1)
        ->  Nested Loop Left Join  (cost=5.02..41.66 rows=16 width=39) (actual time=2.222..8.460 rows=18 loops=1)
              ->  Nested Loop  (cost=4.60..23.91 rows=3 width=39) (actual time=1.247..1.276 rows=4 loops=1)
                    ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..8.30 rows=1 width=10) (actual time=0.029..0.031 rows=1 loops=1)
                          Index Cond: (id = 35)
                    ->  Bitmap Heap Scan on "Variant" v  (cost=4.31..15.57 rows=3 width=37) (actual time=1.212..1.235 rows=4 loops=1)
                          Recheck Cond: (product_id = 35)
                          Heap Blocks: exact=4
                          ->  Bitmap Index Scan on idx_variant_product_id  (cost=0.00..4.31 rows=3 width=0) (actual time=0.008..0.009 rows=4 loops=1)
                                Index Cond: (product_id = 35)
              ->  Index Only Scan using uq_varopt_variant_option on "VariantOption" vo  (cost=0.42..5.86 rows=6 width=8) (actual time=1.785..1.791 rows=4 loops=4)
                    Index Cond: (variant_id = v.id)
                    Heap Fetches: 0
        ->  Index Scan using "Option_pkey" on "Option" opt  (cost=0.28..0.29 rows=1 width=14) (actual time=0.138..0.138 rows=1 loops=18)
              Index Cond: (id = vo.option_id)
  ->  Hash  (cost=1.30..1.30 rows=30 width=18) (actual time=0.038..0.038 rows=30 loops=1)
        Buckets: 1024  Batches: 1  Memory Usage: 10kB
        ->  Seq Scan on "Attribute" a  (cost=0.00..1.30 rows=30 width=18) (actual time=0.024..0.028 rows=30 loops=1)
Planning Time: 0.875 ms
Execution Time: 12.050 ms


==================================================
EXPLAIN ANALYZE — Query 26: Lista Wszystkich Dziecięcych Kategorii (Podkategorii) dla Konkretnej Kategorii Nadrzędnej (np. ID=5)
==================================================
Seq Scan on "Category"  (cost=0.00..3.88 rows=3 width=12) (actual time=0.549..0.559 rows=3 loops=1)
  Filter: (parent_id = 5)
  Rows Removed by Filter: 147
Planning Time: 1.417 ms
Execution Time: 0.579 ms


==================================================
EXPLAIN ANALYZE — Query 27: Porównanie Średniej Oceny dla Promowanych i Niepromowanych Produktów
==================================================
HashAggregate  (cost=87850.51..87853.01 rows=200 width=64) (actual time=194.596..194.600 rows=2 loops=1)
  Group Key: CASE WHEN (ANY (p.id = (hashed SubPlan 2).col1)) THEN 'Promowany'::text ELSE 'Niepromowany'::text END
  Batches: 1  Memory Usage: 40kB
  ->  HashAggregate  (cost=1300.51..87550.51 rows=20000 width=68) (actual time=184.879..191.665 rows=12612 loops=1)
        Group Key: p.id
        Batches: 1  Memory Usage: 2577kB
        ->  Hash Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=39.941..158.566 rows=20000 loops=1)
              Hash Cond: (r.product_id = p.id)
              ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=1.254..111.307 rows=20000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=38.525..38.526 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 960kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.008..35.310 rows=20000 loops=1)
        SubPlan 2
          ->  Index Only Scan using idx_variant_product_promotion on "Variant" v2  (cost=0.28..157.63 rows=5690 width=4) (actual time=5.315..11.722 rows=5684 loops=1)
                Heap Fetches: 0
Planning Time: 4.008 ms
Execution Time: 195.289 ms


==================================================
EXPLAIN ANALYZE — Query 28: Top 5 Miast Generujących Największy Przychód (Wg. Adresu Wysyłki)
==================================================
Limit  (cost=15175.51..15175.53 rows=5 width=45) (actual time=4319.994..4354.527 rows=5 loops=1)
  ->  Sort  (cost=15175.51..15225.51 rows=20000 width=45) (actual time=4319.983..4353.571 rows=5 loops=1)
        Sort Key: (sum(oi.unit_price)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=14593.32..14843.32 rows=20000 width=45) (actual time=4309.747..4348.651 rows=12950 loops=1)
              Group Key: a.city
              Batches: 1  Memory Usage: 5905kB
              ->  Gather  (cost=12697.56..14468.33 rows=16666 width=45) (actual time=4128.835..4211.849 rows=16090 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=11697.56..11801.73 rows=8333 width=45) (actual time=4096.711..4102.701 rows=5363 loops=3)
                          Group Key: a.city
                          Batches: 1  Memory Usage: 2449kB
                          Worker 0:  Batches: 1  Memory Usage: 2449kB
                          Worker 1:  Batches: 1  Memory Usage: 2449kB
                          ->  Nested Loop  (cost=681.42..11655.90 rows=8333 width=19) (actual time=23.474..4055.631 rows=6667 loops=3)
                                ->  Parallel Hash Join  (cost=681.00..6566.02 rows=8333 width=10) (actual time=20.012..295.419 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.009..209.204 rows=133333 loops=3)
                                      ->  Parallel Hash  (cost=533.93..533.93 rows=11765 width=10) (actual time=19.244..20.178 rows=6667 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1248kB
                                            ->  Parallel Index Only Scan using idx_orderitem_order_price_cover on "OrderItem" oi  (cost=0.29..533.93 rows=11765 width=10) (actual time=1.913..16.629 rows=6667 loops=3)
                                                  Heap Fetches: 0
                                ->  Index Scan using "Address_pkey" on "Address" a  (cost=0.43..0.61 rows=1 width=17) (actual time=0.561..0.561 rows=1 loops=20000)
                                      Index Cond: (id = o.shipping_address_id)
Planning Time: 28.326 ms
Execution Time: 4357.944 ms


==================================================
EXPLAIN ANALYZE — Query 29: Porównanie Wolumenu Sprzedaży Produktów Promowanych vs. Niepromowanych (w Ostatnich 30 Dniach)
==================================================
Finalize GroupAggregate  (cost=6389.73..6445.59 rows=200 width=40) (actual time=770.727..909.675 rows=2 loops=1)
  Group Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
  ->  Gather Merge  (cost=6389.73..6441.59 rows=400 width=40) (actual time=770.701..908.548 rows=6 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=5389.70..5395.40 rows=200 width=40) (actual time=649.713..650.499 rows=2 loops=3)
              Group Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
              ->  Sort  (cost=5389.70..5390.94 rows=493 width=32) (actual time=649.431..649.903 rows=391 loops=3)
                    Sort Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
                    Sort Method: quicksort  Memory: 25kB
                    Worker 0:  Sort Method: quicksort  Memory: 25kB
                    Worker 1:  Sort Method: quicksort  Memory: 25kB
                    ->  Nested Loop  (cost=1026.51..5367.65 rows=493 width=32) (actual time=32.689..631.640 rows=391 loops=3)
                          ->  Nested Loop  (cost=1026.22..5212.79 rows=493 width=4) (actual time=31.174..565.523 rows=391 loops=3)
                                ->  Hash Join  (cost=1025.80..4600.88 rows=493 width=4) (actual time=28.697..67.509 rows=391 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Bitmap Heap Scan on "Order" o  (cost=447.80..3956.33 rows=9859 width=4) (actual time=8.186..43.604 rows=7823 loops=3)
                                            Recheck Cond: (order_date >= (now() - '30 days'::interval))
                                            Heap Blocks: exact=1130
                                            ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..441.88 rows=23661 width=0) (actual time=23.998..23.998 rows=23470 loops=1)
                                                  Index Cond: (order_date >= (now() - '30 days'::interval))
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=8) (actual time=20.055..20.499 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=8) (actual time=1.370..15.824 rows=20000 loops=3)
                                ->  Index Scan using "StockItem_pkey" on "StockItem" si  (cost=0.42..1.24 rows=1 width=8) (actual time=1.271..1.271 rows=1 loops=1174)
                                      Index Cond: (id = oi.stock_item_id)
                          ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.31 rows=1 width=8) (actual time=0.167..0.167 rows=1 loops=1174)
                                Index Cond: (id = si.variant_id)
Planning Time: 16.280 ms
Execution Time: 918.077 ms


==================================================
EXPLAIN ANALYZE — Query 30: Wskaźnik Lojalności (Repeat Purchase Rate) Użytkowników z Podziałem na Miasto Adresu Rozliczeniowego
==================================================
Sort  (cost=68002.37..68076.46 rows=29636 width=61) (actual time=4708.265..4731.129 rows=66456 loops=1)
  Sort Key: (round((((count(*) FILTER (WHERE (u.orders_count > 1)))::numeric * 100.0) / (NULLIF(count(*), 0))::numeric), 2)) DESC
  Sort Method: external merge  Disk: 3192kB
  ->  Finalize HashAggregate  (cost=65060.25..65801.15 rows=29636 width=61) (actual time=4481.103..4553.582 rows=66456 loops=1)
        Group Key: a.city
        Batches: 5  Memory Usage: 8241kB  Disk Usage: 712kB
        ->  Gather  (cost=58392.15..64615.71 rows=59272 width=29) (actual time=3981.914..4099.132 rows=122175 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial HashAggregate  (cost=57392.15..57688.51 rows=29636 width=29) (actual time=3656.914..3672.378 rows=40725 loops=3)
                    Group Key: a.city
                    Batches: 1  Memory Usage: 5137kB
                    Worker 0:  Batches: 1  Memory Usage: 5137kB
                    Worker 1:  Batches: 1  Memory Usage: 5137kB
                    ->  Parallel Hash Join  (cost=34868.03..55725.48 rows=166667 width=21) (actual time=1249.982..3309.562 rows=133333 loops=3)
                          Hash Cond: (a.id = o.billing_address_id)
                          ->  Parallel Seq Scan on "Address" a  (cost=0.00..18288.00 rows=500000 width=17) (actual time=10.498..1365.869 rows=400000 loops=3)
                          ->  Parallel Hash  (cost=32784.69..32784.69 rows=166667 width=12) (actual time=1209.487..1210.693 rows=133333 loops=3)
                                Buckets: 524288  Batches: 1  Memory Usage: 22912kB
                                ->  Hash Join  (cost=24635.51..32784.69 rows=166667 width=12) (actual time=652.001..1032.383 rows=133333 loops=3)
                                      Hash Cond: (o.user_id = u.user_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.755..105.059 rows=133333 loops=3)
                                      ->  Hash  (cost=19635.86..19635.86 rows=287572 width=12) (actual time=499.792..500.994 rows=329619 loops=3)
                                            Buckets: 262144  Batches: 4  Memory Usage: 5596kB
                                            ->  Subquery Scan on u  (cost=0.42..19635.86 rows=287572 width=12) (actual time=47.006..349.120 rows=329619 loops=3)
                                                  ->  GroupAggregate  (cost=0.42..16760.14 rows=287572 width=12) (actual time=45.465..310.969 rows=329619 loops=3)
                                                        Group Key: "Order".user_id
                                                        ->  Index Only Scan using idx_order_user_id on "Order"  (cost=0.42..11884.42 rows=400000 width=4) (actual time=41.931..197.608 rows=400000 loops=3)
                                                              Heap Fetches: 150240
Planning Time: 14.956 ms
Execution Time: 4773.188 ms

FINISHED — 2025-11-22 18:14:53.819566
========================================================================================================================
========================================================================================================================
START EXPLAIN RUN — 2025-12-02 20:48:36.782124
========================================================================================================================


==================================================
EXPLAIN ANALYZE — Query 1: Średnia Wartość Zamówienia (AOV) w Ostatnim Miesiącu
==================================================
Aggregate  (cost=4365.66..4365.67 rows=1 width=32) (actual time=1125.680..1125.683 rows=1 loops=1)
  ->  GroupAggregate  (cost=4345.67..4357.97 rows=615 width=36) (actual time=1125.249..1125.629 rows=608 loops=1)
        Group Key: o.id
        ->  Sort  (cost=4345.67..4347.20 rows=615 width=10) (actual time=1125.230..1125.275 rows=619 loops=1)
              Sort Key: o.id
              Sort Method: quicksort  Memory: 44kB
              ->  Hash Join  (cost=3936.68..4317.18 rows=615 width=10) (actual time=1119.982..1125.070 rows=619 loops=1)
                    Hash Cond: (oi.order_id = o.id)
                    ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.020..2.509 rows=20000 loops=1)
                    ->  Hash  (cost=3782.95..3782.95 rows=12298 width=4) (actual time=1119.910..1119.911 rows=12346 loops=1)
                          Buckets: 16384  Batches: 1  Memory Usage: 563kB
                          ->  Bitmap Heap Scan on "Order" o  (cost=231.74..3782.95 rows=12298 width=4) (actual time=6.370..1115.731 rows=12346 loops=1)
                                Recheck Cond: (order_date >= (now() - '1 mon'::interval))
                                Heap Blocks: exact=3270
                                ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..228.66 rows=12298 width=0) (actual time=4.796..4.797 rows=12346 loops=1)
                                      Index Cond: (order_date >= (now() - '1 mon'::interval))
Planning Time: 14.800 ms
Execution Time: 1125.829 ms


==================================================
EXPLAIN ANALYZE — Query 2: Średnia wartość zamówienia per użytkownik
==================================================
Sort  (cost=16066.87..16115.61 rows=19495 width=50) (actual time=2861.206..2952.148 rows=19296 loops=1)
  Sort Key: (round(avg(order_totals.total_price), 2)) DESC
  Sort Method: quicksort  Memory: 1612kB
  ->  Finalize HashAggregate  (cost=14385.35..14677.77 rows=19495 width=50) (actual time=2787.258..2912.520 rows=19296 loops=1)
        Group Key: u.id
        Batches: 5  Memory Usage: 8241kB  Disk Usage: 216kB
        ->  Gather  (cost=12537.36..14263.50 rows=16246 width=50) (actual time=2543.447..2737.993 rows=19436 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial HashAggregate  (cost=11537.36..11638.90 rows=8123 width=50) (actual time=2527.124..2544.297 rows=6479 loops=3)
                    Group Key: u.id
                    Batches: 1  Memory Usage: 3217kB
                    Worker 0:  Batches: 1  Memory Usage: 2961kB
                    Worker 1:  Batches: 1  Memory Usage: 2961kB
                    ->  Nested Loop  (cost=1110.75..11496.75 rows=8123 width=50) (actual time=41.695..2452.555 rows=6498 loops=3)
                          ->  Hash Join  (cost=1110.33..6550.49 rows=8123 width=36) (actual time=37.460..161.433 rows=6498 loops=3)
                                Hash Cond: (o.id = order_totals.order_id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.008..55.303 rows=133333 loops=3)
                                ->  Hash  (cost=866.64..866.64 rows=19495 width=36) (actual time=37.130..38.687 rows=19495 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1094kB
                                      ->  Subquery Scan on order_totals  (cost=428.00..866.64 rows=19495 width=36) (actual time=22.402..32.572 rows=19495 loops=3)
                                            ->  HashAggregate  (cost=428.00..671.69 rows=19495 width=36) (actual time=22.401..30.738 rows=19495 loops=3)
                                                  Group Key: oi.order_id
                                                  Batches: 1  Memory Usage: 7953kB
                                                  Worker 0:  Batches: 1  Memory Usage: 7953kB
                                                  Worker 1:  Batches: 1  Memory Usage: 7953kB
                                                  ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.032..3.377 rows=20000 loops=3)
                          ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.341..0.341 rows=1 loops=19495)
                                Index Cond: (id = o.user_id)
Planning Time: 13.867 ms
Execution Time: 2986.906 ms


==================================================
EXPLAIN ANALYZE — Query 3: Top 10 Najlepiej Sprzedających Się Produktów (wg. Ilości Sprzedanych Jednostek) w Ostatnim Kwartale
==================================================
[ERROR EXECUTING QUERY 3] relation "StockItem" does not exist
LINE 9:         JOIN "StockItem" si ON si.variant_id = v.id
                     ^



==================================================
EXPLAIN ANALYZE — Query 4: Top 5 produktów z najwięcej recenzjami
==================================================
[ERROR EXECUTING QUERY 4] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 5: Całkowity Przychód Pogrupowany Miesięcznie za Ostatni Rok
==================================================
[ERROR EXECUTING QUERY 5] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 6: Produkty najczęściej dodawane do ulubionych
==================================================
[ERROR EXECUTING QUERY 6] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 7: Dostępny Stan Magazynowy Wariantów Produktu Pogrupowany po Magazynach
==================================================
[ERROR EXECUTING QUERY 7] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 8: Stan magazynowy per produkt
==================================================
[ERROR EXECUTING QUERY 8] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 9: Najpopularniejsze Kategorie (wg. Całkowitego Przychodu)
==================================================
[ERROR EXECUTING QUERY 9] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 10: Liczba produktów per kategoria
==================================================
[ERROR EXECUTING QUERY 10] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 11: Liczba zamówień per metoda płatności
==================================================
[ERROR EXECUTING QUERY 11] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 12: Średnia ocena per producent
==================================================
[ERROR EXECUTING QUERY 12] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 13: Aktywne promocje i objęta nimi liczba wariantów
==================================================
[ERROR EXECUTING QUERY 13] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 14: Najczęściej wybierane warianty w koszykach
==================================================
[ERROR EXECUTING QUERY 14] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 15: Produkty z Największą Różnicą Między Ceną Podstawową a Ceną Wariantu
==================================================
[ERROR EXECUTING QUERY 15] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 16: Konwersja zamówień wg statusu
==================================================
[ERROR EXECUTING QUERY 16] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 17: Top klienci wg wydatków
==================================================
[ERROR EXECUTING QUERY 17] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 18: Produkty z wariantami objętymi promocją, z końcową ceną
==================================================
[ERROR EXECUTING QUERY 18] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 19: Użytkownicy, Którzy Dodali Produkt do Koszyka, Ale Nie Złożyli Zamówienia (Potencjał Odbudowy Koszyka)
==================================================
[ERROR EXECUTING QUERY 19] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 20: Wyszukiwanie produktów po nazwie lub opisie (parametryzowane)
==================================================
[ERROR EXECUTING QUERY 20] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 21: Użytkownicy, Którzy Zapisali Konkretny Produkt jako Ulubiony (np. Product ID=350259)
==================================================
[ERROR EXECUTING QUERY 21] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 22: Znajdź Magazyny, Które Posiadają Zapasy Konkretnego Wariantu (np. SKU='VR-000000-a637d44b7afd')
==================================================
[ERROR EXECUTING QUERY 22] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 23: Warianty, Które Wymagają Uzyskania Konkretnej Opcji (np. 'Kolor'='Czerwony')
==================================================
[ERROR EXECUTING QUERY 23] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 24: Znajdź Zamówienia Użytkownika (np. email='debbie.lane.16786.50af0753@example.com') o Statusie 'Paid'
==================================================
[ERROR EXECUTING QUERY 24] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 25: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
[ERROR EXECUTING QUERY 25] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 26: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
[ERROR EXECUTING QUERY 26] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 27: Porównanie Średniej Oceny dla Promowanych i Niepromowanych Produktów
==================================================
[ERROR EXECUTING QUERY 27] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 28: Top 5 Miast Generujących Największy Przychód (Wg. Adresu Wysyłki)
==================================================
[ERROR EXECUTING QUERY 28] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 29: Porównanie Wolumenu Sprzedaży Produktów Promowanych vs. Niepromowanych (w Ostatnich 30 Dniach)
==================================================
[ERROR EXECUTING QUERY 29] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 30: Wskaźnik Lojalności (Repeat Purchase Rate) Użytkowników z Podziałem na Miasto Adresu Rozliczeniowego
==================================================
[ERROR EXECUTING QUERY 30] current transaction is aborted, commands ignored until end of transaction block


FINISHED — 2025-12-02 20:48:42.473922
========================================================================================================================
========================================================================================================================
START EXPLAIN RUN — 2025-12-02 20:54:50.193302
========================================================================================================================


==================================================
EXPLAIN ANALYZE — Query 1: Średnia Wartość Zamówienia (AOV) w Ostatnim Miesiącu
==================================================
Aggregate  (cost=4365.47..4365.48 rows=1 width=32) (actual time=21.662..21.665 rows=1 loops=1)
  ->  GroupAggregate  (cost=4345.48..4357.78 rows=615 width=36) (actual time=21.232..21.605 rows=608 loops=1)
        Group Key: o.id
        ->  Sort  (cost=4345.48..4347.01 rows=615 width=10) (actual time=21.214..21.260 rows=619 loops=1)
              Sort Key: o.id
              Sort Method: quicksort  Memory: 44kB
              ->  Hash Join  (cost=3936.49..4316.99 rows=615 width=10) (actual time=15.929..20.921 rows=619 loops=1)
                    Hash Cond: (oi.order_id = o.id)
                    ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.019..2.508 rows=20000 loops=1)
                    ->  Hash  (cost=3782.83..3782.83 rows=12293 width=4) (actual time=15.820..15.822 rows=12342 loops=1)
                          Buckets: 16384  Batches: 1  Memory Usage: 562kB
                          ->  Bitmap Heap Scan on "Order" o  (cost=231.70..3782.83 rows=12293 width=4) (actual time=2.611..13.453 rows=12342 loops=1)
                                Recheck Cond: (order_date >= (now() - '1 mon'::interval))
                                Heap Blocks: exact=3270
                                ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..228.62 rows=12293 width=0) (actual time=2.235..2.235 rows=12342 loops=1)
                                      Index Cond: (order_date >= (now() - '1 mon'::interval))
Planning Time: 2.612 ms
Execution Time: 21.797 ms


==================================================
EXPLAIN ANALYZE — Query 2: Średnia wartość zamówienia per użytkownik
==================================================
Sort  (cost=16066.87..16115.61 rows=19495 width=50) (actual time=1417.296..1423.931 rows=19296 loops=1)
  Sort Key: (round(avg(order_totals.total_price), 2)) DESC
  Sort Method: quicksort  Memory: 1612kB
  ->  Finalize HashAggregate  (cost=14385.35..14677.77 rows=19495 width=50) (actual time=1388.582..1410.807 rows=19296 loops=1)
        Group Key: u.id
        Batches: 5  Memory Usage: 8241kB  Disk Usage: 224kB
        ->  Gather  (cost=12537.36..14263.50 rows=16246 width=50) (actual time=1233.684..1292.507 rows=19428 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial HashAggregate  (cost=11537.36..11638.90 rows=8123 width=50) (actual time=1168.677..1222.980 rows=6476 loops=3)
                    Group Key: u.id
                    Batches: 1  Memory Usage: 3217kB
                    Worker 0:  Batches: 1  Memory Usage: 3217kB
                    Worker 1:  Batches: 1  Memory Usage: 2961kB
                    ->  Nested Loop  (cost=1110.75..11496.75 rows=8123 width=50) (actual time=260.232..1126.484 rows=6498 loops=3)
                          ->  Hash Join  (cost=1110.33..6550.49 rows=8123 width=36) (actual time=248.640..352.931 rows=6498 loops=3)
                                Hash Cond: (o.id = order_totals.order_id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.008..41.421 rows=133333 loops=3)
                                ->  Hash  (cost=866.64..866.64 rows=19495 width=36) (actual time=246.079..246.589 rows=19495 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1094kB
                                      ->  Subquery Scan on order_totals  (cost=428.00..866.64 rows=19495 width=36) (actual time=227.746..238.056 rows=19495 loops=3)
                                            ->  HashAggregate  (cost=428.00..671.69 rows=19495 width=36) (actual time=227.746..235.945 rows=19495 loops=3)
                                                  Group Key: oi.order_id
                                                  Batches: 1  Memory Usage: 7953kB
                                                  Worker 0:  Batches: 1  Memory Usage: 7953kB
                                                  Worker 1:  Batches: 1  Memory Usage: 7953kB
                                                  ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.032..77.742 rows=20000 loops=3)
                          ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.114..0.114 rows=1 loops=19495)
                                Index Cond: (id = o.user_id)
Planning Time: 2.764 ms
Execution Time: 1456.896 ms


==================================================
EXPLAIN ANALYZE — Query 3: Top 10 Najlepiej Sprzedających Się Produktów (wg. Ilości Sprzedanych Jednostek) w Ostatnim Kwartale
==================================================
[ERROR EXECUTING QUERY 3] relation "StockItem" does not exist
LINE 9:         JOIN "StockItem" si ON si.variant_id = v.id
                     ^



==================================================
EXPLAIN ANALYZE — Query 4: Top 5 produktów z najwięcej recenzjami
==================================================
[ERROR EXECUTING QUERY 4] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 5: Całkowity Przychód Pogrupowany Miesięcznie za Ostatni Rok
==================================================
[ERROR EXECUTING QUERY 5] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 6: Produkty najczęściej dodawane do ulubionych
==================================================
[ERROR EXECUTING QUERY 6] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 7: Dostępny Stan Magazynowy Wariantów Produktu Pogrupowany po Magazynach
==================================================
[ERROR EXECUTING QUERY 7] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 8: Stan magazynowy per produkt
==================================================
[ERROR EXECUTING QUERY 8] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 9: Najpopularniejsze Kategorie (wg. Całkowitego Przychodu)
==================================================
[ERROR EXECUTING QUERY 9] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 10: Liczba produktów per kategoria
==================================================
[ERROR EXECUTING QUERY 10] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 11: Liczba zamówień per metoda płatności
==================================================
[ERROR EXECUTING QUERY 11] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 12: Średnia ocena per producent
==================================================
[ERROR EXECUTING QUERY 12] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 13: Aktywne promocje i objęta nimi liczba wariantów
==================================================
[ERROR EXECUTING QUERY 13] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 14: Najczęściej wybierane warianty w koszykach
==================================================
[ERROR EXECUTING QUERY 14] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 15: Produkty z Największą Różnicą Między Ceną Podstawową a Ceną Wariantu
==================================================
[ERROR EXECUTING QUERY 15] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 16: Konwersja zamówień wg statusu
==================================================
[ERROR EXECUTING QUERY 16] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 17: Top klienci wg wydatków
==================================================
[ERROR EXECUTING QUERY 17] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 18: Produkty z wariantami objętymi promocją, z końcową ceną
==================================================
[ERROR EXECUTING QUERY 18] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 19: Użytkownicy, Którzy Dodali Produkt do Koszyka, Ale Nie Złożyli Zamówienia (Potencjał Odbudowy Koszyka)
==================================================
[ERROR EXECUTING QUERY 19] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 20: Wyszukiwanie produktów po nazwie lub opisie (parametryzowane)
==================================================
[ERROR EXECUTING QUERY 20] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 21: Użytkownicy, Którzy Zapisali Konkretny Produkt jako Ulubiony (np. Product ID=350259)
==================================================
[ERROR EXECUTING QUERY 21] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 22: Znajdź Magazyny, Które Posiadają Zapasy Konkretnego Wariantu (np. SKU='VR-000000-a637d44b7afd')
==================================================
[ERROR EXECUTING QUERY 22] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 23: Warianty, Które Wymagają Uzyskania Konkretnej Opcji (np. 'Kolor'='Czerwony')
==================================================
[ERROR EXECUTING QUERY 23] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 24: Znajdź Zamówienia Użytkownika (np. email='debbie.lane.16786.50af0753@example.com') o Statusie 'Paid'
==================================================
[ERROR EXECUTING QUERY 24] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 25: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
[ERROR EXECUTING QUERY 25] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 26: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
[ERROR EXECUTING QUERY 26] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 27: Porównanie Średniej Oceny dla Promowanych i Niepromowanych Produktów
==================================================
[ERROR EXECUTING QUERY 27] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 28: Top 5 Miast Generujących Największy Przychód (Wg. Adresu Wysyłki)
==================================================
[ERROR EXECUTING QUERY 28] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 29: Porównanie Wolumenu Sprzedaży Produktów Promowanych vs. Niepromowanych (w Ostatnich 30 Dniach)
==================================================
[ERROR EXECUTING QUERY 29] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 30: Wskaźnik Lojalności (Repeat Purchase Rate) Użytkowników z Podziałem na Miasto Adresu Rozliczeniowego
==================================================
[ERROR EXECUTING QUERY 30] current transaction is aborted, commands ignored until end of transaction block


FINISHED — 2025-12-02 20:54:53.204235
========================================================================================================================
========================================================================================================================
START EXPLAIN RUN — 2025-12-02 20:55:07.222908
========================================================================================================================


==================================================
EXPLAIN ANALYZE — Query 1: Średnia Wartość Zamówienia (AOV) w Ostatnim Miesiącu
==================================================
Aggregate  (cost=4365.47..4365.48 rows=1 width=32) (actual time=192.240..192.242 rows=1 loops=1)
  ->  GroupAggregate  (cost=4345.48..4357.78 rows=615 width=36) (actual time=191.819..192.189 rows=608 loops=1)
        Group Key: o.id
        ->  Sort  (cost=4345.48..4347.01 rows=615 width=10) (actual time=191.800..191.842 rows=619 loops=1)
              Sort Key: o.id
              Sort Method: quicksort  Memory: 44kB
              ->  Hash Join  (cost=3936.49..4316.99 rows=615 width=10) (actual time=186.117..191.641 rows=619 loops=1)
                    Hash Cond: (oi.order_id = o.id)
                    ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.018..2.505 rows=20000 loops=1)
                    ->  Hash  (cost=3782.83..3782.83 rows=12293 width=4) (actual time=186.035..186.036 rows=12341 loops=1)
                          Buckets: 16384  Batches: 1  Memory Usage: 562kB
                          ->  Bitmap Heap Scan on "Order" o  (cost=231.70..3782.83 rows=12293 width=4) (actual time=4.627..183.078 rows=12341 loops=1)
                                Recheck Cond: (order_date >= (now() - '1 mon'::interval))
                                Heap Blocks: exact=3270
                                ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..228.62 rows=12293 width=0) (actual time=4.244..4.245 rows=12341 loops=1)
                                      Index Cond: (order_date >= (now() - '1 mon'::interval))
Planning Time: 4.840 ms
Execution Time: 192.387 ms


==================================================
EXPLAIN ANALYZE — Query 2: Średnia wartość zamówienia per użytkownik
==================================================
Sort  (cost=16066.87..16115.61 rows=19495 width=50) (actual time=603.730..651.448 rows=19296 loops=1)
  Sort Key: (round(avg(order_totals.total_price), 2)) DESC
  Sort Method: quicksort  Memory: 1612kB
  ->  Finalize HashAggregate  (cost=14385.35..14677.77 rows=19495 width=50) (actual time=578.410..639.406 rows=19296 loops=1)
        Group Key: u.id
        Batches: 5  Memory Usage: 8241kB  Disk Usage: 216kB
        ->  Gather  (cost=12537.36..14263.50 rows=16246 width=50) (actual time=469.182..563.326 rows=19419 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial HashAggregate  (cost=11537.36..11638.90 rows=8123 width=50) (actual time=434.417..439.272 rows=6473 loops=3)
                    Group Key: u.id
                    Batches: 1  Memory Usage: 3473kB
                    Worker 0:  Batches: 1  Memory Usage: 3217kB
                    Worker 1:  Batches: 1  Memory Usage: 2449kB
                    ->  Nested Loop  (cost=1110.75..11496.75 rows=8123 width=50) (actual time=106.087..369.473 rows=6498 loops=3)
                          ->  Hash Join  (cost=1110.33..6550.49 rows=8123 width=36) (actual time=89.086..169.940 rows=6498 loops=3)
                                Hash Cond: (o.id = order_totals.order_id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.008..26.390 rows=133333 loops=3)
                                ->  Hash  (cost=866.64..866.64 rows=19495 width=36) (actual time=85.459..86.357 rows=19495 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1094kB
                                      ->  Subquery Scan on order_totals  (cost=428.00..866.64 rows=19495 width=36) (actual time=68.741..78.913 rows=19495 loops=3)
                                            ->  HashAggregate  (cost=428.00..671.69 rows=19495 width=36) (actual time=68.740..76.540 rows=19495 loops=3)
                                                  Group Key: oi.order_id
                                                  Batches: 1  Memory Usage: 7953kB
                                                  Worker 0:  Batches: 1  Memory Usage: 7953kB
                                                  Worker 1:  Batches: 1  Memory Usage: 7953kB
                                                  ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.029..8.343 rows=20000 loops=3)
                          ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.026..0.026 rows=1 loops=19495)
                                Index Cond: (id = o.user_id)
Planning Time: 3.315 ms
Execution Time: 672.858 ms


==================================================
EXPLAIN ANALYZE — Query 3: Top 10 Najlepiej Sprzedających Się Produktów (wg. Ilości Sprzedanych Jednostek) w Ostatnim Kwartale
==================================================
Limit  (cost=9141.52..9141.54 rows=10 width=46) (actual time=78.615..80.661 rows=1 loops=1)
  ->  Sort  (cost=9141.52..9151.47 rows=3981 width=46) (actual time=78.613..80.659 rows=1 loops=1)
        Sort Key: (sum(oi.quantity)) DESC
        Sort Method: quicksort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=9015.68..9055.49 rows=3981 width=46) (actual time=78.569..80.640 rows=1 loops=1)
              Group Key: p.name, m.name
              Batches: 1  Memory Usage: 217kB
              ->  Gather  (cost=8642.41..8990.80 rows=3318 width=46) (actual time=75.328..80.597 rows=3 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=7642.41..7659.00 rows=1659 width=46) (actual time=35.192..35.203 rows=1 loops=3)
                          Group Key: p.name, m.name
                          Batches: 1  Memory Usage: 73kB
                          Worker 0:  Batches: 1  Memory Usage: 73kB
                          Worker 1:  Batches: 1  Memory Usage: 73kB
                          ->  Hash Join  (cost=2077.42..7629.96 rows=1659 width=42) (actual time=14.670..34.707 rows=1324 loops=3)
                                Hash Cond: (p.manufacturer_id = m.id)
                                ->  Nested Loop  (cost=2072.04..7620.11 rows=1659 width=21) (actual time=14.164..33.868 rows=1324 loops=3)
                                      ->  Nested Loop  (cost=2071.76..7072.47 rows=1659 width=8) (actual time=14.150..31.731 rows=1324 loops=3)
                                            ->  Hash Join  (cost=2071.47..6211.94 rows=1659 width=8) (actual time=14.124..26.735 rows=1324 loops=3)
                                                  Hash Cond: (o.id = oi.order_id)
                                                  ->  Parallel Bitmap Heap Scan on "Order" o  (cost=1493.47..5410.01 rows=33174 width=4) (actual time=3.586..11.534 rows=26380 loops=3)
                                                        Recheck Cond: (order_date >= (now() - '3 mons'::interval))
                                                        Heap Blocks: exact=3016
                                                        ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..1473.56 rows=79618 width=0) (actual time=10.172..10.173 rows=79141 loops=1)
                                                              Index Cond: (order_date >= (now() - '3 mons'::interval))
                                                  ->  Hash  (cost=328.00..328.00 rows=20000 width=12) (actual time=9.115..9.115 rows=20000 loops=3)
                                                        Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                                        ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=12) (actual time=0.021..2.507 rows=20000 loops=3)
                                            ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.52 rows=1 width=8) (actual time=0.003..0.003 rows=1 loops=3973)
                                                  Index Cond: (id = oi.variant_id)
                                      ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=21) (actual time=0.001..0.001 rows=1 loops=3973)
                                            Index Cond: (id = v.product_id)
                                ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.283..0.283 rows=150 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 18kB
                                      ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.024..0.044 rows=150 loops=3)
Planning Time: 29.805 ms
Execution Time: 82.536 ms


==================================================
EXPLAIN ANALYZE — Query 4: Top 5 produktów z najwięcej recenzjami
==================================================
Limit  (cost=1792.59..1792.61 rows=5 width=25) (actual time=468.501..468.505 rows=5 loops=1)
  ->  Sort  (cost=1792.59..1842.59 rows=20000 width=25) (actual time=468.500..468.503 rows=5 loops=1)
        Sort Key: (COALESCE(r.count, '0'::bigint)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Hash Left Join  (cost=969.89..1460.40 rows=20000 width=25) (actual time=246.460..464.408 rows=20000 loops=1)
              Hash Cond: (p.id = r.product_id)
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=2.498..203.501 rows=20000 loops=1)
              ->  Hash  (cost=812.24..812.24 rows=12612 width=12) (actual time=243.940..243.942 rows=12612 loops=1)
                    Buckets: 16384  Batches: 1  Memory Usage: 670kB
                    ->  Subquery Scan on r  (cost=560.00..812.24 rows=12612 width=12) (actual time=237.982..241.929 rows=12612 loops=1)
                          ->  HashAggregate  (cost=560.00..686.12 rows=12612 width=12) (actual time=237.980..240.722 rows=12612 loops=1)
                                Group Key: "Review".product_id
                                Batches: 1  Memory Usage: 1425kB
                                ->  Seq Scan on "Review"  (cost=0.00..460.00 rows=20000 width=4) (actual time=2.436..228.806 rows=20000 loops=1)
Planning Time: 15.122 ms
Execution Time: 468.576 ms


==================================================
EXPLAIN ANALYZE — Query 5: Całkowity Przychód Pogrupowany Miesięcznie za Ostatni Rok
==================================================
Finalize GroupAggregate  (cost=9617.65..11883.29 rows=17380 width=36) (actual time=166.335..168.839 rows=11 loops=1)
  Group Key: ((date_trunc('month'::text, o.order_date))::date)
  ->  Gather Merge  (cost=9617.65..11470.51 rows=14484 width=36) (actual time=166.056..168.810 rows=33 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=8617.62..8798.67 rows=7242 width=36) (actual time=158.807..160.168 rows=11 loops=3)
              Group Key: ((date_trunc('month'::text, o.order_date))::date)
              ->  Sort  (cost=8617.62..8635.73 rows=7242 width=10) (actual time=158.581..159.125 rows=5760 loops=3)
                    Sort Key: ((date_trunc('month'::text, o.order_date))::date) DESC
                    Sort Method: quicksort  Memory: 664kB
                    Worker 0:  Sort Method: quicksort  Memory: 327kB
                    Worker 1:  Sort Method: quicksort  Memory: 223kB
                    ->  Parallel Hash Join  (cost=681.00..8153.33 rows=7242 width=10) (actual time=66.487..157.375 rows=5760 loops=3)
                          Hash Cond: (o.id = oi.order_id)
                          ->  Parallel Seq Scan on "Order" o  (cost=0.00..6669.33 rows=144838 width=12) (actual time=0.020..57.045 rows=115772 loops=3)
                                Filter: (order_date >= (date_trunc('year'::text, now()) - '00:00:00'::interval))
                                Rows Removed by Filter: 17562
                          ->  Parallel Hash  (cost=533.93..533.93 rows=11765 width=10) (actual time=64.725..64.726 rows=6667 loops=3)
                                Buckets: 32768  Batches: 1  Memory Usage: 1248kB
                                ->  Parallel Index Only Scan using idx_orderitem_order_price_cover on "OrderItem" oi  (cost=0.29..533.93 rows=11765 width=10) (actual time=1.666..62.807 rows=6667 loops=3)
                                      Heap Fetches: 0
Planning Time: 0.369 ms
Execution Time: 171.120 ms


==================================================
EXPLAIN ANALYZE — Query 6: Produkty najczęściej dodawane do ulubionych
==================================================
Limit  (cost=14382.58..14382.60 rows=10 width=25) (actual time=717.165..767.437 rows=10 loops=1)
  ->  Sort  (cost=14382.58..14432.58 rows=20000 width=25) (actual time=717.156..767.427 rows=10 loops=1)
        Sort Key: (count(f.id)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=13750.38..13950.38 rows=20000 width=25) (actual time=709.349..763.590 rows=20000 loops=1)
              Group Key: p.id
              Batches: 1  Memory Usage: 2577kB
              ->  Gather  (cost=9350.38..13550.38 rows=40000 width=25) (actual time=648.488..736.220 rows=59996 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=8350.38..8550.38 rows=20000 width=25) (actual time=644.019..649.283 rows=19999 loops=3)
                          Group Key: p.id
                          Batches: 1  Memory Usage: 2577kB
                          Worker 0:  Batches: 1  Memory Usage: 2577kB
                          Worker 1:  Batches: 1  Memory Usage: 2577kB
                          ->  Hash Join  (cost=688.00..7100.38 rows=250000 width=21) (actual time=8.991..568.684 rows=200000 loops=3)
                                Hash Cond: (f.product_id = p.id)
                                ->  Parallel Seq Scan on "FavoriteProduct" f  (cost=0.00..5756.00 rows=250000 width=8) (actual time=2.122..479.553 rows=200000 loops=3)
                                ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=6.795..6.796 rows=20000 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1215kB
                                      ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.024..2.553 rows=20000 loops=3)
Planning Time: 17.358 ms
Execution Time: 775.941 ms


==================================================
EXPLAIN ANALYZE — Query 7: Dostępny Stan Magazynowy Wariantów Produktu Pogrupowany po Magazynach
==================================================
[ERROR EXECUTING QUERY 7] relation "StockItem" does not exist
LINE 7:         FROM "StockItem" si
                     ^



==================================================
EXPLAIN ANALYZE — Query 8: Stan magazynowy per produkt
==================================================
[ERROR EXECUTING QUERY 8] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 9: Najpopularniejsze Kategorie (wg. Całkowitego Przychodu)
==================================================
[ERROR EXECUTING QUERY 9] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 10: Liczba produktów per kategoria
==================================================
[ERROR EXECUTING QUERY 10] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 11: Liczba zamówień per metoda płatności
==================================================
[ERROR EXECUTING QUERY 11] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 12: Średnia ocena per producent
==================================================
[ERROR EXECUTING QUERY 12] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 13: Aktywne promocje i objęta nimi liczba wariantów
==================================================
[ERROR EXECUTING QUERY 13] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 14: Najczęściej wybierane warianty w koszykach
==================================================
[ERROR EXECUTING QUERY 14] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 15: Produkty z Największą Różnicą Między Ceną Podstawową a Ceną Wariantu
==================================================
[ERROR EXECUTING QUERY 15] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 16: Konwersja zamówień wg statusu
==================================================
[ERROR EXECUTING QUERY 16] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 17: Top klienci wg wydatków
==================================================
[ERROR EXECUTING QUERY 17] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 18: Produkty z wariantami objętymi promocją, z końcową ceną
==================================================
[ERROR EXECUTING QUERY 18] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 19: Użytkownicy, Którzy Dodali Produkt do Koszyka, Ale Nie Złożyli Zamówienia (Potencjał Odbudowy Koszyka)
==================================================
[ERROR EXECUTING QUERY 19] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 20: Wyszukiwanie produktów po nazwie lub opisie (parametryzowane)
==================================================
[ERROR EXECUTING QUERY 20] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 21: Użytkownicy, Którzy Zapisali Konkretny Produkt jako Ulubiony (np. Product ID=350259)
==================================================
[ERROR EXECUTING QUERY 21] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 22: Znajdź Magazyny, Które Posiadają Zapasy Konkretnego Wariantu (np. SKU='VR-000000-a637d44b7afd')
==================================================
[ERROR EXECUTING QUERY 22] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 23: Warianty, Które Wymagają Uzyskania Konkretnej Opcji (np. 'Kolor'='Czerwony')
==================================================
[ERROR EXECUTING QUERY 23] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 24: Znajdź Zamówienia Użytkownika (np. email='debbie.lane.16786.50af0753@example.com') o Statusie 'Paid'
==================================================
[ERROR EXECUTING QUERY 24] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 25: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
[ERROR EXECUTING QUERY 25] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 26: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
[ERROR EXECUTING QUERY 26] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 27: Porównanie Średniej Oceny dla Promowanych i Niepromowanych Produktów
==================================================
[ERROR EXECUTING QUERY 27] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 28: Top 5 Miast Generujących Największy Przychód (Wg. Adresu Wysyłki)
==================================================
[ERROR EXECUTING QUERY 28] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 29: Porównanie Wolumenu Sprzedaży Produktów Promowanych vs. Niepromowanych (w Ostatnich 30 Dniach)
==================================================
[ERROR EXECUTING QUERY 29] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 30: Wskaźnik Lojalności (Repeat Purchase Rate) Użytkowników z Podziałem na Miasto Adresu Rozliczeniowego
==================================================
[ERROR EXECUTING QUERY 30] current transaction is aborted, commands ignored until end of transaction block


FINISHED — 2025-12-02 20:55:11.277177
========================================================================================================================
========================================================================================================================
START EXPLAIN RUN — 2025-12-02 20:56:29.926753
========================================================================================================================


==================================================
EXPLAIN ANALYZE — Query 1: Średnia Wartość Zamówienia (AOV) w Ostatnim Miesiącu
==================================================
Aggregate  (cost=4365.43..4365.44 rows=1 width=32) (actual time=25.778..25.781 rows=1 loops=1)
  ->  GroupAggregate  (cost=4345.44..4357.74 rows=615 width=36) (actual time=25.349..25.728 rows=608 loops=1)
        Group Key: o.id
        ->  Sort  (cost=4345.44..4346.98 rows=615 width=10) (actual time=24.546..24.602 rows=619 loops=1)
              Sort Key: o.id
              Sort Method: quicksort  Memory: 44kB
              ->  Hash Join  (cost=3936.45..4316.95 rows=615 width=10) (actual time=19.122..24.385 rows=619 loops=1)
                    Hash Cond: (oi.order_id = o.id)
                    ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.020..2.530 rows=20000 loops=1)
                    ->  Hash  (cost=3782.80..3782.80 rows=12292 width=4) (actual time=18.811..18.812 rows=12340 loops=1)
                          Buckets: 16384  Batches: 1  Memory Usage: 562kB
                          ->  Bitmap Heap Scan on "Order" o  (cost=231.69..3782.80 rows=12292 width=4) (actual time=2.535..15.861 rows=12340 loops=1)
                                Recheck Cond: (order_date >= (now() - '1 mon'::interval))
                                Heap Blocks: exact=3270
                                ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..228.62 rows=12292 width=0) (actual time=2.140..2.140 rows=12340 loops=1)
                                      Index Cond: (order_date >= (now() - '1 mon'::interval))
Planning Time: 4.969 ms
Execution Time: 26.525 ms


==================================================
EXPLAIN ANALYZE — Query 2: Średnia wartość zamówienia per użytkownik
==================================================
Sort  (cost=16066.87..16115.61 rows=19495 width=50) (actual time=2265.497..2276.232 rows=19296 loops=1)
  Sort Key: (round(avg(order_totals.total_price), 2)) DESC
  Sort Method: quicksort  Memory: 1612kB
  ->  Finalize HashAggregate  (cost=14385.35..14677.77 rows=19495 width=50) (actual time=2226.167..2262.861 rows=19296 loops=1)
        Group Key: u.id
        Batches: 5  Memory Usage: 8241kB  Disk Usage: 224kB
        ->  Gather  (cost=12537.36..14263.50 rows=16246 width=50) (actual time=1783.427..2142.178 rows=19413 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial HashAggregate  (cost=11537.36..11638.90 rows=8123 width=50) (actual time=1284.344..1377.939 rows=6471 loops=3)
                    Group Key: u.id
                    Batches: 1  Memory Usage: 5009kB
                    Worker 0:  Batches: 1  Memory Usage: 2193kB
                    Worker 1:  Batches: 1  Memory Usage: 1937kB
                    ->  Nested Loop  (cost=1110.75..11496.75 rows=8123 width=50) (actual time=92.895..1099.663 rows=6498 loops=3)
                          ->  Hash Join  (cost=1110.33..6550.49 rows=8123 width=36) (actual time=75.614..289.702 rows=6498 loops=3)
                                Hash Cond: (o.id = order_totals.order_id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.014..77.406 rows=133333 loops=3)
                                ->  Hash  (cost=866.64..866.64 rows=19495 width=36) (actual time=73.071..73.877 rows=19495 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1094kB
                                      ->  Subquery Scan on order_totals  (cost=428.00..866.64 rows=19495 width=36) (actual time=50.894..64.621 rows=19495 loops=3)
                                            ->  HashAggregate  (cost=428.00..671.69 rows=19495 width=36) (actual time=50.372..61.669 rows=19495 loops=3)
                                                  Group Key: oi.order_id
                                                  Batches: 1  Memory Usage: 7953kB
                                                  Worker 0:  Batches: 1  Memory Usage: 7953kB
                                                  Worker 1:  Batches: 1  Memory Usage: 7953kB
                                                  ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=5.414..11.482 rows=20000 loops=3)
                          ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.095..0.095 rows=1 loops=19495)
                                Index Cond: (id = o.user_id)
Planning Time: 2.090 ms
Execution Time: 2309.903 ms


==================================================
EXPLAIN ANALYZE — Query 3: Top 10 Najlepiej Sprzedających Się Produktów (wg. Ilości Sprzedanych Jednostek) w Ostatnim Kwartale
==================================================
Limit  (cost=9141.50..9141.53 rows=10 width=46) (actual time=86.410..140.132 rows=1 loops=1)
  ->  Sort  (cost=9141.50..9151.46 rows=3981 width=46) (actual time=86.408..140.130 rows=1 loops=1)
        Sort Key: (sum(oi.quantity)) DESC
        Sort Method: quicksort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=9015.67..9055.48 rows=3981 width=46) (actual time=85.765..139.508 rows=1 loops=1)
              Group Key: p.name, m.name
              Batches: 1  Memory Usage: 217kB
              ->  Gather  (cost=8642.39..8990.78 rows=3318 width=46) (actual time=81.665..139.467 rows=3 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=7642.39..7658.98 rows=1659 width=46) (actual time=42.308..42.318 rows=1 loops=3)
                          Group Key: p.name, m.name
                          Batches: 1  Memory Usage: 73kB
                          Worker 0:  Batches: 1  Memory Usage: 73kB
                          Worker 1:  Batches: 1  Memory Usage: 73kB
                          ->  Hash Join  (cost=2077.41..7629.95 rows=1659 width=42) (actual time=15.092..40.055 rows=1324 loops=3)
                                Hash Cond: (p.manufacturer_id = m.id)
                                ->  Nested Loop  (cost=2072.04..7620.10 rows=1659 width=21) (actual time=14.350..38.976 rows=1324 loops=3)
                                      ->  Nested Loop  (cost=2071.75..7072.45 rows=1659 width=8) (actual time=14.136..36.460 rows=1324 loops=3)
                                            ->  Hash Join  (cost=2071.46..6211.93 rows=1659 width=8) (actual time=14.105..33.911 rows=1324 loops=3)
                                                  Hash Cond: (o.id = oi.order_id)
                                                  ->  Parallel Bitmap Heap Scan on "Order" o  (cost=1493.46..5410.00 rows=33174 width=4) (actual time=3.586..18.713 rows=26380 loops=3)
                                                        Recheck Cond: (order_date >= (now() - '3 mons'::interval))
                                                        Heap Blocks: exact=1469
                                                        ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..1473.55 rows=79617 width=0) (actual time=10.162..10.162 rows=79141 loops=1)
                                                              Index Cond: (order_date >= (now() - '3 mons'::interval))
                                                  ->  Hash  (cost=328.00..328.00 rows=20000 width=12) (actual time=8.435..8.436 rows=20000 loops=3)
                                                        Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                                        ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=12) (actual time=0.025..2.567 rows=20000 loops=3)
                                            ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.52 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=3973)
                                                  Index Cond: (id = oi.variant_id)
                                      ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=21) (actual time=0.001..0.001 rows=1 loops=3973)
                                            Index Cond: (id = v.product_id)
                                ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.521..0.521 rows=150 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 18kB
                                      ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.033..0.052 rows=150 loops=3)
Planning Time: 33.478 ms
Execution Time: 143.885 ms


==================================================
EXPLAIN ANALYZE — Query 4: Top 5 produktów z najwięcej recenzjami
==================================================
Limit  (cost=1792.59..1792.61 rows=5 width=25) (actual time=40.083..40.086 rows=5 loops=1)
  ->  Sort  (cost=1792.59..1842.59 rows=20000 width=25) (actual time=40.081..40.083 rows=5 loops=1)
        Sort Key: (COALESCE(r.count, '0'::bigint)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Hash Left Join  (cost=969.89..1460.40 rows=20000 width=25) (actual time=23.177..36.305 rows=20000 loops=1)
              Hash Cond: (p.id = r.product_id)
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.013..5.744 rows=20000 loops=1)
              ->  Hash  (cost=812.24..812.24 rows=12612 width=12) (actual time=23.154..23.156 rows=12612 loops=1)
                    Buckets: 16384  Batches: 1  Memory Usage: 670kB
                    ->  Subquery Scan on r  (cost=560.00..812.24 rows=12612 width=12) (actual time=17.607..21.101 rows=12612 loops=1)
                          ->  HashAggregate  (cost=560.00..686.12 rows=12612 width=12) (actual time=17.606..19.915 rows=12612 loops=1)
                                Group Key: "Review".product_id
                                Batches: 1  Memory Usage: 1425kB
                                ->  Seq Scan on "Review"  (cost=0.00..460.00 rows=20000 width=4) (actual time=0.010..7.784 rows=20000 loops=1)
Planning Time: 6.150 ms
Execution Time: 40.904 ms


==================================================
EXPLAIN ANALYZE — Query 5: Całkowity Przychód Pogrupowany Miesięcznie za Ostatni Rok
==================================================
Finalize GroupAggregate  (cost=9617.65..11883.29 rows=17380 width=36) (actual time=131.757..186.989 rows=11 loops=1)
  Group Key: ((date_trunc('month'::text, o.order_date))::date)
  ->  Gather Merge  (cost=9617.65..11470.51 rows=14484 width=36) (actual time=131.403..186.966 rows=33 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=8617.62..8798.67 rows=7242 width=36) (actual time=94.985..96.293 rows=11 loops=3)
              Group Key: ((date_trunc('month'::text, o.order_date))::date)
              ->  Sort  (cost=8617.62..8635.73 rows=7242 width=10) (actual time=93.413..93.902 rows=5760 loops=3)
                    Sort Key: ((date_trunc('month'::text, o.order_date))::date) DESC
                    Sort Method: quicksort  Memory: 712kB
                    Worker 0:  Sort Method: quicksort  Memory: 194kB
                    Worker 1:  Sort Method: quicksort  Memory: 211kB
                    ->  Parallel Hash Join  (cost=681.00..8153.33 rows=7242 width=10) (actual time=9.436..92.198 rows=5760 loops=3)
                          Hash Cond: (o.id = oi.order_id)
                          ->  Parallel Seq Scan on "Order" o  (cost=0.00..6669.33 rows=144838 width=12) (actual time=0.014..57.007 rows=115772 loops=3)
                                Filter: (order_date >= (date_trunc('year'::text, now()) - '00:00:00'::interval))
                                Rows Removed by Filter: 17562
                          ->  Parallel Hash  (cost=533.93..533.93 rows=11765 width=10) (actual time=5.080..5.080 rows=6667 loops=3)
                                Buckets: 32768  Batches: 1  Memory Usage: 1216kB
                                ->  Parallel Index Only Scan using idx_orderitem_order_price_cover on "OrderItem" oi  (cost=0.29..533.93 rows=11765 width=10) (actual time=0.015..7.834 rows=20000 loops=1)
                                      Heap Fetches: 0
Planning Time: 1.050 ms
Execution Time: 188.130 ms


==================================================
EXPLAIN ANALYZE — Query 6: Produkty najczęściej dodawane do ulubionych
==================================================
Limit  (cost=14382.58..14382.60 rows=10 width=25) (actual time=354.192..411.145 rows=10 loops=1)
  ->  Sort  (cost=14382.58..14432.58 rows=20000 width=25) (actual time=353.357..410.309 rows=10 loops=1)
        Sort Key: (count(f.id)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=13750.38..13950.38 rows=20000 width=25) (actual time=346.231..406.304 rows=20000 loops=1)
              Group Key: p.id
              Batches: 1  Memory Usage: 2577kB
              ->  Gather  (cost=9350.38..13550.38 rows=40000 width=25) (actual time=279.479..381.881 rows=59998 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=8350.38..8550.38 rows=20000 width=25) (actual time=257.885..262.429 rows=19999 loops=3)
                          Group Key: p.id
                          Batches: 1  Memory Usage: 2577kB
                          Worker 0:  Batches: 1  Memory Usage: 2577kB
                          Worker 1:  Batches: 1  Memory Usage: 2577kB
                          ->  Hash Join  (cost=688.00..7100.38 rows=250000 width=21) (actual time=11.156..194.877 rows=200000 loops=3)
                                Hash Cond: (f.product_id = p.id)
                                ->  Parallel Seq Scan on "FavoriteProduct" f  (cost=0.00..5756.00 rows=250000 width=8) (actual time=0.170..77.122 rows=200000 loops=3)
                                ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=7.199..7.200 rows=20000 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1215kB
                                      ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.033..2.670 rows=20000 loops=3)
Planning Time: 6.489 ms
Execution Time: 422.405 ms


==================================================
EXPLAIN ANALYZE — Query 7: Dostępny Stan Magazynowy Wariantów Produktu Pogrupowany po Magazynach
==================================================
Finalize GroupAggregate  (cost=8886.64..10869.06 rows=16000 width=61) (actual time=1371.520..1873.877 rows=231755 loops=1)
  Group Key: p.name, w.name, v.sku
  ->  Gather Merge  (cost=8886.64..10575.72 rows=13334 width=61) (actual time=1369.758..1778.133 rows=268273 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=7886.61..8036.62 rows=6667 width=61) (actual time=1322.611..1451.564 rows=89424 loops=3)
              Group Key: p.name, w.name, v.sku
              ->  Sort  (cost=7886.61..7903.28 rows=6667 width=57) (actual time=1321.292..1403.802 rows=106667 loops=3)
                    Sort Key: p.name, w.name, v.sku
                    Sort Method: external merge  Disk: 5616kB
                    Worker 0:  Sort Method: external merge  Disk: 7760kB
                    Worker 1:  Sort Method: external merge  Disk: 8392kB
                    ->  Hash Join  (cost=2543.72..7463.16 rows=6667 width=57) (actual time=262.607..830.504 rows=106667 loops=3)
                          Hash Cond: (v.product_id = p.id)
                          ->  Hash Join  (cost=1855.72..6757.66 rows=6667 width=48) (actual time=255.173..778.487 rows=106667 loops=3)
                                Hash Cond: (ssi.variant_id = v.id)
                                ->  Hash Join  (cost=1.23..4885.66 rows=6667 width=25) (actual time=1.839..435.352 rows=106667 loops=3)
                                      Hash Cond: (ssi.warehouse_id = w.id)
                                      ->  Parallel Append  (cost=0.00..4527.02 rows=133333 width=12) (actual time=1.143..376.100 rows=106667 loops=3)
                                            ->  Parallel Seq Scan on "SerialStockItem" ssi  (cost=0.00..2001.16 rows=93816 width=12) (actual time=5.602..150.487 rows=53163 loops=3)
                                            ->  Parallel Seq Scan on "BulkStockItem" bsi  (cost=0.00..1859.19 rows=94419 width=12) (actual time=1.063..320.933 rows=80256 loops=2)
                                      ->  Hash  (cost=1.10..1.10 rows=10 width=21) (actual time=0.675..1.228 rows=10 loops=3)
                                            Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                            ->  Seq Scan on "Warehouse" w  (cost=0.00..1.10 rows=10 width=21) (actual time=0.667..0.669 rows=10 loops=3)
                                ->  Hash  (cost=1267.00..1267.00 rows=47000 width=31) (actual time=251.110..251.111 rows=47000 loops=3)
                                      Buckets: 65536  Batches: 1  Memory Usage: 3450kB
                                      ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=31) (actual time=0.655..224.473 rows=47000 loops=3)
                          ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=7.275..7.276 rows=20000 loops=3)
                                Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                                ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.093..2.777 rows=20000 loops=3)
Planning Time: 22.683 ms
Execution Time: 1896.954 ms


==================================================
EXPLAIN ANALYZE — Query 8: Stan magazynowy per produkt
==================================================
[ERROR EXECUTING QUERY 8] relation "StockItem" does not exist
LINE 7:         JOIN "StockItem" si ON si.variant_id = v.id
                     ^



==================================================
EXPLAIN ANALYZE — Query 9: Najpopularniejsze Kategorie (wg. Całkowitego Przychodu)
==================================================
[ERROR EXECUTING QUERY 9] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 10: Liczba produktów per kategoria
==================================================
[ERROR EXECUTING QUERY 10] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 11: Liczba zamówień per metoda płatności
==================================================
[ERROR EXECUTING QUERY 11] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 12: Średnia ocena per producent
==================================================
[ERROR EXECUTING QUERY 12] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 13: Aktywne promocje i objęta nimi liczba wariantów
==================================================
[ERROR EXECUTING QUERY 13] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 14: Najczęściej wybierane warianty w koszykach
==================================================
[ERROR EXECUTING QUERY 14] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 15: Produkty z Największą Różnicą Między Ceną Podstawową a Ceną Wariantu
==================================================
[ERROR EXECUTING QUERY 15] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 16: Konwersja zamówień wg statusu
==================================================
[ERROR EXECUTING QUERY 16] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 17: Top klienci wg wydatków
==================================================
[ERROR EXECUTING QUERY 17] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 18: Produkty z wariantami objętymi promocją, z końcową ceną
==================================================
[ERROR EXECUTING QUERY 18] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 19: Użytkownicy, Którzy Dodali Produkt do Koszyka, Ale Nie Złożyli Zamówienia (Potencjał Odbudowy Koszyka)
==================================================
[ERROR EXECUTING QUERY 19] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 20: Wyszukiwanie produktów po nazwie lub opisie (parametryzowane)
==================================================
[ERROR EXECUTING QUERY 20] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 21: Użytkownicy, Którzy Zapisali Konkretny Produkt jako Ulubiony (np. Product ID=350259)
==================================================
[ERROR EXECUTING QUERY 21] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 22: Znajdź Magazyny, Które Posiadają Zapasy Konkretnego Wariantu (np. SKU='VR-000000-a637d44b7afd')
==================================================
[ERROR EXECUTING QUERY 22] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 23: Warianty, Które Wymagają Uzyskania Konkretnej Opcji (np. 'Kolor'='Czerwony')
==================================================
[ERROR EXECUTING QUERY 23] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 24: Znajdź Zamówienia Użytkownika (np. email='debbie.lane.16786.50af0753@example.com') o Statusie 'Paid'
==================================================
[ERROR EXECUTING QUERY 24] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 25: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
[ERROR EXECUTING QUERY 25] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 26: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
[ERROR EXECUTING QUERY 26] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 27: Porównanie Średniej Oceny dla Promowanych i Niepromowanych Produktów
==================================================
[ERROR EXECUTING QUERY 27] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 28: Top 5 Miast Generujących Największy Przychód (Wg. Adresu Wysyłki)
==================================================
[ERROR EXECUTING QUERY 28] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 29: Porównanie Wolumenu Sprzedaży Produktów Promowanych vs. Niepromowanych (w Ostatnich 30 Dniach)
==================================================
[ERROR EXECUTING QUERY 29] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 30: Wskaźnik Lojalności (Repeat Purchase Rate) Użytkowników z Podziałem na Miasto Adresu Rozliczeniowego
==================================================
[ERROR EXECUTING QUERY 30] current transaction is aborted, commands ignored until end of transaction block


FINISHED — 2025-12-02 20:56:36.792210
========================================================================================================================
========================================================================================================================
START EXPLAIN RUN — 2025-12-02 20:57:18.103692
========================================================================================================================


==================================================
EXPLAIN ANALYZE — Query 1: Średnia Wartość Zamówienia (AOV) w Ostatnim Miesiącu
==================================================
Aggregate  (cost=4365.43..4365.44 rows=1 width=32) (actual time=103.850..103.853 rows=1 loops=1)
  ->  GroupAggregate  (cost=4345.44..4357.74 rows=615 width=36) (actual time=103.428..103.800 rows=608 loops=1)
        Group Key: o.id
        ->  Sort  (cost=4345.44..4346.98 rows=615 width=10) (actual time=103.410..103.455 rows=619 loops=1)
              Sort Key: o.id
              Sort Method: quicksort  Memory: 44kB
              ->  Hash Join  (cost=3936.45..4316.95 rows=615 width=10) (actual time=97.581..103.252 rows=619 loops=1)
                    Hash Cond: (oi.order_id = o.id)
                    ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.019..3.064 rows=20000 loops=1)
                    ->  Hash  (cost=3782.80..3782.80 rows=12292 width=4) (actual time=97.503..97.504 rows=12338 loops=1)
                          Buckets: 16384  Batches: 1  Memory Usage: 562kB
                          ->  Bitmap Heap Scan on "Order" o  (cost=231.69..3782.80 rows=12292 width=4) (actual time=1.368..95.099 rows=12338 loops=1)
                                Recheck Cond: (order_date >= (now() - '1 mon'::interval))
                                Heap Blocks: exact=3270
                                ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..228.62 rows=12292 width=0) (actual time=0.993..0.994 rows=12338 loops=1)
                                      Index Cond: (order_date >= (now() - '1 mon'::interval))
Planning Time: 6.871 ms
Execution Time: 103.983 ms


==================================================
EXPLAIN ANALYZE — Query 2: Średnia wartość zamówienia per użytkownik
==================================================
Sort  (cost=16066.87..16115.61 rows=19495 width=50) (actual time=1298.647..1374.435 rows=19296 loops=1)
  Sort Key: (round(avg(order_totals.total_price), 2)) DESC
  Sort Method: quicksort  Memory: 1612kB
  ->  Finalize HashAggregate  (cost=14385.35..14677.77 rows=19495 width=50) (actual time=1269.527..1359.970 rows=19296 loops=1)
        Group Key: u.id
        Batches: 5  Memory Usage: 8241kB  Disk Usage: 224kB
        ->  Gather  (cost=12537.36..14263.50 rows=16246 width=50) (actual time=1121.358..1265.845 rows=19424 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial HashAggregate  (cost=11537.36..11638.90 rows=8123 width=50) (actual time=1110.386..1115.970 rows=6475 loops=3)
                    Group Key: u.id
                    Batches: 1  Memory Usage: 2961kB
                    Worker 0:  Batches: 1  Memory Usage: 2961kB
                    Worker 1:  Batches: 1  Memory Usage: 2961kB
                    ->  Nested Loop  (cost=1110.75..11496.75 rows=8123 width=50) (actual time=121.206..1061.355 rows=6498 loops=3)
                          ->  Hash Join  (cost=1110.33..6550.49 rows=8123 width=36) (actual time=111.181..245.430 rows=6498 loops=3)
                                Hash Cond: (o.id = order_totals.order_id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.007..75.763 rows=133333 loops=3)
                                ->  Hash  (cost=866.64..866.64 rows=19495 width=36) (actual time=105.268..106.642 rows=19495 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1094kB
                                      ->  Subquery Scan on order_totals  (cost=428.00..866.64 rows=19495 width=36) (actual time=40.904..74.406 rows=19495 loops=3)
                                            ->  HashAggregate  (cost=428.00..671.69 rows=19495 width=36) (actual time=40.903..68.169 rows=19495 loops=3)
                                                  Group Key: oi.order_id
                                                  Batches: 1  Memory Usage: 7953kB
                                                  Worker 0:  Batches: 1  Memory Usage: 7953kB
                                                  Worker 1:  Batches: 1  Memory Usage: 7953kB
                                                  ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.140..5.688 rows=20000 loops=3)
                          ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.122..0.122 rows=1 loops=19495)
                                Index Cond: (id = o.user_id)
Planning Time: 1.848 ms
Execution Time: 1409.686 ms


==================================================
EXPLAIN ANALYZE — Query 3: Top 10 Najlepiej Sprzedających Się Produktów (wg. Ilości Sprzedanych Jednostek) w Ostatnim Kwartale
==================================================
Limit  (cost=9141.48..9141.51 rows=10 width=46) (actual time=100.357..152.790 rows=1 loops=1)
  ->  Sort  (cost=9141.48..9151.44 rows=3981 width=46) (actual time=100.356..152.787 rows=1 loops=1)
        Sort Key: (sum(oi.quantity)) DESC
        Sort Method: quicksort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=9015.65..9055.46 rows=3981 width=46) (actual time=100.305..152.761 rows=1 loops=1)
              Group Key: p.name, m.name
              Batches: 1  Memory Usage: 217kB
              ->  Gather  (cost=8642.37..8990.76 rows=3318 width=46) (actual time=97.760..152.715 rows=3 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=7642.37..7658.96 rows=1659 width=46) (actual time=39.018..39.028 rows=1 loops=3)
                          Group Key: p.name, m.name
                          Batches: 1  Memory Usage: 73kB
                          Worker 0:  Batches: 1  Memory Usage: 73kB
                          Worker 1:  Batches: 1  Memory Usage: 73kB
                          ->  Hash Join  (cost=2077.40..7629.93 rows=1659 width=42) (actual time=17.147..38.256 rows=1324 loops=3)
                                Hash Cond: (p.manufacturer_id = m.id)
                                ->  Nested Loop  (cost=2072.03..7620.08 rows=1659 width=21) (actual time=16.651..37.412 rows=1324 loops=3)
                                      ->  Nested Loop  (cost=2071.74..7072.43 rows=1659 width=8) (actual time=16.633..35.334 rows=1324 loops=3)
                                            ->  Hash Join  (cost=2071.45..6211.91 rows=1659 width=8) (actual time=16.219..32.656 rows=1324 loops=3)
                                                  Hash Cond: (o.id = oi.order_id)
                                                  ->  Parallel Bitmap Heap Scan on "Order" o  (cost=1493.45..5409.98 rows=33173 width=4) (actual time=7.635..15.231 rows=26380 loops=3)
                                                        Recheck Cond: (order_date >= (now() - '3 mons'::interval))
                                                        Heap Blocks: exact=3243
                                                        ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..1473.55 rows=79616 width=0) (actual time=22.302..22.303 rows=79140 loops=1)
                                                              Index Cond: (order_date >= (now() - '3 mons'::interval))
                                                  ->  Hash  (cost=328.00..328.00 rows=20000 width=12) (actual time=6.929..6.930 rows=20000 loops=3)
                                                        Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                                        ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=12) (actual time=0.023..2.570 rows=20000 loops=3)
                                            ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.52 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=3972)
                                                  Index Cond: (id = oi.variant_id)
                                      ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=21) (actual time=0.001..0.001 rows=1 loops=3972)
                                            Index Cond: (id = v.product_id)
                                ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.473..0.474 rows=150 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 18kB
                                      ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.032..0.053 rows=150 loops=3)
Planning Time: 22.751 ms
Execution Time: 155.924 ms


==================================================
EXPLAIN ANALYZE — Query 4: Top 5 produktów z najwięcej recenzjami
==================================================
Limit  (cost=1792.59..1792.61 rows=5 width=25) (actual time=29.972..29.976 rows=5 loops=1)
  ->  Sort  (cost=1792.59..1842.59 rows=20000 width=25) (actual time=29.971..29.974 rows=5 loops=1)
        Sort Key: (COALESCE(r.count, '0'::bigint)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Hash Left Join  (cost=969.89..1460.40 rows=20000 width=25) (actual time=17.135..26.796 rows=20000 loops=1)
              Hash Cond: (p.id = r.product_id)
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.010..3.019 rows=20000 loops=1)
              ->  Hash  (cost=812.24..812.24 rows=12612 width=12) (actual time=17.114..17.116 rows=12612 loops=1)
                    Buckets: 16384  Batches: 1  Memory Usage: 670kB
                    ->  Subquery Scan on r  (cost=560.00..812.24 rows=12612 width=12) (actual time=11.581..15.044 rows=12612 loops=1)
                          ->  HashAggregate  (cost=560.00..686.12 rows=12612 width=12) (actual time=11.580..13.857 rows=12612 loops=1)
                                Group Key: "Review".product_id
                                Batches: 1  Memory Usage: 1425kB
                                ->  Seq Scan on "Review"  (cost=0.00..460.00 rows=20000 width=4) (actual time=0.005..2.223 rows=20000 loops=1)
Planning Time: 3.062 ms
Execution Time: 30.041 ms


==================================================
EXPLAIN ANALYZE — Query 5: Całkowity Przychód Pogrupowany Miesięcznie za Ostatni Rok
==================================================
Finalize GroupAggregate  (cost=9617.65..11883.29 rows=17380 width=36) (actual time=120.869..164.512 rows=11 loops=1)
  Group Key: ((date_trunc('month'::text, o.order_date))::date)
  ->  Gather Merge  (cost=9617.65..11470.51 rows=14484 width=36) (actual time=120.557..164.487 rows=33 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=8617.62..8798.67 rows=7242 width=36) (actual time=100.469..101.819 rows=11 loops=3)
              Group Key: ((date_trunc('month'::text, o.order_date))::date)
              ->  Sort  (cost=8617.62..8635.73 rows=7242 width=10) (actual time=99.252..99.772 rows=5760 loops=3)
                    Sort Key: ((date_trunc('month'::text, o.order_date))::date) DESC
                    Sort Method: quicksort  Memory: 676kB
                    Worker 0:  Sort Method: quicksort  Memory: 216kB
                    Worker 1:  Sort Method: quicksort  Memory: 322kB
                    ->  Parallel Hash Join  (cost=681.00..8153.33 rows=7242 width=10) (actual time=6.784..95.384 rows=5760 loops=3)
                          Hash Cond: (o.id = oi.order_id)
                          ->  Parallel Seq Scan on "Order" o  (cost=0.00..6669.33 rows=144838 width=12) (actual time=0.012..58.279 rows=115772 loops=3)
                                Filter: (order_date >= (date_trunc('year'::text, now()) - '00:00:00'::interval))
                                Rows Removed by Filter: 17562
                          ->  Parallel Hash  (cost=533.93..533.93 rows=11765 width=10) (actual time=6.613..6.613 rows=6667 loops=3)
                                Buckets: 32768  Batches: 1  Memory Usage: 1216kB
                                ->  Parallel Index Only Scan using idx_orderitem_order_price_cover on "OrderItem" oi  (cost=0.29..533.93 rows=11765 width=10) (actual time=0.013..13.912 rows=20000 loops=1)
                                      Heap Fetches: 0
Planning Time: 1.099 ms
Execution Time: 164.605 ms


==================================================
EXPLAIN ANALYZE — Query 6: Produkty najczęściej dodawane do ulubionych
==================================================
Limit  (cost=14382.58..14382.60 rows=10 width=25) (actual time=338.501..411.372 rows=10 loops=1)
  ->  Sort  (cost=14382.58..14432.58 rows=20000 width=25) (actual time=337.188..409.305 rows=10 loops=1)
        Sort Key: (count(f.id)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=13750.38..13950.38 rows=20000 width=25) (actual time=330.237..405.424 rows=20000 loops=1)
              Group Key: p.id
              Batches: 1  Memory Usage: 2577kB
              ->  Gather  (cost=9350.38..13550.38 rows=40000 width=25) (actual time=280.885..381.455 rows=59995 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=8350.38..8550.38 rows=20000 width=25) (actual time=268.285..272.916 rows=19998 loops=3)
                          Group Key: p.id
                          Batches: 1  Memory Usage: 2577kB
                          Worker 0:  Batches: 1  Memory Usage: 2577kB
                          Worker 1:  Batches: 1  Memory Usage: 2577kB
                          ->  Hash Join  (cost=688.00..7100.38 rows=250000 width=21) (actual time=7.554..193.386 rows=200000 loops=3)
                                Hash Cond: (f.product_id = p.id)
                                ->  Parallel Seq Scan on "FavoriteProduct" f  (cost=0.00..5756.00 rows=250000 width=8) (actual time=0.007..92.479 rows=200000 loops=3)
                                ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=7.060..7.216 rows=20000 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1215kB
                                      ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.025..2.601 rows=20000 loops=3)
Planning Time: 2.431 ms
Execution Time: 416.211 ms


==================================================
EXPLAIN ANALYZE — Query 7: Dostępny Stan Magazynowy Wariantów Produktu Pogrupowany po Magazynach
==================================================
Finalize GroupAggregate  (cost=8886.64..10869.06 rows=16000 width=61) (actual time=1102.311..1660.334 rows=231755 loops=1)
  Group Key: p.name, w.name, v.sku
  ->  Gather Merge  (cost=8886.64..10575.72 rows=13334 width=61) (actual time=1099.036..1561.340 rows=263367 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=7886.61..8036.62 rows=6667 width=61) (actual time=1073.244..1202.283 rows=87789 loops=3)
              Group Key: p.name, w.name, v.sku
              ->  Sort  (cost=7886.61..7903.28 rows=6667 width=57) (actual time=1071.197..1154.305 rows=106667 loops=3)
                    Sort Key: p.name, w.name, v.sku
                    Sort Method: external merge  Disk: 9384kB
                    Worker 0:  Sort Method: external merge  Disk: 4152kB
                    Worker 1:  Sort Method: external merge  Disk: 8256kB
                    ->  Hash Join  (cost=2543.72..7463.16 rows=6667 width=57) (actual time=41.613..525.409 rows=106667 loops=3)
                          Hash Cond: (v.product_id = p.id)
                          ->  Hash Join  (cost=1855.72..6757.66 rows=6667 width=48) (actual time=32.401..467.141 rows=106667 loops=3)
                                Hash Cond: (ssi.variant_id = v.id)
                                ->  Hash Join  (cost=1.23..4885.66 rows=6667 width=25) (actual time=1.739..373.505 rows=106667 loops=3)
                                      Hash Cond: (ssi.warehouse_id = w.id)
                                      ->  Parallel Append  (cost=0.00..4527.02 rows=133333 width=12) (actual time=1.680..303.065 rows=106667 loops=3)
                                            ->  Parallel Seq Scan on "SerialStockItem" ssi  (cost=0.00..2001.16 rows=93816 width=12) (actual time=1.492..100.980 rows=53163 loops=3)
                                            ->  Parallel Seq Scan on "BulkStockItem" bsi  (cost=0.00..1859.19 rows=94419 width=12) (actual time=0.678..274.669 rows=80256 loops=2)
                                      ->  Hash  (cost=1.10..1.10 rows=10 width=21) (actual time=0.038..0.643 rows=10 loops=3)
                                            Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                            ->  Seq Scan on "Warehouse" w  (cost=0.00..1.10 rows=10 width=21) (actual time=0.031..0.033 rows=10 loops=3)
                                ->  Hash  (cost=1267.00..1267.00 rows=47000 width=31) (actual time=30.156..30.156 rows=47000 loops=3)
                                      Buckets: 65536  Batches: 1  Memory Usage: 3450kB
                                      ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=31) (actual time=0.015..12.475 rows=47000 loops=3)
                          ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=8.215..8.216 rows=20000 loops=3)
                                Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                                ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.027..3.106 rows=20000 loops=3)
Planning Time: 15.553 ms
Execution Time: 1682.795 ms


==================================================
EXPLAIN ANALYZE — Query 8: Stan magazynowy per produkt
==================================================
[ERROR EXECUTING QUERY 8] relation "StockItem" does not exist
LINE 7:         JOIN "StockItem" si ON si.variant_id = v.id
                     ^



==================================================
EXPLAIN ANALYZE — Query 9: Najpopularniejsze Kategorie (wg. Całkowitego Przychodu)
==================================================
[ERROR EXECUTING QUERY 9] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 10: Liczba produktów per kategoria
==================================================
[ERROR EXECUTING QUERY 10] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 11: Liczba zamówień per metoda płatności
==================================================
[ERROR EXECUTING QUERY 11] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 12: Średnia ocena per producent
==================================================
[ERROR EXECUTING QUERY 12] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 13: Aktywne promocje i objęta nimi liczba wariantów
==================================================
[ERROR EXECUTING QUERY 13] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 14: Najczęściej wybierane warianty w koszykach
==================================================
[ERROR EXECUTING QUERY 14] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 15: Produkty z Największą Różnicą Między Ceną Podstawową a Ceną Wariantu
==================================================
[ERROR EXECUTING QUERY 15] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 16: Konwersja zamówień wg statusu
==================================================
[ERROR EXECUTING QUERY 16] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 17: Top klienci wg wydatków
==================================================
[ERROR EXECUTING QUERY 17] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 18: Produkty z wariantami objętymi promocją, z końcową ceną
==================================================
[ERROR EXECUTING QUERY 18] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 19: Użytkownicy, Którzy Dodali Produkt do Koszyka, Ale Nie Złożyli Zamówienia (Potencjał Odbudowy Koszyka)
==================================================
[ERROR EXECUTING QUERY 19] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 20: Wyszukiwanie produktów po nazwie lub opisie (parametryzowane)
==================================================
[ERROR EXECUTING QUERY 20] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 21: Użytkownicy, Którzy Zapisali Konkretny Produkt jako Ulubiony (np. Product ID=350259)
==================================================
[ERROR EXECUTING QUERY 21] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 22: Znajdź Magazyny, Które Posiadają Zapasy Konkretnego Wariantu (np. SKU='VR-000000-a637d44b7afd')
==================================================
[ERROR EXECUTING QUERY 22] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 23: Warianty, Które Wymagają Uzyskania Konkretnej Opcji (np. 'Kolor'='Czerwony')
==================================================
[ERROR EXECUTING QUERY 23] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 24: Znajdź Zamówienia Użytkownika (np. email='debbie.lane.16786.50af0753@example.com') o Statusie 'Paid'
==================================================
[ERROR EXECUTING QUERY 24] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 25: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
[ERROR EXECUTING QUERY 25] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 26: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
[ERROR EXECUTING QUERY 26] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 27: Porównanie Średniej Oceny dla Promowanych i Niepromowanych Produktów
==================================================
[ERROR EXECUTING QUERY 27] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 28: Top 5 Miast Generujących Największy Przychód (Wg. Adresu Wysyłki)
==================================================
[ERROR EXECUTING QUERY 28] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 29: Porównanie Wolumenu Sprzedaży Produktów Promowanych vs. Niepromowanych (w Ostatnich 30 Dniach)
==================================================
[ERROR EXECUTING QUERY 29] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 30: Wskaźnik Lojalności (Repeat Purchase Rate) Użytkowników z Podziałem na Miasto Adresu Rozliczeniowego
==================================================
[ERROR EXECUTING QUERY 30] current transaction is aborted, commands ignored until end of transaction block


FINISHED — 2025-12-02 20:57:23.845617
========================================================================================================================
========================================================================================================================
START EXPLAIN RUN — 2025-12-02 20:58:21.629776
========================================================================================================================


==================================================
EXPLAIN ANALYZE — Query 1: Średnia Wartość Zamówienia (AOV) w Ostatnim Miesiącu
==================================================
Aggregate  (cost=4365.39..4365.40 rows=1 width=32) (actual time=116.922..116.925 rows=1 loops=1)
  ->  GroupAggregate  (cost=4345.40..4357.70 rows=615 width=36) (actual time=116.502..116.872 rows=608 loops=1)
        Group Key: o.id
        ->  Sort  (cost=4345.40..4346.94 rows=615 width=10) (actual time=116.483..116.525 rows=619 loops=1)
              Sort Key: o.id
              Sort Method: quicksort  Memory: 44kB
              ->  Hash Join  (cost=3936.41..4316.91 rows=615 width=10) (actual time=111.185..116.316 rows=619 loops=1)
                    Hash Cond: (oi.order_id = o.id)
                    ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.019..2.491 rows=20000 loops=1)
                    ->  Hash  (cost=3782.78..3782.78 rows=12291 width=4) (actual time=111.105..111.106 rows=12337 loops=1)
                          Buckets: 16384  Batches: 1  Memory Usage: 562kB
                          ->  Bitmap Heap Scan on "Order" o  (cost=231.68..3782.78 rows=12291 width=4) (actual time=8.950..108.517 rows=12337 loops=1)
                                Recheck Cond: (order_date >= (now() - '1 mon'::interval))
                                Heap Blocks: exact=3270
                                ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..228.61 rows=12291 width=0) (actual time=8.563..8.564 rows=12337 loops=1)
                                      Index Cond: (order_date >= (now() - '1 mon'::interval))
Planning Time: 13.294 ms
Execution Time: 117.062 ms


==================================================
EXPLAIN ANALYZE — Query 2: Średnia wartość zamówienia per użytkownik
==================================================
Sort  (cost=16066.87..16115.61 rows=19495 width=50) (actual time=1229.521..1279.980 rows=19296 loops=1)
  Sort Key: (round(avg(order_totals.total_price), 2)) DESC
  Sort Method: quicksort  Memory: 1612kB
  ->  Finalize HashAggregate  (cost=14385.35..14677.77 rows=19495 width=50) (actual time=1198.924..1263.046 rows=19296 loops=1)
        Group Key: u.id
        Batches: 5  Memory Usage: 8241kB  Disk Usage: 224kB
        ->  Gather  (cost=12537.36..14263.50 rows=16246 width=50) (actual time=1032.802..1159.540 rows=19424 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial HashAggregate  (cost=11537.36..11638.90 rows=8123 width=50) (actual time=1005.442..1011.453 rows=6475 loops=3)
                    Group Key: u.id
                    Batches: 1  Memory Usage: 3217kB
                    Worker 0:  Batches: 1  Memory Usage: 3217kB
                    Worker 1:  Batches: 1  Memory Usage: 2961kB
                    ->  Nested Loop  (cost=1110.75..11496.75 rows=8123 width=50) (actual time=135.916..943.977 rows=6498 loops=3)
                          ->  Hash Join  (cost=1110.33..6550.49 rows=8123 width=36) (actual time=102.502..231.397 rows=6498 loops=3)
                                Hash Cond: (o.id = order_totals.order_id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.009..52.200 rows=133333 loops=3)
                                ->  Hash  (cost=866.64..866.64 rows=19495 width=36) (actual time=101.434..102.816 rows=19495 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1094kB
                                      ->  Subquery Scan on order_totals  (cost=428.00..866.64 rows=19495 width=36) (actual time=84.364..95.162 rows=19495 loops=3)
                                            ->  HashAggregate  (cost=428.00..671.69 rows=19495 width=36) (actual time=84.363..92.940 rows=19495 loops=3)
                                                  Group Key: oi.order_id
                                                  Batches: 1  Memory Usage: 7953kB
                                                  Worker 0:  Batches: 1  Memory Usage: 7953kB
                                                  Worker 1:  Batches: 1  Memory Usage: 7953kB
                                                  ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.030..25.376 rows=20000 loops=3)
                          ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.098..0.098 rows=1 loops=19495)
                                Index Cond: (id = o.user_id)
Planning Time: 6.114 ms
Execution Time: 1313.551 ms


==================================================
EXPLAIN ANALYZE — Query 3: Top 10 Najlepiej Sprzedających Się Produktów (wg. Ilości Sprzedanych Jednostek) w Ostatnim Kwartale
==================================================
Limit  (cost=9141.48..9141.51 rows=10 width=46) (actual time=84.926..126.833 rows=1 loops=1)
  ->  Sort  (cost=9141.48..9151.44 rows=3981 width=46) (actual time=84.924..126.831 rows=1 loops=1)
        Sort Key: (sum(oi.quantity)) DESC
        Sort Method: quicksort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=9015.65..9055.46 rows=3981 width=46) (actual time=84.375..126.308 rows=1 loops=1)
              Group Key: p.name, m.name
              Batches: 1  Memory Usage: 217kB
              ->  Gather  (cost=8642.37..8990.76 rows=3318 width=46) (actual time=81.133..126.265 rows=2 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=7642.37..7658.96 rows=1659 width=46) (actual time=34.023..34.031 rows=1 loops=3)
                          Group Key: p.name, m.name
                          Batches: 1  Memory Usage: 73kB
                          Worker 0:  Batches: 1  Memory Usage: 73kB
                          Worker 1:  Batches: 1  Memory Usage: 73kB
                          ->  Hash Join  (cost=2077.40..7629.93 rows=1659 width=42) (actual time=17.325..33.541 rows=1324 loops=3)
                                Hash Cond: (p.manufacturer_id = m.id)
                                ->  Nested Loop  (cost=2072.03..7620.08 rows=1659 width=21) (actual time=16.800..32.673 rows=1324 loops=3)
                                      ->  Nested Loop  (cost=2071.74..7072.43 rows=1659 width=8) (actual time=16.791..30.608 rows=1324 loops=3)
                                            ->  Hash Join  (cost=2071.45..6211.91 rows=1659 width=8) (actual time=16.773..28.381 rows=1324 loops=3)
                                                  Hash Cond: (o.id = oi.order_id)
                                                  ->  Parallel Bitmap Heap Scan on "Order" o  (cost=1493.45..5409.98 rows=33173 width=4) (actual time=4.002..10.908 rows=26380 loops=3)
                                                        Recheck Cond: (order_date >= (now() - '3 mons'::interval))
                                                        Heap Blocks: exact=3297
                                                        ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..1473.55 rows=79616 width=0) (actual time=11.466..11.466 rows=79139 loops=1)
                                                              Index Cond: (order_date >= (now() - '3 mons'::interval))
                                                  ->  Hash  (cost=328.00..328.00 rows=20000 width=12) (actual time=11.170..11.170 rows=20000 loops=3)
                                                        Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                                        ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=12) (actual time=0.022..2.519 rows=20000 loops=3)
                                            ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.52 rows=1 width=8) (actual time=0.001..0.001 rows=1 loops=3972)
                                                  Index Cond: (id = oi.variant_id)
                                      ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=21) (actual time=0.001..0.001 rows=1 loops=3972)
                                            Index Cond: (id = v.product_id)
                                ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.503..0.504 rows=150 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 18kB
                                      ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.024..0.044 rows=150 loops=3)
Planning Time: 24.338 ms
Execution Time: 129.047 ms


==================================================
EXPLAIN ANALYZE — Query 4: Top 5 produktów z najwięcej recenzjami
==================================================
Limit  (cost=1792.59..1792.61 rows=5 width=25) (actual time=41.406..41.410 rows=5 loops=1)
  ->  Sort  (cost=1792.59..1842.59 rows=20000 width=25) (actual time=41.405..41.408 rows=5 loops=1)
        Sort Key: (COALESCE(r.count, '0'::bigint)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Hash Left Join  (cost=969.89..1460.40 rows=20000 width=25) (actual time=29.892..37.619 rows=20000 loops=1)
              Hash Cond: (p.id = r.product_id)
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.010..2.042 rows=20000 loops=1)
              ->  Hash  (cost=812.24..812.24 rows=12612 width=12) (actual time=29.870..29.872 rows=12612 loops=1)
                    Buckets: 16384  Batches: 1  Memory Usage: 670kB
                    ->  Subquery Scan on r  (cost=560.00..812.24 rows=12612 width=12) (actual time=24.063..27.851 rows=12612 loops=1)
                          ->  HashAggregate  (cost=560.00..686.12 rows=12612 width=12) (actual time=24.062..26.675 rows=12612 loops=1)
                                Group Key: "Review".product_id
                                Batches: 1  Memory Usage: 1425kB
                                ->  Seq Scan on "Review"  (cost=0.00..460.00 rows=20000 width=4) (actual time=1.191..17.726 rows=20000 loops=1)
Planning Time: 5.917 ms
Execution Time: 41.477 ms


==================================================
EXPLAIN ANALYZE — Query 5: Całkowity Przychód Pogrupowany Miesięcznie za Ostatni Rok
==================================================
Finalize GroupAggregate  (cost=9617.65..11883.29 rows=17380 width=36) (actual time=129.063..158.340 rows=11 loops=1)
  Group Key: ((date_trunc('month'::text, o.order_date))::date)
  ->  Gather Merge  (cost=9617.65..11470.51 rows=14484 width=36) (actual time=128.806..158.316 rows=33 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=8617.62..8798.67 rows=7242 width=36) (actual time=99.936..101.276 rows=11 loops=3)
              Group Key: ((date_trunc('month'::text, o.order_date))::date)
              ->  Sort  (cost=8617.62..8635.73 rows=7242 width=10) (actual time=98.770..99.293 rows=5760 loops=3)
                    Sort Key: ((date_trunc('month'::text, o.order_date))::date) DESC
                    Sort Method: quicksort  Memory: 441kB
                    Worker 0:  Sort Method: quicksort  Memory: 201kB
                    Worker 1:  Sort Method: quicksort  Memory: 379kB
                    ->  Parallel Hash Join  (cost=681.00..8153.33 rows=7242 width=10) (actual time=5.823..96.537 rows=5760 loops=3)
                          Hash Cond: (o.id = oi.order_id)
                          ->  Parallel Seq Scan on "Order" o  (cost=0.00..6669.33 rows=144838 width=12) (actual time=0.015..60.879 rows=115772 loops=3)
                                Filter: (order_date >= (date_trunc('year'::text, now()) - '00:00:00'::interval))
                                Rows Removed by Filter: 17562
                          ->  Parallel Hash  (cost=533.93..533.93 rows=11765 width=10) (actual time=5.644..5.644 rows=6667 loops=3)
                                Buckets: 32768  Batches: 1  Memory Usage: 1216kB
                                ->  Parallel Index Only Scan using idx_orderitem_order_price_cover on "OrderItem" oi  (cost=0.29..533.93 rows=11765 width=10) (actual time=0.017..9.471 rows=20000 loops=1)
                                      Heap Fetches: 0
Planning Time: 3.122 ms
Execution Time: 158.454 ms


==================================================
EXPLAIN ANALYZE — Query 6: Produkty najczęściej dodawane do ulubionych
==================================================
Limit  (cost=14382.58..14382.60 rows=10 width=25) (actual time=386.635..443.505 rows=10 loops=1)
  ->  Sort  (cost=14382.58..14432.58 rows=20000 width=25) (actual time=386.634..443.502 rows=10 loops=1)
        Sort Key: (count(f.id)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=13750.38..13950.38 rows=20000 width=25) (actual time=378.545..439.184 rows=20000 loops=1)
              Group Key: p.id
              Batches: 1  Memory Usage: 2577kB
              ->  Gather  (cost=9350.38..13550.38 rows=40000 width=25) (actual time=330.789..415.756 rows=59995 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=8350.38..8550.38 rows=20000 width=25) (actual time=325.452..330.013 rows=19998 loops=3)
                          Group Key: p.id
                          Batches: 1  Memory Usage: 2577kB
                          Worker 0:  Batches: 1  Memory Usage: 2577kB
                          Worker 1:  Batches: 1  Memory Usage: 2577kB
                          ->  Hash Join  (cost=688.00..7100.38 rows=250000 width=21) (actual time=13.874..253.340 rows=200000 loops=3)
                                Hash Cond: (f.product_id = p.id)
                                ->  Parallel Seq Scan on "FavoriteProduct" f  (cost=0.00..5756.00 rows=250000 width=8) (actual time=3.836..163.818 rows=200000 loops=3)
                                ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=9.560..9.561 rows=20000 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1215kB
                                      ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.236..2.868 rows=20000 loops=3)
Planning Time: 6.540 ms
Execution Time: 445.318 ms


==================================================
EXPLAIN ANALYZE — Query 7: Dostępny Stan Magazynowy Wariantów Produktu Pogrupowany po Magazynach
==================================================
Finalize GroupAggregate  (cost=8886.64..10869.06 rows=16000 width=61) (actual time=1041.927..1674.497 rows=231755 loops=1)
  Group Key: p.name, w.name, v.sku
  ->  Gather Merge  (cost=8886.64..10575.72 rows=13334 width=61) (actual time=1040.624..1568.545 rows=276241 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=7886.61..8036.62 rows=6667 width=61) (actual time=999.859..1144.038 rows=92080 loops=3)
              Group Key: p.name, w.name, v.sku
              ->  Sort  (cost=7886.61..7903.28 rows=6667 width=57) (actual time=997.030..1091.110 rows=106667 loops=3)
                    Sort Key: p.name, w.name, v.sku
                    Sort Method: external merge  Disk: 9952kB
                    Worker 0:  Sort Method: external merge  Disk: 7000kB
                    Worker 1:  Sort Method: external merge  Disk: 4816kB
                    ->  Hash Join  (cost=2543.72..7463.16 rows=6667 width=57) (actual time=36.436..498.428 rows=106667 loops=3)
                          Hash Cond: (v.product_id = p.id)
                          ->  Hash Join  (cost=1855.72..6757.66 rows=6667 width=48) (actual time=29.066..444.171 rows=106667 loops=3)
                                Hash Cond: (ssi.variant_id = v.id)
                                ->  Hash Join  (cost=1.23..4885.66 rows=6667 width=25) (actual time=5.115..367.468 rows=106667 loops=3)
                                      Hash Cond: (ssi.warehouse_id = w.id)
                                      ->  Parallel Append  (cost=0.00..4527.02 rows=133333 width=12) (actual time=5.028..322.422 rows=106667 loops=3)
                                            ->  Parallel Seq Scan on "SerialStockItem" ssi  (cost=0.00..2001.16 rows=93816 width=12) (actual time=6.384..196.070 rows=53163 loops=3)
                                            ->  Parallel Seq Scan on "BulkStockItem" bsi  (cost=0.00..1859.19 rows=94419 width=12) (actual time=2.156..153.002 rows=80256 loops=2)
                                      ->  Hash  (cost=1.10..1.10 rows=10 width=21) (actual time=0.038..0.419 rows=10 loops=3)
                                            Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                            ->  Seq Scan on "Warehouse" w  (cost=0.00..1.10 rows=10 width=21) (actual time=0.031..0.033 rows=10 loops=3)
                                ->  Hash  (cost=1267.00..1267.00 rows=47000 width=31) (actual time=23.492..23.492 rows=47000 loops=3)
                                      Buckets: 65536  Batches: 1  Memory Usage: 3450kB
                                      ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=31) (actual time=0.015..7.341 rows=47000 loops=3)
                          ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=7.185..7.186 rows=20000 loops=3)
                                Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                                ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.023..3.050 rows=20000 loops=3)
Planning Time: 17.462 ms
Execution Time: 1698.823 ms


==================================================
EXPLAIN ANALYZE — Query 8: Stan magazynowy per produkt
==================================================
Sort  (cost=19267.36..19316.89 rows=19812 width=21) (actual time=473.151..475.010 rows=17954 loops=1)
  Sort Key: (sum("*SELECT* 1".quantity)) DESC
  Sort Method: quicksort  Memory: 1483kB
  ->  HashAggregate  (cost=17655.24..17853.36 rows=19812 width=21) (actual time=465.980..469.684 rows=17954 loops=1)
        Group Key: p.name
        Batches: 1  Memory Usage: 2065kB
        ->  Hash Join  (cost=2542.50..16055.24 rows=320000 width=17) (actual time=22.377..353.138 rows=320000 loops=1)
              Hash Cond: ("*SELECT* 1".product_id = p.id)
              ->  Append  (cost=1854.50..14527.07 rows=320000 width=8) (actual time=12.748..236.063 rows=320000 loops=1)
                    ->  Subquery Scan on "*SELECT* 1"  (cost=1854.50..6525.95 rows=159488 width=8) (actual time=12.747..107.439 rows=159488 loops=1)
                          ->  Hash Join  (cost=1854.50..4931.07 rows=159488 width=8) (actual time=12.745..92.365 rows=159488 loops=1)
                                Hash Cond: (ssi.variant_id = v.id)
                                ->  Seq Scan on "SerialStockItem" ssi  (cost=0.00..2657.88 rows=159488 width=4) (actual time=0.013..12.655 rows=159488 loops=1)
                                ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=12.710..12.712 rows=47000 loops=1)
                                      Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                      ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.006..5.395 rows=47000 loops=1)
                    ->  Subquery Scan on "*SELECT* 2"  (cost=1854.50..6401.12 rows=160512 width=8) (actual time=13.330..104.251 rows=160512 loops=1)
                          ->  Hash Join  (cost=1854.50..4796.00 rows=160512 width=8) (actual time=13.329..88.858 rows=160512 loops=1)
                                Hash Cond: (bsi.variant_id = v_1.id)
                                ->  Seq Scan on "BulkStockItem" bsi  (cost=0.00..2520.12 rows=160512 width=8) (actual time=0.015..12.251 rows=160512 loops=1)
                                ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=13.125..13.125 rows=47000 loops=1)
                                      Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                      ->  Seq Scan on "Variant" v_1  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.008..5.432 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=9.616..9.617 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.017..2.405 rows=20000 loops=1)
Planning Time: 24.038 ms
Execution Time: 478.476 ms


==================================================
EXPLAIN ANALYZE — Query 9: Najpopularniejsze Kategorie (wg. Całkowitego Przychodu)
==================================================
[ERROR EXECUTING QUERY 9] relation "StockItem" does not exist
LINE 9:         JOIN "StockItem" si ON v.id = si.variant_id
                     ^



==================================================
EXPLAIN ANALYZE — Query 10: Liczba produktów per kategoria
==================================================
[ERROR EXECUTING QUERY 10] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 11: Liczba zamówień per metoda płatności
==================================================
[ERROR EXECUTING QUERY 11] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 12: Średnia ocena per producent
==================================================
[ERROR EXECUTING QUERY 12] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 13: Aktywne promocje i objęta nimi liczba wariantów
==================================================
[ERROR EXECUTING QUERY 13] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 14: Najczęściej wybierane warianty w koszykach
==================================================
[ERROR EXECUTING QUERY 14] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 15: Produkty z Największą Różnicą Między Ceną Podstawową a Ceną Wariantu
==================================================
[ERROR EXECUTING QUERY 15] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 16: Konwersja zamówień wg statusu
==================================================
[ERROR EXECUTING QUERY 16] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 17: Top klienci wg wydatków
==================================================
[ERROR EXECUTING QUERY 17] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 18: Produkty z wariantami objętymi promocją, z końcową ceną
==================================================
[ERROR EXECUTING QUERY 18] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 19: Użytkownicy, Którzy Dodali Produkt do Koszyka, Ale Nie Złożyli Zamówienia (Potencjał Odbudowy Koszyka)
==================================================
[ERROR EXECUTING QUERY 19] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 20: Wyszukiwanie produktów po nazwie lub opisie (parametryzowane)
==================================================
[ERROR EXECUTING QUERY 20] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 21: Użytkownicy, Którzy Zapisali Konkretny Produkt jako Ulubiony (np. Product ID=350259)
==================================================
[ERROR EXECUTING QUERY 21] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 22: Znajdź Magazyny, Które Posiadają Zapasy Konkretnego Wariantu (np. SKU='VR-000000-a637d44b7afd')
==================================================
[ERROR EXECUTING QUERY 22] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 23: Warianty, Które Wymagają Uzyskania Konkretnej Opcji (np. 'Kolor'='Czerwony')
==================================================
[ERROR EXECUTING QUERY 23] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 24: Znajdź Zamówienia Użytkownika (np. email='debbie.lane.16786.50af0753@example.com') o Statusie 'Paid'
==================================================
[ERROR EXECUTING QUERY 24] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 25: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
[ERROR EXECUTING QUERY 25] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 26: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
[ERROR EXECUTING QUERY 26] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 27: Porównanie Średniej Oceny dla Promowanych i Niepromowanych Produktów
==================================================
[ERROR EXECUTING QUERY 27] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 28: Top 5 Miast Generujących Największy Przychód (Wg. Adresu Wysyłki)
==================================================
[ERROR EXECUTING QUERY 28] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 29: Porównanie Wolumenu Sprzedaży Produktów Promowanych vs. Niepromowanych (w Ostatnich 30 Dniach)
==================================================
[ERROR EXECUTING QUERY 29] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 30: Wskaźnik Lojalności (Repeat Purchase Rate) Użytkowników z Podziałem na Miasto Adresu Rozliczeniowego
==================================================
[ERROR EXECUTING QUERY 30] current transaction is aborted, commands ignored until end of transaction block


FINISHED — 2025-12-02 20:58:27.867350
========================================================================================================================
========================================================================================================================
START EXPLAIN RUN — 2025-12-02 20:59:31.494735
========================================================================================================================


==================================================
EXPLAIN ANALYZE — Query 1: Średnia Wartość Zamówienia (AOV) w Ostatnim Miesiącu
==================================================
Aggregate  (cost=4365.27..4365.28 rows=1 width=32) (actual time=169.232..169.234 rows=1 loops=1)
  ->  GroupAggregate  (cost=4345.31..4357.59 rows=614 width=36) (actual time=168.809..169.180 rows=608 loops=1)
        Group Key: o.id
        ->  Sort  (cost=4345.31..4346.84 rows=614 width=10) (actual time=168.791..168.836 rows=619 loops=1)
              Sort Key: o.id
              Sort Method: quicksort  Memory: 44kB
              ->  Hash Join  (cost=3936.38..4316.88 rows=614 width=10) (actual time=162.838..168.630 rows=619 loops=1)
                    Hash Cond: (oi.order_id = o.id)
                    ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.022..3.152 rows=20000 loops=1)
                    ->  Hash  (cost=3782.75..3782.75 rows=12290 width=4) (actual time=162.762..162.763 rows=12336 loops=1)
                          Buckets: 16384  Batches: 1  Memory Usage: 562kB
                          ->  Bitmap Heap Scan on "Order" o  (cost=231.67..3782.75 rows=12290 width=4) (actual time=2.782..159.588 rows=12336 loops=1)
                                Recheck Cond: (order_date >= (now() - '1 mon'::interval))
                                Heap Blocks: exact=3270
                                ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..228.60 rows=12290 width=0) (actual time=2.387..2.387 rows=12336 loops=1)
                                      Index Cond: (order_date >= (now() - '1 mon'::interval))
Planning Time: 9.172 ms
Execution Time: 176.478 ms


==================================================
EXPLAIN ANALYZE — Query 2: Średnia wartość zamówienia per użytkownik
==================================================
Sort  (cost=16066.87..16115.61 rows=19495 width=50) (actual time=2704.922..2731.742 rows=19296 loops=1)
  Sort Key: (round(avg(order_totals.total_price), 2)) DESC
  Sort Method: quicksort  Memory: 1612kB
  ->  Finalize HashAggregate  (cost=14385.35..14677.77 rows=19495 width=50) (actual time=2677.410..2716.361 rows=19296 loops=1)
        Group Key: u.id
        Batches: 5  Memory Usage: 8241kB  Disk Usage: 224kB
        ->  Gather  (cost=12537.36..14263.50 rows=16246 width=50) (actual time=2047.215..2600.924 rows=19392 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial HashAggregate  (cost=11537.36..11638.90 rows=8123 width=50) (actual time=1348.851..1507.831 rows=6464 loops=3)
                    Group Key: u.id
                    Batches: 1  Memory Usage: 5777kB
                    Worker 0:  Batches: 1  Memory Usage: 1681kB
                    Worker 1:  Batches: 1  Memory Usage: 1681kB
                    ->  Nested Loop  (cost=1110.75..11496.75 rows=8123 width=50) (actual time=147.513..1197.227 rows=6498 loops=3)
                          ->  Hash Join  (cost=1110.33..6550.49 rows=8123 width=36) (actual time=118.063..290.937 rows=6498 loops=3)
                                Hash Cond: (o.id = order_totals.order_id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.010..74.334 rows=133333 loops=3)
                                ->  Hash  (cost=866.64..866.64 rows=19495 width=36) (actual time=109.327..110.379 rows=19495 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1094kB
                                      ->  Subquery Scan on order_totals  (cost=428.00..866.64 rows=19495 width=36) (actual time=93.159..103.392 rows=19495 loops=3)
                                            ->  HashAggregate  (cost=428.00..671.69 rows=19495 width=36) (actual time=93.156..101.009 rows=19495 loops=3)
                                                  Group Key: oi.order_id
                                                  Batches: 1  Memory Usage: 7953kB
                                                  Worker 0:  Batches: 1  Memory Usage: 7953kB
                                                  Worker 1:  Batches: 1  Memory Usage: 7953kB
                                                  ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=5.812..47.041 rows=20000 loops=3)
                          ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.115..0.115 rows=1 loops=19495)
                                Index Cond: (id = o.user_id)
Planning Time: 20.176 ms
Execution Time: 2773.114 ms


==================================================
EXPLAIN ANALYZE — Query 3: Top 10 Najlepiej Sprzedających Się Produktów (wg. Ilości Sprzedanych Jednostek) w Ostatnim Kwartale
==================================================
Limit  (cost=9141.47..9141.49 rows=10 width=46) (actual time=131.732..197.743 rows=1 loops=1)
  ->  Sort  (cost=9141.47..9151.42 rows=3981 width=46) (actual time=131.730..197.740 rows=1 loops=1)
        Sort Key: (sum(oi.quantity)) DESC
        Sort Method: quicksort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=9015.63..9055.44 rows=3981 width=46) (actual time=131.072..197.107 rows=1 loops=1)
              Group Key: p.name, m.name
              Batches: 1  Memory Usage: 217kB
              ->  Gather  (cost=8642.36..8990.75 rows=3318 width=46) (actual time=127.477..197.064 rows=3 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=7642.36..7658.95 rows=1659 width=46) (actual time=67.124..67.135 rows=1 loops=3)
                          Group Key: p.name, m.name
                          Batches: 1  Memory Usage: 73kB
                          Worker 0:  Batches: 1  Memory Usage: 73kB
                          Worker 1:  Batches: 1  Memory Usage: 73kB
                          ->  Hash Join  (cost=2077.40..7629.91 rows=1659 width=42) (actual time=18.690..66.596 rows=1324 loops=3)
                                Hash Cond: (p.manufacturer_id = m.id)
                                ->  Nested Loop  (cost=2072.02..7620.06 rows=1659 width=21) (actual time=17.899..65.455 rows=1324 loops=3)
                                      ->  Nested Loop  (cost=2071.73..7072.41 rows=1659 width=8) (actual time=17.381..62.539 rows=1324 loops=3)
                                            ->  Hash Join  (cost=2071.44..6211.89 rows=1659 width=8) (actual time=17.008..59.454 rows=1324 loops=3)
                                                  Hash Cond: (o.id = oi.order_id)
                                                  ->  Parallel Bitmap Heap Scan on "Order" o  (cost=1493.44..5409.97 rows=33173 width=4) (actual time=6.778..43.173 rows=26379 loops=3)
                                                        Recheck Cond: (order_date >= (now() - '3 mons'::interval))
                                                        Heap Blocks: exact=1585
                                                        ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..1473.54 rows=79615 width=0) (actual time=19.761..19.761 rows=79137 loops=1)
                                                              Index Cond: (order_date >= (now() - '3 mons'::interval))
                                                  ->  Hash  (cost=328.00..328.00 rows=20000 width=12) (actual time=6.854..6.855 rows=20000 loops=3)
                                                        Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                                        ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=12) (actual time=0.029..2.618 rows=20000 loops=3)
                                            ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.52 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=3972)
                                                  Index Cond: (id = oi.variant_id)
                                      ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=21) (actual time=0.002..0.002 rows=1 loops=3972)
                                            Index Cond: (id = v.product_id)
                                ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.757..0.757 rows=150 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 18kB
                                      ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.032..0.051 rows=150 loops=3)
Planning Time: 49.173 ms
Execution Time: 202.532 ms


==================================================
EXPLAIN ANALYZE — Query 4: Top 5 produktów z najwięcej recenzjami
==================================================
Limit  (cost=1792.59..1792.61 rows=5 width=25) (actual time=75.871..75.875 rows=5 loops=1)
  ->  Sort  (cost=1792.59..1842.59 rows=20000 width=25) (actual time=75.870..75.873 rows=5 loops=1)
        Sort Key: (COALESCE(r.count, '0'::bigint)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Hash Left Join  (cost=969.89..1460.40 rows=20000 width=25) (actual time=47.900..72.339 rows=20000 loops=1)
              Hash Cond: (p.id = r.product_id)
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.636..8.292 rows=20000 loops=1)
              ->  Hash  (cost=812.24..812.24 rows=12612 width=12) (actual time=47.252..47.254 rows=12612 loops=1)
                    Buckets: 16384  Batches: 1  Memory Usage: 670kB
                    ->  Subquery Scan on r  (cost=560.00..812.24 rows=12612 width=12) (actual time=40.635..44.350 rows=12612 loops=1)
                          ->  HashAggregate  (cost=560.00..686.12 rows=12612 width=12) (actual time=40.634..43.165 rows=12612 loops=1)
                                Group Key: "Review".product_id
                                Batches: 1  Memory Usage: 1425kB
                                ->  Seq Scan on "Review"  (cost=0.00..460.00 rows=20000 width=4) (actual time=1.236..34.438 rows=20000 loops=1)
Planning Time: 8.221 ms
Execution Time: 76.496 ms


==================================================
EXPLAIN ANALYZE — Query 5: Całkowity Przychód Pogrupowany Miesięcznie za Ostatni Rok
==================================================
Finalize GroupAggregate  (cost=9617.65..11883.29 rows=17380 width=36) (actual time=140.800..211.580 rows=11 loops=1)
  Group Key: ((date_trunc('month'::text, o.order_date))::date)
  ->  Gather Merge  (cost=9617.65..11470.51 rows=14484 width=36) (actual time=140.427..211.540 rows=33 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=8617.62..8798.67 rows=7242 width=36) (actual time=90.552..92.339 rows=11 loops=3)
              Group Key: ((date_trunc('month'::text, o.order_date))::date)
              ->  Sort  (cost=8617.62..8635.73 rows=7242 width=10) (actual time=90.440..91.388 rows=5760 loops=3)
                    Sort Key: ((date_trunc('month'::text, o.order_date))::date) DESC
                    Sort Method: quicksort  Memory: 737kB
                    Worker 0:  Sort Method: quicksort  Memory: 190kB
                    Worker 1:  Sort Method: quicksort  Memory: 190kB
                    ->  Parallel Hash Join  (cost=681.00..8153.33 rows=7242 width=10) (actual time=4.876..88.310 rows=5760 loops=3)
                          Hash Cond: (o.id = oi.order_id)
                          ->  Parallel Seq Scan on "Order" o  (cost=0.00..6669.33 rows=144838 width=12) (actual time=0.014..55.958 rows=115772 loops=3)
                                Filter: (order_date >= (date_trunc('year'::text, now()) - '00:00:00'::interval))
                                Rows Removed by Filter: 17562
                          ->  Parallel Hash  (cost=533.93..533.93 rows=11765 width=10) (actual time=4.559..4.560 rows=6667 loops=3)
                                Buckets: 32768  Batches: 1  Memory Usage: 1216kB
                                ->  Parallel Index Only Scan using idx_orderitem_order_price_cover on "OrderItem" oi  (cost=0.29..533.93 rows=11765 width=10) (actual time=0.017..8.202 rows=20000 loops=1)
                                      Heap Fetches: 0
Planning Time: 2.088 ms
Execution Time: 213.792 ms


==================================================
EXPLAIN ANALYZE — Query 6: Produkty najczęściej dodawane do ulubionych
==================================================
Limit  (cost=14382.58..14382.60 rows=10 width=25) (actual time=582.871..701.380 rows=10 loops=1)
  ->  Sort  (cost=14382.58..14432.58 rows=20000 width=25) (actual time=582.864..701.368 rows=10 loops=1)
        Sort Key: (count(f.id)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=13750.38..13950.38 rows=20000 width=25) (actual time=576.170..698.150 rows=20000 loops=1)
              Group Key: p.id
              Batches: 1  Memory Usage: 2577kB
              ->  Gather  (cost=9350.38..13550.38 rows=40000 width=25) (actual time=527.377..672.346 rows=59989 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=8350.38..8550.38 rows=20000 width=25) (actual time=477.731..483.432 rows=19996 loops=3)
                          Group Key: p.id
                          Batches: 1  Memory Usage: 2577kB
                          Worker 0:  Batches: 1  Memory Usage: 2577kB
                          Worker 1:  Batches: 1  Memory Usage: 2577kB
                          ->  Hash Join  (cost=688.00..7100.38 rows=250000 width=21) (actual time=9.592..391.651 rows=200000 loops=3)
                                Hash Cond: (f.product_id = p.id)
                                ->  Parallel Seq Scan on "FavoriteProduct" f  (cost=0.00..5756.00 rows=250000 width=8) (actual time=1.903..297.387 rows=200000 loops=3)
                                ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=7.308..7.309 rows=20000 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1215kB
                                      ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.028..2.681 rows=20000 loops=3)
Planning Time: 23.253 ms
Execution Time: 705.523 ms


==================================================
EXPLAIN ANALYZE — Query 7: Dostępny Stan Magazynowy Wariantów Produktu Pogrupowany po Magazynach
==================================================
Finalize GroupAggregate  (cost=8886.64..10869.06 rows=16000 width=61) (actual time=960.654..1468.566 rows=231755 loops=1)
  Group Key: p.name, w.name, v.sku
  ->  Gather Merge  (cost=8886.64..10575.72 rows=13334 width=61) (actual time=959.394..1371.538 rows=264528 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=7886.61..8036.62 rows=6667 width=61) (actual time=890.419..1018.315 rows=88176 loops=3)
              Group Key: p.name, w.name, v.sku
              ->  Sort  (cost=7886.61..7903.28 rows=6667 width=57) (actual time=888.506..970.614 rows=106667 loops=3)
                    Sort Key: p.name, w.name, v.sku
                    Sort Method: external merge  Disk: 8256kB
                    Worker 0:  Sort Method: external merge  Disk: 5264kB
                    Worker 1:  Sort Method: external merge  Disk: 8264kB
                    ->  Hash Join  (cost=2543.72..7463.16 rows=6667 width=57) (actual time=52.808..384.544 rows=106667 loops=3)
                          Hash Cond: (v.product_id = p.id)
                          ->  Hash Join  (cost=1855.72..6757.66 rows=6667 width=48) (actual time=45.731..334.757 rows=106667 loops=3)
                                Hash Cond: (ssi.variant_id = v.id)
                                ->  Hash Join  (cost=1.23..4885.66 rows=6667 width=25) (actual time=0.072..232.518 rows=106667 loops=3)
                                      Hash Cond: (ssi.warehouse_id = w.id)
                                      ->  Parallel Append  (cost=0.00..4527.02 rows=133333 width=12) (actual time=0.015..196.215 rows=106667 loops=3)
                                            ->  Parallel Seq Scan on "SerialStockItem" ssi  (cost=0.00..2001.16 rows=93816 width=12) (actual time=3.615..73.915 rows=53163 loops=3)
                                            ->  Parallel Seq Scan on "BulkStockItem" bsi  (cost=0.00..1859.19 rows=94419 width=12) (actual time=0.014..169.670 rows=80256 loops=2)
                                      ->  Hash  (cost=1.10..1.10 rows=10 width=21) (actual time=0.040..0.633 rows=10 loops=3)
                                            Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                            ->  Seq Scan on "Warehouse" w  (cost=0.00..1.10 rows=10 width=21) (actual time=0.034..0.036 rows=10 loops=3)
                                ->  Hash  (cost=1267.00..1267.00 rows=47000 width=31) (actual time=45.138..45.138 rows=47000 loops=3)
                                      Buckets: 65536  Batches: 1  Memory Usage: 3450kB
                                      ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=31) (actual time=0.013..27.480 rows=47000 loops=3)
                          ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=6.926..6.927 rows=20000 loops=3)
                                Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                                ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.023..2.663 rows=20000 loops=3)
Planning Time: 15.670 ms
Execution Time: 1481.725 ms


==================================================
EXPLAIN ANALYZE — Query 8: Stan magazynowy per produkt
==================================================
Sort  (cost=19267.36..19316.89 rows=19812 width=21) (actual time=464.679..466.551 rows=17954 loops=1)
  Sort Key: (sum("*SELECT* 1".quantity)) DESC
  Sort Method: quicksort  Memory: 1483kB
  ->  HashAggregate  (cost=17655.24..17853.36 rows=19812 width=21) (actual time=457.498..461.208 rows=17954 loops=1)
        Group Key: p.name
        Batches: 1  Memory Usage: 2065kB
        ->  Hash Join  (cost=2542.50..16055.24 rows=320000 width=17) (actual time=18.805..348.695 rows=320000 loops=1)
              Hash Cond: ("*SELECT* 1".product_id = p.id)
              ->  Append  (cost=1854.50..14527.07 rows=320000 width=8) (actual time=12.854..239.427 rows=320000 loops=1)
                    ->  Subquery Scan on "*SELECT* 1"  (cost=1854.50..6525.95 rows=159488 width=8) (actual time=12.852..108.523 rows=159488 loops=1)
                          ->  Hash Join  (cost=1854.50..4931.07 rows=159488 width=8) (actual time=12.850..93.468 rows=159488 loops=1)
                                Hash Cond: (ssi.variant_id = v.id)
                                ->  Seq Scan on "SerialStockItem" ssi  (cost=0.00..2657.88 rows=159488 width=4) (actual time=0.012..12.611 rows=159488 loops=1)
                                ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=12.818..12.819 rows=47000 loops=1)
                                      Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                      ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.006..5.407 rows=47000 loops=1)
                    ->  Subquery Scan on "*SELECT* 2"  (cost=1854.50..6401.12 rows=160512 width=8) (actual time=13.349..105.934 rows=160512 loops=1)
                          ->  Hash Join  (cost=1854.50..4796.00 rows=160512 width=8) (actual time=13.348..90.475 rows=160512 loops=1)
                                Hash Cond: (bsi.variant_id = v_1.id)
                                ->  Seq Scan on "BulkStockItem" bsi  (cost=0.00..2520.12 rows=160512 width=8) (actual time=0.014..12.197 rows=160512 loops=1)
                                ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=13.138..13.139 rows=47000 loops=1)
                                      Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                      ->  Seq Scan on "Variant" v_1  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.008..5.414 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=5.940..5.940 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.015..2.448 rows=20000 loops=1)
Planning Time: 7.680 ms
Execution Time: 468.898 ms


==================================================
EXPLAIN ANALYZE — Query 9: Najpopularniejsze Kategorie (wg. Całkowitego Przychodu)
==================================================
Limit  (cost=7440.92..7440.95 rows=10 width=44) (actual time=305.900..305.908 rows=1 loops=1)
  ->  Sort  (cost=7440.92..7441.30 rows=150 width=44) (actual time=305.898..305.905 rows=1 loops=1)
        Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
        Sort Method: quicksort  Memory: 25kB
        ->  HashAggregate  (cost=7435.81..7437.68 rows=150 width=44) (actual time=305.884..305.892 rows=1 loops=1)
              Group Key: c.name
              Batches: 1  Memory Usage: 40kB
              ->  Hash Join  (cost=3230.89..6435.81 rows=100000 width=22) (actual time=60.320..297.893 rows=20000 loops=1)
                    Hash Cond: (pc.category_id = c.id)
                    ->  Hash Join  (cost=3225.51..6160.51 rows=100000 width=14) (actual time=59.642..293.185 rows=20000 loops=1)
                          Hash Cond: (pc.product_id = p.id)
                          ->  Seq Scan on "ProductCategory" pc  (cost=0.00..1560.00 rows=100000 width=8) (actual time=1.317..245.217 rows=100000 loops=1)
                          ->  Hash  (cost=2975.51..2975.51 rows=20000 width=18) (actual time=31.006..31.010 rows=20000 loops=1)
                                Buckets: 32768  Batches: 1  Memory Usage: 1272kB
                                ->  Hash Join  (cost=2542.50..2975.51 rows=20000 width=18) (actual time=17.971..27.590 rows=20000 loops=1)
                                      Hash Cond: (v.product_id = p.id)
                                      ->  Hash Join  (cost=1854.50..2235.00 rows=20000 width=14) (actual time=13.199..19.438 rows=20000 loops=1)
                                            Hash Cond: (oi.variant_id = v.id)
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=14) (actual time=0.021..2.581 rows=20000 loops=1)
                                            ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=13.024..13.025 rows=47000 loops=1)
                                                  Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                                  ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.006..5.364 rows=47000 loops=1)
                                      ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=4.763..4.763 rows=20000 loops=1)
                                            Buckets: 32768  Batches: 1  Memory Usage: 960kB
                                            ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.006..2.056 rows=20000 loops=1)
                    ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=0.668..0.668 rows=150 loops=1)
                          Buckets: 1024  Batches: 1  Memory Usage: 16kB
                          ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=0.620..0.639 rows=150 loops=1)
Planning Time: 24.303 ms
Execution Time: 306.572 ms


==================================================
EXPLAIN ANALYZE — Query 10: Liczba produktów per kategoria
==================================================
Sort  (cost=2342.22..2342.59 rows=150 width=20) (actual time=56.999..57.012 rows=150 loops=1)
  Sort Key: (count(pc.product_id)) DESC
  Sort Method: quicksort  Memory: 30kB
  ->  HashAggregate  (cost=2335.30..2336.80 rows=150 width=20) (actual time=56.939..56.962 rows=150 loops=1)
        Group Key: c.name
        Batches: 1  Memory Usage: 48kB
        ->  Hash Right Join  (cost=5.38..1835.30 rows=100000 width=16) (actual time=0.080..33.730 rows=100000 loops=1)
              Hash Cond: (pc.category_id = c.id)
              ->  Seq Scan on "ProductCategory" pc  (cost=0.00..1560.00 rows=100000 width=8) (actual time=0.004..7.821 rows=100000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=0.066..0.066 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 16kB
                    ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=0.011..0.034 rows=150 loops=1)
Planning Time: 0.207 ms
Execution Time: 57.067 ms


==================================================
EXPLAIN ANALYZE — Query 11: Liczba zamówień per metoda płatności
==================================================
Sort  (cost=7850.14..7850.15 rows=6 width=50) (actual time=101.971..106.845 rows=6 loops=1)
  Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  Finalize GroupAggregate  (cost=7848.47..7850.06 rows=6 width=50) (actual time=101.950..106.836 rows=6 loops=1)
        Group Key: pm.name
        ->  Gather Merge  (cost=7848.47..7849.87 rows=12 width=50) (actual time=101.935..106.815 rows=18 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Sort  (cost=6848.44..6848.46 rows=6 width=50) (actual time=67.352..67.355 rows=6 loops=3)
                    Sort Key: pm.name
                    Sort Method: quicksort  Memory: 25kB
                    Worker 0:  Sort Method: quicksort  Memory: 25kB
                    Worker 1:  Sort Method: quicksort  Memory: 25kB
                    ->  Partial HashAggregate  (cost=6848.29..6848.36 rows=6 width=50) (actual time=66.323..66.328 rows=6 loops=3)
                          Group Key: pm.name
                          Batches: 1  Memory Usage: 24kB
                          Worker 0:  Batches: 1  Memory Usage: 24kB
                          Worker 1:  Batches: 1  Memory Usage: 24kB
                          ->  Hash Join  (cost=579.13..6744.13 rows=8333 width=24) (actual time=10.960..63.109 rows=6667 loops=3)
                                Hash Cond: (o.payment_method_id = pm.id)
                                ->  Hash Join  (cost=578.00..6705.67 rows=8333 width=18) (actual time=10.908..61.658 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.006..23.622 rows=133333 loops=3)
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=14) (actual time=10.679..10.680 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1194kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=14) (actual time=0.139..2.704 rows=20000 loops=3)
                                ->  Hash  (cost=1.06..1.06 rows=6 width=14) (actual time=0.029..0.029 rows=6 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                      ->  Seq Scan on "PaymentMethod" pm  (cost=0.00..1.06 rows=6 width=14) (actual time=0.024..0.025 rows=6 loops=3)
Planning Time: 6.546 ms
Execution Time: 106.935 ms


==================================================
EXPLAIN ANALYZE — Query 12: Średnia ocena per producent
==================================================
Sort  (cost=1367.54..1367.91 rows=150 width=57) (actual time=36.074..36.085 rows=150 loops=1)
  Sort Key: (round(avg(r.rating), 2)) DESC NULLS LAST
  Sort Method: quicksort  Memory: 32kB
  ->  HashAggregate  (cost=1359.87..1362.12 rows=150 width=57) (actual time=35.954..36.017 rows=150 loops=1)
        Group Key: m.name
        Batches: 1  Memory Usage: 64kB
        ->  Hash Join  (cost=693.38..1259.87 rows=20000 width=29) (actual time=5.311..29.551 rows=27388 loops=1)
              Hash Cond: (p.manufacturer_id = m.id)
              ->  Hash Right Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=5.251..24.169 rows=27388 loops=1)
                    Hash Cond: (r.product_id = p.id)
                    ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=0.008..7.142 rows=20000 loops=1)
                    ->  Hash  (cost=438.00..438.00 rows=20000 width=8) (actual time=5.232..5.233 rows=20000 loops=1)
                          Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                          ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=8) (actual time=0.004..2.196 rows=20000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.055..0.056 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 18kB
                    ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.013..0.030 rows=150 loops=1)
Planning Time: 3.827 ms
Execution Time: 36.153 ms


==================================================
EXPLAIN ANALYZE — Query 13: Aktywne promocje i objęta nimi liczba wariantów
==================================================
Sort  (cost=587.95..588.05 rows=42 width=14) (actual time=12.761..12.765 rows=42 loops=1)
  Sort Key: (count(v.id)) DESC
  Sort Method: quicksort  Memory: 26kB
  ->  HashAggregate  (cost=586.40..586.82 rows=42 width=14) (actual time=12.733..12.742 rows=42 loops=1)
        Group Key: pr.name
        Batches: 1  Memory Usage: 24kB
        ->  Merge Join  (cost=7.46..535.87 rows=10105 width=10) (actual time=0.182..12.436 rows=1238 loops=1)
              Merge Cond: (v.promotion_id = pr.id)
              ->  Index Scan using idx_variant_promotion on "Variant" v  (cost=0.29..4233.14 rows=47000 width=8) (actual time=0.030..11.888 rows=5685 loops=1)
              ->  Sort  (cost=7.17..7.27 rows=43 width=10) (actual time=0.044..0.051 rows=43 loops=1)
                    Sort Key: pr.id
                    Sort Method: quicksort  Memory: 26kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=43 width=10) (actual time=0.011..0.034 rows=43 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 157
Planning Time: 14.792 ms
Execution Time: 12.819 ms


==================================================
EXPLAIN ANALYZE — Query 14: Najczęściej wybierane warianty w koszykach
==================================================
Limit  (cost=268487.71..268487.74 rows=10 width=44) (actual time=1792.524..1792.531 rows=10 loops=1)
  ->  Sort  (cost=268487.71..272237.71 rows=1500000 width=44) (actual time=1792.510..1792.516 rows=10 loops=1)
        Sort Key: (sum("CartItem".quantity)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  HashAggregate  (cost=197635.75..236073.25 rows=1500000 width=44) (actual time=1772.888..1784.621 rows=47000 loops=1)
              Group Key: "Variant".sku, p.name
              Planned Partitions: 32  Batches: 1  Memory Usage: 6161kB
              ->  Hash Join  (cost=3858.75..62635.75 rows=1500000 width=40) (actual time=41.857..1032.634 rows=1500000 loops=1)
                    Hash Cond: ("CartItem".variant_id = "Variant".id)
                    ->  Seq Scan on "CartItem"  (cost=0.00..23152.00 rows=1500000 width=16) (actual time=2.264..272.324 rows=1500000 loops=1)
                    ->  Hash  (cost=3271.25..3271.25 rows=47000 width=40) (actual time=39.575..39.579 rows=47000 loops=1)
                          Buckets: 65536  Batches: 1  Memory Usage: 3868kB
                          ->  Hash Join  (cost=888.00..3271.25 rows=47000 width=40) (actual time=7.988..29.027 rows=47000 loops=1)
                                Hash Cond: ("Variant".product_id = p.id)
                                ->  Seq Scan on "Variant"  (cost=0.00..1267.00 rows=47000 width=68) (actual time=0.007..6.710 rows=47000 loops=1)
                                ->  Hash  (cost=638.00..638.00 rows=20000 width=17) (actual time=7.969..7.970 rows=20000 loops=1)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                                      ->  Subquery Scan on p  (cost=0.00..638.00 rows=20000 width=17) (actual time=0.006..4.692 rows=20000 loops=1)
                                            ->  Seq Scan on "Product"  (cost=0.00..438.00 rows=20000 width=85) (actual time=0.005..2.739 rows=20000 loops=1)
Planning Time: 11.321 ms
Execution Time: 1793.977 ms


==================================================
EXPLAIN ANALYZE — Query 15: Produkty z Największą Różnicą Między Ceną Podstawową a Ceną Wariantu
==================================================
Limit  (cost=3211.55..3211.58 rows=10 width=80) (actual time=44.856..44.860 rows=10 loops=1)
  ->  Sort  (cost=3211.55..3329.05 rows=47000 width=80) (actual time=44.854..44.856 rows=10 loops=1)
        Sort Key: v.price_modifier DESC
        Sort Method: top-N heapsort  Memory: 27kB
        ->  Hash Join  (cost=688.00..2195.90 rows=47000 width=80) (actual time=6.261..32.972 rows=47000 loops=1)
              Hash Cond: (v.product_id = p.id)
              ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=33) (actual time=0.012..6.376 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=6.225..6.226 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1381kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.004..2.619 rows=20000 loops=1)
Planning Time: 4.207 ms
Execution Time: 44.901 ms


==================================================
EXPLAIN ANALYZE — Query 16: Konwersja zamówień wg statusu
==================================================
Sort  (cost=7541.77..7541.79 rows=7 width=48) (actual time=119.773..152.344 rows=7 loops=1)
  Sort Key: (count(o.id)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  WindowAgg  (cost=7541.33..7541.67 rows=7 width=48) (actual time=119.760..152.335 rows=7 loops=1)
        ->  Finalize GroupAggregate  (cost=7539.74..7541.51 rows=7 width=16) (actual time=119.697..152.276 rows=7 loops=1)
              Group Key: s.name
              ->  Gather Merge  (cost=7539.74..7541.37 rows=14 width=16) (actual time=119.688..152.264 rows=21 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Sort  (cost=6539.71..6539.73 rows=7 width=16) (actual time=95.258..95.261 rows=7 loops=3)
                          Sort Key: s.name
                          Sort Method: quicksort  Memory: 25kB
                          Worker 0:  Sort Method: quicksort  Memory: 25kB
                          Worker 1:  Sort Method: quicksort  Memory: 25kB
                          ->  Partial HashAggregate  (cost=6539.55..6539.62 rows=7 width=16) (actual time=94.216..94.219 rows=7 loops=3)
                                Group Key: s.name
                                Batches: 1  Memory Usage: 24kB
                                Worker 0:  Batches: 1  Memory Usage: 24kB
                                Worker 1:  Batches: 1  Memory Usage: 24kB
                                ->  Hash Join  (cost=1.16..5706.21 rows=166667 width=12) (actual time=0.152..55.458 rows=133333 loops=3)
                                      Hash Cond: (o.status_id = s.id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.007..17.517 rows=133333 loops=3)
                                      ->  Hash  (cost=1.07..1.07 rows=7 width=12) (actual time=0.033..0.034 rows=7 loops=3)
                                            Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                            ->  Seq Scan on "Status" s  (cost=0.00..1.07 rows=7 width=12) (actual time=0.027..0.029 rows=7 loops=3)
Planning Time: 5.234 ms
Execution Time: 152.424 ms


==================================================
EXPLAIN ANALYZE — Query 17: Top klienci wg wydatków
==================================================
Limit  (cost=15441.08..15441.10 rows=10 width=50) (actual time=2392.700..2397.017 rows=10 loops=1)
  ->  Sort  (cost=15441.08..15491.08 rows=20000 width=50) (actual time=2392.698..2396.960 rows=10 loops=1)
        Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=14758.88..15008.88 rows=20000 width=50) (actual time=2376.227..2391.881 rows=19296 loops=1)
              Group Key: u.id
              Batches: 5  Memory Usage: 8241kB  Disk Usage: 224kB
              ->  Gather  (cost=12863.13..14633.89 rows=16666 width=50) (actual time=2135.759..2286.903 rows=19428 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=11863.13..11967.29 rows=8333 width=50) (actual time=2130.437..2171.003 rows=6476 loops=3)
                          Group Key: u.id
                          Batches: 1  Memory Usage: 2961kB
                          Worker 0:  Batches: 1  Memory Usage: 2961kB
                          Worker 1:  Batches: 1  Memory Usage: 2961kB
                          ->  Nested Loop  (cost=578.42..11779.80 rows=8333 width=28) (actual time=6.852..2075.251 rows=6667 loops=3)
                                ->  Hash Join  (cost=578.00..6705.67 rows=8333 width=14) (actual time=6.696..102.235 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.007..32.162 rows=133333 loops=3)
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=14) (actual time=6.529..6.900 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1194kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=14) (actual time=0.022..2.552 rows=20000 loops=3)
                                ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.290..0.290 rows=1 loops=20000)
                                      Index Cond: (id = o.user_id)
Planning Time: 3.038 ms
Execution Time: 2401.513 ms


==================================================
EXPLAIN ANALYZE — Query 18: Produkty z wariantami objętymi promocją, z końcową ceną
==================================================
Sort  (cost=2074.11..2099.37 rows=10105 width=132) (actual time=38.797..38.905 rows=1238 loops=1)
  Sort Key: (round(((p.price + v.price_modifier) * ('1'::numeric - pr.discount_percentage)), 2))
  Sort Method: quicksort  Memory: 139kB
  ->  Hash Join  (cost=695.46..1401.98 rows=10105 width=132) (actual time=22.464..37.682 rows=1238 loops=1)
        Hash Cond: (v.product_id = p.id)
        ->  Merge Join  (cost=7.46..535.87 rows=10105 width=39) (actual time=3.286..17.078 rows=1238 loops=1)
              Merge Cond: (v.promotion_id = pr.id)
              ->  Index Scan using idx_variant_promotion on "Variant" v  (cost=0.29..4233.14 rows=47000 width=37) (actual time=0.011..16.490 rows=5685 loops=1)
              ->  Sort  (cost=7.17..7.27 rows=43 width=10) (actual time=0.073..0.081 rows=43 loops=1)
                    Sort Key: pr.id
                    Sort Method: quicksort  Memory: 26kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=43 width=10) (actual time=0.037..0.061 rows=43 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 157
        ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=19.154..19.155 rows=20000 loops=1)
              Buckets: 32768  Batches: 1  Memory Usage: 1381kB
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.010..15.354 rows=20000 loops=1)
Planning Time: 9.766 ms
Execution Time: 39.008 ms


==================================================
EXPLAIN ANALYZE — Query 19: Użytkownicy, Którzy Dodali Produkt do Koszyka, Ale Nie Złożyli Zamówienia (Potencjał Odbudowy Koszyka)
==================================================
Hash Join  (cost=46254.21..103988.81 rows=1068640 width=55) (actual time=4957.940..7353.289 rows=1005006 loops=1)
  Hash Cond: (v.product_id = p.id)
  ->  Hash Join  (cost=45566.21..100495.04 rows=1068640 width=46) (actual time=4948.775..6790.540 rows=1005006 loops=1)
        Hash Cond: (ci.variant_id = v.id)
        ->  Hash Join  (cost=43711.71..95835.11 rows=1068640 width=46) (actual time=4927.815..6012.293 rows=1005006 loops=1)
              Hash Cond: (ci.cart_id = c.id)
              ->  Seq Scan on "CartItem" ci  (cost=0.00..23152.00 rows=1500000 width=8) (actual time=0.717..253.947 rows=1500000 loops=1)
              ->  Hash  (cost=41435.91..41435.91 rows=106864 width=46) (actual time=4922.741..4940.930 rows=100414 loops=1)
                    Buckets: 131072  Batches: 2  Memory Usage: 4929kB
                    ->  Gather  (cost=25017.67..41435.91 rows=106864 width=46) (actual time=4676.884..4779.838 rows=100414 loops=1)
                          Workers Planned: 2
                          Workers Launched: 2
                          ->  Parallel Hash Right Anti Join  (cost=24017.67..29749.51 rows=44527 width=46) (actual time=4009.826..4023.808 rows=33471 loops=3)
                                Hash Cond: (o.user_id = u.id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=4) (actual time=1.179..375.489 rows=133333 loops=3)
                                ->  Parallel Hash  (cost=23236.42..23236.42 rows=62500 width=50) (actual time=3269.301..3269.746 rows=50000 loops=3)
                                      Buckets: 262144  Batches: 1  Memory Usage: 14720kB
                                      ->  Hash Join  (cost=4079.00..23236.42 rows=62500 width=50) (actual time=308.029..2754.255 rows=50000 loops=3)
                                            Hash Cond: (u.id = c.user_id)
                                            ->  Parallel Seq Scan on "User" u  (cost=0.00..18063.67 rows=416667 width=46) (actual time=0.018..1460.418 rows=333333 loops=3)
                                            ->  Hash  (cost=2204.00..2204.00 rows=150000 width=8) (actual time=295.445..295.446 rows=150000 loops=3)
                                                  Buckets: 262144  Batches: 1  Memory Usage: 7908kB
                                                  ->  Seq Scan on "Cart" c  (cost=0.00..2204.00 rows=150000 width=8) (actual time=18.709..170.780 rows=150000 loops=3)
        ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=16.960..16.961 rows=47000 loops=1)
              Buckets: 65536  Batches: 1  Memory Usage: 2348kB
              ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.014..6.918 rows=47000 loops=1)
  ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=5.607..5.608 rows=20000 loops=1)
        Buckets: 32768  Batches: 1  Memory Usage: 1245kB
        ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.014..2.365 rows=20000 loops=1)
Planning Time: 26.436 ms
Execution Time: 7485.261 ms


==================================================
EXPLAIN ANALYZE — Query 20: Wyszukiwanie produktów po nazwie lub opisie (parametryzowane)
==================================================
Bitmap Heap Scan on "Product"  (cost=43.00..57.51 rows=4 width=60) (actual time=6.511..36.735 rows=143 loops=1)
  Recheck Cond: (((name)::text ~~* '%test%'::text) OR (description ~~* '%test%'::text))
  Heap Blocks: exact=106
  ->  BitmapOr  (cost=43.00..43.00 rows=4 width=0) (actual time=5.891..5.893 rows=0 loops=1)
        ->  Bitmap Index Scan on idx_product_name_trgm  (cost=0.00..21.50 rows=2 width=0) (actual time=3.246..3.246 rows=42 loops=1)
              Index Cond: ((name)::text ~~* '%test%'::text)
        ->  Bitmap Index Scan on idx_product_description_trgm  (cost=0.00..21.50 rows=2 width=0) (actual time=2.639..2.639 rows=102 loops=1)
              Index Cond: (description ~~* '%test%'::text)
Planning Time: 115.718 ms
Execution Time: 41.170 ms


==================================================
EXPLAIN ANALYZE — Query 21: Użytkownicy, Którzy Zapisali Konkretny Produkt jako Ulubiony (np. Product ID=350259)
==================================================
Nested Loop  (cost=0.85..262.23 rows=30 width=56) (actual time=2.407..12.365 rows=26 loops=1)
  ->  Index Only Scan using idx_favoriteproduct_product_user on "FavoriteProduct" fp  (cost=0.42..8.95 rows=30 width=4) (actual time=1.830..1.837 rows=26 loops=1)
        Index Cond: (product_id = 35)
        Heap Fetches: 0
  ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..8.44 rows=1 width=60) (actual time=0.404..0.404 rows=1 loops=26)
        Index Cond: (id = fp.user_id)
Planning Time: 13.388 ms
Execution Time: 12.400 ms


==================================================
EXPLAIN ANALYZE — Query 22: Znajdź Magazyny, Które Posiadają Zapasy Konkretnego Wariantu (np. SKU='VR-000000-a637d44b7afd')
==================================================
[ERROR EXECUTING QUERY 22] relation "StockItem" does not exist
LINE 6:         JOIN "StockItem" si ON w.id = si.warehouse_id
                     ^



==================================================
EXPLAIN ANALYZE — Query 23: Warianty, Które Wymagają Uzyskania Konkretnej Opcji (np. 'Kolor'='Czerwony')
==================================================
[ERROR EXECUTING QUERY 23] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 24: Znajdź Zamówienia Użytkownika (np. email='debbie.lane.16786.50af0753@example.com') o Statusie 'Paid'
==================================================
[ERROR EXECUTING QUERY 24] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 25: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
[ERROR EXECUTING QUERY 25] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 26: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
[ERROR EXECUTING QUERY 26] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 27: Porównanie Średniej Oceny dla Promowanych i Niepromowanych Produktów
==================================================
[ERROR EXECUTING QUERY 27] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 28: Top 5 Miast Generujących Największy Przychód (Wg. Adresu Wysyłki)
==================================================
[ERROR EXECUTING QUERY 28] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 29: Porównanie Wolumenu Sprzedaży Produktów Promowanych vs. Niepromowanych (w Ostatnich 30 Dniach)
==================================================
[ERROR EXECUTING QUERY 29] current transaction is aborted, commands ignored until end of transaction block



==================================================
EXPLAIN ANALYZE — Query 30: Wskaźnik Lojalności (Repeat Purchase Rate) Użytkowników z Podziałem na Miasto Adresu Rozliczeniowego
==================================================
[ERROR EXECUTING QUERY 30] current transaction is aborted, commands ignored until end of transaction block


FINISHED — 2025-12-02 20:59:52.720407
========================================================================================================================
========================================================================================================================
START EXPLAIN RUN — 2025-12-02 21:00:54.275021
========================================================================================================================


==================================================
EXPLAIN ANALYZE — Query 1: Średnia Wartość Zamówienia (AOV) w Ostatnim Miesiącu
==================================================
Aggregate  (cost=4365.23..4365.24 rows=1 width=32) (actual time=104.984..104.987 rows=1 loops=1)
  ->  GroupAggregate  (cost=4345.27..4357.55 rows=614 width=36) (actual time=104.539..104.933 rows=608 loops=1)
        Group Key: o.id
        ->  Sort  (cost=4345.27..4346.81 rows=614 width=10) (actual time=104.519..104.571 rows=619 loops=1)
              Sort Key: o.id
              Sort Method: quicksort  Memory: 44kB
              ->  Hash Join  (cost=3936.34..4316.84 rows=614 width=10) (actual time=60.336..104.295 rows=619 loops=1)
                    Hash Cond: (oi.order_id = o.id)
                    ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.614..40.458 rows=20000 loops=1)
                    ->  Hash  (cost=3782.72..3782.72 rows=12289 width=4) (actual time=59.662..59.664 rows=12335 loops=1)
                          Buckets: 16384  Batches: 1  Memory Usage: 562kB
                          ->  Bitmap Heap Scan on "Order" o  (cost=231.67..3782.72 rows=12289 width=4) (actual time=15.260..57.275 rows=12335 loops=1)
                                Recheck Cond: (order_date >= (now() - '1 mon'::interval))
                                Heap Blocks: exact=3270
                                ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..228.59 rows=12289 width=0) (actual time=14.869..14.869 rows=12335 loops=1)
                                      Index Cond: (order_date >= (now() - '1 mon'::interval))
Planning Time: 25.807 ms
Execution Time: 105.143 ms


==================================================
EXPLAIN ANALYZE — Query 2: Średnia wartość zamówienia per użytkownik
==================================================
Sort  (cost=16066.87..16115.61 rows=19495 width=50) (actual time=1051.857..1106.141 rows=19296 loops=1)
  Sort Key: (round(avg(order_totals.total_price), 2)) DESC
  Sort Method: quicksort  Memory: 1612kB
  ->  Finalize HashAggregate  (cost=14385.35..14677.77 rows=19495 width=50) (actual time=1030.373..1095.862 rows=19296 loops=1)
        Group Key: u.id
        Batches: 5  Memory Usage: 8241kB  Disk Usage: 216kB
        ->  Gather  (cost=12537.36..14263.50 rows=16246 width=50) (actual time=934.670..1032.059 rows=19432 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial HashAggregate  (cost=11537.36..11638.90 rows=8123 width=50) (actual time=924.042..932.432 rows=6477 loops=3)
                    Group Key: u.id
                    Batches: 1  Memory Usage: 3217kB
                    Worker 0:  Batches: 1  Memory Usage: 2961kB
                    Worker 1:  Batches: 1  Memory Usage: 2961kB
                    ->  Nested Loop  (cost=1110.75..11496.75 rows=8123 width=50) (actual time=49.864..856.500 rows=6498 loops=3)
                          ->  Hash Join  (cost=1110.33..6550.49 rows=8123 width=36) (actual time=48.702..138.210 rows=6498 loops=3)
                                Hash Cond: (o.id = order_totals.order_id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.008..30.095 rows=133333 loops=3)
                                ->  Hash  (cost=866.64..866.64 rows=19495 width=36) (actual time=48.527..48.816 rows=19495 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1094kB
                                      ->  Subquery Scan on order_totals  (cost=428.00..866.64 rows=19495 width=36) (actual time=27.215..42.996 rows=19495 loops=3)
                                            ->  HashAggregate  (cost=428.00..671.69 rows=19495 width=36) (actual time=27.214..41.169 rows=19495 loops=3)
                                                  Group Key: oi.order_id
                                                  Batches: 1  Memory Usage: 7953kB
                                                  Worker 0:  Batches: 1  Memory Usage: 7953kB
                                                  Worker 1:  Batches: 1  Memory Usage: 7953kB
                                                  ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.027..3.080 rows=20000 loops=3)
                          ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.103..0.103 rows=1 loops=19495)
                                Index Cond: (id = o.user_id)
Planning Time: 8.872 ms
Execution Time: 1112.230 ms


==================================================
EXPLAIN ANALYZE — Query 3: Top 10 Najlepiej Sprzedających Się Produktów (wg. Ilości Sprzedanych Jednostek) w Ostatnim Kwartale
==================================================
Limit  (cost=9141.45..9141.47 rows=10 width=46) (actual time=191.580..199.341 rows=1 loops=1)
  ->  Sort  (cost=9141.45..9151.40 rows=3981 width=46) (actual time=191.579..199.338 rows=1 loops=1)
        Sort Key: (sum(oi.quantity)) DESC
        Sort Method: quicksort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=9015.61..9055.42 rows=3981 width=46) (actual time=191.536..199.319 rows=1 loops=1)
              Group Key: p.name, m.name
              Batches: 1  Memory Usage: 217kB
              ->  Gather  (cost=8642.33..8990.72 rows=3318 width=46) (actual time=189.291..199.275 rows=3 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=7642.33..7658.92 rows=1659 width=46) (actual time=148.165..148.175 rows=1 loops=3)
                          Group Key: p.name, m.name
                          Batches: 1  Memory Usage: 73kB
                          Worker 0:  Batches: 1  Memory Usage: 73kB
                          Worker 1:  Batches: 1  Memory Usage: 73kB
                          ->  Hash Join  (cost=2077.39..7629.89 rows=1659 width=42) (actual time=87.768..147.139 rows=1324 loops=3)
                                Hash Cond: (p.manufacturer_id = m.id)
                                ->  Nested Loop  (cost=2072.01..7620.04 rows=1659 width=21) (actual time=87.663..146.682 rows=1324 loops=3)
                                      ->  Nested Loop  (cost=2071.73..7072.39 rows=1659 width=8) (actual time=87.649..134.834 rows=1324 loops=3)
                                            ->  Hash Join  (cost=2071.44..6211.87 rows=1659 width=8) (actual time=87.622..131.906 rows=1324 loops=3)
                                                  Hash Cond: (o.id = oi.order_id)
                                                  ->  Parallel Bitmap Heap Scan on "Order" o  (cost=1493.44..5409.95 rows=33172 width=4) (actual time=81.184..111.239 rows=26379 loops=3)
                                                        Recheck Cond: (order_date >= (now() - '3 mons'::interval))
                                                        Heap Blocks: exact=1183
                                                        ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..1473.53 rows=79614 width=0) (actual time=113.885..113.885 rows=79137 loops=1)
                                                              Index Cond: (order_date >= (now() - '3 mons'::interval))
                                                  ->  Hash  (cost=328.00..328.00 rows=20000 width=12) (actual time=6.357..6.358 rows=20000 loops=3)
                                                        Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                                        ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=12) (actual time=0.018..2.649 rows=20000 loops=3)
                                            ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.52 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=3972)
                                                  Index Cond: (id = oi.variant_id)
                                      ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=21) (actual time=0.009..0.009 rows=1 loops=3972)
                                            Index Cond: (id = v.product_id)
                                ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.079..0.080 rows=150 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 18kB
                                      ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.028..0.047 rows=150 loops=3)
Planning Time: 35.047 ms
Execution Time: 200.590 ms


==================================================
EXPLAIN ANALYZE — Query 4: Top 5 produktów z najwięcej recenzjami
==================================================
Limit  (cost=1792.59..1792.61 rows=5 width=25) (actual time=151.173..151.177 rows=5 loops=1)
  ->  Sort  (cost=1792.59..1842.59 rows=20000 width=25) (actual time=151.172..151.175 rows=5 loops=1)
        Sort Key: (COALESCE(r.count, '0'::bigint)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Hash Left Join  (cost=969.89..1460.40 rows=20000 width=25) (actual time=96.660..147.925 rows=20000 loops=1)
              Hash Cond: (p.id = r.product_id)
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.011..24.317 rows=20000 loops=1)
              ->  Hash  (cost=812.24..812.24 rows=12612 width=12) (actual time=96.024..96.025 rows=12612 loops=1)
                    Buckets: 16384  Batches: 1  Memory Usage: 670kB
                    ->  Subquery Scan on r  (cost=560.00..812.24 rows=12612 width=12) (actual time=90.275..94.006 rows=12612 loops=1)
                          ->  HashAggregate  (cost=560.00..686.12 rows=12612 width=12) (actual time=90.274..92.827 rows=12612 loops=1)
                                Group Key: "Review".product_id
                                Batches: 1  Memory Usage: 1425kB
                                ->  Seq Scan on "Review"  (cost=0.00..460.00 rows=20000 width=4) (actual time=0.549..54.773 rows=20000 loops=1)
Planning Time: 5.852 ms
Execution Time: 151.245 ms


==================================================
EXPLAIN ANALYZE — Query 5: Całkowity Przychód Pogrupowany Miesięcznie za Ostatni Rok
==================================================
Finalize GroupAggregate  (cost=9617.65..11883.29 rows=17380 width=36) (actual time=135.060..139.308 rows=11 loops=1)
  Group Key: ((date_trunc('month'::text, o.order_date))::date)
  ->  Gather Merge  (cost=9617.65..11470.51 rows=14484 width=36) (actual time=134.922..139.286 rows=33 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=8617.62..8798.67 rows=7242 width=36) (actual time=129.919..131.250 rows=11 loops=3)
              Group Key: ((date_trunc('month'::text, o.order_date))::date)
              ->  Sort  (cost=8617.62..8635.73 rows=7242 width=10) (actual time=129.827..130.331 rows=5760 loops=3)
                    Sort Key: ((date_trunc('month'::text, o.order_date))::date) DESC
                    Sort Method: quicksort  Memory: 333kB
                    Worker 0:  Sort Method: quicksort  Memory: 654kB
                    Worker 1:  Sort Method: quicksort  Memory: 323kB
                    ->  Parallel Hash Join  (cost=681.00..8153.33 rows=7242 width=10) (actual time=36.875..128.584 rows=5760 loops=3)
                          Hash Cond: (o.id = oi.order_id)
                          ->  Parallel Seq Scan on "Order" o  (cost=0.00..6669.33 rows=144838 width=12) (actual time=0.021..58.837 rows=115772 loops=3)
                                Filter: (order_date >= (date_trunc('year'::text, now()) - '00:00:00'::interval))
                                Rows Removed by Filter: 17562
                          ->  Parallel Hash  (cost=533.93..533.93 rows=11765 width=10) (actual time=34.411..34.411 rows=6667 loops=3)
                                Buckets: 32768  Batches: 1  Memory Usage: 1216kB
                                ->  Parallel Index Only Scan using idx_orderitem_order_price_cover on "OrderItem" oi  (cost=0.29..533.93 rows=11765 width=10) (actual time=1.411..32.439 rows=6667 loops=3)
                                      Heap Fetches: 0
Planning Time: 0.355 ms
Execution Time: 140.590 ms


==================================================
EXPLAIN ANALYZE — Query 6: Produkty najczęściej dodawane do ulubionych
==================================================
Limit  (cost=14382.58..14382.60 rows=10 width=25) (actual time=701.784..746.858 rows=10 loops=1)
  ->  Sort  (cost=14382.58..14432.58 rows=20000 width=25) (actual time=701.774..746.847 rows=10 loops=1)
        Sort Key: (count(f.id)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=13750.38..13950.38 rows=20000 width=25) (actual time=694.773..743.651 rows=20000 loops=1)
              Group Key: p.id
              Batches: 1  Memory Usage: 2577kB
              ->  Gather  (cost=9350.38..13550.38 rows=40000 width=25) (actual time=635.220..718.989 rows=59997 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=8350.38..8550.38 rows=20000 width=25) (actual time=631.221..635.962 rows=19999 loops=3)
                          Group Key: p.id
                          Batches: 1  Memory Usage: 2577kB
                          Worker 0:  Batches: 1  Memory Usage: 2577kB
                          Worker 1:  Batches: 1  Memory Usage: 2577kB
                          ->  Hash Join  (cost=688.00..7100.38 rows=250000 width=21) (actual time=8.754..554.105 rows=200000 loops=3)
                                Hash Cond: (f.product_id = p.id)
                                ->  Parallel Seq Scan on "FavoriteProduct" f  (cost=0.00..5756.00 rows=250000 width=8) (actual time=2.639..465.641 rows=200000 loops=3)
                                ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=6.043..6.044 rows=20000 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1215kB
                                      ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.026..2.554 rows=20000 loops=3)
Planning Time: 8.871 ms
Execution Time: 748.566 ms


==================================================
EXPLAIN ANALYZE — Query 7: Dostępny Stan Magazynowy Wariantów Produktu Pogrupowany po Magazynach
==================================================
Finalize GroupAggregate  (cost=8886.64..10869.06 rows=16000 width=61) (actual time=1499.425..2058.718 rows=231755 loops=1)
  Group Key: p.name, w.name, v.sku
  ->  Gather Merge  (cost=8886.64..10575.72 rows=13334 width=61) (actual time=1498.356..1961.053 rows=273931 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=7886.61..8036.62 rows=6667 width=61) (actual time=1439.067..1565.102 rows=91310 loops=3)
              Group Key: p.name, w.name, v.sku
              ->  Sort  (cost=7886.61..7903.28 rows=6667 width=57) (actual time=1437.049..1516.827 rows=106667 loops=3)
                    Sort Key: p.name, w.name, v.sku
                    Sort Method: external merge  Disk: 8256kB
                    Worker 0:  Sort Method: external merge  Disk: 7064kB
                    Worker 1:  Sort Method: external merge  Disk: 6472kB
                    ->  Hash Join  (cost=2543.72..7463.16 rows=6667 width=57) (actual time=216.872..914.751 rows=106667 loops=3)
                          Hash Cond: (v.product_id = p.id)
                          ->  Hash Join  (cost=1855.72..6757.66 rows=6667 width=48) (actual time=210.086..857.144 rows=106667 loops=3)
                                Hash Cond: (ssi.variant_id = v.id)
                                ->  Hash Join  (cost=1.23..4885.66 rows=6667 width=25) (actual time=1.415..577.993 rows=106667 loops=3)
                                      Hash Cond: (ssi.warehouse_id = w.id)
                                      ->  Parallel Append  (cost=0.00..4527.02 rows=133333 width=12) (actual time=0.981..504.443 rows=106667 loops=3)
                                            ->  Parallel Seq Scan on "SerialStockItem" ssi  (cost=0.00..2001.16 rows=93816 width=12) (actual time=0.392..262.943 rows=53163 loops=3)
                                            ->  Parallel Seq Scan on "BulkStockItem" bsi  (cost=0.00..1859.19 rows=94419 width=12) (actual time=0.892..340.951 rows=80256 loops=2)
                                      ->  Hash  (cost=1.10..1.10 rows=10 width=21) (actual time=0.367..0.898 rows=10 loops=3)
                                            Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                            ->  Seq Scan on "Warehouse" w  (cost=0.00..1.10 rows=10 width=21) (actual time=0.359..0.360 rows=10 loops=3)
                                ->  Hash  (cost=1267.00..1267.00 rows=47000 width=31) (actual time=208.408..208.408 rows=47000 loops=3)
                                      Buckets: 65536  Batches: 1  Memory Usage: 3450kB
                                      ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=31) (actual time=0.225..194.232 rows=47000 loops=3)
                          ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=6.460..6.461 rows=20000 loops=3)
                                Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                                ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.036..2.585 rows=20000 loops=3)
Planning Time: 19.446 ms
Execution Time: 2075.373 ms


==================================================
EXPLAIN ANALYZE — Query 8: Stan magazynowy per produkt
==================================================
Sort  (cost=19267.36..19316.89 rows=19812 width=21) (actual time=648.511..650.696 rows=17954 loops=1)
  Sort Key: (sum("*SELECT* 1".quantity)) DESC
  Sort Method: quicksort  Memory: 1483kB
  ->  HashAggregate  (cost=17655.24..17853.36 rows=19812 width=21) (actual time=639.629..644.250 rows=17954 loops=1)
        Group Key: p.name
        Batches: 1  Memory Usage: 2065kB
        ->  Hash Join  (cost=2542.50..16055.24 rows=320000 width=17) (actual time=28.009..494.280 rows=320000 loops=1)
              Hash Cond: ("*SELECT* 1".product_id = p.id)
              ->  Append  (cost=1854.50..14527.07 rows=320000 width=8) (actual time=20.911..348.151 rows=320000 loops=1)
                    ->  Subquery Scan on "*SELECT* 1"  (cost=1854.50..6525.95 rows=159488 width=8) (actual time=20.910..118.108 rows=159488 loops=1)
                          ->  Hash Join  (cost=1854.50..4931.07 rows=159488 width=8) (actual time=20.908..103.057 rows=159488 loops=1)
                                Hash Cond: (ssi.variant_id = v.id)
                                ->  Seq Scan on "SerialStockItem" ssi  (cost=0.00..2657.88 rows=159488 width=4) (actual time=0.013..12.872 rows=159488 loops=1)
                                ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=20.865..20.867 rows=47000 loops=1)
                                      Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                      ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.005..13.082 rows=47000 loops=1)
                    ->  Subquery Scan on "*SELECT* 2"  (cost=1854.50..6401.12 rows=160512 width=8) (actual time=13.223..205.061 rows=160512 loops=1)
                          ->  Hash Join  (cost=1854.50..4796.00 rows=160512 width=8) (actual time=13.222..184.605 rows=160512 loops=1)
                                Hash Cond: (bsi.variant_id = v_1.id)
                                ->  Seq Scan on "BulkStockItem" bsi  (cost=0.00..2520.12 rows=160512 width=8) (actual time=0.015..25.748 rows=160512 loops=1)
                                ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=13.016..13.018 rows=47000 loops=1)
                                      Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                      ->  Seq Scan on "Variant" v_1  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.016..5.413 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=7.086..7.086 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.015..2.453 rows=20000 loops=1)
Planning Time: 22.207 ms
Execution Time: 653.201 ms


==================================================
EXPLAIN ANALYZE — Query 9: Najpopularniejsze Kategorie (wg. Całkowitego Przychodu)
==================================================
Limit  (cost=7440.92..7440.95 rows=10 width=44) (actual time=177.657..177.665 rows=1 loops=1)
  ->  Sort  (cost=7440.92..7441.30 rows=150 width=44) (actual time=177.656..177.662 rows=1 loops=1)
        Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
        Sort Method: quicksort  Memory: 25kB
        ->  HashAggregate  (cost=7435.81..7437.68 rows=150 width=44) (actual time=177.637..177.645 rows=1 loops=1)
              Group Key: c.name
              Batches: 1  Memory Usage: 40kB
              ->  Hash Join  (cost=3230.89..6435.81 rows=100000 width=22) (actual time=75.624..169.672 rows=20000 loops=1)
                    Hash Cond: (pc.category_id = c.id)
                    ->  Hash Join  (cost=3225.51..6160.51 rows=100000 width=14) (actual time=74.001..164.047 rows=20000 loops=1)
                          Hash Cond: (pc.product_id = p.id)
                          ->  Seq Scan on "ProductCategory" pc  (cost=0.00..1560.00 rows=100000 width=8) (actual time=1.384..110.924 rows=100000 loops=1)
                          ->  Hash  (cost=2975.51..2975.51 rows=20000 width=18) (actual time=35.973..35.978 rows=20000 loops=1)
                                Buckets: 32768  Batches: 1  Memory Usage: 1272kB
                                ->  Hash Join  (cost=2542.50..2975.51 rows=20000 width=18) (actual time=18.959..32.442 rows=20000 loops=1)
                                      Hash Cond: (v.product_id = p.id)
                                      ->  Hash Join  (cost=1854.50..2235.00 rows=20000 width=14) (actual time=13.911..24.028 rows=20000 loops=1)
                                            Hash Cond: (oi.variant_id = v.id)
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=14) (actual time=0.027..6.456 rows=20000 loops=1)
                                            ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=13.718..13.719 rows=47000 loops=1)
                                                  Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                                  ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.006..5.409 rows=47000 loops=1)
                                      ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=5.037..5.038 rows=20000 loops=1)
                                            Buckets: 32768  Batches: 1  Memory Usage: 960kB
                                            ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.011..2.130 rows=20000 loops=1)
                    ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=1.609..1.610 rows=150 loops=1)
                          Buckets: 1024  Batches: 1  Memory Usage: 16kB
                          ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=1.543..1.575 rows=150 loops=1)
Planning Time: 24.289 ms
Execution Time: 178.393 ms


==================================================
EXPLAIN ANALYZE — Query 10: Liczba produktów per kategoria
==================================================
Sort  (cost=2342.22..2342.59 rows=150 width=20) (actual time=49.261..49.271 rows=150 loops=1)
  Sort Key: (count(pc.product_id)) DESC
  Sort Method: quicksort  Memory: 30kB
  ->  HashAggregate  (cost=2335.30..2336.80 rows=150 width=20) (actual time=49.198..49.221 rows=150 loops=1)
        Group Key: c.name
        Batches: 1  Memory Usage: 48kB
        ->  Hash Right Join  (cost=5.38..1835.30 rows=100000 width=16) (actual time=0.064..28.748 rows=100000 loops=1)
              Hash Cond: (pc.category_id = c.id)
              ->  Seq Scan on "ProductCategory" pc  (cost=0.00..1560.00 rows=100000 width=8) (actual time=0.003..6.703 rows=100000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=0.055..0.055 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 16kB
                    ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=0.011..0.030 rows=150 loops=1)
Planning Time: 0.194 ms
Execution Time: 49.332 ms


==================================================
EXPLAIN ANALYZE — Query 11: Liczba zamówień per metoda płatności
==================================================
Sort  (cost=7850.14..7850.15 rows=6 width=50) (actual time=188.898..196.048 rows=6 loops=1)
  Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  Finalize GroupAggregate  (cost=7848.47..7850.06 rows=6 width=50) (actual time=188.876..196.038 rows=6 loops=1)
        Group Key: pm.name
        ->  Gather Merge  (cost=7848.47..7849.87 rows=12 width=50) (actual time=188.861..196.016 rows=18 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Sort  (cost=6848.44..6848.46 rows=6 width=50) (actual time=150.486..150.489 rows=6 loops=3)
                    Sort Key: pm.name
                    Sort Method: quicksort  Memory: 25kB
                    Worker 0:  Sort Method: quicksort  Memory: 25kB
                    Worker 1:  Sort Method: quicksort  Memory: 25kB
                    ->  Partial HashAggregate  (cost=6848.29..6848.36 rows=6 width=50) (actual time=149.366..149.371 rows=6 loops=3)
                          Group Key: pm.name
                          Batches: 1  Memory Usage: 24kB
                          Worker 0:  Batches: 1  Memory Usage: 24kB
                          Worker 1:  Batches: 1  Memory Usage: 24kB
                          ->  Hash Join  (cost=579.13..6744.13 rows=8333 width=24) (actual time=7.414..145.901 rows=6667 loops=3)
                                Hash Cond: (o.payment_method_id = pm.id)
                                ->  Hash Join  (cost=578.00..6705.67 rows=8333 width=18) (actual time=7.190..144.195 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.007..69.370 rows=133333 loops=3)
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=14) (actual time=6.855..6.855 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1194kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=14) (actual time=0.021..2.585 rows=20000 loops=3)
                                ->  Hash  (cost=1.06..1.06 rows=6 width=14) (actual time=0.032..0.032 rows=6 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                      ->  Seq Scan on "PaymentMethod" pm  (cost=0.00..1.06 rows=6 width=14) (actual time=0.026..0.027 rows=6 loops=3)
Planning Time: 4.318 ms
Execution Time: 196.138 ms


==================================================
EXPLAIN ANALYZE — Query 12: Średnia ocena per producent
==================================================
Sort  (cost=1367.54..1367.91 rows=150 width=57) (actual time=73.512..73.523 rows=150 loops=1)
  Sort Key: (round(avg(r.rating), 2)) DESC NULLS LAST
  Sort Method: quicksort  Memory: 32kB
  ->  HashAggregate  (cost=1359.87..1362.12 rows=150 width=57) (actual time=73.392..73.455 rows=150 loops=1)
        Group Key: m.name
        Batches: 1  Memory Usage: 64kB
        ->  Hash Join  (cost=693.38..1259.87 rows=20000 width=29) (actual time=7.301..66.709 rows=27388 loops=1)
              Hash Cond: (p.manufacturer_id = m.id)
              ->  Hash Right Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=6.611..60.634 rows=27388 loops=1)
                    Hash Cond: (r.product_id = p.id)
                    ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=1.293..45.127 rows=20000 loops=1)
                    ->  Hash  (cost=438.00..438.00 rows=20000 width=8) (actual time=5.304..5.304 rows=20000 loops=1)
                          Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                          ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=8) (actual time=0.005..2.222 rows=20000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.057..0.058 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 18kB
                    ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.015..0.031 rows=150 loops=1)
Planning Time: 8.148 ms
Execution Time: 73.597 ms


==================================================
EXPLAIN ANALYZE — Query 13: Aktywne promocje i objęta nimi liczba wariantów
==================================================
Sort  (cost=587.95..588.05 rows=42 width=14) (actual time=9.321..9.324 rows=42 loops=1)
  Sort Key: (count(v.id)) DESC
  Sort Method: quicksort  Memory: 26kB
  ->  HashAggregate  (cost=586.40..586.82 rows=42 width=14) (actual time=9.297..9.306 rows=42 loops=1)
        Group Key: pr.name
        Batches: 1  Memory Usage: 24kB
        ->  Merge Join  (cost=7.46..535.87 rows=10105 width=10) (actual time=0.190..8.926 rows=1238 loops=1)
              Merge Cond: (v.promotion_id = pr.id)
              ->  Index Scan using idx_variant_promotion on "Variant" v  (cost=0.29..4233.14 rows=47000 width=8) (actual time=0.017..8.297 rows=5685 loops=1)
              ->  Sort  (cost=7.17..7.27 rows=43 width=10) (actual time=0.054..0.062 rows=43 loops=1)
                    Sort Key: pr.id
                    Sort Method: quicksort  Memory: 26kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=43 width=10) (actual time=0.019..0.042 rows=43 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 157
Planning Time: 8.001 ms
Execution Time: 9.395 ms


==================================================
EXPLAIN ANALYZE — Query 14: Najczęściej wybierane warianty w koszykach
==================================================
Limit  (cost=268487.71..268487.74 rows=10 width=44) (actual time=1878.977..1878.988 rows=10 loops=1)
  ->  Sort  (cost=268487.71..272237.71 rows=1500000 width=44) (actual time=1878.965..1878.971 rows=10 loops=1)
        Sort Key: (sum("CartItem".quantity)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  HashAggregate  (cost=197635.75..236073.25 rows=1500000 width=44) (actual time=1859.632..1871.585 rows=47000 loops=1)
              Group Key: "Variant".sku, p.name
              Planned Partitions: 32  Batches: 1  Memory Usage: 6161kB
              ->  Hash Join  (cost=3858.75..62635.75 rows=1500000 width=40) (actual time=66.491..1086.757 rows=1500000 loops=1)
                    Hash Cond: ("CartItem".variant_id = "Variant".id)
                    ->  Seq Scan on "CartItem"  (cost=0.00..23152.00 rows=1500000 width=16) (actual time=1.384..267.170 rows=1500000 loops=1)
                    ->  Hash  (cost=3271.25..3271.25 rows=47000 width=40) (actual time=65.079..65.082 rows=47000 loops=1)
                          Buckets: 65536  Batches: 1  Memory Usage: 3868kB
                          ->  Hash Join  (cost=888.00..3271.25 rows=47000 width=40) (actual time=10.283..50.833 rows=47000 loops=1)
                                Hash Cond: ("Variant".product_id = p.id)
                                ->  Seq Scan on "Variant"  (cost=0.00..1267.00 rows=47000 width=68) (actual time=0.013..9.311 rows=47000 loops=1)
                                ->  Hash  (cost=638.00..638.00 rows=20000 width=17) (actual time=10.255..10.256 rows=20000 loops=1)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                                      ->  Subquery Scan on p  (cost=0.00..638.00 rows=20000 width=17) (actual time=0.008..5.068 rows=20000 loops=1)
                                            ->  Seq Scan on "Product"  (cost=0.00..438.00 rows=20000 width=85) (actual time=0.007..3.106 rows=20000 loops=1)
Planning Time: 19.875 ms
Execution Time: 1881.404 ms


==================================================
EXPLAIN ANALYZE — Query 15: Produkty z Największą Różnicą Między Ceną Podstawową a Ceną Wariantu
==================================================
Limit  (cost=3211.55..3211.58 rows=10 width=80) (actual time=44.725..44.729 rows=10 loops=1)
  ->  Sort  (cost=3211.55..3329.05 rows=47000 width=80) (actual time=44.724..44.726 rows=10 loops=1)
        Sort Key: v.price_modifier DESC
        Sort Method: top-N heapsort  Memory: 27kB
        ->  Hash Join  (cost=688.00..2195.90 rows=47000 width=80) (actual time=6.379..32.926 rows=47000 loops=1)
              Hash Cond: (v.product_id = p.id)
              ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=33) (actual time=0.010..6.267 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=6.352..6.353 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1381kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.004..2.684 rows=20000 loops=1)
Planning Time: 1.536 ms
Execution Time: 44.768 ms


==================================================
EXPLAIN ANALYZE — Query 16: Konwersja zamówień wg statusu
==================================================
Sort  (cost=7541.77..7541.79 rows=7 width=48) (actual time=132.537..175.591 rows=7 loops=1)
  Sort Key: (count(o.id)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  WindowAgg  (cost=7541.33..7541.67 rows=7 width=48) (actual time=132.526..175.584 rows=7 loops=1)
        ->  Finalize GroupAggregate  (cost=7539.74..7541.51 rows=7 width=16) (actual time=132.493..175.555 rows=7 loops=1)
              Group Key: s.name
              ->  Gather Merge  (cost=7539.74..7541.37 rows=14 width=16) (actual time=132.483..175.542 rows=21 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Sort  (cost=6539.71..6539.73 rows=7 width=16) (actual time=97.058..97.060 rows=7 loops=3)
                          Sort Key: s.name
                          Sort Method: quicksort  Memory: 25kB
                          Worker 0:  Sort Method: quicksort  Memory: 25kB
                          Worker 1:  Sort Method: quicksort  Memory: 25kB
                          ->  Partial HashAggregate  (cost=6539.55..6539.62 rows=7 width=16) (actual time=95.613..95.616 rows=7 loops=3)
                                Group Key: s.name
                                Batches: 1  Memory Usage: 24kB
                                Worker 0:  Batches: 1  Memory Usage: 24kB
                                Worker 1:  Batches: 1  Memory Usage: 24kB
                                ->  Hash Join  (cost=1.16..5706.21 rows=166667 width=12) (actual time=0.056..63.441 rows=133333 loops=3)
                                      Hash Cond: (o.status_id = s.id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.007..21.059 rows=133333 loops=3)
                                      ->  Hash  (cost=1.07..1.07 rows=7 width=12) (actual time=0.026..0.026 rows=7 loops=3)
                                            Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                            ->  Seq Scan on "Status" s  (cost=0.00..1.07 rows=7 width=12) (actual time=0.020..0.021 rows=7 loops=3)
Planning Time: 3.807 ms
Execution Time: 175.687 ms


==================================================
EXPLAIN ANALYZE — Query 17: Top klienci wg wydatków
==================================================
Limit  (cost=15441.08..15441.10 rows=10 width=50) (actual time=1553.751..1632.259 rows=10 loops=1)
  ->  Sort  (cost=15441.08..15491.08 rows=20000 width=50) (actual time=1553.749..1632.256 rows=10 loops=1)
        Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=14758.88..15008.88 rows=20000 width=50) (actual time=1539.291..1626.878 rows=19296 loops=1)
              Group Key: u.id
              Batches: 5  Memory Usage: 8241kB  Disk Usage: 224kB
              ->  Gather  (cost=12863.13..14633.89 rows=16666 width=50) (actual time=1335.874..1466.487 rows=19442 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=11863.13..11967.29 rows=8333 width=50) (actual time=1330.348..1337.758 rows=6481 loops=3)
                          Group Key: u.id
                          Batches: 1  Memory Usage: 2961kB
                          Worker 0:  Batches: 1  Memory Usage: 2961kB
                          Worker 1:  Batches: 1  Memory Usage: 2961kB
                          ->  Nested Loop  (cost=578.42..11779.80 rows=8333 width=28) (actual time=7.855..1312.006 rows=6667 loops=3)
                                ->  Hash Join  (cost=578.00..6705.67 rows=8333 width=14) (actual time=7.400..65.213 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.019..12.503 rows=133333 loops=3)
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=14) (actual time=6.963..7.465 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1194kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=14) (actual time=0.105..2.642 rows=20000 loops=3)
                                ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.186..0.186 rows=1 loops=20000)
                                      Index Cond: (id = o.user_id)
Planning Time: 1.121 ms
Execution Time: 1637.865 ms


==================================================
EXPLAIN ANALYZE — Query 18: Produkty z wariantami objętymi promocją, z końcową ceną
==================================================
Sort  (cost=2074.11..2099.37 rows=10105 width=132) (actual time=14.857..14.966 rows=1238 loops=1)
  Sort Key: (round(((p.price + v.price_modifier) * ('1'::numeric - pr.discount_percentage)), 2))
  Sort Method: quicksort  Memory: 139kB
  ->  Hash Join  (cost=695.46..1401.98 rows=10105 width=132) (actual time=9.021..14.393 rows=1238 loops=1)
        Hash Cond: (v.product_id = p.id)
        ->  Merge Join  (cost=7.46..535.87 rows=10105 width=39) (actual time=0.167..4.157 rows=1238 loops=1)
              Merge Cond: (v.promotion_id = pr.id)
              ->  Index Scan using idx_variant_promotion on "Variant" v  (cost=0.29..4233.14 rows=47000 width=37) (actual time=0.008..3.611 rows=5685 loops=1)
              ->  Sort  (cost=7.17..7.27 rows=43 width=10) (actual time=0.043..0.050 rows=43 loops=1)
                    Sort Key: pr.id
                    Sort Method: quicksort  Memory: 26kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=43 width=10) (actual time=0.011..0.033 rows=43 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 157
        ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=8.835..8.835 rows=20000 loops=1)
              Buckets: 32768  Batches: 1  Memory Usage: 1381kB
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.005..4.987 rows=20000 loops=1)
Planning Time: 5.259 ms
Execution Time: 15.069 ms


==================================================
EXPLAIN ANALYZE — Query 19: Użytkownicy, Którzy Dodali Produkt do Koszyka, Ale Nie Złożyli Zamówienia (Potencjał Odbudowy Koszyka)
==================================================
Hash Join  (cost=46254.21..103988.81 rows=1068640 width=55) (actual time=3555.063..6004.442 rows=1005006 loops=1)
  Hash Cond: (v.product_id = p.id)
  ->  Hash Join  (cost=45566.21..100495.04 rows=1068640 width=46) (actual time=3546.013..5432.756 rows=1005006 loops=1)
        Hash Cond: (ci.variant_id = v.id)
        ->  Hash Join  (cost=43711.71..95835.11 rows=1068640 width=46) (actual time=3529.219..4627.143 rows=1005006 loops=1)
              Hash Cond: (ci.cart_id = c.id)
              ->  Seq Scan on "CartItem" ci  (cost=0.00..23152.00 rows=1500000 width=8) (actual time=0.680..257.938 rows=1500000 loops=1)
              ->  Hash  (cost=41435.91..41435.91 rows=106864 width=46) (actual time=3522.064..3532.667 rows=100414 loops=1)
                    Buckets: 131072  Batches: 2  Memory Usage: 4929kB
                    ->  Gather  (cost=25017.67..41435.91 rows=106864 width=46) (actual time=3266.464..3348.475 rows=100414 loops=1)
                          Workers Planned: 2
                          Workers Launched: 2
                          ->  Parallel Hash Right Anti Join  (cost=24017.67..29749.51 rows=44527 width=46) (actual time=3171.420..3184.582 rows=33471 loops=3)
                                Hash Cond: (o.user_id = u.id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=4) (actual time=1.966..499.777 rows=133333 loops=3)
                                ->  Parallel Hash  (cost=23236.42..23236.42 rows=62500 width=50) (actual time=2272.244..2273.057 rows=50000 loops=3)
                                      Buckets: 262144  Batches: 1  Memory Usage: 14720kB
                                      ->  Hash Join  (cost=4079.00..23236.42 rows=62500 width=50) (actual time=254.001..1973.746 rows=50000 loops=3)
                                            Hash Cond: (u.id = c.user_id)
                                            ->  Parallel Seq Scan on "User" u  (cost=0.00..18063.67 rows=416667 width=46) (actual time=0.533..1197.080 rows=333333 loops=3)
                                            ->  Hash  (cost=2204.00..2204.00 rows=150000 width=8) (actual time=249.113..249.304 rows=150000 loops=3)
                                                  Buckets: 262144  Batches: 1  Memory Usage: 7908kB
                                                  ->  Seq Scan on "Cart" c  (cost=0.00..2204.00 rows=150000 width=8) (actual time=0.454..172.844 rows=150000 loops=3)
        ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=13.015..13.604 rows=47000 loops=1)
              Buckets: 65536  Batches: 1  Memory Usage: 2348kB
              ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.015..5.365 rows=47000 loops=1)
  ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=5.678..5.679 rows=20000 loops=1)
        Buckets: 32768  Batches: 1  Memory Usage: 1245kB
        ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.014..2.365 rows=20000 loops=1)
Planning Time: 30.745 ms
Execution Time: 6107.239 ms


==================================================
EXPLAIN ANALYZE — Query 20: Wyszukiwanie produktów po nazwie lub opisie (parametryzowane)
==================================================
Bitmap Heap Scan on "Product"  (cost=43.00..57.51 rows=4 width=60) (actual time=6.135..29.417 rows=143 loops=1)
  Recheck Cond: (((name)::text ~~* '%test%'::text) OR (description ~~* '%test%'::text))
  Heap Blocks: exact=106
  ->  BitmapOr  (cost=43.00..43.00 rows=4 width=0) (actual time=5.360..5.362 rows=0 loops=1)
        ->  Bitmap Index Scan on idx_product_name_trgm  (cost=0.00..21.50 rows=2 width=0) (actual time=2.670..2.670 rows=42 loops=1)
              Index Cond: ((name)::text ~~* '%test%'::text)
        ->  Bitmap Index Scan on idx_product_description_trgm  (cost=0.00..21.50 rows=2 width=0) (actual time=2.684..2.684 rows=102 loops=1)
              Index Cond: (description ~~* '%test%'::text)
Planning Time: 79.480 ms
Execution Time: 33.922 ms


==================================================
EXPLAIN ANALYZE — Query 21: Użytkownicy, Którzy Zapisali Konkretny Produkt jako Ulubiony (np. Product ID=350259)
==================================================
Nested Loop  (cost=0.85..262.23 rows=30 width=56) (actual time=1.913..16.973 rows=26 loops=1)
  ->  Index Only Scan using idx_favoriteproduct_product_user on "FavoriteProduct" fp  (cost=0.42..8.95 rows=30 width=4) (actual time=1.898..1.908 rows=26 loops=1)
        Index Cond: (product_id = 35)
        Heap Fetches: 0
  ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..8.44 rows=1 width=60) (actual time=0.578..0.578 rows=1 loops=26)
        Index Cond: (id = fp.user_id)
Planning Time: 10.150 ms
Execution Time: 17.009 ms


==================================================
EXPLAIN ANALYZE — Query 22: Znajdź Magazyny, Które Posiadają Zapasy Konkretnego Wariantu (np. SKU='VR-000000-a637d44b7afd')
==================================================
Sort  (cost=80.54..80.54 rows=2 width=25) (actual time=5.394..5.398 rows=0 loops=1)
  Sort Key: (sum("*SELECT* 1".stock_units)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  GroupAggregate  (cost=80.41..80.53 rows=2 width=25) (actual time=5.384..5.387 rows=0 loops=1)
        Group Key: w.name
        Filter: (sum("*SELECT* 1".stock_units) > 0)
        ->  Sort  (cost=80.41..80.42 rows=6 width=21) (actual time=5.382..5.385 rows=0 loops=1)
              Sort Key: w.name
              Sort Method: quicksort  Memory: 25kB
              ->  Nested Loop  (cost=4.76..80.33 rows=6 width=21) (actual time=5.371..5.374 rows=0 loops=1)
                    Join Filter: (w.id = "*SELECT* 1".warehouse_id)
                    ->  Append  (cost=4.76..78.43 rows=6 width=8) (actual time=5.370..5.373 rows=0 loops=1)
                          ->  Subquery Scan on "*SELECT* 1"  (cost=4.76..39.13 rows=3 width=8) (actual time=5.346..5.347 rows=0 loops=1)
                                ->  Nested Loop  (cost=4.76..39.10 rows=3 width=8) (actual time=5.345..5.347 rows=0 loops=1)
                                      ->  Index Scan using "Variant_sku_key" on "Variant" v  (cost=0.41..8.43 rows=1 width=4) (actual time=5.345..5.345 rows=0 loops=1)
                                            Index Cond: ((sku)::text = 'VR-000001-2704de10f283'::text)
                                      ->  Bitmap Heap Scan on "BulkStockItem" bsi  (cost=4.35..30.60 rows=7 width=12) (never executed)
                                            Recheck Cond: (variant_id = v.id)
                                            ->  Bitmap Index Scan on idx_bulk_variant  (cost=0.00..4.35 rows=7 width=0) (never executed)
                                                  Index Cond: (variant_id = v.id)
                          ->  Subquery Scan on "*SELECT* 2"  (cost=4.76..39.27 rows=3 width=8) (actual time=0.022..0.023 rows=0 loops=1)
                                ->  Nested Loop  (cost=4.76..39.24 rows=3 width=8) (actual time=0.021..0.022 rows=0 loops=1)
                                      ->  Index Scan using "Variant_sku_key" on "Variant" v_1  (cost=0.41..8.43 rows=1 width=4) (actual time=0.021..0.021 rows=0 loops=1)
                                            Index Cond: ((sku)::text = 'VR-000001-2704de10f283'::text)
                                      ->  Bitmap Heap Scan on "SerialStockItem" ssi  (cost=4.35..30.73 rows=7 width=8) (never executed)
                                            Recheck Cond: (variant_id = v_1.id)
                                            ->  Bitmap Index Scan on idx_serial_variant  (cost=0.00..4.35 rows=7 width=0) (never executed)
                                                  Index Cond: (variant_id = v_1.id)
                    ->  Materialize  (cost=0.00..1.15 rows=10 width=21) (never executed)
                          ->  Seq Scan on "Warehouse" w  (cost=0.00..1.10 rows=10 width=21) (never executed)
Planning Time: 7.747 ms
Execution Time: 6.075 ms


==================================================
EXPLAIN ANALYZE — Query 23: Warianty, Które Wymagają Uzyskania Konkretnej Opcji (np. 'Kolor'='Czerwony')
==================================================
Nested Loop  (cost=6.81..677.99 rows=8 width=36) (actual time=0.018..0.019 rows=0 loops=1)
  ->  Nested Loop  (cost=6.52..675.35 rows=8 width=27) (actual time=0.018..0.019 rows=0 loops=1)
        ->  Nested Loop  (cost=6.23..672.76 rows=8 width=4) (actual time=0.018..0.018 rows=0 loops=1)
              Join Filter: (opt.attribute_id = a.id)
              ->  Seq Scan on "Attribute" a  (cost=0.00..1.38 rows=1 width=4) (actual time=0.018..0.018 rows=0 loops=1)
                    Filter: ((name)::text = 'Attr_49_Century'::text)
                    Rows Removed by Filter: 30
              ->  Nested Loop  (cost=6.23..668.26 rows=250 width=8) (never executed)
                    ->  Seq Scan on "Option" opt  (cost=0.00..18.50 rows=1 width=8) (never executed)
                          Filter: ((value)::text = 'do'::text)
                    ->  Bitmap Heap Scan on "VariantOption" vo  (cost=6.23..647.26 rows=250 width=8) (never executed)
                          Recheck Cond: (option_id = opt.id)
                          ->  Bitmap Index Scan on idx_variantoption_option_id  (cost=0.00..6.17 rows=250 width=0) (never executed)
                                Index Cond: (option_id = opt.id)
        ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.32 rows=1 width=31) (never executed)
              Index Cond: (id = vo.variant_id)
  ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=17) (never executed)
        Index Cond: (id = v.product_id)
Planning Time: 58.441 ms
Execution Time: 0.082 ms


==================================================
EXPLAIN ANALYZE — Query 24: Znajdź Zamówienia Użytkownika (np. email='debbie.lane.16786.50af0753@example.com') o Statusie 'Paid'
==================================================
Nested Loop  (cost=0.98..17.07 rows=1 width=20) (actual time=3.974..3.975 rows=0 loops=1)
  ->  Nested Loop  (cost=0.85..16.89 rows=1 width=16) (actual time=3.974..3.974 rows=0 loops=1)
        ->  Index Scan using "User_email_key" on "User" u  (cost=0.42..8.44 rows=1 width=4) (actual time=3.973..3.974 rows=0 loops=1)
              Index Cond: ((email)::text = 'debbie.lane.16786.50af0753@example.com'::text)
        ->  Index Scan using idx_order_user_id on "Order" o  (cost=0.42..8.44 rows=1 width=20) (never executed)
              Index Cond: (user_id = u.id)
  ->  Index Scan using "Status_pkey" on "Status" s  (cost=0.13..0.15 rows=1 width=12) (never executed)
        Index Cond: (id = o.status_id)
        Filter: ((name)::text = 'Paid'::text)
Planning Time: 3.319 ms
Execution Time: 4.011 ms


==================================================
EXPLAIN ANALYZE — Query 25: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
Hash Left Join  (cost=6.97..48.34 rows=16 width=87) (actual time=3.590..11.446 rows=18 loops=1)
  Hash Cond: (opt.attribute_id = a.id)
  ->  Nested Loop Left Join  (cost=5.30..46.57 rows=16 width=45) (actual time=2.433..10.269 rows=18 loops=1)
        ->  Nested Loop Left Join  (cost=5.02..41.89 rows=16 width=39) (actual time=1.328..6.550 rows=18 loops=1)
              ->  Nested Loop  (cost=4.60..24.13 rows=3 width=39) (actual time=0.626..1.213 rows=4 loops=1)
                    ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..8.30 rows=1 width=10) (actual time=0.596..0.598 rows=1 loops=1)
                          Index Cond: (id = 35)
                    ->  Bitmap Heap Scan on "Variant" v  (cost=4.31..15.80 rows=3 width=37) (actual time=0.027..0.611 rows=4 loops=1)
                          Recheck Cond: (product_id = 35)
                          Heap Blocks: exact=4
                          ->  Bitmap Index Scan on idx_variant_product_id  (cost=0.00..4.31 rows=3 width=0) (actual time=0.016..0.016 rows=4 loops=1)
                                Index Cond: (product_id = 35)
              ->  Index Only Scan using uq_varopt_variant_option on "VariantOption" vo  (cost=0.42..5.86 rows=6 width=8) (actual time=1.331..1.332 rows=4 loops=4)
                    Index Cond: (variant_id = v.id)
                    Heap Fetches: 0
        ->  Index Scan using "Option_pkey" on "Option" opt  (cost=0.28..0.29 rows=1 width=14) (actual time=0.206..0.206 rows=1 loops=18)
              Index Cond: (id = vo.option_id)
  ->  Hash  (cost=1.30..1.30 rows=30 width=18) (actual time=0.021..0.022 rows=30 loops=1)
        Buckets: 1024  Batches: 1  Memory Usage: 10kB
        ->  Seq Scan on "Attribute" a  (cost=0.00..1.30 rows=30 width=18) (actual time=0.010..0.013 rows=30 loops=1)
Planning Time: 0.540 ms
Execution Time: 11.497 ms


==================================================
EXPLAIN ANALYZE — Query 26: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
Hash Left Join  (cost=6.97..48.42 rows=16 width=87) (actual time=0.007..0.009 rows=0 loops=1)
  Hash Cond: (opt.attribute_id = a.id)
  ->  Nested Loop Left Join  (cost=5.30..46.57 rows=16 width=45) (actual time=0.007..0.008 rows=0 loops=1)
        ->  Nested Loop Left Join  (cost=5.02..41.89 rows=16 width=39) (actual time=0.007..0.007 rows=0 loops=1)
              ->  Nested Loop  (cost=4.60..24.13 rows=3 width=39) (actual time=0.007..0.007 rows=0 loops=1)
                    ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..8.30 rows=1 width=10) (actual time=0.006..0.006 rows=0 loops=1)
                          Index Cond: (id = 350259)
                    ->  Bitmap Heap Scan on "Variant" v  (cost=4.31..15.80 rows=3 width=37) (never executed)
                          Recheck Cond: (product_id = 350259)
                          ->  Bitmap Index Scan on idx_variant_product_id  (cost=0.00..4.31 rows=3 width=0) (never executed)
                                Index Cond: (product_id = 350259)
              ->  Index Only Scan using uq_varopt_variant_option on "VariantOption" vo  (cost=0.42..5.86 rows=6 width=8) (never executed)
                    Index Cond: (variant_id = v.id)
                    Heap Fetches: 0
        ->  Index Scan using "Option_pkey" on "Option" opt  (cost=0.28..0.29 rows=1 width=14) (never executed)
              Index Cond: (id = vo.option_id)
  ->  Hash  (cost=1.30..1.30 rows=30 width=18) (never executed)
        ->  Seq Scan on "Attribute" a  (cost=0.00..1.30 rows=30 width=18) (never executed)
Planning Time: 0.594 ms
Execution Time: 0.048 ms


==================================================
EXPLAIN ANALYZE — Query 27: Porównanie Średniej Oceny dla Promowanych i Niepromowanych Produktów
==================================================
HashAggregate  (cost=87850.51..87853.01 rows=200 width=64) (actual time=165.521..165.526 rows=2 loops=1)
  Group Key: CASE WHEN (ANY (p.id = (hashed SubPlan 2).col1)) THEN 'Promowany'::text ELSE 'Niepromowany'::text END
  Batches: 1  Memory Usage: 40kB
  ->  HashAggregate  (cost=1300.51..87550.51 rows=20000 width=68) (actual time=155.732..162.643 rows=12612 loops=1)
        Group Key: p.id
        Batches: 1  Memory Usage: 2577kB
        ->  Hash Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=28.833..129.892 rows=20000 loops=1)
              Hash Cond: (r.product_id = p.id)
              ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=0.010..45.447 rows=20000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=28.790..28.792 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 960kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.005..24.303 rows=20000 loops=1)
        SubPlan 2
          ->  Index Only Scan using idx_variant_product_promotion on "Variant" v2  (cost=0.28..215.94 rows=5577 width=4) (actual time=2.029..14.311 rows=5684 loops=1)
                Heap Fetches: 0
Planning Time: 1.538 ms
Execution Time: 166.204 ms


==================================================
EXPLAIN ANALYZE — Query 28: Top 5 Miast Generujących Największy Przychód (Wg. Adresu Wysyłki)
==================================================
Limit  (cost=15175.51..15175.53 rows=5 width=45) (actual time=3875.266..3960.134 rows=5 loops=1)
  ->  Sort  (cost=15175.51..15225.51 rows=20000 width=45) (actual time=3873.941..3957.970 rows=5 loops=1)
        Sort Key: (sum(oi.unit_price)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=14593.32..14843.32 rows=20000 width=45) (actual time=3865.583..3954.887 rows=12950 loops=1)
              Group Key: a.city
              Batches: 1  Memory Usage: 5905kB
              ->  Gather  (cost=12697.56..14468.33 rows=16666 width=45) (actual time=3818.372..3930.184 rows=16072 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=11697.56..11801.73 rows=8333 width=45) (actual time=3797.593..3800.085 rows=5357 loops=3)
                          Group Key: a.city
                          Batches: 1  Memory Usage: 2449kB
                          Worker 0:  Batches: 1  Memory Usage: 2449kB
                          Worker 1:  Batches: 1  Memory Usage: 2449kB
                          ->  Nested Loop  (cost=681.42..11655.90 rows=8333 width=19) (actual time=14.811..3761.843 rows=6667 loops=3)
                                ->  Parallel Hash Join  (cost=681.00..6566.02 rows=8333 width=10) (actual time=11.799..102.690 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.009..34.079 rows=133333 loops=3)
                                      ->  Parallel Hash  (cost=533.93..533.93 rows=11765 width=10) (actual time=11.614..11.616 rows=6667 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1248kB
                                            ->  Parallel Index Only Scan using idx_orderitem_order_price_cover on "OrderItem" oi  (cost=0.29..533.93 rows=11765 width=10) (actual time=0.941..9.879 rows=6667 loops=3)
                                                  Heap Fetches: 0
                                ->  Index Scan using "Address_pkey" on "Address" a  (cost=0.43..0.61 rows=1 width=17) (actual time=0.546..0.546 rows=1 loops=20000)
                                      Index Cond: (id = o.shipping_address_id)
Planning Time: 29.280 ms
Execution Time: 3964.549 ms


==================================================
EXPLAIN ANALYZE — Query 29: Porównanie Wolumenu Sprzedaży Produktów Promowanych vs. Niepromowanych (w Ostatnich 30 Dniach)
==================================================
[ERROR EXECUTING QUERY 29] relation "StockItem" does not exist
LINE 7:         JOIN "StockItem" si ON oi.stock_item_id = si.id
                     ^



==================================================
EXPLAIN ANALYZE — Query 30: Wskaźnik Lojalności (Repeat Purchase Rate) Użytkowników z Podziałem na Miasto Adresu Rozliczeniowego
==================================================
[ERROR EXECUTING QUERY 30] current transaction is aborted, commands ignored until end of transaction block


FINISHED — 2025-12-02 21:01:16.749744
========================================================================================================================
========================================================================================================================
START EXPLAIN RUN — 2025-12-02 21:02:00.908377
========================================================================================================================


==================================================
EXPLAIN ANALYZE — Query 1: Średnia Wartość Zamówienia (AOV) w Ostatnim Miesiącu
==================================================
Aggregate  (cost=4365.19..4365.20 rows=1 width=32) (actual time=56.685..56.688 rows=1 loops=1)
  ->  GroupAggregate  (cost=4345.23..4357.51 rows=614 width=36) (actual time=56.251..56.634 rows=608 loops=1)
        Group Key: o.id
        ->  Sort  (cost=4345.23..4346.77 rows=614 width=10) (actual time=54.896..54.961 rows=619 loops=1)
              Sort Key: o.id
              Sort Method: quicksort  Memory: 44kB
              ->  Hash Join  (cost=3936.30..4316.80 rows=614 width=10) (actual time=20.367..54.712 rows=619 loops=1)
                    Hash Cond: (oi.order_id = o.id)
                    ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.018..30.827 rows=20000 loops=1)
                    ->  Hash  (cost=3782.70..3782.70 rows=12288 width=4) (actual time=20.290..20.291 rows=12333 loops=1)
                          Buckets: 16384  Batches: 1  Memory Usage: 562kB
                          ->  Bitmap Heap Scan on "Order" o  (cost=231.66..3782.70 rows=12288 width=4) (actual time=6.985..18.209 rows=12333 loops=1)
                                Recheck Cond: (order_date >= (now() - '1 mon'::interval))
                                Heap Blocks: exact=3270
                                ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..228.59 rows=12288 width=0) (actual time=6.597..6.597 rows=12333 loops=1)
                                      Index Cond: (order_date >= (now() - '1 mon'::interval))
Planning Time: 21.427 ms
Execution Time: 57.440 ms


==================================================
EXPLAIN ANALYZE — Query 2: Średnia wartość zamówienia per użytkownik
==================================================
Sort  (cost=16066.87..16115.61 rows=19495 width=50) (actual time=3631.362..3701.309 rows=19296 loops=1)
  Sort Key: (round(avg(order_totals.total_price), 2)) DESC
  Sort Method: quicksort  Memory: 1612kB
  ->  Finalize HashAggregate  (cost=14385.35..14677.77 rows=19495 width=50) (actual time=3586.122..3679.816 rows=19296 loops=1)
        Group Key: u.id
        Batches: 5  Memory Usage: 8241kB  Disk Usage: 224kB
        ->  Gather  (cost=12537.36..14263.50 rows=16246 width=50) (actual time=3338.731..3505.219 rows=19428 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial HashAggregate  (cost=11537.36..11638.90 rows=8123 width=50) (actual time=3299.378..3310.248 rows=6476 loops=3)
                    Group Key: u.id
                    Batches: 1  Memory Usage: 2961kB
                    Worker 0:  Batches: 1  Memory Usage: 2961kB
                    Worker 1:  Batches: 1  Memory Usage: 3217kB
                    ->  Nested Loop  (cost=1110.75..11496.75 rows=8123 width=50) (actual time=165.669..3238.563 rows=6498 loops=3)
                          ->  Hash Join  (cost=1110.33..6550.49 rows=8123 width=36) (actual time=134.227..258.615 rows=6498 loops=3)
                                Hash Cond: (o.id = order_totals.order_id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.009..44.513 rows=133333 loops=3)
                                ->  Hash  (cost=866.64..866.64 rows=19495 width=36) (actual time=131.781..133.951 rows=19495 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1094kB
                                      ->  Subquery Scan on order_totals  (cost=428.00..866.64 rows=19495 width=36) (actual time=72.581..109.661 rows=19495 loops=3)
                                            ->  HashAggregate  (cost=428.00..671.69 rows=19495 width=36) (actual time=72.580..104.868 rows=19495 loops=3)
                                                  Group Key: oi.order_id
                                                  Batches: 1  Memory Usage: 7953kB
                                                  Worker 0:  Batches: 1  Memory Usage: 7953kB
                                                  Worker 1:  Batches: 1  Memory Usage: 7953kB
                                                  ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.586..12.265 rows=20000 loops=3)
                          ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.447..0.447 rows=1 loops=19495)
                                Index Cond: (id = o.user_id)
Planning Time: 11.316 ms
Execution Time: 3740.537 ms


==================================================
EXPLAIN ANALYZE — Query 3: Top 10 Najlepiej Sprzedających Się Produktów (wg. Ilości Sprzedanych Jednostek) w Ostatnim Kwartale
==================================================
Limit  (cost=9141.43..9141.46 rows=10 width=46) (actual time=119.449..187.921 rows=1 loops=1)
  ->  Sort  (cost=9141.43..9151.38 rows=3981 width=46) (actual time=119.447..187.919 rows=1 loops=1)
        Sort Key: (sum(oi.quantity)) DESC
        Sort Method: quicksort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=9015.59..9055.40 rows=3981 width=46) (actual time=118.793..187.288 rows=1 loops=1)
              Group Key: p.name, m.name
              Batches: 1  Memory Usage: 217kB
              ->  Gather  (cost=8642.32..8990.71 rows=3318 width=46) (actual time=110.613..187.253 rows=1 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=7642.32..7658.91 rows=1659 width=46) (actual time=43.226..43.233 rows=0 loops=3)
                          Group Key: p.name, m.name
                          Batches: 1  Memory Usage: 73kB
                          Worker 0:  Batches: 1  Memory Usage: 73kB
                          Worker 1:  Batches: 1  Memory Usage: 73kB
                          ->  Hash Join  (cost=2077.38..7629.88 rows=1659 width=42) (actual time=23.493..42.533 rows=1324 loops=3)
                                Hash Cond: (p.manufacturer_id = m.id)
                                ->  Nested Loop  (cost=2072.01..7620.02 rows=1659 width=21) (actual time=22.967..41.670 rows=1324 loops=3)
                                      ->  Nested Loop  (cost=2071.72..7072.38 rows=1659 width=8) (actual time=22.177..38.884 rows=1324 loops=3)
                                            ->  Hash Join  (cost=2071.43..6211.85 rows=1659 width=8) (actual time=21.604..36.097 rows=1324 loops=3)
                                                  Hash Cond: (o.id = oi.order_id)
                                                  ->  Parallel Bitmap Heap Scan on "Order" o  (cost=1493.43..5409.94 rows=33172 width=4) (actual time=8.210..17.741 rows=26379 loops=3)
                                                        Recheck Cond: (order_date >= (now() - '3 mons'::interval))
                                                        Heap Blocks: exact=3334
                                                        ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..1473.52 rows=79613 width=0) (actual time=24.050..24.050 rows=79137 loops=1)
                                                              Index Cond: (order_date >= (now() - '3 mons'::interval))
                                                  ->  Hash  (cost=328.00..328.00 rows=20000 width=12) (actual time=8.479..8.479 rows=20000 loops=3)
                                                        Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                                        ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=12) (actual time=0.039..2.614 rows=20000 loops=3)
                                            ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.52 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=3972)
                                                  Index Cond: (id = oi.variant_id)
                                      ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=21) (actual time=0.002..0.002 rows=1 loops=3972)
                                            Index Cond: (id = v.product_id)
                                ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.495..0.495 rows=150 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 18kB
                                      ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.031..0.052 rows=150 loops=3)
Planning Time: 54.304 ms
Execution Time: 194.415 ms


==================================================
EXPLAIN ANALYZE — Query 4: Top 5 produktów z najwięcej recenzjami
==================================================
Limit  (cost=1792.59..1792.61 rows=5 width=25) (actual time=63.520..63.525 rows=5 loops=1)
  ->  Sort  (cost=1792.59..1842.59 rows=20000 width=25) (actual time=63.519..63.522 rows=5 loops=1)
        Sort Key: (COALESCE(r.count, '0'::bigint)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Hash Left Join  (cost=969.89..1460.40 rows=20000 width=25) (actual time=42.199..60.320 rows=20000 loops=1)
              Hash Cond: (p.id = r.product_id)
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.862..12.558 rows=20000 loops=1)
              ->  Hash  (cost=812.24..812.24 rows=12612 width=12) (actual time=41.323..41.325 rows=12612 loops=1)
                    Buckets: 16384  Batches: 1  Memory Usage: 670kB
                    ->  Subquery Scan on r  (cost=560.00..812.24 rows=12612 width=12) (actual time=35.628..39.246 rows=12612 loops=1)
                          ->  HashAggregate  (cost=560.00..686.12 rows=12612 width=12) (actual time=35.627..38.062 rows=12612 loops=1)
                                Group Key: "Review".product_id
                                Batches: 1  Memory Usage: 1425kB
                                ->  Seq Scan on "Review"  (cost=0.00..460.00 rows=20000 width=4) (actual time=1.399..28.177 rows=20000 loops=1)
Planning Time: 18.338 ms
Execution Time: 63.598 ms


==================================================
EXPLAIN ANALYZE — Query 5: Całkowity Przychód Pogrupowany Miesięcznie za Ostatni Rok
==================================================
Finalize GroupAggregate  (cost=9617.65..11883.29 rows=17380 width=36) (actual time=148.842..220.843 rows=11 loops=1)
  Group Key: ((date_trunc('month'::text, o.order_date))::date)
  ->  Gather Merge  (cost=9617.65..11470.51 rows=14484 width=36) (actual time=148.492..220.810 rows=33 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=8617.62..8798.67 rows=7242 width=36) (actual time=90.968..92.363 rows=11 loops=3)
              Group Key: ((date_trunc('month'::text, o.order_date))::date)
              ->  Sort  (cost=8617.62..8635.73 rows=7242 width=10) (actual time=89.966..90.526 rows=5760 loops=3)
                    Sort Key: ((date_trunc('month'::text, o.order_date))::date) DESC
                    Sort Method: quicksort  Memory: 742kB
                    Worker 0:  Sort Method: quicksort  Memory: 183kB
                    Worker 1:  Sort Method: quicksort  Memory: 192kB
                    ->  Parallel Hash Join  (cost=681.00..8153.33 rows=7242 width=10) (actual time=4.611..87.383 rows=5760 loops=3)
                          Hash Cond: (o.id = oi.order_id)
                          ->  Parallel Seq Scan on "Order" o  (cost=0.00..6669.33 rows=144838 width=12) (actual time=0.014..56.567 rows=115772 loops=3)
                                Filter: (order_date >= (date_trunc('year'::text, now()) - '00:00:00'::interval))
                                Rows Removed by Filter: 17562
                          ->  Parallel Hash  (cost=533.93..533.93 rows=11765 width=10) (actual time=4.053..4.053 rows=6667 loops=3)
                                Buckets: 32768  Batches: 1  Memory Usage: 1216kB
                                ->  Parallel Index Only Scan using idx_orderitem_order_price_cover on "OrderItem" oi  (cost=0.29..533.93 rows=11765 width=10) (actual time=0.019..6.956 rows=20000 loops=1)
                                      Heap Fetches: 0
Planning Time: 3.117 ms
Execution Time: 225.234 ms


==================================================
EXPLAIN ANALYZE — Query 6: Produkty najczęściej dodawane do ulubionych
==================================================
Limit  (cost=14382.58..14382.60 rows=10 width=25) (actual time=563.140..635.670 rows=10 loops=1)
  ->  Sort  (cost=14382.58..14432.58 rows=20000 width=25) (actual time=563.132..634.567 rows=10 loops=1)
        Sort Key: (count(f.id)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=13750.38..13950.38 rows=20000 width=25) (actual time=552.783..628.201 rows=20000 loops=1)
              Group Key: p.id
              Batches: 1  Memory Usage: 2577kB
              ->  Gather  (cost=9350.38..13550.38 rows=40000 width=25) (actual time=467.886..595.297 rows=59995 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=8350.38..8550.38 rows=20000 width=25) (actual time=424.403..431.003 rows=19998 loops=3)
                          Group Key: p.id
                          Batches: 1  Memory Usage: 2577kB
                          Worker 0:  Batches: 1  Memory Usage: 2577kB
                          Worker 1:  Batches: 1  Memory Usage: 2577kB
                          ->  Hash Join  (cost=688.00..7100.38 rows=250000 width=21) (actual time=12.626..348.355 rows=200000 loops=3)
                                Hash Cond: (f.product_id = p.id)
                                ->  Parallel Seq Scan on "FavoriteProduct" f  (cost=0.00..5756.00 rows=250000 width=8) (actual time=2.285..251.336 rows=200000 loops=3)
                                ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=7.354..9.086 rows=20000 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1215kB
                                      ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.273..3.094 rows=20000 loops=3)
Planning Time: 23.698 ms
Execution Time: 639.459 ms


==================================================
EXPLAIN ANALYZE — Query 7: Dostępny Stan Magazynowy Wariantów Produktu Pogrupowany po Magazynach
==================================================
Finalize GroupAggregate  (cost=8886.64..10869.06 rows=16000 width=61) (actual time=1338.916..1968.316 rows=231755 loops=1)
  Group Key: p.name, w.name, v.sku
  ->  Gather Merge  (cost=8886.64..10575.72 rows=13334 width=61) (actual time=1336.794..1870.478 rows=267509 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=7886.61..8036.62 rows=6667 width=61) (actual time=1305.271..1444.070 rows=89170 loops=3)
              Group Key: p.name, w.name, v.sku
              ->  Sort  (cost=7886.61..7903.28 rows=6667 width=57) (actual time=1303.930..1394.560 rows=106667 loops=3)
                    Sort Key: p.name, w.name, v.sku
                    Sort Method: external merge  Disk: 5552kB
                    Worker 0:  Sort Method: external merge  Disk: 7968kB
                    Worker 1:  Sort Method: external merge  Disk: 8264kB
                    ->  Hash Join  (cost=2543.72..7463.16 rows=6667 width=57) (actual time=101.145..743.128 rows=106667 loops=3)
                          Hash Cond: (v.product_id = p.id)
                          ->  Hash Join  (cost=1855.72..6757.66 rows=6667 width=48) (actual time=94.050..664.681 rows=106667 loops=3)
                                Hash Cond: (ssi.variant_id = v.id)
                                ->  Hash Join  (cost=1.23..4885.66 rows=6667 width=25) (actual time=1.319..498.182 rows=106667 loops=3)
                                      Hash Cond: (ssi.warehouse_id = w.id)
                                      ->  Parallel Append  (cost=0.00..4527.02 rows=133333 width=12) (actual time=1.049..435.223 rows=106667 loops=3)
                                            ->  Parallel Seq Scan on "SerialStockItem" ssi  (cost=0.00..2001.16 rows=93816 width=12) (actual time=3.155..190.403 rows=53163 loops=3)
                                            ->  Parallel Seq Scan on "BulkStockItem" bsi  (cost=0.00..1859.19 rows=94419 width=12) (actual time=0.927..345.271 rows=80256 loops=2)
                                      ->  Hash  (cost=1.10..1.10 rows=10 width=21) (actual time=0.243..0.246 rows=10 loops=3)
                                            Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                            ->  Seq Scan on "Warehouse" w  (cost=0.00..1.10 rows=10 width=21) (actual time=0.235..0.237 rows=10 loops=3)
                                ->  Hash  (cost=1267.00..1267.00 rows=47000 width=31) (actual time=92.018..92.018 rows=47000 loops=3)
                                      Buckets: 65536  Batches: 1  Memory Usage: 3450kB
                                      ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=31) (actual time=0.473..76.902 rows=47000 loops=3)
                          ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=6.860..6.861 rows=20000 loops=3)
                                Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                                ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.025..2.835 rows=20000 loops=3)
Planning Time: 12.967 ms
Execution Time: 1989.485 ms


==================================================
EXPLAIN ANALYZE — Query 8: Stan magazynowy per produkt
==================================================
Sort  (cost=19267.36..19316.89 rows=19812 width=21) (actual time=499.905..501.649 rows=17954 loops=1)
  Sort Key: (sum("*SELECT* 1".quantity)) DESC
  Sort Method: quicksort  Memory: 1483kB
  ->  HashAggregate  (cost=17655.24..17853.36 rows=19812 width=21) (actual time=492.528..496.329 rows=17954 loops=1)
        Group Key: p.name
        Batches: 1  Memory Usage: 2065kB
        ->  Hash Join  (cost=2542.50..16055.24 rows=320000 width=17) (actual time=24.730..374.487 rows=320000 loops=1)
              Hash Cond: ("*SELECT* 1".product_id = p.id)
              ->  Append  (cost=1854.50..14527.07 rows=320000 width=8) (actual time=14.551..253.569 rows=320000 loops=1)
                    ->  Subquery Scan on "*SELECT* 1"  (cost=1854.50..6525.95 rows=159488 width=8) (actual time=14.549..115.011 rows=159488 loops=1)
                          ->  Hash Join  (cost=1854.50..4931.07 rows=159488 width=8) (actual time=14.547..99.474 rows=159488 loops=1)
                                Hash Cond: (ssi.variant_id = v.id)
                                ->  Seq Scan on "SerialStockItem" ssi  (cost=0.00..2657.88 rows=159488 width=4) (actual time=0.020..13.601 rows=159488 loops=1)
                                ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=14.499..14.500 rows=47000 loops=1)
                                      Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                      ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.006..6.782 rows=47000 loops=1)
                    ->  Subquery Scan on "*SELECT* 2"  (cost=1854.50..6401.12 rows=160512 width=8) (actual time=13.530..112.838 rows=160512 loops=1)
                          ->  Hash Join  (cost=1854.50..4796.00 rows=160512 width=8) (actual time=13.529..97.203 rows=160512 loops=1)
                                Hash Cond: (bsi.variant_id = v_1.id)
                                ->  Seq Scan on "BulkStockItem" bsi  (cost=0.00..2520.12 rows=160512 width=8) (actual time=0.016..12.863 rows=160512 loops=1)
                                ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=13.490..13.490 rows=47000 loops=1)
                                      Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                      ->  Seq Scan on "Variant" v_1  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.006..5.439 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=10.168..10.168 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.017..3.705 rows=20000 loops=1)
Planning Time: 37.830 ms
Execution Time: 503.335 ms


==================================================
EXPLAIN ANALYZE — Query 9: Najpopularniejsze Kategorie (wg. Całkowitego Przychodu)
==================================================
Limit  (cost=7440.92..7440.95 rows=10 width=44) (actual time=192.041..192.049 rows=1 loops=1)
  ->  Sort  (cost=7440.92..7441.30 rows=150 width=44) (actual time=192.040..192.047 rows=1 loops=1)
        Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
        Sort Method: quicksort  Memory: 25kB
        ->  HashAggregate  (cost=7435.81..7437.68 rows=150 width=44) (actual time=192.025..192.034 rows=1 loops=1)
              Group Key: c.name
              Batches: 1  Memory Usage: 40kB
              ->  Hash Join  (cost=3230.89..6435.81 rows=100000 width=22) (actual time=69.431..183.454 rows=20000 loops=1)
                    Hash Cond: (pc.category_id = c.id)
                    ->  Hash Join  (cost=3225.51..6160.51 rows=100000 width=14) (actual time=68.037..177.961 rows=20000 loops=1)
                          Hash Cond: (pc.product_id = p.id)
                          ->  Seq Scan on "ProductCategory" pc  (cost=0.00..1560.00 rows=100000 width=8) (actual time=1.288..127.571 rows=100000 loops=1)
                          ->  Hash  (cost=2975.51..2975.51 rows=20000 width=18) (actual time=33.341..33.345 rows=20000 loops=1)
                                Buckets: 32768  Batches: 1  Memory Usage: 1272kB
                                ->  Hash Join  (cost=2542.50..2975.51 rows=20000 width=18) (actual time=19.955..29.808 rows=20000 loops=1)
                                      Hash Cond: (v.product_id = p.id)
                                      ->  Hash Join  (cost=1854.50..2235.00 rows=20000 width=14) (actual time=14.136..20.591 rows=20000 loops=1)
                                            Hash Cond: (oi.variant_id = v.id)
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=14) (actual time=0.014..2.662 rows=20000 loops=1)
                                            ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=13.956..13.958 rows=47000 loops=1)
                                                  Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                                  ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.007..5.729 rows=47000 loops=1)
                                      ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=4.965..4.966 rows=20000 loops=1)
                                            Buckets: 32768  Batches: 1  Memory Usage: 960kB
                                            ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.011..2.177 rows=20000 loops=1)
                    ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=0.704..0.705 rows=150 loops=1)
                          Buckets: 1024  Batches: 1  Memory Usage: 16kB
                          ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=0.653..0.676 rows=150 loops=1)
Planning Time: 27.058 ms
Execution Time: 192.155 ms


==================================================
EXPLAIN ANALYZE — Query 10: Liczba produktów per kategoria
==================================================
Sort  (cost=2342.22..2342.59 rows=150 width=20) (actual time=49.639..49.649 rows=150 loops=1)
  Sort Key: (count(pc.product_id)) DESC
  Sort Method: quicksort  Memory: 30kB
  ->  HashAggregate  (cost=2335.30..2336.80 rows=150 width=20) (actual time=49.583..49.606 rows=150 loops=1)
        Group Key: c.name
        Batches: 1  Memory Usage: 48kB
        ->  Hash Right Join  (cost=5.38..1835.30 rows=100000 width=16) (actual time=0.616..29.182 rows=100000 loops=1)
              Hash Cond: (pc.category_id = c.id)
              ->  Seq Scan on "ProductCategory" pc  (cost=0.00..1560.00 rows=100000 width=8) (actual time=0.004..6.660 rows=100000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=0.058..0.059 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 16kB
                    ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=0.014..0.032 rows=150 loops=1)
Planning Time: 0.177 ms
Execution Time: 49.702 ms


==================================================
EXPLAIN ANALYZE — Query 11: Liczba zamówień per metoda płatności
==================================================
Sort  (cost=7850.14..7850.15 rows=6 width=50) (actual time=144.271..148.064 rows=6 loops=1)
  Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  Finalize GroupAggregate  (cost=7848.47..7850.06 rows=6 width=50) (actual time=144.247..148.053 rows=6 loops=1)
        Group Key: pm.name
        ->  Gather Merge  (cost=7848.47..7849.87 rows=12 width=50) (actual time=144.232..148.031 rows=18 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Sort  (cost=6848.44..6848.46 rows=6 width=50) (actual time=109.327..109.332 rows=6 loops=3)
                    Sort Key: pm.name
                    Sort Method: quicksort  Memory: 25kB
                    Worker 0:  Sort Method: quicksort  Memory: 25kB
                    Worker 1:  Sort Method: quicksort  Memory: 25kB
                    ->  Partial HashAggregate  (cost=6848.29..6848.36 rows=6 width=50) (actual time=106.650..106.657 rows=6 loops=3)
                          Group Key: pm.name
                          Batches: 1  Memory Usage: 24kB
                          Worker 0:  Batches: 1  Memory Usage: 24kB
                          Worker 1:  Batches: 1  Memory Usage: 24kB
                          ->  Hash Join  (cost=579.13..6744.13 rows=8333 width=24) (actual time=8.883..103.140 rows=6667 loops=3)
                                Hash Cond: (o.payment_method_id = pm.id)
                                ->  Hash Join  (cost=578.00..6705.67 rows=8333 width=18) (actual time=8.834..101.683 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.006..40.094 rows=133333 loops=3)
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=14) (actual time=6.669..6.670 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1194kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=14) (actual time=0.029..2.593 rows=20000 loops=3)
                                ->  Hash  (cost=1.06..1.06 rows=6 width=14) (actual time=0.026..0.027 rows=6 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                      ->  Seq Scan on "PaymentMethod" pm  (cost=0.00..1.06 rows=6 width=14) (actual time=0.021..0.022 rows=6 loops=3)
Planning Time: 7.944 ms
Execution Time: 148.147 ms


==================================================
EXPLAIN ANALYZE — Query 12: Średnia ocena per producent
==================================================
Sort  (cost=1367.54..1367.91 rows=150 width=57) (actual time=30.136..30.148 rows=150 loops=1)
  Sort Key: (round(avg(r.rating), 2)) DESC NULLS LAST
  Sort Method: quicksort  Memory: 32kB
  ->  HashAggregate  (cost=1359.87..1362.12 rows=150 width=57) (actual time=30.010..30.082 rows=150 loops=1)
        Group Key: m.name
        Batches: 1  Memory Usage: 64kB
        ->  Hash Join  (cost=693.38..1259.87 rows=20000 width=29) (actual time=5.370..22.874 rows=27388 loops=1)
              Hash Cond: (p.manufacturer_id = m.id)
              ->  Hash Right Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=5.305..17.519 rows=27388 loops=1)
                    Hash Cond: (r.product_id = p.id)
                    ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=0.010..2.911 rows=20000 loops=1)
                    ->  Hash  (cost=438.00..438.00 rows=20000 width=8) (actual time=5.283..5.285 rows=20000 loops=1)
                          Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                          ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=8) (actual time=0.004..2.251 rows=20000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.055..0.055 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 18kB
                    ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.013..0.030 rows=150 loops=1)
Planning Time: 6.699 ms
Execution Time: 30.231 ms


==================================================
EXPLAIN ANALYZE — Query 13: Aktywne promocje i objęta nimi liczba wariantów
==================================================
Sort  (cost=587.95..588.05 rows=42 width=14) (actual time=10.647..10.651 rows=42 loops=1)
  Sort Key: (count(v.id)) DESC
  Sort Method: quicksort  Memory: 26kB
  ->  HashAggregate  (cost=586.40..586.82 rows=42 width=14) (actual time=10.625..10.634 rows=42 loops=1)
        Group Key: pr.name
        Batches: 1  Memory Usage: 24kB
        ->  Merge Join  (cost=7.46..535.87 rows=10105 width=10) (actual time=0.180..10.324 rows=1238 loops=1)
              Merge Cond: (v.promotion_id = pr.id)
              ->  Index Scan using idx_variant_promotion on "Variant" v  (cost=0.29..4233.14 rows=47000 width=8) (actual time=0.012..9.767 rows=5685 loops=1)
              ->  Sort  (cost=7.17..7.27 rows=43 width=10) (actual time=0.048..0.054 rows=43 loops=1)
                    Sort Key: pr.id
                    Sort Method: quicksort  Memory: 26kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=43 width=10) (actual time=0.014..0.037 rows=43 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 157
Planning Time: 15.128 ms
Execution Time: 11.363 ms


==================================================
EXPLAIN ANALYZE — Query 14: Najczęściej wybierane warianty w koszykach
==================================================
Limit  (cost=268487.71..268487.74 rows=10 width=44) (actual time=2001.553..2001.561 rows=10 loops=1)
  ->  Sort  (cost=268487.71..272237.71 rows=1500000 width=44) (actual time=2001.541..2001.547 rows=10 loops=1)
        Sort Key: (sum("CartItem".quantity)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  HashAggregate  (cost=197635.75..236073.25 rows=1500000 width=44) (actual time=1974.555..1989.497 rows=47000 loops=1)
              Group Key: "Variant".sku, p.name
              Planned Partitions: 32  Batches: 1  Memory Usage: 6161kB
              ->  Hash Join  (cost=3858.75..62635.75 rows=1500000 width=40) (actual time=40.449..1119.330 rows=1500000 loops=1)
                    Hash Cond: ("CartItem".variant_id = "Variant".id)
                    ->  Seq Scan on "CartItem"  (cost=0.00..23152.00 rows=1500000 width=16) (actual time=1.288..311.742 rows=1500000 loops=1)
                    ->  Hash  (cost=3271.25..3271.25 rows=47000 width=40) (actual time=39.142..39.145 rows=47000 loops=1)
                          Buckets: 65536  Batches: 1  Memory Usage: 3868kB
                          ->  Hash Join  (cost=888.00..3271.25 rows=47000 width=40) (actual time=8.071..28.839 rows=47000 loops=1)
                                Hash Cond: ("Variant".product_id = p.id)
                                ->  Seq Scan on "Variant"  (cost=0.00..1267.00 rows=47000 width=68) (actual time=0.007..6.891 rows=47000 loops=1)
                                ->  Hash  (cost=638.00..638.00 rows=20000 width=17) (actual time=8.053..8.054 rows=20000 loops=1)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                                      ->  Subquery Scan on p  (cost=0.00..638.00 rows=20000 width=17) (actual time=0.005..4.748 rows=20000 loops=1)
                                            ->  Seq Scan on "Product"  (cost=0.00..438.00 rows=20000 width=85) (actual time=0.005..2.848 rows=20000 loops=1)
Planning Time: 10.030 ms
Execution Time: 2002.482 ms


==================================================
EXPLAIN ANALYZE — Query 15: Produkty z Największą Różnicą Między Ceną Podstawową a Ceną Wariantu
==================================================
Limit  (cost=3211.55..3211.58 rows=10 width=80) (actual time=56.990..56.993 rows=10 loops=1)
  ->  Sort  (cost=3211.55..3329.05 rows=47000 width=80) (actual time=56.989..56.991 rows=10 loops=1)
        Sort Key: v.price_modifier DESC
        Sort Method: top-N heapsort  Memory: 27kB
        ->  Hash Join  (cost=688.00..2195.90 rows=47000 width=80) (actual time=7.869..42.854 rows=47000 loops=1)
              Hash Cond: (v.product_id = p.id)
              ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=33) (actual time=0.014..7.257 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=7.827..7.827 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1381kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.005..3.281 rows=20000 loops=1)
Planning Time: 2.987 ms
Execution Time: 57.037 ms


==================================================
EXPLAIN ANALYZE — Query 16: Konwersja zamówień wg statusu
==================================================
Sort  (cost=7541.77..7541.79 rows=7 width=48) (actual time=212.059..248.514 rows=7 loops=1)
  Sort Key: (count(o.id)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  WindowAgg  (cost=7541.33..7541.67 rows=7 width=48) (actual time=212.047..248.507 rows=7 loops=1)
        ->  Finalize GroupAggregate  (cost=7539.74..7541.51 rows=7 width=16) (actual time=212.010..248.473 rows=7 loops=1)
              Group Key: s.name
              ->  Gather Merge  (cost=7539.74..7541.37 rows=14 width=16) (actual time=212.000..248.460 rows=21 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Sort  (cost=6539.71..6539.73 rows=7 width=16) (actual time=138.212..138.215 rows=7 loops=3)
                          Sort Key: s.name
                          Sort Method: quicksort  Memory: 25kB
                          Worker 0:  Sort Method: quicksort  Memory: 25kB
                          Worker 1:  Sort Method: quicksort  Memory: 25kB
                          ->  Partial HashAggregate  (cost=6539.55..6539.62 rows=7 width=16) (actual time=137.206..137.210 rows=7 loops=3)
                                Group Key: s.name
                                Batches: 1  Memory Usage: 24kB
                                Worker 0:  Batches: 1  Memory Usage: 24kB
                                Worker 1:  Batches: 1  Memory Usage: 24kB
                                ->  Hash Join  (cost=1.16..5706.21 rows=166667 width=12) (actual time=0.067..87.899 rows=133333 loops=3)
                                      Hash Cond: (o.status_id = s.id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.009..23.293 rows=133333 loops=3)
                                      ->  Hash  (cost=1.07..1.07 rows=7 width=12) (actual time=0.028..0.029 rows=7 loops=3)
                                            Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                            ->  Seq Scan on "Status" s  (cost=0.00..1.07 rows=7 width=12) (actual time=0.023..0.024 rows=7 loops=3)
Planning Time: 6.193 ms
Execution Time: 248.621 ms


==================================================
EXPLAIN ANALYZE — Query 17: Top klienci wg wydatków
==================================================
Limit  (cost=15441.08..15441.10 rows=10 width=50) (actual time=2422.170..2425.477 rows=10 loops=1)
  ->  Sort  (cost=15441.08..15491.08 rows=20000 width=50) (actual time=2422.169..2425.474 rows=10 loops=1)
        Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=14758.88..15008.88 rows=20000 width=50) (actual time=2407.790..2420.270 rows=19296 loops=1)
              Group Key: u.id
              Batches: 5  Memory Usage: 8241kB  Disk Usage: 224kB
              ->  Gather  (cost=12863.13..14633.89 rows=16666 width=50) (actual time=2111.476..2306.376 rows=19431 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=11863.13..11967.29 rows=8333 width=50) (actual time=2101.194..2148.105 rows=6477 loops=3)
                          Group Key: u.id
                          Batches: 1  Memory Usage: 3217kB
                          Worker 0:  Batches: 1  Memory Usage: 2961kB
                          Worker 1:  Batches: 1  Memory Usage: 2961kB
                          ->  Nested Loop  (cost=578.42..11779.80 rows=8333 width=28) (actual time=9.749..2052.905 rows=6667 loops=3)
                                ->  Hash Join  (cost=578.00..6705.67 rows=8333 width=14) (actual time=6.488..76.358 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.007..17.392 rows=133333 loops=3)
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=14) (actual time=6.409..6.669 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1194kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=14) (actual time=0.022..2.775 rows=20000 loops=3)
                                ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.294..0.294 rows=1 loops=20000)
                                      Index Cond: (id = o.user_id)
Planning Time: 4.073 ms
Execution Time: 2433.159 ms


==================================================
EXPLAIN ANALYZE — Query 18: Produkty z wariantami objętymi promocją, z końcową ceną
==================================================
Sort  (cost=2074.11..2099.37 rows=10105 width=132) (actual time=40.482..40.594 rows=1238 loops=1)
  Sort Key: (round(((p.price + v.price_modifier) * ('1'::numeric - pr.discount_percentage)), 2))
  Sort Method: quicksort  Memory: 139kB
  ->  Hash Join  (cost=695.46..1401.98 rows=10105 width=132) (actual time=20.233..39.473 rows=1238 loops=1)
        Hash Cond: (v.product_id = p.id)
        ->  Merge Join  (cost=7.46..535.87 rows=10105 width=39) (actual time=2.077..19.891 rows=1238 loops=1)
              Merge Cond: (v.promotion_id = pr.id)
              ->  Index Scan using idx_variant_promotion on "Variant" v  (cost=0.29..4233.14 rows=47000 width=37) (actual time=0.013..18.656 rows=5685 loops=1)
              ->  Sort  (cost=7.17..7.27 rows=43 width=10) (actual time=0.730..0.738 rows=43 loops=1)
                    Sort Key: pr.id
                    Sort Method: quicksort  Memory: 26kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=43 width=10) (actual time=0.015..0.038 rows=43 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 157
        ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=18.134..18.134 rows=20000 loops=1)
              Buckets: 32768  Batches: 1  Memory Usage: 1381kB
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.013..11.268 rows=20000 loops=1)
Planning Time: 12.016 ms
Execution Time: 41.360 ms


==================================================
EXPLAIN ANALYZE — Query 19: Użytkownicy, Którzy Dodali Produkt do Koszyka, Ale Nie Złożyli Zamówienia (Potencjał Odbudowy Koszyka)
==================================================
Hash Join  (cost=46254.21..103988.81 rows=1068640 width=55) (actual time=5682.920..8033.159 rows=1005006 loops=1)
  Hash Cond: (v.product_id = p.id)
  ->  Hash Join  (cost=45566.21..100495.04 rows=1068640 width=46) (actual time=5673.903..7473.952 rows=1005006 loops=1)
        Hash Cond: (ci.variant_id = v.id)
        ->  Hash Join  (cost=43711.71..95835.11 rows=1068640 width=46) (actual time=5654.442..6729.601 rows=1005006 loops=1)
              Hash Cond: (ci.cart_id = c.id)
              ->  Seq Scan on "CartItem" ci  (cost=0.00..23152.00 rows=1500000 width=8) (actual time=1.244..259.242 rows=1500000 loops=1)
              ->  Hash  (cost=41435.91..41435.91 rows=106864 width=46) (actual time=5644.003..5659.679 rows=100414 loops=1)
                    Buckets: 131072  Batches: 2  Memory Usage: 4929kB
                    ->  Gather  (cost=25017.67..41435.91 rows=106864 width=46) (actual time=5378.508..5493.969 rows=100414 loops=1)
                          Workers Planned: 2
                          Workers Launched: 2
                          ->  Parallel Hash Right Anti Join  (cost=24017.67..29749.51 rows=44527 width=46) (actual time=4857.530..4871.348 rows=33471 loops=3)
                                Hash Cond: (o.user_id = u.id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=4) (actual time=1.940..249.176 rows=133333 loops=3)
                                ->  Parallel Hash  (cost=23236.42..23236.42 rows=62500 width=50) (actual time=4352.583..4353.053 rows=50000 loops=3)
                                      Buckets: 262144  Batches: 1  Memory Usage: 14720kB
                                      ->  Hash Join  (cost=4079.00..23236.42 rows=62500 width=50) (actual time=498.517..3826.428 rows=50000 loops=3)
                                            Hash Cond: (u.id = c.user_id)
                                            ->  Parallel Seq Scan on "User" u  (cost=0.00..18063.67 rows=416667 width=46) (actual time=21.468..2147.641 rows=333333 loops=3)
                                            ->  Hash  (cost=2204.00..2204.00 rows=150000 width=8) (actual time=469.218..469.219 rows=150000 loops=3)
                                                  Buckets: 262144  Batches: 1  Memory Usage: 7908kB
                                                  ->  Seq Scan on "Cart" c  (cost=0.00..2204.00 rows=150000 width=8) (actual time=34.101..298.960 rows=150000 loops=3)
        ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=15.985..15.985 rows=47000 loops=1)
              Buckets: 65536  Batches: 1  Memory Usage: 2348kB
              ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.011..6.070 rows=47000 loops=1)
  ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=5.649..6.146 rows=20000 loops=1)
        Buckets: 32768  Batches: 1  Memory Usage: 1245kB
        ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.012..2.362 rows=20000 loops=1)
Planning Time: 37.326 ms
Execution Time: 8103.000 ms


==================================================
EXPLAIN ANALYZE — Query 20: Wyszukiwanie produktów po nazwie lub opisie (parametryzowane)
==================================================
Bitmap Heap Scan on "Product"  (cost=43.00..57.51 rows=4 width=60) (actual time=9.594..32.284 rows=143 loops=1)
  Recheck Cond: (((name)::text ~~* '%test%'::text) OR (description ~~* '%test%'::text))
  Heap Blocks: exact=106
  ->  BitmapOr  (cost=43.00..43.00 rows=4 width=0) (actual time=8.468..8.469 rows=0 loops=1)
        ->  Bitmap Index Scan on idx_product_name_trgm  (cost=0.00..21.50 rows=2 width=0) (actual time=3.729..3.729 rows=42 loops=1)
              Index Cond: ((name)::text ~~* '%test%'::text)
        ->  Bitmap Index Scan on idx_product_description_trgm  (cost=0.00..21.50 rows=2 width=0) (actual time=4.734..4.734 rows=102 loops=1)
              Index Cond: (description ~~* '%test%'::text)
Planning Time: 124.155 ms
Execution Time: 39.547 ms


==================================================
EXPLAIN ANALYZE — Query 21: Użytkownicy, Którzy Zapisali Konkretny Produkt jako Ulubiony (np. Product ID=350259)
==================================================
Nested Loop  (cost=0.85..262.23 rows=30 width=56) (actual time=4.374..16.268 rows=26 loops=1)
  ->  Index Only Scan using idx_favoriteproduct_product_user on "FavoriteProduct" fp  (cost=0.42..8.95 rows=30 width=4) (actual time=3.730..3.739 rows=26 loops=1)
        Index Cond: (product_id = 35)
        Heap Fetches: 0
  ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..8.44 rows=1 width=60) (actual time=0.481..0.481 rows=1 loops=26)
        Index Cond: (id = fp.user_id)
Planning Time: 11.604 ms
Execution Time: 16.304 ms


==================================================
EXPLAIN ANALYZE — Query 22: Znajdź Magazyny, Które Posiadają Zapasy Konkretnego Wariantu (np. SKU='VR-000000-a637d44b7afd')
==================================================
Sort  (cost=80.54..80.54 rows=2 width=25) (actual time=7.344..7.348 rows=0 loops=1)
  Sort Key: (sum("*SELECT* 1".stock_units)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  GroupAggregate  (cost=80.41..80.53 rows=2 width=25) (actual time=6.645..6.648 rows=0 loops=1)
        Group Key: w.name
        Filter: (sum("*SELECT* 1".stock_units) > 0)
        ->  Sort  (cost=80.41..80.42 rows=6 width=21) (actual time=6.643..6.646 rows=0 loops=1)
              Sort Key: w.name
              Sort Method: quicksort  Memory: 25kB
              ->  Nested Loop  (cost=4.76..80.33 rows=6 width=21) (actual time=6.632..6.635 rows=0 loops=1)
                    Join Filter: (w.id = "*SELECT* 1".warehouse_id)
                    ->  Append  (cost=4.76..78.43 rows=6 width=8) (actual time=6.631..6.634 rows=0 loops=1)
                          ->  Subquery Scan on "*SELECT* 1"  (cost=4.76..39.13 rows=3 width=8) (actual time=6.605..6.606 rows=0 loops=1)
                                ->  Nested Loop  (cost=4.76..39.10 rows=3 width=8) (actual time=6.604..6.605 rows=0 loops=1)
                                      ->  Index Scan using "Variant_sku_key" on "Variant" v  (cost=0.41..8.43 rows=1 width=4) (actual time=6.603..6.603 rows=0 loops=1)
                                            Index Cond: ((sku)::text = 'VR-000001-2704de10f283'::text)
                                      ->  Bitmap Heap Scan on "BulkStockItem" bsi  (cost=4.35..30.60 rows=7 width=12) (never executed)
                                            Recheck Cond: (variant_id = v.id)
                                            ->  Bitmap Index Scan on idx_bulk_variant  (cost=0.00..4.35 rows=7 width=0) (never executed)
                                                  Index Cond: (variant_id = v.id)
                          ->  Subquery Scan on "*SELECT* 2"  (cost=4.76..39.27 rows=3 width=8) (actual time=0.024..0.025 rows=0 loops=1)
                                ->  Nested Loop  (cost=4.76..39.24 rows=3 width=8) (actual time=0.023..0.024 rows=0 loops=1)
                                      ->  Index Scan using "Variant_sku_key" on "Variant" v_1  (cost=0.41..8.43 rows=1 width=4) (actual time=0.023..0.023 rows=0 loops=1)
                                            Index Cond: ((sku)::text = 'VR-000001-2704de10f283'::text)
                                      ->  Bitmap Heap Scan on "SerialStockItem" ssi  (cost=4.35..30.73 rows=7 width=8) (never executed)
                                            Recheck Cond: (variant_id = v_1.id)
                                            ->  Bitmap Index Scan on idx_serial_variant  (cost=0.00..4.35 rows=7 width=0) (never executed)
                                                  Index Cond: (variant_id = v_1.id)
                    ->  Materialize  (cost=0.00..1.15 rows=10 width=21) (never executed)
                          ->  Seq Scan on "Warehouse" w  (cost=0.00..1.10 rows=10 width=21) (never executed)
Planning Time: 10.100 ms
Execution Time: 8.083 ms


==================================================
EXPLAIN ANALYZE — Query 23: Warianty, Które Wymagają Uzyskania Konkretnej Opcji (np. 'Kolor'='Czerwony')
==================================================
Nested Loop  (cost=6.81..677.99 rows=8 width=36) (actual time=0.015..0.016 rows=0 loops=1)
  ->  Nested Loop  (cost=6.52..675.35 rows=8 width=27) (actual time=0.015..0.015 rows=0 loops=1)
        ->  Nested Loop  (cost=6.23..672.76 rows=8 width=4) (actual time=0.015..0.015 rows=0 loops=1)
              Join Filter: (opt.attribute_id = a.id)
              ->  Seq Scan on "Attribute" a  (cost=0.00..1.38 rows=1 width=4) (actual time=0.014..0.015 rows=0 loops=1)
                    Filter: ((name)::text = 'Attr_49_Century'::text)
                    Rows Removed by Filter: 30
              ->  Nested Loop  (cost=6.23..668.26 rows=250 width=8) (never executed)
                    ->  Seq Scan on "Option" opt  (cost=0.00..18.50 rows=1 width=8) (never executed)
                          Filter: ((value)::text = 'do'::text)
                    ->  Bitmap Heap Scan on "VariantOption" vo  (cost=6.23..647.26 rows=250 width=8) (never executed)
                          Recheck Cond: (option_id = opt.id)
                          ->  Bitmap Index Scan on idx_variantoption_option_id  (cost=0.00..6.17 rows=250 width=0) (never executed)
                                Index Cond: (option_id = opt.id)
        ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.32 rows=1 width=31) (never executed)
              Index Cond: (id = vo.variant_id)
  ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=17) (never executed)
        Index Cond: (id = v.product_id)
Planning Time: 39.201 ms
Execution Time: 0.077 ms


==================================================
EXPLAIN ANALYZE — Query 24: Znajdź Zamówienia Użytkownika (np. email='debbie.lane.16786.50af0753@example.com') o Statusie 'Paid'
==================================================
Nested Loop  (cost=0.98..17.07 rows=1 width=20) (actual time=5.106..5.107 rows=0 loops=1)
  ->  Nested Loop  (cost=0.85..16.89 rows=1 width=16) (actual time=5.104..5.104 rows=0 loops=1)
        ->  Index Scan using "User_email_key" on "User" u  (cost=0.42..8.44 rows=1 width=4) (actual time=5.103..5.103 rows=0 loops=1)
              Index Cond: ((email)::text = 'debbie.lane.16786.50af0753@example.com'::text)
        ->  Index Scan using idx_order_user_id on "Order" o  (cost=0.42..8.44 rows=1 width=20) (never executed)
              Index Cond: (user_id = u.id)
  ->  Index Scan using "Status_pkey" on "Status" s  (cost=0.13..0.15 rows=1 width=12) (never executed)
        Index Cond: (id = o.status_id)
        Filter: ((name)::text = 'Paid'::text)
Planning Time: 1.561 ms
Execution Time: 5.147 ms


==================================================
EXPLAIN ANALYZE — Query 25: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
Hash Left Join  (cost=6.97..48.34 rows=16 width=87) (actual time=2.642..8.606 rows=18 loops=1)
  Hash Cond: (opt.attribute_id = a.id)
  ->  Nested Loop Left Join  (cost=5.30..46.57 rows=16 width=45) (actual time=2.053..7.992 rows=18 loops=1)
        ->  Nested Loop Left Join  (cost=5.02..41.89 rows=16 width=39) (actual time=2.018..7.318 rows=18 loops=1)
              ->  Nested Loop  (cost=4.60..24.13 rows=3 width=39) (actual time=0.044..0.630 rows=4 loops=1)
                    ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..8.30 rows=1 width=10) (actual time=0.016..0.017 rows=1 loops=1)
                          Index Cond: (id = 35)
                    ->  Bitmap Heap Scan on "Variant" v  (cost=4.31..15.80 rows=3 width=37) (actual time=0.026..0.608 rows=4 loops=1)
                          Recheck Cond: (product_id = 35)
                          Heap Blocks: exact=4
                          ->  Bitmap Index Scan on idx_variant_product_id  (cost=0.00..4.31 rows=3 width=0) (actual time=0.011..0.011 rows=4 loops=1)
                                Index Cond: (product_id = 35)
              ->  Index Only Scan using uq_varopt_variant_option on "VariantOption" vo  (cost=0.42..5.86 rows=6 width=8) (actual time=1.669..1.670 rows=4 loops=4)
                    Index Cond: (variant_id = v.id)
                    Heap Fetches: 0
        ->  Index Scan using "Option_pkey" on "Option" opt  (cost=0.28..0.29 rows=1 width=14) (actual time=0.037..0.037 rows=1 loops=18)
              Index Cond: (id = vo.option_id)
  ->  Hash  (cost=1.30..1.30 rows=30 width=18) (actual time=0.022..0.022 rows=30 loops=1)
        Buckets: 1024  Batches: 1  Memory Usage: 10kB
        ->  Seq Scan on "Attribute" a  (cost=0.00..1.30 rows=30 width=18) (actual time=0.011..0.014 rows=30 loops=1)
Planning Time: 0.527 ms
Execution Time: 8.656 ms


==================================================
EXPLAIN ANALYZE — Query 26: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
Hash Left Join  (cost=6.97..48.42 rows=16 width=87) (actual time=0.007..0.008 rows=0 loops=1)
  Hash Cond: (opt.attribute_id = a.id)
  ->  Nested Loop Left Join  (cost=5.30..46.57 rows=16 width=45) (actual time=0.007..0.007 rows=0 loops=1)
        ->  Nested Loop Left Join  (cost=5.02..41.89 rows=16 width=39) (actual time=0.006..0.007 rows=0 loops=1)
              ->  Nested Loop  (cost=4.60..24.13 rows=3 width=39) (actual time=0.006..0.007 rows=0 loops=1)
                    ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..8.30 rows=1 width=10) (actual time=0.006..0.006 rows=0 loops=1)
                          Index Cond: (id = 350259)
                    ->  Bitmap Heap Scan on "Variant" v  (cost=4.31..15.80 rows=3 width=37) (never executed)
                          Recheck Cond: (product_id = 350259)
                          ->  Bitmap Index Scan on idx_variant_product_id  (cost=0.00..4.31 rows=3 width=0) (never executed)
                                Index Cond: (product_id = 350259)
              ->  Index Only Scan using uq_varopt_variant_option on "VariantOption" vo  (cost=0.42..5.86 rows=6 width=8) (never executed)
                    Index Cond: (variant_id = v.id)
                    Heap Fetches: 0
        ->  Index Scan using "Option_pkey" on "Option" opt  (cost=0.28..0.29 rows=1 width=14) (never executed)
              Index Cond: (id = vo.option_id)
  ->  Hash  (cost=1.30..1.30 rows=30 width=18) (never executed)
        ->  Seq Scan on "Attribute" a  (cost=0.00..1.30 rows=30 width=18) (never executed)
Planning Time: 0.534 ms
Execution Time: 0.046 ms


==================================================
EXPLAIN ANALYZE — Query 27: Porównanie Średniej Oceny dla Promowanych i Niepromowanych Produktów
==================================================
HashAggregate  (cost=87850.51..87853.01 rows=200 width=64) (actual time=133.461..133.466 rows=2 loops=1)
  Group Key: CASE WHEN (ANY (p.id = (hashed SubPlan 2).col1)) THEN 'Promowany'::text ELSE 'Niepromowany'::text END
  Batches: 1  Memory Usage: 40kB
  ->  HashAggregate  (cost=1300.51..87550.51 rows=20000 width=68) (actual time=123.471..130.468 rows=12612 loops=1)
        Group Key: p.id
        Batches: 1  Memory Usage: 2577kB
        ->  Hash Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=36.312..96.495 rows=20000 loops=1)
              Hash Cond: (r.product_id = p.id)
              ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=0.011..32.504 rows=20000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=36.275..36.276 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 960kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.005..30.286 rows=20000 loops=1)
        SubPlan 2
          ->  Index Only Scan using idx_variant_product_promotion on "Variant" v2  (cost=0.28..215.94 rows=5577 width=4) (actual time=3.658..16.697 rows=5684 loops=1)
                Heap Fetches: 0
Planning Time: 1.605 ms
Execution Time: 134.748 ms


==================================================
EXPLAIN ANALYZE — Query 28: Top 5 Miast Generujących Największy Przychód (Wg. Adresu Wysyłki)
==================================================
Limit  (cost=15175.51..15175.53 rows=5 width=45) (actual time=3903.592..3982.850 rows=5 loops=1)
  ->  Sort  (cost=15175.51..15225.51 rows=20000 width=45) (actual time=3903.179..3982.432 rows=5 loops=1)
        Sort Key: (sum(oi.unit_price)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=14593.32..14843.32 rows=20000 width=45) (actual time=3895.416..3979.860 rows=12950 loops=1)
              Group Key: a.city
              Batches: 1  Memory Usage: 5905kB
              ->  Gather  (cost=12697.56..14468.33 rows=16666 width=45) (actual time=3838.119..3960.539 rows=16137 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=11697.56..11801.73 rows=8333 width=45) (actual time=3811.334..3814.309 rows=5379 loops=3)
                          Group Key: a.city
                          Batches: 1  Memory Usage: 2449kB
                          Worker 0:  Batches: 1  Memory Usage: 2449kB
                          Worker 1:  Batches: 1  Memory Usage: 2449kB
                          ->  Nested Loop  (cost=681.42..11655.90 rows=8333 width=19) (actual time=18.712..3782.158 rows=6667 loops=3)
                                ->  Parallel Hash Join  (cost=681.00..6566.02 rows=8333 width=10) (actual time=16.211..92.405 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.010..21.578 rows=133333 loops=3)
                                      ->  Parallel Hash  (cost=533.93..533.93 rows=11765 width=10) (actual time=15.671..15.673 rows=6667 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1216kB
                                            ->  Parallel Index Only Scan using idx_orderitem_order_price_cover on "OrderItem" oi  (cost=0.29..533.93 rows=11765 width=10) (actual time=0.248..13.820 rows=6667 loops=3)
                                                  Heap Fetches: 0
                                ->  Index Scan using "Address_pkey" on "Address" a  (cost=0.43..0.61 rows=1 width=17) (actual time=0.552..0.552 rows=1 loops=20000)
                                      Index Cond: (id = o.shipping_address_id)
Planning Time: 25.935 ms
Execution Time: 3988.423 ms


==================================================
EXPLAIN ANALYZE — Query 29: Porównanie Wolumenu Sprzedaży Produktów Promowanych vs. Niepromowanych (w Ostatnich 30 Dniach)
==================================================
[ERROR EXECUTING QUERY 29] relation "StockItem" does not exist
LINE 7:         JOIN "StockItem" si ON oi.stock_item_id = si.id
                     ^



==================================================
EXPLAIN ANALYZE — Query 30: Wskaźnik Lojalności (Repeat Purchase Rate) Użytkowników z Podziałem na Miasto Adresu Rozliczeniowego
==================================================
[ERROR EXECUTING QUERY 30] current transaction is aborted, commands ignored until end of transaction block


FINISHED — 2025-12-02 21:02:28.793839
========================================================================================================================
========================================================================================================================
START EXPLAIN RUN — 2025-12-02 21:02:34.947601
========================================================================================================================


==================================================
EXPLAIN ANALYZE — Query 1: Średnia Wartość Zamówienia (AOV) w Ostatnim Miesiącu
==================================================
Aggregate  (cost=4365.15..4365.16 rows=1 width=32) (actual time=48.488..48.491 rows=1 loops=1)
  ->  GroupAggregate  (cost=4345.20..4357.48 rows=614 width=36) (actual time=48.055..48.438 rows=608 loops=1)
        Group Key: o.id
        ->  Sort  (cost=4345.20..4346.73 rows=614 width=10) (actual time=48.038..48.094 rows=619 loops=1)
              Sort Key: o.id
              Sort Method: quicksort  Memory: 44kB
              ->  Hash Join  (cost=3936.26..4316.76 rows=614 width=10) (actual time=21.584..47.859 rows=619 loops=1)
                    Hash Cond: (oi.order_id = o.id)
                    ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.020..23.213 rows=20000 loops=1)
                    ->  Hash  (cost=3782.67..3782.67 rows=12287 width=4) (actual time=21.505..21.507 rows=12333 loops=1)
                          Buckets: 16384  Batches: 1  Memory Usage: 562kB
                          ->  Bitmap Heap Scan on "Order" o  (cost=231.65..3782.67 rows=12287 width=4) (actual time=7.828..19.072 rows=12333 loops=1)
                                Recheck Cond: (order_date >= (now() - '1 mon'::interval))
                                Heap Blocks: exact=3270
                                ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..228.58 rows=12287 width=0) (actual time=7.448..7.448 rows=12333 loops=1)
                                      Index Cond: (order_date >= (now() - '1 mon'::interval))
Planning Time: 22.118 ms
Execution Time: 48.642 ms


==================================================
EXPLAIN ANALYZE — Query 2: Średnia wartość zamówienia per użytkownik
==================================================
Sort  (cost=16066.87..16115.61 rows=19495 width=50) (actual time=3820.112..3872.718 rows=19296 loops=1)
  Sort Key: (round(avg(order_totals.total_price), 2)) DESC
  Sort Method: quicksort  Memory: 1612kB
  ->  Finalize HashAggregate  (cost=14385.35..14677.77 rows=19495 width=50) (actual time=3771.549..3848.411 rows=19296 loops=1)
        Group Key: u.id
        Batches: 5  Memory Usage: 8241kB  Disk Usage: 216kB
        ->  Gather  (cost=12537.36..14263.50 rows=16246 width=50) (actual time=3508.141..3668.951 rows=19431 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial HashAggregate  (cost=11537.36..11638.90 rows=8123 width=50) (actual time=3473.600..3482.317 rows=6477 loops=3)
                    Group Key: u.id
                    Batches: 1  Memory Usage: 2961kB
                    Worker 0:  Batches: 1  Memory Usage: 2961kB
                    Worker 1:  Batches: 1  Memory Usage: 2961kB
                    ->  Nested Loop  (cost=1110.75..11496.75 rows=8123 width=50) (actual time=132.763..3407.751 rows=6498 loops=3)
                          ->  Hash Join  (cost=1110.33..6550.49 rows=8123 width=36) (actual time=92.840..226.869 rows=6498 loops=3)
                                Hash Cond: (o.id = order_totals.order_id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.009..52.174 rows=133333 loops=3)
                                ->  Hash  (cost=866.64..866.64 rows=19495 width=36) (actual time=90.148..90.910 rows=19495 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1094kB
                                      ->  Subquery Scan on order_totals  (cost=428.00..866.64 rows=19495 width=36) (actual time=72.105..82.545 rows=19495 loops=3)
                                            ->  HashAggregate  (cost=428.00..671.69 rows=19495 width=36) (actual time=72.103..80.686 rows=19495 loops=3)
                                                  Group Key: oi.order_id
                                                  Batches: 1  Memory Usage: 7953kB
                                                  Worker 0:  Batches: 1  Memory Usage: 7953kB
                                                  Worker 1:  Batches: 1  Memory Usage: 7953kB
                                                  ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=10) (actual time=0.465..11.517 rows=20000 loops=3)
                          ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.480..0.480 rows=1 loops=19495)
                                Index Cond: (id = o.user_id)
Planning Time: 10.994 ms
Execution Time: 3911.972 ms


==================================================
EXPLAIN ANALYZE — Query 3: Top 10 Najlepiej Sprzedających Się Produktów (wg. Ilości Sprzedanych Jednostek) w Ostatnim Kwartale
==================================================
Limit  (cost=9141.42..9141.44 rows=10 width=46) (actual time=134.250..204.360 rows=1 loops=1)
  ->  Sort  (cost=9141.42..9151.37 rows=3981 width=46) (actual time=134.248..204.357 rows=1 loops=1)
        Sort Key: (sum(oi.quantity)) DESC
        Sort Method: quicksort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=9015.58..9055.39 rows=3981 width=46) (actual time=133.579..203.711 rows=1 loops=1)
              Group Key: p.name, m.name
              Batches: 1  Memory Usage: 217kB
              ->  Gather  (cost=8642.30..8990.69 rows=3318 width=46) (actual time=127.242..203.671 rows=3 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=7642.30..7658.89 rows=1659 width=46) (actual time=63.217..63.227 rows=1 loops=3)
                          Group Key: p.name, m.name
                          Batches: 1  Memory Usage: 73kB
                          Worker 0:  Batches: 1  Memory Usage: 73kB
                          Worker 1:  Batches: 1  Memory Usage: 73kB
                          ->  Hash Join  (cost=2077.37..7629.86 rows=1659 width=42) (actual time=29.018..59.962 rows=1324 loops=3)
                                Hash Cond: (p.manufacturer_id = m.id)
                                ->  Nested Loop  (cost=2072.00..7620.01 rows=1659 width=21) (actual time=28.120..58.730 rows=1324 loops=3)
                                      ->  Nested Loop  (cost=2071.71..7072.36 rows=1659 width=8) (actual time=27.499..55.655 rows=1324 loops=3)
                                            ->  Hash Join  (cost=2071.42..6211.84 rows=1659 width=8) (actual time=26.603..50.446 rows=1324 loops=3)
                                                  Hash Cond: (o.id = oi.order_id)
                                                  ->  Parallel Bitmap Heap Scan on "Order" o  (cost=1493.42..5409.92 rows=33172 width=4) (actual time=16.566..35.342 rows=26379 loops=3)
                                                        Recheck Cond: (order_date >= (now() - '3 mons'::interval))
                                                        Heap Blocks: exact=1114
                                                        ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..1473.52 rows=79612 width=0) (actual time=49.143..49.143 rows=79137 loops=1)
                                                              Index Cond: (order_date >= (now() - '3 mons'::interval))
                                                  ->  Hash  (cost=328.00..328.00 rows=20000 width=12) (actual time=7.753..7.754 rows=20000 loops=3)
                                                        Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                                        ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=12) (actual time=0.028..3.996 rows=20000 loops=3)
                                            ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.52 rows=1 width=8) (actual time=0.004..0.004 rows=1 loops=3972)
                                                  Index Cond: (id = oi.variant_id)
                                      ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=21) (actual time=0.002..0.002 rows=1 loops=3972)
                                            Index Cond: (id = v.product_id)
                                ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.676..0.676 rows=150 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 18kB
                                      ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.038..0.057 rows=150 loops=3)
Planning Time: 53.466 ms
Execution Time: 207.048 ms


==================================================
EXPLAIN ANALYZE — Query 4: Top 5 produktów z najwięcej recenzjami
==================================================
Limit  (cost=1792.59..1792.61 rows=5 width=25) (actual time=117.943..117.946 rows=5 loops=1)
  ->  Sort  (cost=1792.59..1842.59 rows=20000 width=25) (actual time=117.941..117.944 rows=5 loops=1)
        Sort Key: (COALESCE(r.count, '0'::bigint)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Hash Left Join  (cost=969.89..1460.40 rows=20000 width=25) (actual time=63.372..114.163 rows=20000 loops=1)
              Hash Cond: (p.id = r.product_id)
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=1.637..39.400 rows=20000 loops=1)
              ->  Hash  (cost=812.24..812.24 rows=12612 width=12) (actual time=61.382..61.383 rows=12612 loops=1)
                    Buckets: 16384  Batches: 1  Memory Usage: 670kB
                    ->  Subquery Scan on r  (cost=560.00..812.24 rows=12612 width=12) (actual time=55.036..58.729 rows=12612 loops=1)
                          ->  HashAggregate  (cost=560.00..686.12 rows=12612 width=12) (actual time=55.035..57.531 rows=12612 loops=1)
                                Group Key: "Review".product_id
                                Batches: 1  Memory Usage: 1425kB
                                ->  Seq Scan on "Review"  (cost=0.00..460.00 rows=20000 width=4) (actual time=2.565..47.464 rows=20000 loops=1)
Planning Time: 17.939 ms
Execution Time: 119.599 ms


==================================================
EXPLAIN ANALYZE — Query 5: Całkowity Przychód Pogrupowany Miesięcznie za Ostatni Rok
==================================================
Finalize GroupAggregate  (cost=9617.65..11883.29 rows=17380 width=36) (actual time=180.598..286.137 rows=11 loops=1)
  Group Key: ((date_trunc('month'::text, o.order_date))::date)
  ->  Gather Merge  (cost=9617.65..11470.51 rows=14484 width=36) (actual time=180.063..286.081 rows=33 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=8617.62..8798.67 rows=7242 width=36) (actual time=120.852..124.399 rows=11 loops=3)
              Group Key: ((date_trunc('month'::text, o.order_date))::date)
              ->  Sort  (cost=8617.62..8635.73 rows=7242 width=10) (actual time=119.501..120.951 rows=5760 loops=3)
                    Sort Key: ((date_trunc('month'::text, o.order_date))::date) DESC
                    Sort Method: quicksort  Memory: 689kB
                    Worker 0:  Sort Method: quicksort  Memory: 215kB
                    Worker 1:  Sort Method: quicksort  Memory: 214kB
                    ->  Parallel Hash Join  (cost=681.00..8153.33 rows=7242 width=10) (actual time=17.421..110.369 rows=5760 loops=3)
                          Hash Cond: (o.id = oi.order_id)
                          ->  Parallel Seq Scan on "Order" o  (cost=0.00..6669.33 rows=144838 width=12) (actual time=0.783..64.546 rows=115772 loops=3)
                                Filter: (order_date >= (date_trunc('year'::text, now()) - '00:00:00'::interval))
                                Rows Removed by Filter: 17562
                          ->  Parallel Hash  (cost=533.93..533.93 rows=11765 width=10) (actual time=16.304..16.305 rows=6667 loops=3)
                                Buckets: 32768  Batches: 1  Memory Usage: 1216kB
                                ->  Parallel Index Only Scan using idx_orderitem_order_price_cover on "OrderItem" oi  (cost=0.29..533.93 rows=11765 width=10) (actual time=0.021..41.730 rows=20000 loops=1)
                                      Heap Fetches: 0
Planning Time: 1.243 ms
Execution Time: 289.255 ms


==================================================
EXPLAIN ANALYZE — Query 6: Produkty najczęściej dodawane do ulubionych
==================================================
Limit  (cost=14382.58..14382.60 rows=10 width=25) (actual time=514.586..598.469 rows=10 loops=1)
  ->  Sort  (cost=14382.58..14432.58 rows=20000 width=25) (actual time=513.680..596.570 rows=10 loops=1)
        Sort Key: (count(f.id)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=13750.38..13950.38 rows=20000 width=25) (actual time=505.472..592.070 rows=20000 loops=1)
              Group Key: p.id
              Batches: 1  Memory Usage: 2577kB
              ->  Gather  (cost=9350.38..13550.38 rows=40000 width=25) (actual time=408.494..563.727 rows=59994 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=8350.38..8550.38 rows=20000 width=25) (actual time=357.858..365.211 rows=19998 loops=3)
                          Group Key: p.id
                          Batches: 1  Memory Usage: 2577kB
                          Worker 0:  Batches: 1  Memory Usage: 2577kB
                          Worker 1:  Batches: 1  Memory Usage: 2577kB
                          ->  Hash Join  (cost=688.00..7100.38 rows=250000 width=21) (actual time=12.507..287.482 rows=200000 loops=3)
                                Hash Cond: (f.product_id = p.id)
                                ->  Parallel Seq Scan on "FavoriteProduct" f  (cost=0.00..5756.00 rows=250000 width=8) (actual time=4.579..199.172 rows=200000 loops=3)
                                ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=7.580..8.496 rows=20000 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1215kB
                                      ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.029..2.719 rows=20000 loops=3)
Planning Time: 23.089 ms
Execution Time: 603.133 ms


==================================================
EXPLAIN ANALYZE — Query 7: Dostępny Stan Magazynowy Wariantów Produktu Pogrupowany po Magazynach
==================================================
Finalize GroupAggregate  (cost=8886.64..10869.06 rows=16000 width=61) (actual time=1689.348..2207.784 rows=231755 loops=1)
  Group Key: p.name, w.name, v.sku
  ->  Gather Merge  (cost=8886.64..10575.72 rows=13334 width=61) (actual time=1687.703..2108.728 rows=271773 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=7886.61..8036.62 rows=6667 width=61) (actual time=1587.626..1716.735 rows=90591 loops=3)
              Group Key: p.name, w.name, v.sku
              ->  Sort  (cost=7886.61..7903.28 rows=6667 width=57) (actual time=1585.067..1665.860 rows=106667 loops=3)
                    Sort Key: p.name, w.name, v.sku
                    Sort Method: external merge  Disk: 8152kB
                    Worker 0:  Sort Method: external merge  Disk: 7080kB
                    Worker 1:  Sort Method: external merge  Disk: 6544kB
                    ->  Hash Join  (cost=2543.72..7463.16 rows=6667 width=57) (actual time=126.078..942.655 rows=106667 loops=3)
                          Hash Cond: (v.product_id = p.id)
                          ->  Hash Join  (cost=1855.72..6757.66 rows=6667 width=48) (actual time=107.406..863.887 rows=106667 loops=3)
                                Hash Cond: (ssi.variant_id = v.id)
                                ->  Hash Join  (cost=1.23..4885.66 rows=6667 width=25) (actual time=9.468..687.337 rows=106667 loops=3)
                                      Hash Cond: (ssi.warehouse_id = w.id)
                                      ->  Parallel Append  (cost=0.00..4527.02 rows=133333 width=12) (actual time=8.414..615.694 rows=106667 loops=3)
                                            ->  Parallel Seq Scan on "SerialStockItem" ssi  (cost=0.00..2001.16 rows=93816 width=12) (actual time=14.825..323.081 rows=53163 loops=3)
                                            ->  Parallel Seq Scan on "BulkStockItem" bsi  (cost=0.00..1859.19 rows=94419 width=12) (actual time=6.306..419.047 rows=80256 loops=2)
                                      ->  Hash  (cost=1.10..1.10 rows=10 width=21) (actual time=0.919..1.812 rows=10 loops=3)
                                            Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                            ->  Seq Scan on "Warehouse" w  (cost=0.00..1.10 rows=10 width=21) (actual time=0.910..1.274 rows=10 loops=3)
                                ->  Hash  (cost=1267.00..1267.00 rows=47000 width=31) (actual time=95.483..95.485 rows=47000 loops=3)
                                      Buckets: 65536  Batches: 1  Memory Usage: 3450kB
                                      ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=31) (actual time=0.422..57.368 rows=47000 loops=3)
                          ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=18.493..18.494 rows=20000 loops=3)
                                Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                                ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.023..5.571 rows=20000 loops=3)
Planning Time: 13.063 ms
Execution Time: 2228.581 ms


==================================================
EXPLAIN ANALYZE — Query 8: Stan magazynowy per produkt
==================================================
Sort  (cost=19267.36..19316.89 rows=19812 width=21) (actual time=480.647..482.303 rows=17954 loops=1)
  Sort Key: (sum("*SELECT* 1".quantity)) DESC
  Sort Method: quicksort  Memory: 1483kB
  ->  HashAggregate  (cost=17655.24..17853.36 rows=19812 width=21) (actual time=473.512..477.133 rows=17954 loops=1)
        Group Key: p.name
        Batches: 1  Memory Usage: 2065kB
        ->  Hash Join  (cost=2542.50..16055.24 rows=320000 width=17) (actual time=36.885..364.980 rows=320000 loops=1)
              Hash Cond: ("*SELECT* 1".product_id = p.id)
              ->  Append  (cost=1854.50..14527.07 rows=320000 width=8) (actual time=28.664..254.770 rows=320000 loops=1)
                    ->  Subquery Scan on "*SELECT* 1"  (cost=1854.50..6525.95 rows=159488 width=8) (actual time=28.662..125.729 rows=159488 loops=1)
                          ->  Hash Join  (cost=1854.50..4931.07 rows=159488 width=8) (actual time=28.662..110.501 rows=159488 loops=1)
                                Hash Cond: (ssi.variant_id = v.id)
                                ->  Seq Scan on "SerialStockItem" ssi  (cost=0.00..2657.88 rows=159488 width=4) (actual time=0.013..13.273 rows=159488 loops=1)
                                ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=28.626..28.627 rows=47000 loops=1)
                                      Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                      ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.007..21.004 rows=47000 loops=1)
                    ->  Subquery Scan on "*SELECT* 2"  (cost=1854.50..6401.12 rows=160512 width=8) (actual time=13.546..104.404 rows=160512 loops=1)
                          ->  Hash Join  (cost=1854.50..4796.00 rows=160512 width=8) (actual time=13.545..88.857 rows=160512 loops=1)
                                Hash Cond: (bsi.variant_id = v_1.id)
                                ->  Seq Scan on "BulkStockItem" bsi  (cost=0.00..2520.12 rows=160512 width=8) (actual time=0.016..13.236 rows=160512 loops=1)
                                ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=13.506..13.507 rows=47000 loops=1)
                                      Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                      ->  Seq Scan on "Variant" v_1  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.007..5.441 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=8.210..8.210 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.014..4.742 rows=20000 loops=1)
Planning Time: 38.282 ms
Execution Time: 483.903 ms


==================================================
EXPLAIN ANALYZE — Query 9: Najpopularniejsze Kategorie (wg. Całkowitego Przychodu)
==================================================
Limit  (cost=7440.92..7440.95 rows=10 width=44) (actual time=213.578..213.585 rows=1 loops=1)
  ->  Sort  (cost=7440.92..7441.30 rows=150 width=44) (actual time=213.577..213.583 rows=1 loops=1)
        Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
        Sort Method: quicksort  Memory: 25kB
        ->  HashAggregate  (cost=7435.81..7437.68 rows=150 width=44) (actual time=213.560..213.568 rows=1 loops=1)
              Group Key: c.name
              Batches: 1  Memory Usage: 40kB
              ->  Hash Join  (cost=3230.89..6435.81 rows=100000 width=22) (actual time=81.613..205.608 rows=20000 loops=1)
                    Hash Cond: (pc.category_id = c.id)
                    ->  Hash Join  (cost=3225.51..6160.51 rows=100000 width=14) (actual time=79.021..198.994 rows=20000 loops=1)
                          Hash Cond: (pc.product_id = p.id)
                          ->  Seq Scan on "ProductCategory" pc  (cost=0.00..1560.00 rows=100000 width=8) (actual time=2.490..147.366 rows=100000 loops=1)
                          ->  Hash  (cost=2975.51..2975.51 rows=20000 width=18) (actual time=34.799..34.803 rows=20000 loops=1)
                                Buckets: 32768  Batches: 1  Memory Usage: 1272kB
                                ->  Hash Join  (cost=2542.50..2975.51 rows=20000 width=18) (actual time=20.324..31.277 rows=20000 loops=1)
                                      Hash Cond: (v.product_id = p.id)
                                      ->  Hash Join  (cost=1854.50..2235.00 rows=20000 width=14) (actual time=14.366..21.960 rows=20000 loops=1)
                                            Hash Cond: (oi.variant_id = v.id)
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=14) (actual time=0.020..3.944 rows=20000 loops=1)
                                            ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=13.536..13.537 rows=47000 loops=1)
                                                  Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                                  ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.009..5.503 rows=47000 loops=1)
                                      ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=5.220..5.221 rows=20000 loops=1)
                                            Buckets: 32768  Batches: 1  Memory Usage: 960kB
                                            ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.024..2.147 rows=20000 loops=1)
                    ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=1.962..1.962 rows=150 loops=1)
                          Buckets: 1024  Batches: 1  Memory Usage: 16kB
                          ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=1.903..1.929 rows=150 loops=1)
Planning Time: 29.048 ms
Execution Time: 214.294 ms


==================================================
EXPLAIN ANALYZE — Query 10: Liczba produktów per kategoria
==================================================
Sort  (cost=2342.22..2342.59 rows=150 width=20) (actual time=49.234..49.244 rows=150 loops=1)
  Sort Key: (count(pc.product_id)) DESC
  Sort Method: quicksort  Memory: 30kB
  ->  HashAggregate  (cost=2335.30..2336.80 rows=150 width=20) (actual time=49.178..49.202 rows=150 loops=1)
        Group Key: c.name
        Batches: 1  Memory Usage: 48kB
        ->  Hash Right Join  (cost=5.38..1835.30 rows=100000 width=16) (actual time=0.069..28.773 rows=100000 loops=1)
              Hash Cond: (pc.category_id = c.id)
              ->  Seq Scan on "ProductCategory" pc  (cost=0.00..1560.00 rows=100000 width=8) (actual time=0.004..6.670 rows=100000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=0.057..0.058 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 16kB
                    ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=0.010..0.031 rows=150 loops=1)
Planning Time: 0.172 ms
Execution Time: 49.302 ms


==================================================
EXPLAIN ANALYZE — Query 11: Liczba zamówień per metoda płatności
==================================================
Sort  (cost=7850.14..7850.15 rows=6 width=50) (actual time=185.099..185.832 rows=6 loops=1)
  Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  Finalize GroupAggregate  (cost=7848.47..7850.06 rows=6 width=50) (actual time=184.272..185.017 rows=6 loops=1)
        Group Key: pm.name
        ->  Gather Merge  (cost=7848.47..7849.87 rows=12 width=50) (actual time=184.255..184.995 rows=18 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Sort  (cost=6848.44..6848.46 rows=6 width=50) (actual time=156.568..156.572 rows=6 loops=3)
                    Sort Key: pm.name
                    Sort Method: quicksort  Memory: 25kB
                    Worker 0:  Sort Method: quicksort  Memory: 25kB
                    Worker 1:  Sort Method: quicksort  Memory: 25kB
                    ->  Partial HashAggregate  (cost=6848.29..6848.36 rows=6 width=50) (actual time=156.532..156.537 rows=6 loops=3)
                          Group Key: pm.name
                          Batches: 1  Memory Usage: 24kB
                          Worker 0:  Batches: 1  Memory Usage: 24kB
                          Worker 1:  Batches: 1  Memory Usage: 24kB
                          ->  Hash Join  (cost=579.13..6744.13 rows=8333 width=24) (actual time=7.458..153.014 rows=6667 loops=3)
                                Hash Cond: (o.payment_method_id = pm.id)
                                ->  Hash Join  (cost=578.00..6705.67 rows=8333 width=18) (actual time=7.406..151.499 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.207..75.283 rows=133333 loops=3)
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=14) (actual time=6.880..6.880 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1194kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=14) (actual time=0.017..2.574 rows=20000 loops=3)
                                ->  Hash  (cost=1.06..1.06 rows=6 width=14) (actual time=0.029..0.030 rows=6 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                      ->  Seq Scan on "PaymentMethod" pm  (cost=0.00..1.06 rows=6 width=14) (actual time=0.024..0.025 rows=6 loops=3)
Planning Time: 4.961 ms
Execution Time: 185.915 ms


==================================================
EXPLAIN ANALYZE — Query 12: Średnia ocena per producent
==================================================
Sort  (cost=1367.54..1367.91 rows=150 width=57) (actual time=30.787..30.798 rows=150 loops=1)
  Sort Key: (round(avg(r.rating), 2)) DESC NULLS LAST
  Sort Method: quicksort  Memory: 32kB
  ->  HashAggregate  (cost=1359.87..1362.12 rows=150 width=57) (actual time=30.669..30.732 rows=150 loops=1)
        Group Key: m.name
        Batches: 1  Memory Usage: 64kB
        ->  Hash Join  (cost=693.38..1259.87 rows=20000 width=29) (actual time=6.137..24.278 rows=27388 loops=1)
              Hash Cond: (p.manufacturer_id = m.id)
              ->  Hash Right Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=5.342..18.199 rows=27388 loops=1)
                    Hash Cond: (r.product_id = p.id)
                    ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=0.008..3.002 rows=20000 loops=1)
                    ->  Hash  (cost=438.00..438.00 rows=20000 width=8) (actual time=5.323..5.324 rows=20000 loops=1)
                          Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                          ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=8) (actual time=0.004..2.281 rows=20000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.056..0.057 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 18kB
                    ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.015..0.031 rows=150 loops=1)
Planning Time: 6.783 ms
Execution Time: 30.868 ms


==================================================
EXPLAIN ANALYZE — Query 13: Aktywne promocje i objęta nimi liczba wariantów
==================================================
Sort  (cost=587.95..588.05 rows=42 width=14) (actual time=9.693..9.696 rows=42 loops=1)
  Sort Key: (count(v.id)) DESC
  Sort Method: quicksort  Memory: 26kB
  ->  HashAggregate  (cost=586.40..586.82 rows=42 width=14) (actual time=9.671..9.679 rows=42 loops=1)
        Group Key: pr.name
        Batches: 1  Memory Usage: 24kB
        ->  Merge Join  (cost=7.46..535.87 rows=10105 width=10) (actual time=0.171..9.379 rows=1238 loops=1)
              Merge Cond: (v.promotion_id = pr.id)
              ->  Index Scan using idx_variant_promotion on "Variant" v  (cost=0.29..4233.14 rows=47000 width=8) (actual time=0.010..8.834 rows=5685 loops=1)
              ->  Sort  (cost=7.17..7.27 rows=43 width=10) (actual time=0.046..0.052 rows=43 loops=1)
                    Sort Key: pr.id
                    Sort Method: quicksort  Memory: 26kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=43 width=10) (actual time=0.012..0.035 rows=43 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 157
Planning Time: 10.222 ms
Execution Time: 9.748 ms


==================================================
EXPLAIN ANALYZE — Query 14: Najczęściej wybierane warianty w koszykach
==================================================
Limit  (cost=268487.71..268487.74 rows=10 width=44) (actual time=1784.104..1784.112 rows=10 loops=1)
  ->  Sort  (cost=268487.71..272237.71 rows=1500000 width=44) (actual time=1783.094..1783.101 rows=10 loops=1)
        Sort Key: (sum("CartItem".quantity)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  HashAggregate  (cost=197635.75..236073.25 rows=1500000 width=44) (actual time=1764.037..1775.616 rows=47000 loops=1)
              Group Key: "Variant".sku, p.name
              Planned Partitions: 32  Batches: 1  Memory Usage: 6161kB
              ->  Hash Join  (cost=3858.75..62635.75 rows=1500000 width=40) (actual time=40.942..1016.956 rows=1500000 loops=1)
                    Hash Cond: ("CartItem".variant_id = "Variant".id)
                    ->  Seq Scan on "CartItem"  (cost=0.00..23152.00 rows=1500000 width=16) (actual time=1.170..260.998 rows=1500000 loops=1)
                    ->  Hash  (cost=3271.25..3271.25 rows=47000 width=40) (actual time=39.750..39.754 rows=47000 loops=1)
                          Buckets: 65536  Batches: 1  Memory Usage: 3868kB
                          ->  Hash Join  (cost=888.00..3271.25 rows=47000 width=40) (actual time=8.144..29.232 rows=47000 loops=1)
                                Hash Cond: ("Variant".product_id = p.id)
                                ->  Seq Scan on "Variant"  (cost=0.00..1267.00 rows=47000 width=68) (actual time=0.009..7.191 rows=47000 loops=1)
                                ->  Hash  (cost=638.00..638.00 rows=20000 width=17) (actual time=8.123..8.125 rows=20000 loops=1)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                                      ->  Subquery Scan on p  (cost=0.00..638.00 rows=20000 width=17) (actual time=0.005..4.813 rows=20000 loops=1)
                                            ->  Seq Scan on "Product"  (cost=0.00..438.00 rows=20000 width=85) (actual time=0.005..2.891 rows=20000 loops=1)
Planning Time: 7.574 ms
Execution Time: 1787.202 ms


==================================================
EXPLAIN ANALYZE — Query 15: Produkty z Największą Różnicą Między Ceną Podstawową a Ceną Wariantu
==================================================
Limit  (cost=3211.55..3211.58 rows=10 width=80) (actual time=44.698..44.701 rows=10 loops=1)
  ->  Sort  (cost=3211.55..3329.05 rows=47000 width=80) (actual time=44.696..44.698 rows=10 loops=1)
        Sort Key: v.price_modifier DESC
        Sort Method: top-N heapsort  Memory: 27kB
        ->  Hash Join  (cost=688.00..2195.90 rows=47000 width=80) (actual time=6.249..32.114 rows=47000 loops=1)
              Hash Cond: (v.product_id = p.id)
              ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=33) (actual time=0.012..6.298 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=6.222..6.223 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1381kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.004..2.645 rows=20000 loops=1)
Planning Time: 3.263 ms
Execution Time: 44.740 ms


==================================================
EXPLAIN ANALYZE — Query 16: Konwersja zamówień wg statusu
==================================================
Sort  (cost=7541.77..7541.79 rows=7 width=48) (actual time=114.461..118.053 rows=7 loops=1)
  Sort Key: (count(o.id)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  WindowAgg  (cost=7541.33..7541.67 rows=7 width=48) (actual time=114.450..118.046 rows=7 loops=1)
        ->  Finalize GroupAggregate  (cost=7539.74..7541.51 rows=7 width=16) (actual time=114.425..118.026 rows=7 loops=1)
              Group Key: s.name
              ->  Gather Merge  (cost=7539.74..7541.37 rows=14 width=16) (actual time=114.415..118.013 rows=21 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Sort  (cost=6539.71..6539.73 rows=7 width=16) (actual time=98.410..98.413 rows=7 loops=3)
                          Sort Key: s.name
                          Sort Method: quicksort  Memory: 25kB
                          Worker 0:  Sort Method: quicksort  Memory: 25kB
                          Worker 1:  Sort Method: quicksort  Memory: 25kB
                          ->  Partial HashAggregate  (cost=6539.55..6539.62 rows=7 width=16) (actual time=97.541..97.544 rows=7 loops=3)
                                Group Key: s.name
                                Batches: 1  Memory Usage: 24kB
                                Worker 0:  Batches: 1  Memory Usage: 24kB
                                Worker 1:  Batches: 1  Memory Usage: 24kB
                                ->  Hash Join  (cost=1.16..5706.21 rows=166667 width=12) (actual time=0.052..45.021 rows=133333 loops=3)
                                      Hash Cond: (o.status_id = s.id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.007..10.835 rows=133333 loops=3)
                                      ->  Hash  (cost=1.07..1.07 rows=7 width=12) (actual time=0.023..0.024 rows=7 loops=3)
                                            Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                            ->  Seq Scan on "Status" s  (cost=0.00..1.07 rows=7 width=12) (actual time=0.018..0.019 rows=7 loops=3)
Planning Time: 6.942 ms
Execution Time: 118.131 ms


==================================================
EXPLAIN ANALYZE — Query 17: Top klienci wg wydatków
==================================================
Limit  (cost=15441.08..15441.10 rows=10 width=50) (actual time=2368.950..2423.819 rows=10 loops=1)
  ->  Sort  (cost=15441.08..15491.08 rows=20000 width=50) (actual time=2368.941..2423.808 rows=10 loops=1)
        Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=14758.88..15008.88 rows=20000 width=50) (actual time=2354.607..2419.298 rows=19296 loops=1)
              Group Key: u.id
              Batches: 5  Memory Usage: 8241kB  Disk Usage: 224kB
              ->  Gather  (cost=12863.13..14633.89 rows=16666 width=50) (actual time=2254.899..2360.034 rows=19428 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=11863.13..11967.29 rows=8333 width=50) (actual time=2136.313..2168.739 rows=6476 loops=3)
                          Group Key: u.id
                          Batches: 1  Memory Usage: 3217kB
                          Worker 0:  Batches: 1  Memory Usage: 2961kB
                          Worker 1:  Batches: 1  Memory Usage: 2961kB
                          ->  Nested Loop  (cost=578.42..11779.80 rows=8333 width=28) (actual time=10.708..2093.037 rows=6667 loops=3)
                                ->  Hash Join  (cost=578.00..6705.67 rows=8333 width=14) (actual time=7.532..71.454 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.007..14.698 rows=133333 loops=3)
                                      ->  Hash  (cost=328.00..328.00 rows=20000 width=14) (actual time=7.324..7.328 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1194kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=14) (actual time=0.024..2.583 rows=20000 loops=3)
                                ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.301..0.301 rows=1 loops=20000)
                                      Index Cond: (id = o.user_id)
Planning Time: 5.862 ms
Execution Time: 2429.153 ms


==================================================
EXPLAIN ANALYZE — Query 18: Produkty z wariantami objętymi promocją, z końcową ceną
==================================================
Sort  (cost=2074.11..2099.37 rows=10105 width=132) (actual time=57.262..57.371 rows=1238 loops=1)
  Sort Key: (round(((p.price + v.price_modifier) * ('1'::numeric - pr.discount_percentage)), 2))
  Sort Method: quicksort  Memory: 139kB
  ->  Hash Join  (cost=695.46..1401.98 rows=10105 width=132) (actual time=21.636..56.758 rows=1238 loops=1)
        Hash Cond: (v.product_id = p.id)
        ->  Merge Join  (cost=7.46..535.87 rows=10105 width=39) (actual time=8.765..42.345 rows=1238 loops=1)
              Merge Cond: (v.promotion_id = pr.id)
              ->  Index Scan using idx_variant_promotion on "Variant" v  (cost=0.29..4233.14 rows=47000 width=37) (actual time=0.012..41.126 rows=5685 loops=1)
              ->  Sort  (cost=7.17..7.27 rows=43 width=10) (actual time=0.670..0.683 rows=43 loops=1)
                    Sort Key: pr.id
                    Sort Method: quicksort  Memory: 26kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=43 width=10) (actual time=0.019..0.042 rows=43 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 157
        ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=12.848..12.849 rows=20000 loops=1)
              Buckets: 32768  Batches: 1  Memory Usage: 1381kB
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.015..9.048 rows=20000 loops=1)
Planning Time: 5.551 ms
Execution Time: 57.477 ms


==================================================
EXPLAIN ANALYZE — Query 19: Użytkownicy, Którzy Dodali Produkt do Koszyka, Ale Nie Złożyli Zamówienia (Potencjał Odbudowy Koszyka)
==================================================
Hash Join  (cost=46254.21..103988.81 rows=1068640 width=55) (actual time=3724.446..6037.596 rows=1005006 loops=1)
  Hash Cond: (v.product_id = p.id)
  ->  Hash Join  (cost=45566.21..100495.04 rows=1068640 width=46) (actual time=3715.340..5501.574 rows=1005006 loops=1)
        Hash Cond: (ci.variant_id = v.id)
        ->  Hash Join  (cost=43711.71..95835.11 rows=1068640 width=46) (actual time=3698.437..4756.480 rows=1005006 loops=1)
              Hash Cond: (ci.cart_id = c.id)
              ->  Seq Scan on "CartItem" ci  (cost=0.00..23152.00 rows=1500000 width=8) (actual time=0.809..260.826 rows=1500000 loops=1)
              ->  Hash  (cost=41435.91..41435.91 rows=106864 width=46) (actual time=3691.990..3706.499 rows=100414 loops=1)
                    Buckets: 131072  Batches: 2  Memory Usage: 4929kB
                    ->  Gather  (cost=25017.67..41435.91 rows=106864 width=46) (actual time=3413.268..3500.484 rows=100414 loops=1)
                          Workers Planned: 2
                          Workers Launched: 2
                          ->  Parallel Hash Right Anti Join  (cost=24017.67..29749.51 rows=44527 width=46) (actual time=3180.083..3212.942 rows=33471 loops=3)
                                Hash Cond: (o.user_id = u.id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=4) (actual time=2.006..254.691 rows=133333 loops=3)
                                ->  Parallel Hash  (cost=23236.42..23236.42 rows=62500 width=50) (actual time=2617.968..2620.094 rows=50000 loops=3)
                                      Buckets: 262144  Batches: 1  Memory Usage: 14720kB
                                      ->  Hash Join  (cost=4079.00..23236.42 rows=62500 width=50) (actual time=135.676..2298.383 rows=50000 loops=3)
                                            Hash Cond: (u.id = c.user_id)
                                            ->  Parallel Seq Scan on "User" u  (cost=0.00..18063.67 rows=416667 width=46) (actual time=0.011..1502.604 rows=333333 loops=3)
                                            ->  Hash  (cost=2204.00..2204.00 rows=150000 width=8) (actual time=131.654..132.894 rows=150000 loops=3)
                                                  Buckets: 262144  Batches: 1  Memory Usage: 7908kB
                                                  ->  Seq Scan on "Cart" c  (cost=0.00..2204.00 rows=150000 width=8) (actual time=8.697..64.666 rows=150000 loops=3)
        ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=13.465..14.024 rows=47000 loops=1)
              Buckets: 65536  Batches: 1  Memory Usage: 2348kB
              ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.012..6.711 rows=47000 loops=1)
  ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=5.658..5.658 rows=20000 loops=1)
        Buckets: 32768  Batches: 1  Memory Usage: 1245kB
        ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.015..2.366 rows=20000 loops=1)
Planning Time: 30.144 ms
Execution Time: 6135.699 ms


==================================================
EXPLAIN ANALYZE — Query 20: Wyszukiwanie produktów po nazwie lub opisie (parametryzowane)
==================================================
Bitmap Heap Scan on "Product"  (cost=43.00..57.51 rows=4 width=60) (actual time=7.606..54.708 rows=143 loops=1)
  Recheck Cond: (((name)::text ~~* '%test%'::text) OR (description ~~* '%test%'::text))
  Heap Blocks: exact=106
  ->  BitmapOr  (cost=43.00..43.00 rows=4 width=0) (actual time=7.571..7.572 rows=0 loops=1)
        ->  Bitmap Index Scan on idx_product_name_trgm  (cost=0.00..21.50 rows=2 width=0) (actual time=4.016..4.016 rows=42 loops=1)
              Index Cond: ((name)::text ~~* '%test%'::text)
        ->  Bitmap Index Scan on idx_product_description_trgm  (cost=0.00..21.50 rows=2 width=0) (actual time=3.549..3.549 rows=102 loops=1)
              Index Cond: (description ~~* '%test%'::text)
Planning Time: 213.869 ms
Execution Time: 59.460 ms


==================================================
EXPLAIN ANALYZE — Query 21: Użytkownicy, Którzy Zapisali Konkretny Produkt jako Ulubiony (np. Product ID=350259)
==================================================
Nested Loop  (cost=0.85..262.23 rows=30 width=56) (actual time=4.588..15.789 rows=26 loops=1)
  ->  Index Only Scan using idx_favoriteproduct_product_user on "FavoriteProduct" fp  (cost=0.42..8.95 rows=30 width=4) (actual time=4.561..4.571 rows=26 loops=1)
        Index Cond: (product_id = 35)
        Heap Fetches: 0
  ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..8.44 rows=1 width=60) (actual time=0.430..0.430 rows=1 loops=26)
        Index Cond: (id = fp.user_id)
Planning Time: 9.796 ms
Execution Time: 15.827 ms


==================================================
EXPLAIN ANALYZE — Query 22: Znajdź Magazyny, Które Posiadają Zapasy Konkretnego Wariantu (np. SKU='VR-000000-a637d44b7afd')
==================================================
Sort  (cost=80.54..80.54 rows=2 width=25) (actual time=4.087..4.090 rows=0 loops=1)
  Sort Key: (sum("*SELECT* 1".stock_units)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  GroupAggregate  (cost=80.41..80.53 rows=2 width=25) (actual time=4.068..4.071 rows=0 loops=1)
        Group Key: w.name
        Filter: (sum("*SELECT* 1".stock_units) > 0)
        ->  Sort  (cost=80.41..80.42 rows=6 width=21) (actual time=4.067..4.069 rows=0 loops=1)
              Sort Key: w.name
              Sort Method: quicksort  Memory: 25kB
              ->  Nested Loop  (cost=4.76..80.33 rows=6 width=21) (actual time=4.053..4.055 rows=0 loops=1)
                    Join Filter: (w.id = "*SELECT* 1".warehouse_id)
                    ->  Append  (cost=4.76..78.43 rows=6 width=8) (actual time=4.052..4.054 rows=0 loops=1)
                          ->  Subquery Scan on "*SELECT* 1"  (cost=4.76..39.13 rows=3 width=8) (actual time=4.029..4.030 rows=0 loops=1)
                                ->  Nested Loop  (cost=4.76..39.10 rows=3 width=8) (actual time=4.028..4.029 rows=0 loops=1)
                                      ->  Index Scan using "Variant_sku_key" on "Variant" v  (cost=0.41..8.43 rows=1 width=4) (actual time=4.027..4.027 rows=0 loops=1)
                                            Index Cond: ((sku)::text = 'VR-000001-2704de10f283'::text)
                                      ->  Bitmap Heap Scan on "BulkStockItem" bsi  (cost=4.35..30.60 rows=7 width=12) (never executed)
                                            Recheck Cond: (variant_id = v.id)
                                            ->  Bitmap Index Scan on idx_bulk_variant  (cost=0.00..4.35 rows=7 width=0) (never executed)
                                                  Index Cond: (variant_id = v.id)
                          ->  Subquery Scan on "*SELECT* 2"  (cost=4.76..39.27 rows=3 width=8) (actual time=0.022..0.023 rows=0 loops=1)
                                ->  Nested Loop  (cost=4.76..39.24 rows=3 width=8) (actual time=0.021..0.021 rows=0 loops=1)
                                      ->  Index Scan using "Variant_sku_key" on "Variant" v_1  (cost=0.41..8.43 rows=1 width=4) (actual time=0.020..0.020 rows=0 loops=1)
                                            Index Cond: ((sku)::text = 'VR-000001-2704de10f283'::text)
                                      ->  Bitmap Heap Scan on "SerialStockItem" ssi  (cost=4.35..30.73 rows=7 width=8) (never executed)
                                            Recheck Cond: (variant_id = v_1.id)
                                            ->  Bitmap Index Scan on idx_serial_variant  (cost=0.00..4.35 rows=7 width=0) (never executed)
                                                  Index Cond: (variant_id = v_1.id)
                    ->  Materialize  (cost=0.00..1.15 rows=10 width=21) (never executed)
                          ->  Seq Scan on "Warehouse" w  (cost=0.00..1.10 rows=10 width=21) (never executed)
Planning Time: 7.617 ms
Execution Time: 4.825 ms


==================================================
EXPLAIN ANALYZE — Query 23: Warianty, Które Wymagają Uzyskania Konkretnej Opcji (np. 'Kolor'='Czerwony')
==================================================
Nested Loop  (cost=6.81..677.99 rows=8 width=36) (actual time=0.018..0.019 rows=0 loops=1)
  ->  Nested Loop  (cost=6.52..675.35 rows=8 width=27) (actual time=0.017..0.018 rows=0 loops=1)
        ->  Nested Loop  (cost=6.23..672.76 rows=8 width=4) (actual time=0.017..0.018 rows=0 loops=1)
              Join Filter: (opt.attribute_id = a.id)
              ->  Seq Scan on "Attribute" a  (cost=0.00..1.38 rows=1 width=4) (actual time=0.017..0.017 rows=0 loops=1)
                    Filter: ((name)::text = 'Attr_49_Century'::text)
                    Rows Removed by Filter: 30
              ->  Nested Loop  (cost=6.23..668.26 rows=250 width=8) (never executed)
                    ->  Seq Scan on "Option" opt  (cost=0.00..18.50 rows=1 width=8) (never executed)
                          Filter: ((value)::text = 'do'::text)
                    ->  Bitmap Heap Scan on "VariantOption" vo  (cost=6.23..647.26 rows=250 width=8) (never executed)
                          Recheck Cond: (option_id = opt.id)
                          ->  Bitmap Index Scan on idx_variantoption_option_id  (cost=0.00..6.17 rows=250 width=0) (never executed)
                                Index Cond: (option_id = opt.id)
        ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.32 rows=1 width=31) (never executed)
              Index Cond: (id = vo.variant_id)
  ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=17) (never executed)
        Index Cond: (id = v.product_id)
Planning Time: 38.252 ms
Execution Time: 0.084 ms


==================================================
EXPLAIN ANALYZE — Query 24: Znajdź Zamówienia Użytkownika (np. email='debbie.lane.16786.50af0753@example.com') o Statusie 'Paid'
==================================================
Nested Loop  (cost=0.98..17.07 rows=1 width=20) (actual time=2.537..2.538 rows=0 loops=1)
  ->  Nested Loop  (cost=0.85..16.89 rows=1 width=16) (actual time=2.537..2.537 rows=0 loops=1)
        ->  Index Scan using "User_email_key" on "User" u  (cost=0.42..8.44 rows=1 width=4) (actual time=2.536..2.536 rows=0 loops=1)
              Index Cond: ((email)::text = 'debbie.lane.16786.50af0753@example.com'::text)
        ->  Index Scan using idx_order_user_id on "Order" o  (cost=0.42..8.44 rows=1 width=20) (never executed)
              Index Cond: (user_id = u.id)
  ->  Index Scan using "Status_pkey" on "Status" s  (cost=0.13..0.15 rows=1 width=12) (never executed)
        Index Cond: (id = o.status_id)
        Filter: ((name)::text = 'Paid'::text)
Planning Time: 5.108 ms
Execution Time: 2.572 ms


==================================================
EXPLAIN ANALYZE — Query 25: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
Hash Left Join  (cost=6.97..48.34 rows=16 width=87) (actual time=3.178..7.946 rows=18 loops=1)
  Hash Cond: (opt.attribute_id = a.id)
  ->  Nested Loop Left Join  (cost=5.30..46.57 rows=16 width=45) (actual time=2.563..7.306 rows=18 loops=1)
        ->  Nested Loop Left Join  (cost=5.02..41.89 rows=16 width=39) (actual time=1.306..4.699 rows=18 loops=1)
              ->  Nested Loop  (cost=4.60..24.13 rows=3 width=39) (actual time=0.680..0.699 rows=4 loops=1)
                    ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..8.30 rows=1 width=10) (actual time=0.007..0.009 rows=1 loops=1)
                          Index Cond: (id = 35)
                    ->  Bitmap Heap Scan on "Variant" v  (cost=4.31..15.80 rows=3 width=37) (actual time=0.670..0.687 rows=4 loops=1)
                          Recheck Cond: (product_id = 35)
                          Heap Blocks: exact=4
                          ->  Bitmap Index Scan on idx_variant_product_id  (cost=0.00..4.31 rows=3 width=0) (actual time=0.020..0.020 rows=4 loops=1)
                                Index Cond: (product_id = 35)
              ->  Index Only Scan using uq_varopt_variant_option on "VariantOption" vo  (cost=0.42..5.86 rows=6 width=8) (actual time=0.997..0.998 rows=4 loops=4)
                    Index Cond: (variant_id = v.id)
                    Heap Fetches: 0
        ->  Index Scan using "Option_pkey" on "Option" opt  (cost=0.28..0.29 rows=1 width=14) (actual time=0.144..0.144 rows=1 loops=18)
              Index Cond: (id = vo.option_id)
  ->  Hash  (cost=1.30..1.30 rows=30 width=18) (actual time=0.021..0.022 rows=30 loops=1)
        Buckets: 1024  Batches: 1  Memory Usage: 10kB
        ->  Seq Scan on "Attribute" a  (cost=0.00..1.30 rows=30 width=18) (actual time=0.010..0.013 rows=30 loops=1)
Planning Time: 0.540 ms
Execution Time: 7.997 ms


==================================================
EXPLAIN ANALYZE — Query 26: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
Hash Left Join  (cost=6.97..48.42 rows=16 width=87) (actual time=0.007..0.008 rows=0 loops=1)
  Hash Cond: (opt.attribute_id = a.id)
  ->  Nested Loop Left Join  (cost=5.30..46.57 rows=16 width=45) (actual time=0.006..0.007 rows=0 loops=1)
        ->  Nested Loop Left Join  (cost=5.02..41.89 rows=16 width=39) (actual time=0.006..0.007 rows=0 loops=1)
              ->  Nested Loop  (cost=4.60..24.13 rows=3 width=39) (actual time=0.006..0.006 rows=0 loops=1)
                    ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..8.30 rows=1 width=10) (actual time=0.006..0.006 rows=0 loops=1)
                          Index Cond: (id = 350259)
                    ->  Bitmap Heap Scan on "Variant" v  (cost=4.31..15.80 rows=3 width=37) (never executed)
                          Recheck Cond: (product_id = 350259)
                          ->  Bitmap Index Scan on idx_variant_product_id  (cost=0.00..4.31 rows=3 width=0) (never executed)
                                Index Cond: (product_id = 350259)
              ->  Index Only Scan using uq_varopt_variant_option on "VariantOption" vo  (cost=0.42..5.86 rows=6 width=8) (never executed)
                    Index Cond: (variant_id = v.id)
                    Heap Fetches: 0
        ->  Index Scan using "Option_pkey" on "Option" opt  (cost=0.28..0.29 rows=1 width=14) (never executed)
              Index Cond: (id = vo.option_id)
  ->  Hash  (cost=1.30..1.30 rows=30 width=18) (never executed)
        ->  Seq Scan on "Attribute" a  (cost=0.00..1.30 rows=30 width=18) (never executed)
Planning Time: 0.542 ms
Execution Time: 0.046 ms


==================================================
EXPLAIN ANALYZE — Query 27: Porównanie Średniej Oceny dla Promowanych i Niepromowanych Produktów
==================================================
HashAggregate  (cost=87850.51..87853.01 rows=200 width=64) (actual time=192.853..192.858 rows=2 loops=1)
  Group Key: CASE WHEN (ANY (p.id = (hashed SubPlan 2).col1)) THEN 'Promowany'::text ELSE 'Niepromowany'::text END
  Batches: 1  Memory Usage: 40kB
  ->  HashAggregate  (cost=1300.51..87550.51 rows=20000 width=68) (actual time=182.994..189.887 rows=12612 loops=1)
        Group Key: p.id
        Batches: 1  Memory Usage: 2577kB
        ->  Hash Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=55.911..147.146 rows=20000 loops=1)
              Hash Cond: (r.product_id = p.id)
              ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=0.612..53.124 rows=20000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=54.438..54.439 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 960kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.010..49.567 rows=20000 loops=1)
        SubPlan 2
          ->  Index Only Scan using idx_variant_product_promotion on "Variant" v2  (cost=0.28..215.94 rows=5577 width=4) (actual time=2.966..24.865 rows=5684 loops=1)
                Heap Fetches: 0
Planning Time: 2.292 ms
Execution Time: 193.566 ms


==================================================
EXPLAIN ANALYZE — Query 28: Top 5 Miast Generujących Największy Przychód (Wg. Adresu Wysyłki)
==================================================
Limit  (cost=15175.51..15175.53 rows=5 width=45) (actual time=4023.277..4121.154 rows=5 loops=1)
  ->  Sort  (cost=15175.51..15225.51 rows=20000 width=45) (actual time=4023.266..4119.743 rows=5 loops=1)
        Sort Key: (sum(oi.unit_price)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=14593.32..14843.32 rows=20000 width=45) (actual time=4012.084..4114.232 rows=12950 loops=1)
              Group Key: a.city
              Batches: 1  Memory Usage: 5905kB
              ->  Gather  (cost=12697.56..14468.33 rows=16666 width=45) (actual time=3922.943..4085.598 rows=16100 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=11697.56..11801.73 rows=8333 width=45) (actual time=3907.719..3914.371 rows=5367 loops=3)
                          Group Key: a.city
                          Batches: 1  Memory Usage: 2449kB
                          Worker 0:  Batches: 1  Memory Usage: 2449kB
                          Worker 1:  Batches: 1  Memory Usage: 2449kB
                          ->  Nested Loop  (cost=681.42..11655.90 rows=8333 width=19) (actual time=33.916..3870.404 rows=6667 loops=3)
                                ->  Parallel Hash Join  (cost=681.00..6566.02 rows=8333 width=10) (actual time=30.806..120.610 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.014..22.786 rows=133333 loops=3)
                                      ->  Parallel Hash  (cost=533.93..533.93 rows=11765 width=10) (actual time=30.610..30.611 rows=6667 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1216kB
                                            ->  Parallel Index Only Scan using idx_orderitem_order_price_cover on "OrderItem" oi  (cost=0.29..533.93 rows=11765 width=10) (actual time=0.855..28.674 rows=6667 loops=3)
                                                  Heap Fetches: 0
                                ->  Index Scan using "Address_pkey" on "Address" a  (cost=0.43..0.61 rows=1 width=17) (actual time=0.559..0.559 rows=1 loops=20000)
                                      Index Cond: (id = o.shipping_address_id)
Planning Time: 27.040 ms
Execution Time: 4126.688 ms


==================================================
EXPLAIN ANALYZE — Query 29: Porównanie Wolumenu Sprzedaży Produktów Promowanych vs. Niepromowanych (w Ostatnich 30 Dniach)
==================================================
GroupAggregate  (cost=4663.68..4670.28 rows=200 width=40) (actual time=48.387..49.815 rows=1 loops=1)
  Group Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
  ->  Sort  (cost=4663.68..4665.21 rows=614 width=36) (actual time=48.257..48.292 rows=619 loops=1)
        Sort Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
        Sort Method: quicksort  Memory: 49kB
        ->  Nested Loop  (cost=3936.55..4635.24 rows=614 width=36) (actual time=21.335..48.126 rows=619 loops=1)
              ->  Hash Join  (cost=3936.26..4316.76 rows=614 width=8) (actual time=21.315..46.979 rows=619 loops=1)
                    Hash Cond: (oi.order_id = o.id)
                    ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=12) (actual time=1.108..23.144 rows=20000 loops=1)
                    ->  Hash  (cost=3782.67..3782.67 rows=12287 width=4) (actual time=20.186..20.188 rows=12333 loops=1)
                          Buckets: 16384  Batches: 1  Memory Usage: 562kB
                          ->  Bitmap Heap Scan on "Order" o  (cost=231.65..3782.67 rows=12287 width=4) (actual time=10.820..18.203 rows=12333 loops=1)
                                Recheck Cond: (order_date >= (now() - '30 days'::interval))
                                Heap Blocks: exact=3270
                                ->  Bitmap Index Scan on idx_order_order_date  (cost=0.00..228.58 rows=12287 width=0) (actual time=10.440..10.440 rows=12333 loops=1)
                                      Index Cond: (order_date >= (now() - '30 days'::interval))
              ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.52 rows=1 width=8) (actual time=0.001..0.001 rows=1 loops=619)
                    Index Cond: (id = oi.variant_id)
Planning Time: 9.203 ms
Execution Time: 49.896 ms


==================================================
EXPLAIN ANALYZE — Query 30: Wskaźnik Lojalności (Repeat Purchase Rate) Użytkowników z Podziałem na Miasto Adresu Rozliczeniowego
==================================================
Sort  (cost=68002.37..68076.46 rows=29636 width=61) (actual time=4708.091..4729.335 rows=66456 loops=1)
  Sort Key: (round((((count(*) FILTER (WHERE (u.orders_count > 1)))::numeric * 100.0) / (NULLIF(count(*), 0))::numeric), 2)) DESC
  Sort Method: external merge  Disk: 3192kB
  ->  Finalize HashAggregate  (cost=65060.25..65801.15 rows=29636 width=61) (actual time=4576.681..4649.369 rows=66456 loops=1)
        Group Key: a.city
        Batches: 5  Memory Usage: 8241kB  Disk Usage: 720kB
        ->  Gather  (cost=58392.15..64615.71 rows=59272 width=29) (actual time=4077.658..4203.470 rows=122066 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial HashAggregate  (cost=57392.15..57688.51 rows=29636 width=29) (actual time=3925.582..3944.669 rows=40689 loops=3)
                    Group Key: a.city
                    Batches: 1  Memory Usage: 5137kB
                    Worker 0:  Batches: 1  Memory Usage: 5137kB
                    Worker 1:  Batches: 1  Memory Usage: 5137kB
                    ->  Parallel Hash Join  (cost=34868.03..55725.48 rows=166667 width=21) (actual time=1302.317..3470.003 rows=133333 loops=3)
                          Hash Cond: (a.id = o.billing_address_id)
                          ->  Parallel Seq Scan on "Address" a  (cost=0.00..18288.00 rows=500000 width=17) (actual time=9.183..1431.445 rows=400000 loops=3)
                          ->  Parallel Hash  (cost=32784.69..32784.69 rows=166667 width=12) (actual time=1289.284..1290.821 rows=133333 loops=3)
                                Buckets: 524288  Batches: 1  Memory Usage: 22912kB
                                ->  Hash Join  (cost=24635.51..32784.69 rows=166667 width=12) (actual time=520.631..931.170 rows=133333 loops=3)
                                      Hash Cond: (o.user_id = u.user_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.014..92.058 rows=133333 loops=3)
                                      ->  Hash  (cost=19635.86..19635.86 rows=287572 width=12) (actual time=427.976..429.267 rows=329619 loops=3)
                                            Buckets: 262144  Batches: 4  Memory Usage: 5596kB
                                            ->  Subquery Scan on u  (cost=0.42..19635.86 rows=287572 width=12) (actual time=12.089..294.164 rows=329619 loops=3)
                                                  ->  GroupAggregate  (cost=0.42..16760.14 rows=287572 width=12) (actual time=12.087..257.205 rows=329619 loops=3)
                                                        Group Key: "Order".user_id
                                                        ->  Index Only Scan using idx_order_user_id on "Order"  (cost=0.42..11884.42 rows=400000 width=4) (actual time=11.817..152.722 rows=400000 loops=3)
                                                              Heap Fetches: 150240
Planning Time: 6.202 ms
Execution Time: 4823.041 ms

FINISHED — 2025-12-02 21:03:06.445734
========================================================================================================================
========================================================================================================================
START EXPLAIN RUN — 2025-12-02 21:09:13.590383
========================================================================================================================


==================================================
EXPLAIN ANALYZE — Query 1: Średnia Wartość Zamówienia (AOV) w Ostatnim Miesiącu
==================================================
Aggregate  (cost=4368.04..4368.05 rows=1 width=32) (actual time=26.578..26.581 rows=1 loops=1)
  ->  GroupAggregate  (cost=4345.01..4360.36 rows=614 width=36) (actual time=26.046..26.528 rows=608 loops=1)
        Group Key: o.id
        ->  Sort  (cost=4345.01..4346.54 rows=614 width=14) (actual time=26.026..26.073 rows=619 loops=1)
              Sort Key: o.id
              Sort Method: quicksort  Memory: 44kB
              ->  Hash Join  (cost=3936.07..4316.57 rows=614 width=14) (actual time=20.394..25.553 rows=619 loops=1)
                    Hash Cond: (oi.order_id = o.id)
                    ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=14) (actual time=0.020..2.635 rows=20000 loops=1)
                    ->  Hash  (cost=3782.55..3782.55 rows=12282 width=4) (actual time=20.110..20.111 rows=12324 loops=1)
                          Buckets: 16384  Batches: 1  Memory Usage: 562kB
                          ->  Bitmap Heap Scan on "Order" o  (cost=231.61..3782.55 rows=12282 width=4) (actual time=6.927..17.472 rows=12324 loops=1)
                                Recheck Cond: (order_date >= (now() - '1 mon'::interval))
                                Heap Blocks: exact=3270
                                ->  Bitmap Index Scan on idx_order_date  (cost=0.00..228.54 rows=12282 width=0) (actual time=6.539..6.539 rows=12324 loops=1)
                                      Index Cond: (order_date >= (now() - '1 mon'::interval))
Planning Time: 32.287 ms
Execution Time: 27.264 ms


==================================================
EXPLAIN ANALYZE — Query 2: Średnia wartość zamówienia per użytkownik
==================================================
Sort  (cost=16166.87..16215.61 rows=19495 width=50) (actual time=4681.157..4722.228 rows=19296 loops=1)
  Sort Key: (round(avg(order_totals.total_price), 2)) DESC
  Sort Method: quicksort  Memory: 1612kB
  ->  Finalize HashAggregate  (cost=14485.35..14777.77 rows=19495 width=50) (actual time=4639.430..4703.469 rows=19296 loops=1)
        Group Key: u.id
        Batches: 5  Memory Usage: 8241kB  Disk Usage: 216kB
        ->  Gather  (cost=12637.36..14363.50 rows=16246 width=50) (actual time=4288.641..4443.738 rows=19433 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial HashAggregate  (cost=11637.36..11738.90 rows=8123 width=50) (actual time=4267.962..4290.870 rows=6478 loops=3)
                    Group Key: u.id
                    Batches: 1  Memory Usage: 3217kB
                    Worker 0:  Batches: 1  Memory Usage: 2961kB
                    Worker 1:  Batches: 1  Memory Usage: 2961kB
                    ->  Nested Loop  (cost=1210.75..11596.75 rows=8123 width=50) (actual time=201.663..4197.969 rows=6498 loops=3)
                          ->  Hash Join  (cost=1210.33..6650.49 rows=8123 width=36) (actual time=152.088..244.429 rows=6498 loops=3)
                                Hash Cond: (o.id = order_totals.order_id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.009..24.006 rows=133333 loops=3)
                                ->  Hash  (cost=966.64..966.64 rows=19495 width=36) (actual time=146.768..148.362 rows=19495 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1094kB
                                      ->  Subquery Scan on order_totals  (cost=528.00..966.64 rows=19495 width=36) (actual time=112.317..132.332 rows=19495 loops=3)
                                            ->  HashAggregate  (cost=528.00..771.69 rows=19495 width=36) (actual time=112.316..129.144 rows=19495 loops=3)
                                                  Group Key: oi.order_id
                                                  Batches: 1  Memory Usage: 7953kB
                                                  Worker 0:  Batches: 1  Memory Usage: 7953kB
                                                  Worker 1:  Batches: 1  Memory Usage: 7953kB
                                                  ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=14) (actual time=0.344..29.392 rows=20000 loops=3)
                          ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.599..0.599 rows=1 loops=19495)
                                Index Cond: (id = o.user_id)
Planning Time: 12.338 ms
Execution Time: 4759.771 ms


==================================================
EXPLAIN ANALYZE — Query 3: Top 10 Najlepiej Sprzedających Się Produktów (wg. Ilości Sprzedanych Jednostek) w Ostatnim Kwartale
==================================================
Limit  (cost=9140.21..9140.24 rows=10 width=46) (actual time=168.247..235.280 rows=1 loops=1)
  ->  Sort  (cost=9140.21..9150.16 rows=3980 width=46) (actual time=168.246..235.278 rows=1 loops=1)
        Sort Key: (sum(oi.quantity)) DESC
        Sort Method: quicksort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=9014.41..9054.21 rows=3980 width=46) (actual time=166.992..234.049 rows=1 loops=1)
              Group Key: p.name, m.name
              Batches: 1  Memory Usage: 217kB
              ->  Gather  (cost=8641.36..8989.54 rows=3316 width=46) (actual time=158.640..234.006 rows=3 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=7641.36..7657.94 rows=1658 width=46) (actual time=92.308..92.318 rows=1 loops=3)
                          Group Key: p.name, m.name
                          Batches: 1  Memory Usage: 73kB
                          Worker 0:  Batches: 1  Memory Usage: 73kB
                          Worker 1:  Batches: 1  Memory Usage: 73kB
                          ->  Hash Join  (cost=2077.33..7628.92 rows=1658 width=42) (actual time=28.693..91.616 rows=1324 loops=3)
                                Hash Cond: (p.manufacturer_id = m.id)
                                ->  Nested Loop  (cost=2071.96..7619.07 rows=1658 width=21) (actual time=28.094..90.657 rows=1324 loops=3)
                                      ->  Nested Loop  (cost=2071.67..7071.76 rows=1658 width=8) (actual time=27.453..87.730 rows=1324 loops=3)
                                            ->  Hash Join  (cost=2071.38..6211.75 rows=1658 width=8) (actual time=27.421..85.064 rows=1324 loops=3)
                                                  Hash Cond: (o.id = oi.order_id)
                                                  ->  Parallel Bitmap Heap Scan on "Order" o  (cost=1493.38..5409.85 rows=33170 width=4) (actual time=18.057..69.768 rows=26376 loops=3)
                                                        Recheck Cond: (order_date >= (now() - '3 mons'::interval))
                                                        Heap Blocks: exact=1267
                                                        ->  Bitmap Index Scan on idx_order_date  (cost=0.00..1473.48 rows=79607 width=0) (actual time=53.191..53.191 rows=79129 loops=1)
                                                              Index Cond: (order_date >= (now() - '3 mons'::interval))
                                                  ->  Hash  (cost=328.00..328.00 rows=20000 width=12) (actual time=7.954..7.954 rows=20000 loops=3)
                                                        Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                                        ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=12) (actual time=0.366..4.047 rows=20000 loops=3)
                                            ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.52 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=3972)
                                                  Index Cond: (id = oi.variant_id)
                                      ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=21) (actual time=0.002..0.002 rows=1 loops=3972)
                                            Index Cond: (id = v.product_id)
                                ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.574..0.574 rows=150 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 18kB
                                      ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.036..0.053 rows=150 loops=3)
Planning Time: 68.829 ms
Execution Time: 240.025 ms


==================================================
EXPLAIN ANALYZE — Query 4: Top 5 produktów z najwięcej recenzjami
==================================================
Limit  (cost=1792.59..1792.61 rows=5 width=25) (actual time=184.098..184.102 rows=5 loops=1)
  ->  Sort  (cost=1792.59..1842.59 rows=20000 width=25) (actual time=184.097..184.100 rows=5 loops=1)
        Sort Key: (COALESCE(r.count, '0'::bigint)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Hash Left Join  (cost=969.89..1460.40 rows=20000 width=25) (actual time=117.526..180.921 rows=20000 loops=1)
              Hash Cond: (p.id = r.product_id)
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=1.178..57.385 rows=20000 loops=1)
              ->  Hash  (cost=812.24..812.24 rows=12612 width=12) (actual time=116.335..116.337 rows=12612 loops=1)
                    Buckets: 16384  Batches: 1  Memory Usage: 670kB
                    ->  Subquery Scan on r  (cost=560.00..812.24 rows=12612 width=12) (actual time=110.026..113.685 rows=12612 loops=1)
                          ->  HashAggregate  (cost=560.00..686.12 rows=12612 width=12) (actual time=110.024..112.506 rows=12612 loops=1)
                                Group Key: "Review".product_id
                                Batches: 1  Memory Usage: 1425kB
                                ->  Seq Scan on "Review"  (cost=0.00..460.00 rows=20000 width=4) (actual time=1.079..100.884 rows=20000 loops=1)
Planning Time: 25.795 ms
Execution Time: 184.179 ms


==================================================
EXPLAIN ANALYZE — Query 5: Całkowity Przychód Pogrupowany Miesięcznie za Ostatni Rok
==================================================
Finalize GroupAggregate  (cost=9410.37..11923.61 rows=18977 width=36) (actual time=147.753..241.389 rows=12 loops=1)
  Group Key: ((date_trunc('month'::text, o.order_date))::date)
  ->  Gather Merge  (cost=9410.37..11472.91 rows=15814 width=36) (actual time=147.188..241.346 rows=36 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=8410.34..8647.55 rows=7907 width=36) (actual time=86.370..88.867 rows=12 loops=3)
              Group Key: ((date_trunc('month'::text, o.order_date))::date)
              ->  Sort  (cost=8410.34..8430.11 rows=7907 width=14) (actual time=86.106..86.712 rows=6310 loops=3)
                    Sort Key: ((date_trunc('month'::text, o.order_date))::date) DESC
                    Sort Method: quicksort  Memory: 784kB
                    Worker 0:  Sort Method: quicksort  Memory: 198kB
                    Worker 1:  Sort Method: quicksort  Memory: 187kB
                    ->  Parallel Hash Join  (cost=769.00..7898.41 rows=7907 width=14) (actual time=12.067..84.178 rows=6310 loops=3)
                          Hash Cond: (o.id = oi.order_id)
                          ->  Parallel Seq Scan on "Order" o  (cost=0.00..6252.67 rows=158140 width=12) (actual time=0.014..44.615 rows=126416 loops=3)
                                Filter: (order_date >= (now() - '1 year'::interval))
                                Rows Removed by Filter: 6918
                          ->  Parallel Hash  (cost=621.93..621.93 rows=11765 width=14) (actual time=8.610..8.610 rows=6667 loops=3)
                                Buckets: 32768  Batches: 1  Memory Usage: 1216kB
                                ->  Parallel Index Only Scan using idx_orderitem_variant_order_agg on "OrderItem" oi  (cost=0.29..621.93 rows=11765 width=14) (actual time=2.603..18.806 rows=20000 loops=1)
                                      Heap Fetches: 0
Planning Time: 5.451 ms
Execution Time: 247.795 ms


==================================================
EXPLAIN ANALYZE — Query 6: Produkty najczęściej dodawane do ulubionych
==================================================
Limit  (cost=14382.58..14382.60 rows=10 width=25) (actual time=711.600..772.114 rows=10 loops=1)
  ->  Sort  (cost=14382.58..14432.58 rows=20000 width=25) (actual time=710.683..770.417 rows=10 loops=1)
        Sort Key: (count(f.user_id)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=13750.38..13950.38 rows=20000 width=25) (actual time=703.732..766.708 rows=20000 loops=1)
              Group Key: p.id
              Batches: 1  Memory Usage: 2577kB
              ->  Gather  (cost=9350.38..13550.38 rows=40000 width=25) (actual time=610.258..738.003 rows=59996 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=8350.38..8550.38 rows=20000 width=25) (actual time=566.441..572.848 rows=19999 loops=3)
                          Group Key: p.id
                          Batches: 1  Memory Usage: 2577kB
                          Worker 0:  Batches: 1  Memory Usage: 2577kB
                          Worker 1:  Batches: 1  Memory Usage: 2577kB
                          ->  Hash Join  (cost=688.00..7100.38 rows=250000 width=21) (actual time=10.162..487.441 rows=200000 loops=3)
                                Hash Cond: (f.product_id = p.id)
                                ->  Parallel Seq Scan on "FavoriteProduct" f  (cost=0.00..5756.00 rows=250000 width=8) (actual time=2.566..392.363 rows=200000 loops=3)
                                ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=7.182..7.792 rows=20000 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1215kB
                                      ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.028..2.574 rows=20000 loops=3)
Planning Time: 20.126 ms
Execution Time: 784.235 ms


==================================================
EXPLAIN ANALYZE — Query 7: Dostępny Stan Magazynowy Wariantów Produktu Pogrupowany po Magazynach
==================================================
Finalize GroupAggregate  (cost=8886.64..10869.06 rows=16000 width=61) (actual time=1817.107..2321.426 rows=231755 loops=1)
  Group Key: p.name, w.name, v.sku
  ->  Gather Merge  (cost=8886.64..10575.72 rows=13334 width=61) (actual time=1815.511..2223.021 rows=263598 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=7886.61..8036.62 rows=6667 width=61) (actual time=1784.223..1927.527 rows=87866 loops=3)
              Group Key: p.name, w.name, v.sku
              ->  Sort  (cost=7886.61..7903.28 rows=6667 width=57) (actual time=1783.512..1877.163 rows=106667 loops=3)
                    Sort Key: p.name, w.name, v.sku
                    Sort Method: external merge  Disk: 7144kB
                    Worker 0:  Sort Method: external merge  Disk: 8952kB
                    Worker 1:  Sort Method: external merge  Disk: 5688kB
                    ->  Hash Join  (cost=2543.72..7463.16 rows=6667 width=57) (actual time=165.224..1271.386 rows=106667 loops=3)
                          Hash Cond: (v.product_id = p.id)
                          ->  Hash Join  (cost=1855.72..6757.66 rows=6667 width=48) (actual time=157.832..1211.569 rows=106667 loops=3)
                                Hash Cond: (ssi.variant_id = v.id)
                                ->  Hash Join  (cost=1.23..4885.66 rows=6667 width=25) (actual time=2.712..848.690 rows=106667 loops=3)
                                      Hash Cond: (ssi.warehouse_id = w.id)
                                      ->  Parallel Append  (cost=0.00..4527.02 rows=133333 width=12) (actual time=2.471..738.304 rows=106667 loops=3)
                                            ->  Parallel Seq Scan on "SerialStockItem" ssi  (cost=0.00..2001.16 rows=93816 width=12) (actual time=3.078..315.124 rows=53163 loops=3)
                                            ->  Parallel Seq Scan on "BulkStockItem" bsi  (cost=0.00..1859.19 rows=94419 width=12) (actual time=2.121..612.382 rows=80256 loops=2)
                                      ->  Hash  (cost=1.10..1.10 rows=10 width=21) (actual time=0.220..0.899 rows=10 loops=3)
                                            Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                            ->  Seq Scan on "Warehouse" w  (cost=0.00..1.10 rows=10 width=21) (actual time=0.212..0.539 rows=10 loops=3)
                                ->  Hash  (cost=1267.00..1267.00 rows=47000 width=31) (actual time=153.728..154.083 rows=47000 loops=3)
                                      Buckets: 65536  Batches: 1  Memory Usage: 3450kB
                                      ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=31) (actual time=0.690..131.140 rows=47000 loops=3)
                          ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=7.220..7.220 rows=20000 loops=3)
                                Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                                ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.260..2.858 rows=20000 loops=3)
Planning Time: 16.306 ms
Execution Time: 2346.750 ms


==================================================
EXPLAIN ANALYZE — Query 8: Stan magazynowy per produkt
==================================================
Sort  (cost=19267.36..19316.89 rows=19812 width=21) (actual time=507.856..509.703 rows=17954 loops=1)
  Sort Key: (sum("*SELECT* 1".quantity)) DESC
  Sort Method: quicksort  Memory: 1483kB
  ->  HashAggregate  (cost=17655.24..17853.36 rows=19812 width=21) (actual time=500.568..504.389 rows=17954 loops=1)
        Group Key: p.name
        Batches: 1  Memory Usage: 2065kB
        ->  Hash Join  (cost=2542.50..16055.24 rows=320000 width=17) (actual time=29.285..388.023 rows=320000 loops=1)
              Hash Cond: ("*SELECT* 1".product_id = p.id)
              ->  Append  (cost=1854.50..14527.07 rows=320000 width=8) (actual time=21.843..276.349 rows=320000 loops=1)
                    ->  Subquery Scan on "*SELECT* 1"  (cost=1854.50..6525.95 rows=159488 width=8) (actual time=21.841..129.097 rows=159488 loops=1)
                          ->  Hash Join  (cost=1854.50..4931.07 rows=159488 width=8) (actual time=21.840..113.684 rows=159488 loops=1)
                                Hash Cond: (ssi.variant_id = v.id)
                                ->  Seq Scan on "SerialStockItem" ssi  (cost=0.00..2657.88 rows=159488 width=4) (actual time=0.432..16.416 rows=159488 loops=1)
                                ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=20.866..20.868 rows=47000 loops=1)
                                      Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                      ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.007..13.133 rows=47000 loops=1)
                    ->  Subquery Scan on "*SELECT* 2"  (cost=1854.50..6401.12 rows=160512 width=8) (actual time=13.283..122.805 rows=160512 loops=1)
                          ->  Hash Join  (cost=1854.50..4796.00 rows=160512 width=8) (actual time=13.282..107.553 rows=160512 loops=1)
                                Hash Cond: (bsi.variant_id = v_1.id)
                                ->  Seq Scan on "BulkStockItem" bsi  (cost=0.00..2520.12 rows=160512 width=8) (actual time=0.014..18.924 rows=160512 loops=1)
                                ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=13.077..13.078 rows=47000 loops=1)
                                      Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                      ->  Seq Scan on "Variant" v_1  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.008..5.475 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=6.980..6.980 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.017..2.408 rows=20000 loops=1)
Planning Time: 43.227 ms
Execution Time: 512.559 ms


==================================================
EXPLAIN ANALYZE — Query 9: Najpopularniejsze Kategorie (wg. Całkowitego Przychodu)
==================================================
Limit  (cost=7440.92..7440.95 rows=10 width=44) (actual time=305.674..305.681 rows=1 loops=1)
  ->  Sort  (cost=7440.92..7441.30 rows=150 width=44) (actual time=305.672..305.679 rows=1 loops=1)
        Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
        Sort Method: quicksort  Memory: 25kB
        ->  HashAggregate  (cost=7435.81..7437.68 rows=150 width=44) (actual time=305.029..305.037 rows=1 loops=1)
              Group Key: c.name
              Batches: 1  Memory Usage: 40kB
              ->  Hash Join  (cost=3230.89..6435.81 rows=100000 width=22) (actual time=90.625..296.524 rows=20000 loops=1)
                    Hash Cond: (pc.category_id = c.id)
                    ->  Hash Join  (cost=3225.51..6160.51 rows=100000 width=14) (actual time=89.326..291.243 rows=20000 loops=1)
                          Hash Cond: (pc.product_id = p.id)
                          ->  Seq Scan on "ProductCategory" pc  (cost=0.00..1560.00 rows=100000 width=8) (actual time=1.265..241.655 rows=100000 loops=1)
                          ->  Hash  (cost=2975.51..2975.51 rows=20000 width=18) (actual time=32.644..32.648 rows=20000 loops=1)
                                Buckets: 32768  Batches: 1  Memory Usage: 1272kB
                                ->  Hash Join  (cost=2542.50..2975.51 rows=20000 width=18) (actual time=18.930..29.245 rows=20000 loops=1)
                                      Hash Cond: (v.product_id = p.id)
                                      ->  Hash Join  (cost=1854.50..2235.00 rows=20000 width=14) (actual time=14.102..20.928 rows=20000 loops=1)
                                            Hash Cond: (oi.variant_id = v.id)
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=14) (actual time=0.011..3.239 rows=20000 loops=1)
                                            ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=13.316..13.318 rows=47000 loops=1)
                                                  Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                                  ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.011..5.446 rows=47000 loops=1)
                                      ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=4.814..4.815 rows=20000 loops=1)
                                            Buckets: 32768  Batches: 1  Memory Usage: 960kB
                                            ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.007..2.073 rows=20000 loops=1)
                    ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=1.292..1.293 rows=150 loops=1)
                          Buckets: 1024  Batches: 1  Memory Usage: 16kB
                          ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=0.659..1.262 rows=150 loops=1)
Planning Time: 37.555 ms
Execution Time: 305.785 ms


==================================================
EXPLAIN ANALYZE — Query 10: Liczba produktów per kategoria
==================================================
Sort  (cost=2342.22..2342.59 rows=150 width=20) (actual time=49.801..49.811 rows=150 loops=1)
  Sort Key: (count(pc.product_id)) DESC
  Sort Method: quicksort  Memory: 30kB
  ->  HashAggregate  (cost=2335.30..2336.80 rows=150 width=20) (actual time=49.745..49.768 rows=150 loops=1)
        Group Key: c.name
        Batches: 1  Memory Usage: 48kB
        ->  Hash Right Join  (cost=5.38..1835.30 rows=100000 width=16) (actual time=0.657..29.365 rows=100000 loops=1)
              Hash Cond: (pc.category_id = c.id)
              ->  Seq Scan on "ProductCategory" pc  (cost=0.00..1560.00 rows=100000 width=8) (actual time=0.004..6.741 rows=100000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=0.063..0.065 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 16kB
                    ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=0.014..0.036 rows=150 loops=1)
Planning Time: 0.209 ms
Execution Time: 50.471 ms


==================================================
EXPLAIN ANALYZE — Query 11: Liczba zamówień per metoda płatności
==================================================
Sort  (cost=7798.49..7798.51 rows=6 width=50) (actual time=114.428..122.254 rows=6 loops=1)
  Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  Finalize GroupAggregate  (cost=7796.82..7798.41 rows=6 width=50) (actual time=114.407..122.244 rows=6 loops=1)
        Group Key: pm.name
        ->  Gather Merge  (cost=7796.82..7798.22 rows=12 width=50) (actual time=114.393..122.223 rows=18 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Sort  (cost=6796.80..6796.81 rows=6 width=50) (actual time=77.573..77.577 rows=6 loops=3)
                    Sort Key: pm.name
                    Sort Method: quicksort  Memory: 25kB
                    Worker 0:  Sort Method: quicksort  Memory: 25kB
                    Worker 1:  Sort Method: quicksort  Memory: 25kB
                    ->  Partial HashAggregate  (cost=6796.64..6796.72 rows=6 width=50) (actual time=76.724..76.729 rows=6 loops=3)
                          Group Key: pm.name
                          Batches: 1  Memory Usage: 24kB
                          Worker 0:  Batches: 1  Memory Usage: 24kB
                          Worker 1:  Batches: 1  Memory Usage: 24kB
                          ->  Hash Join  (cost=770.13..6692.48 rows=8333 width=24) (actual time=5.857..73.430 rows=6667 loops=3)
                                Hash Cond: (o.payment_method_id = pm.id)
                                ->  Parallel Hash Join  (cost=769.00..6654.02 rows=8333 width=18) (actual time=5.806..71.548 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.006..29.944 rows=133333 loops=3)
                                      ->  Parallel Hash  (cost=621.93..621.93 rows=11765 width=14) (actual time=5.460..5.461 rows=6667 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1216kB
                                            ->  Parallel Index Only Scan using idx_orderitem_variant_order_agg on "OrderItem" oi  (cost=0.29..621.93 rows=11765 width=14) (actual time=0.694..9.778 rows=20000 loops=1)
                                                  Heap Fetches: 0
                                ->  Hash  (cost=1.06..1.06 rows=6 width=14) (actual time=0.027..0.028 rows=6 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                      ->  Seq Scan on "PaymentMethod" pm  (cost=0.00..1.06 rows=6 width=14) (actual time=0.021..0.022 rows=6 loops=3)
Planning Time: 11.273 ms
Execution Time: 122.335 ms


==================================================
EXPLAIN ANALYZE — Query 12: Średnia ocena per producent
==================================================
Sort  (cost=1367.54..1367.91 rows=150 width=57) (actual time=55.683..55.694 rows=150 loops=1)
  Sort Key: (round(avg(r.rating), 2)) DESC NULLS LAST
  Sort Method: quicksort  Memory: 32kB
  ->  HashAggregate  (cost=1359.87..1362.12 rows=150 width=57) (actual time=55.564..55.628 rows=150 loops=1)
        Group Key: m.name
        Batches: 1  Memory Usage: 64kB
        ->  Hash Join  (cost=693.38..1259.87 rows=20000 width=29) (actual time=5.432..49.031 rows=27388 loops=1)
              Hash Cond: (p.manufacturer_id = m.id)
              ->  Hash Right Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=5.369..43.629 rows=27388 loops=1)
                    Hash Cond: (r.product_id = p.id)
                    ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=0.011..17.407 rows=20000 loops=1)
                    ->  Hash  (cost=438.00..438.00 rows=20000 width=8) (actual time=5.346..5.347 rows=20000 loops=1)
                          Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                          ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=8) (actual time=0.004..2.269 rows=20000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.054..0.054 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 18kB
                    ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.013..0.028 rows=150 loops=1)
Planning Time: 4.260 ms
Execution Time: 55.763 ms


==================================================
EXPLAIN ANALYZE — Query 13: Aktywne promocje i objęta nimi liczba wariantów
==================================================
Sort  (cost=587.95..588.05 rows=42 width=14) (actual time=12.010..12.013 rows=42 loops=1)
  Sort Key: (count(v.id)) DESC
  Sort Method: quicksort  Memory: 26kB
  ->  HashAggregate  (cost=586.40..586.82 rows=42 width=14) (actual time=11.988..11.996 rows=42 loops=1)
        Group Key: pr.name
        Batches: 1  Memory Usage: 24kB
        ->  Merge Join  (cost=7.46..535.87 rows=10105 width=10) (actual time=0.177..11.691 rows=1238 loops=1)
              Merge Cond: (v.promotion_id = pr.id)
              ->  Index Scan using idx_variant_promotion on "Variant" v  (cost=0.29..4233.14 rows=47000 width=8) (actual time=0.015..11.132 rows=5685 loops=1)
              ->  Sort  (cost=7.17..7.27 rows=43 width=10) (actual time=0.049..0.055 rows=43 loops=1)
                    Sort Key: pr.id
                    Sort Method: quicksort  Memory: 26kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=43 width=10) (actual time=0.014..0.037 rows=43 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 157
Planning Time: 14.778 ms
Execution Time: 12.068 ms


==================================================
EXPLAIN ANALYZE — Query 14: Najczęściej wybierane warianty w koszykach
==================================================
Limit  (cost=207700.11..207700.14 rows=10 width=44) (actual time=3059.917..3060.792 rows=10 loops=1)
  ->  Sort  (cost=207700.11..211450.11 rows=1500000 width=44) (actual time=3059.916..3059.919 rows=10 loops=1)
        Sort Key: (sum(ci.quantity)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  GroupAggregate  (cost=3.89..175285.65 rows=1500000 width=44) (actual time=15.957..3050.595 rows=47000 loops=1)
              Group Key: v.sku, p.name
              ->  Incremental Sort  (cost=3.89..149035.65 rows=1500000 width=40) (actual time=8.527..2758.550 rows=1500000 loops=1)
                    Sort Key: v.sku, p.name
                    Presorted Key: v.sku
                    Full-sort Groups: 31708  Sort Method: quicksort  Average Memory: 27kB  Peak Memory: 27kB
                    Pre-sorted Groups: 6442  Sort Method: quicksort  Average Memory: 26kB  Peak Memory: 26kB
                    ->  Nested Loop  (cost=1.14..91874.47 rows=1500000 width=40) (actual time=3.709..2293.695 rows=1500000 loops=1)
                          ->  Nested Loop  (cost=0.71..9221.47 rows=47000 width=40) (actual time=3.698..208.571 rows=47000 loops=1)
                                ->  Index Scan using uix_variant_sku on "Variant" v  (cost=0.41..2458.28 rows=47000 width=31) (actual time=3.127..79.388 rows=47000 loops=1)
                                ->  Memoize  (cost=0.30..0.34 rows=1 width=17) (actual time=0.002..0.002 rows=1 loops=47000)
                                      Cache Key: v.product_id
                                      Cache Mode: logical
                                      Hits: 28889  Misses: 18111  Evictions: 0  Overflows: 0  Memory Usage: 2099kB
                                      ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=17) (actual time=0.004..0.004 rows=1 loops=18111)
                                            Index Cond: (id = v.product_id)
                          ->  Index Only Scan using idx_cartitem_variant_quantity_cover on "CartItem" ci  (cost=0.43..1.43 rows=33 width=8) (actual time=0.003..0.041 rows=32 loops=47000)
                                Index Cond: (variant_id = v.id)
                                Heap Fetches: 150055
Planning Time: 15.504 ms
Execution Time: 3065.265 ms


==================================================
EXPLAIN ANALYZE — Query 15: Produkty z Największą Różnicą Między Ceną Podstawową a Ceną Wariantu
==================================================
Limit  (cost=3211.55..3211.58 rows=10 width=80) (actual time=43.715..43.719 rows=10 loops=1)
  ->  Sort  (cost=3211.55..3329.05 rows=47000 width=80) (actual time=43.713..43.716 rows=10 loops=1)
        Sort Key: v.price_modifier DESC
        Sort Method: top-N heapsort  Memory: 27kB
        ->  Hash Join  (cost=688.00..2195.90 rows=47000 width=80) (actual time=6.284..31.936 rows=47000 loops=1)
              Hash Cond: (v.product_id = p.id)
              ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=33) (actual time=0.017..6.314 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=6.209..6.210 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1381kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.005..2.648 rows=20000 loops=1)
Planning Time: 12.274 ms
Execution Time: 43.762 ms


==================================================
EXPLAIN ANALYZE — Query 16: Konwersja zamówień wg statusu
==================================================
Sort  (cost=7541.77..7541.79 rows=7 width=48) (actual time=155.781..245.656 rows=7 loops=1)
  Sort Key: (count(o.id)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  WindowAgg  (cost=7541.33..7541.67 rows=7 width=48) (actual time=155.769..245.648 rows=7 loops=1)
        ->  Finalize GroupAggregate  (cost=7539.74..7541.51 rows=7 width=16) (actual time=154.873..244.758 rows=7 loops=1)
              Group Key: s.name
              ->  Gather Merge  (cost=7539.74..7541.37 rows=14 width=16) (actual time=154.856..243.574 rows=21 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Sort  (cost=6539.71..6539.73 rows=7 width=16) (actual time=87.100..87.104 rows=7 loops=3)
                          Sort Key: s.name
                          Sort Method: quicksort  Memory: 25kB
                          Worker 0:  Sort Method: quicksort  Memory: 25kB
                          Worker 1:  Sort Method: quicksort  Memory: 25kB
                          ->  Partial HashAggregate  (cost=6539.55..6539.62 rows=7 width=16) (actual time=85.857..85.862 rows=7 loops=3)
                                Group Key: s.name
                                Batches: 1  Memory Usage: 24kB
                                Worker 0:  Batches: 1  Memory Usage: 24kB
                                Worker 1:  Batches: 1  Memory Usage: 24kB
                                ->  Hash Join  (cost=1.16..5706.21 rows=166667 width=12) (actual time=2.667..51.265 rows=133333 loops=3)
                                      Hash Cond: (o.status_id = s.id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.007..16.428 rows=133333 loops=3)
                                      ->  Hash  (cost=1.07..1.07 rows=7 width=12) (actual time=2.375..2.376 rows=7 loops=3)
                                            Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                            ->  Seq Scan on "Status" s  (cost=0.00..1.07 rows=7 width=12) (actual time=2.364..2.366 rows=7 loops=3)
Planning Time: 4.217 ms
Execution Time: 251.643 ms


==================================================
EXPLAIN ANALYZE — Query 17: Top klienci wg wydatków
==================================================
Limit  (cost=15389.43..15389.45 rows=10 width=50) (actual time=3517.708..3531.136 rows=10 loops=1)
  ->  Sort  (cost=15389.43..15439.43 rows=20000 width=50) (actual time=3517.707..3530.826 rows=10 loops=1)
        Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=14707.24..14957.24 rows=20000 width=50) (actual time=3492.987..3524.287 rows=19296 loops=1)
              Group Key: u.id
              Batches: 5  Memory Usage: 8241kB  Disk Usage: 224kB
              ->  Gather  (cost=12811.48..14582.24 rows=16666 width=50) (actual time=2862.260..3129.934 rows=19435 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=11811.48..11915.64 rows=8333 width=50) (actual time=2762.602..2887.196 rows=6478 loops=3)
                          Group Key: u.id
                          Batches: 1  Memory Usage: 3217kB
                          Worker 0:  Batches: 1  Memory Usage: 2961kB
                          Worker 1:  Batches: 1  Memory Usage: 2961kB
                          ->  Nested Loop  (cost=769.42..11728.15 rows=8333 width=28) (actual time=14.024..2674.071 rows=6667 loops=3)
                                ->  Parallel Hash Join  (cost=769.00..6654.02 rows=8333 width=14) (actual time=3.670..154.570 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.009..71.790 rows=133333 loops=3)
                                      ->  Parallel Hash  (cost=621.93..621.93 rows=11765 width=14) (actual time=3.214..4.355 rows=6667 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1216kB
                                            ->  Parallel Index Only Scan using idx_orderitem_variant_order_agg on "OrderItem" oi  (cost=0.29..621.93 rows=11765 width=14) (actual time=0.015..3.463 rows=20000 loops=1)
                                                  Heap Fetches: 0
                                ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.371..0.371 rows=1 loops=20000)
                                      Index Cond: (id = o.user_id)
Planning Time: 18.618 ms
Execution Time: 3544.571 ms


==================================================
EXPLAIN ANALYZE — Query 18: Produkty z wariantami objętymi promocją, z końcową ceną
==================================================
Sort  (cost=2074.11..2099.37 rows=10105 width=132) (actual time=85.847..86.864 rows=1238 loops=1)
  Sort Key: (round(((p.price + v.price_modifier) * ('1'::numeric - pr.discount_percentage)), 2))
  Sort Method: quicksort  Memory: 139kB
  ->  Hash Join  (cost=695.46..1401.98 rows=10105 width=132) (actual time=35.533..84.886 rows=1238 loops=1)
        Hash Cond: (v.product_id = p.id)
        ->  Merge Join  (cost=7.46..535.87 rows=10105 width=39) (actual time=9.371..56.722 rows=1238 loops=1)
              Merge Cond: (v.promotion_id = pr.id)
              ->  Index Scan using idx_variant_promotion on "Variant" v  (cost=0.29..4233.14 rows=47000 width=37) (actual time=0.620..54.676 rows=5685 loops=1)
              ->  Sort  (cost=7.17..7.27 rows=43 width=10) (actual time=1.440..1.457 rows=43 loops=1)
                    Sort Key: pr.id
                    Sort Method: quicksort  Memory: 26kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=43 width=10) (actual time=1.402..1.425 rows=43 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 157
        ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=26.135..26.136 rows=20000 loops=1)
              Buckets: 32768  Batches: 1  Memory Usage: 1381kB
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.017..11.728 rows=20000 loops=1)
Planning Time: 35.532 ms
Execution Time: 87.472 ms


==================================================
EXPLAIN ANALYZE — Query 19: Użytkownicy, Którzy Dodali Produkt do Koszyka, Ale Nie Złożyli Zamówienia (Potencjał Odbudowy Koszyka)
==================================================
Hash Join  (cost=46254.21..103988.81 rows=1068640 width=55) (actual time=3850.690..6601.596 rows=1005006 loops=1)
  Hash Cond: (v.product_id = p.id)
  ->  Hash Join  (cost=45566.21..100495.04 rows=1068640 width=46) (actual time=3840.717..6055.256 rows=1005006 loops=1)
        Hash Cond: (ci.variant_id = v.id)
        ->  Hash Join  (cost=43711.71..95835.11 rows=1068640 width=46) (actual time=3812.234..5300.379 rows=1005006 loops=1)
              Hash Cond: (ci.cart_id = c.id)
              ->  Seq Scan on "CartItem" ci  (cost=0.00..23152.00 rows=1500000 width=8) (actual time=1.666..676.312 rows=1500000 loops=1)
              ->  Hash  (cost=41435.91..41435.91 rows=106864 width=46) (actual time=3796.102..3813.054 rows=100414 loops=1)
                    Buckets: 131072  Batches: 2  Memory Usage: 4929kB
                    ->  Gather  (cost=25017.67..41435.91 rows=106864 width=46) (actual time=3473.959..3609.634 rows=100414 loops=1)
                          Workers Planned: 2
                          Workers Launched: 2
                          ->  Parallel Hash Right Anti Join  (cost=24017.67..29749.51 rows=44527 width=46) (actual time=3094.539..3107.539 rows=33471 loops=3)
                                Hash Cond: (o.user_id = u.id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=4) (actual time=1.952..378.718 rows=133333 loops=3)
                                ->  Parallel Hash  (cost=23236.42..23236.42 rows=62500 width=50) (actual time=2306.490..2306.918 rows=50000 loops=3)
                                      Buckets: 262144  Batches: 1  Memory Usage: 14688kB
                                      ->  Hash Join  (cost=4079.00..23236.42 rows=62500 width=50) (actual time=133.512..2002.011 rows=50000 loops=3)
                                            Hash Cond: (u.id = c.user_id)
                                            ->  Parallel Seq Scan on "User" u  (cost=0.00..18063.67 rows=416667 width=46) (actual time=0.553..1307.139 rows=333333 loops=3)
                                            ->  Hash  (cost=2204.00..2204.00 rows=150000 width=8) (actual time=107.934..107.935 rows=150000 loops=3)
                                                  Buckets: 262144  Batches: 1  Memory Usage: 7908kB
                                                  ->  Seq Scan on "Cart" c  (cost=0.00..2204.00 rows=150000 width=8) (actual time=8.811..66.415 rows=150000 loops=3)
        ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=24.387..24.388 rows=47000 loops=1)
              Buckets: 65536  Batches: 1  Memory Usage: 2348kB
              ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.011..16.748 rows=47000 loops=1)
  ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=6.963..6.963 rows=20000 loops=1)
        Buckets: 32768  Batches: 1  Memory Usage: 1245kB
        ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=1.323..3.669 rows=20000 loops=1)
Planning Time: 46.905 ms
Execution Time: 6735.525 ms


==================================================
EXPLAIN ANALYZE — Query 20: Wyszukiwanie produktów po nazwie lub opisie (parametryzowane)
==================================================
Bitmap Heap Scan on "Product"  (cost=43.00..57.51 rows=4 width=60) (actual time=9.446..25.096 rows=143 loops=1)
  Recheck Cond: (((name)::text ~~* '%test%'::text) OR (description ~~* '%test%'::text))
  Heap Blocks: exact=106
  ->  BitmapOr  (cost=43.00..43.00 rows=4 width=0) (actual time=9.411..9.412 rows=0 loops=1)
        ->  Bitmap Index Scan on idx_product_name_trgm  (cost=0.00..21.50 rows=2 width=0) (actual time=5.457..5.458 rows=42 loops=1)
              Index Cond: ((name)::text ~~* '%test%'::text)
        ->  Bitmap Index Scan on idx_product_description_trgm  (cost=0.00..21.50 rows=2 width=0) (actual time=3.947..3.948 rows=102 loops=1)
              Index Cond: (description ~~* '%test%'::text)
Planning Time: 126.217 ms
Execution Time: 30.042 ms


==================================================
EXPLAIN ANALYZE — Query 21: Użytkownicy, Którzy Zapisali Konkretny Produkt jako Ulubiony (np. Product ID=350259)
==================================================
Nested Loop  (cost=0.85..262.23 rows=30 width=56) (actual time=3.640..19.400 rows=26 loops=1)
  ->  Index Only Scan using idx_favoriteproduct_product_user on "FavoriteProduct" fp  (cost=0.42..8.95 rows=30 width=4) (actual time=3.593..3.602 rows=26 loops=1)
        Index Cond: (product_id = 35)
        Heap Fetches: 0
  ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..8.44 rows=1 width=60) (actual time=0.607..0.607 rows=1 loops=26)
        Index Cond: (id = fp.user_id)
Planning Time: 19.830 ms
Execution Time: 19.438 ms


==================================================
EXPLAIN ANALYZE — Query 22: Znajdź Magazyny, Które Posiadają Zapasy Konkretnego Wariantu (np. SKU='VR-000000-a637d44b7afd')
==================================================
Sort  (cost=27.64..27.64 rows=2 width=25) (actual time=3.732..3.735 rows=0 loops=1)
  Sort Key: (sum("*SELECT* 1".stock_units)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  GroupAggregate  (cost=27.51..27.63 rows=2 width=25) (actual time=3.114..3.116 rows=0 loops=1)
        Group Key: w.name
        Filter: (sum("*SELECT* 1".stock_units) > 0)
        ->  Sort  (cost=27.51..27.52 rows=6 width=21) (actual time=3.113..3.115 rows=0 loops=1)
              Sort Key: w.name
              Sort Method: quicksort  Memory: 25kB
              ->  Hash Join  (cost=2.06..27.43 rows=6 width=21) (actual time=3.099..3.101 rows=0 loops=1)
                    Hash Cond: ("*SELECT* 1".warehouse_id = w.id)
                    ->  Append  (cost=0.83..26.18 rows=6 width=8) (actual time=3.098..3.100 rows=0 loops=1)
                          ->  Subquery Scan on "*SELECT* 1"  (cost=0.83..13.08 rows=3 width=8) (actual time=3.081..3.082 rows=0 loops=1)
                                ->  Nested Loop  (cost=0.83..13.05 rows=3 width=8) (actual time=3.081..3.081 rows=0 loops=1)
                                      ->  Index Scan using uix_variant_sku on "Variant" v  (cost=0.41..8.43 rows=1 width=4) (actual time=3.080..3.080 rows=0 loops=1)
                                            Index Cond: ((sku)::text = 'VR-000001-2704de10f283'::text)
                                      ->  Index Only Scan using idx_bsi_variant_warehouse_qty on "BulkStockItem" bsi  (cost=0.42..4.54 rows=7 width=12) (never executed)
                                            Index Cond: (variant_id = v.id)
                                            Heap Fetches: 0
                          ->  Subquery Scan on "*SELECT* 2"  (cost=0.83..13.08 rows=3 width=8) (actual time=0.015..0.016 rows=0 loops=1)
                                ->  Nested Loop  (cost=0.83..13.05 rows=3 width=8) (actual time=0.014..0.015 rows=0 loops=1)
                                      ->  Index Scan using uix_variant_sku on "Variant" v_1  (cost=0.41..8.43 rows=1 width=4) (actual time=0.014..0.014 rows=0 loops=1)
                                            Index Cond: ((sku)::text = 'VR-000001-2704de10f283'::text)
                                      ->  Index Only Scan using idx_ssi_variant_warehouse on "SerialStockItem" ssi  (cost=0.42..4.54 rows=7 width=8) (never executed)
                                            Index Cond: (variant_id = v_1.id)
                                            Heap Fetches: 0
                    ->  Hash  (cost=1.10..1.10 rows=10 width=21) (never executed)
                          ->  Seq Scan on "Warehouse" w  (cost=0.00..1.10 rows=10 width=21) (never executed)
Planning Time: 16.470 ms
Execution Time: 3.815 ms


==================================================
EXPLAIN ANALYZE — Query 23: Warianty, Które Wymagają Uzyskania Konkretnej Opcji (np. 'Kolor'='Czerwony')
==================================================
Nested Loop  (cost=6.81..677.99 rows=8 width=36) (actual time=0.017..0.018 rows=0 loops=1)
  ->  Nested Loop  (cost=6.52..675.35 rows=8 width=27) (actual time=0.017..0.017 rows=0 loops=1)
        ->  Nested Loop  (cost=6.23..672.76 rows=8 width=4) (actual time=0.017..0.017 rows=0 loops=1)
              Join Filter: (opt.attribute_id = a.id)
              ->  Seq Scan on "Attribute" a  (cost=0.00..1.38 rows=1 width=4) (actual time=0.016..0.017 rows=0 loops=1)
                    Filter: ((name)::text = 'Attr_49_Century'::text)
                    Rows Removed by Filter: 30
              ->  Nested Loop  (cost=6.23..668.26 rows=250 width=8) (never executed)
                    ->  Seq Scan on "Option" opt  (cost=0.00..18.50 rows=1 width=8) (never executed)
                          Filter: ((value)::text = 'do'::text)
                    ->  Bitmap Heap Scan on "VariantOption" vo  (cost=6.23..647.26 rows=250 width=8) (never executed)
                          Recheck Cond: (option_id = opt.id)
                          ->  Bitmap Index Scan on idx_variantoption_option_id  (cost=0.00..6.17 rows=250 width=0) (never executed)
                                Index Cond: (option_id = opt.id)
        ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.32 rows=1 width=31) (never executed)
              Index Cond: (id = vo.variant_id)
  ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=17) (never executed)
        Index Cond: (id = v.product_id)
Planning Time: 45.704 ms
Execution Time: 0.097 ms


==================================================
EXPLAIN ANALYZE — Query 24: Znajdź Zamówienia Użytkownika (np. email='debbie.lane.16786.50af0753@example.com') o Statusie 'Paid'
==================================================
Nested Loop  (cost=0.98..17.07 rows=1 width=20) (actual time=3.100..3.101 rows=0 loops=1)
  ->  Nested Loop  (cost=0.85..16.89 rows=1 width=16) (actual time=3.100..3.100 rows=0 loops=1)
        ->  Index Scan using "User_email_key" on "User" u  (cost=0.42..8.44 rows=1 width=4) (actual time=3.099..3.100 rows=0 loops=1)
              Index Cond: ((email)::text = 'debbie.lane.16786.50af0753@example.com'::text)
        ->  Index Scan using idx_order_user on "Order" o  (cost=0.42..8.44 rows=1 width=20) (never executed)
              Index Cond: (user_id = u.id)
  ->  Index Scan using "Status_pkey" on "Status" s  (cost=0.13..0.15 rows=1 width=12) (never executed)
        Index Cond: (id = o.status_id)
        Filter: ((name)::text = 'Paid'::text)
Planning Time: 4.285 ms
Execution Time: 3.143 ms


==================================================
EXPLAIN ANALYZE — Query 25: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
Hash Left Join  (cost=6.97..48.34 rows=16 width=87) (actual time=1.401..8.530 rows=18 loops=1)
  Hash Cond: (opt.attribute_id = a.id)
  ->  Nested Loop Left Join  (cost=5.30..46.57 rows=16 width=45) (actual time=0.765..7.870 rows=18 loops=1)
        ->  Nested Loop Left Join  (cost=5.02..41.89 rows=16 width=39) (actual time=0.735..6.593 rows=18 loops=1)
              ->  Nested Loop  (cost=4.60..24.13 rows=3 width=39) (actual time=0.035..0.638 rows=4 loops=1)
                    ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..8.30 rows=1 width=10) (actual time=0.012..0.013 rows=1 loops=1)
                          Index Cond: (id = 35)
                    ->  Bitmap Heap Scan on "Variant" v  (cost=4.31..15.80 rows=3 width=37) (actual time=0.021..0.620 rows=4 loops=1)
                          Recheck Cond: (product_id = 35)
                          Heap Blocks: exact=4
                          ->  Bitmap Index Scan on idx_variant_product  (cost=0.00..4.31 rows=3 width=0) (actual time=0.011..0.011 rows=4 loops=1)
                                Index Cond: (product_id = 35)
              ->  Index Only Scan using uq_varopt_variant_option on "VariantOption" vo  (cost=0.42..5.86 rows=6 width=8) (actual time=1.484..1.486 rows=4 loops=4)
                    Index Cond: (variant_id = v.id)
                    Heap Fetches: 0
        ->  Index Scan using "Option_pkey" on "Option" opt  (cost=0.28..0.29 rows=1 width=14) (actual time=0.070..0.070 rows=1 loops=18)
              Index Cond: (id = vo.option_id)
  ->  Hash  (cost=1.30..1.30 rows=30 width=18) (actual time=0.026..0.026 rows=30 loops=1)
        Buckets: 1024  Batches: 1  Memory Usage: 10kB
        ->  Seq Scan on "Attribute" a  (cost=0.00..1.30 rows=30 width=18) (actual time=0.011..0.014 rows=30 loops=1)
Planning Time: 0.581 ms
Execution Time: 8.594 ms


==================================================
EXPLAIN ANALYZE — Query 26: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
Hash Left Join  (cost=6.97..48.42 rows=16 width=87) (actual time=0.007..0.008 rows=0 loops=1)
  Hash Cond: (opt.attribute_id = a.id)
  ->  Nested Loop Left Join  (cost=5.30..46.57 rows=16 width=45) (actual time=0.007..0.007 rows=0 loops=1)
        ->  Nested Loop Left Join  (cost=5.02..41.89 rows=16 width=39) (actual time=0.006..0.007 rows=0 loops=1)
              ->  Nested Loop  (cost=4.60..24.13 rows=3 width=39) (actual time=0.006..0.007 rows=0 loops=1)
                    ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..8.30 rows=1 width=10) (actual time=0.006..0.006 rows=0 loops=1)
                          Index Cond: (id = 350259)
                    ->  Bitmap Heap Scan on "Variant" v  (cost=4.31..15.80 rows=3 width=37) (never executed)
                          Recheck Cond: (product_id = 350259)
                          ->  Bitmap Index Scan on idx_variant_product  (cost=0.00..4.31 rows=3 width=0) (never executed)
                                Index Cond: (product_id = 350259)
              ->  Index Only Scan using uq_varopt_variant_option on "VariantOption" vo  (cost=0.42..5.86 rows=6 width=8) (never executed)
                    Index Cond: (variant_id = v.id)
                    Heap Fetches: 0
        ->  Index Scan using "Option_pkey" on "Option" opt  (cost=0.28..0.29 rows=1 width=14) (never executed)
              Index Cond: (id = vo.option_id)
  ->  Hash  (cost=1.30..1.30 rows=30 width=18) (never executed)
        ->  Seq Scan on "Attribute" a  (cost=0.00..1.30 rows=30 width=18) (never executed)
Planning Time: 0.559 ms
Execution Time: 0.047 ms


==================================================
EXPLAIN ANALYZE — Query 27: Lista Wszystkich Dziecięcych Kategorii (Podkategorii) dla Konkretnej Kategorii Nadrzędnej (np. ID=5)
==================================================
Seq Scan on "Category"  (cost=0.00..3.88 rows=3 width=12) (actual time=2.243..2.801 rows=3 loops=1)
  Filter: (parent_id = 5)
  Rows Removed by Filter: 147
Planning Time: 1.966 ms
Execution Time: 2.820 ms


==================================================
EXPLAIN ANALYZE — Query 28: Porównanie Średniej Oceny dla Promowanych i Niepromowanych Produktów
==================================================
HashAggregate  (cost=87850.51..87853.01 rows=200 width=64) (actual time=112.508..112.513 rows=2 loops=1)
  Group Key: CASE WHEN (ANY (p.id = (hashed SubPlan 2).col1)) THEN 'Promowany'::text ELSE 'Niepromowany'::text END
  Batches: 1  Memory Usage: 40kB
  ->  HashAggregate  (cost=1300.51..87550.51 rows=20000 width=68) (actual time=102.458..109.454 rows=12612 loops=1)
        Group Key: p.id
        Batches: 1  Memory Usage: 2577kB
        ->  Hash Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=42.853..82.103 rows=20000 loops=1)
              Hash Cond: (r.product_id = p.id)
              ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=0.626..31.913 rows=20000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=42.189..42.190 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 960kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.007..37.480 rows=20000 loops=1)
        SubPlan 2
          ->  Index Only Scan using idx_variant_product_promotion on "Variant" v2  (cost=0.28..215.94 rows=5577 width=4) (actual time=2.237..9.963 rows=5684 loops=1)
                Heap Fetches: 0
Planning Time: 5.509 ms
Execution Time: 113.211 ms


==================================================
EXPLAIN ANALYZE — Query 29: Top 5 Miast Generujących Największy Przychód (Wg. Adresu Wysyłki)
==================================================
Limit  (cost=15305.18..15305.19 rows=5 width=45) (actual time=4037.098..4146.336 rows=5 loops=1)
  ->  Sort  (cost=15305.18..15355.18 rows=20000 width=45) (actual time=4037.088..4145.075 rows=5 loops=1)
        Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=14722.99..14972.99 rows=20000 width=45) (actual time=4027.941..4141.216 rows=12950 loops=1)
              Group Key: a.city
              Batches: 1  Memory Usage: 5905kB
              ->  Gather  (cost=12827.23..14597.99 rows=16666 width=45) (actual time=3908.497..4087.277 rows=16090 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=11827.23..11931.39 rows=8333 width=45) (actual time=3884.477..3891.586 rows=5363 loops=3)
                          Group Key: a.city
                          Batches: 1  Memory Usage: 2449kB
                          Worker 0:  Batches: 1  Memory Usage: 2449kB
                          Worker 1:  Batches: 1  Memory Usage: 2449kB
                          ->  Nested Loop  (cost=769.42..11743.90 rows=8333 width=23) (actual time=12.333..3862.166 rows=6667 loops=3)
                                ->  Parallel Hash Join  (cost=769.00..6654.02 rows=8333 width=14) (actual time=9.950..86.410 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.009..17.193 rows=133333 loops=3)
                                      ->  Parallel Hash  (cost=621.93..621.93 rows=11765 width=14) (actual time=9.612..9.776 rows=6667 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1248kB
                                            ->  Parallel Index Only Scan using idx_orderitem_variant_order_agg on "OrderItem" oi  (cost=0.29..621.93 rows=11765 width=14) (actual time=1.496..10.784 rows=10000 loops=2)
                                                  Heap Fetches: 0
                                ->  Index Scan using "Address_pkey" on "Address" a  (cost=0.43..0.61 rows=1 width=17) (actual time=0.565..0.565 rows=1 loops=20000)
                                      Index Cond: (id = o.shipping_address_id)
Planning Time: 26.722 ms
Execution Time: 4149.574 ms


==================================================
EXPLAIN ANALYZE — Query 30: Porównanie Wolumenu Sprzedaży Produktów Promowanych vs. Niepromowanych (w Ostatnich 30 Dniach)
==================================================
GroupAggregate  (cost=4663.49..4670.09 rows=200 width=40) (actual time=63.509..63.512 rows=1 loops=1)
  Group Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
  ->  Sort  (cost=4663.49..4665.02 rows=614 width=36) (actual time=63.387..63.421 rows=619 loops=1)
        Sort Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
        Sort Method: quicksort  Memory: 49kB
        ->  Nested Loop  (cost=3936.36..4635.05 rows=614 width=36) (actual time=25.507..63.266 rows=619 loops=1)
              ->  Hash Join  (cost=3936.07..4316.57 rows=614 width=8) (actual time=25.487..62.168 rows=619 loops=1)
                    Hash Cond: (oi.order_id = o.id)
                    ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=12) (actual time=1.297..34.649 rows=20000 loops=1)
                    ->  Hash  (cost=3782.55..3782.55 rows=12282 width=4) (actual time=24.171..24.172 rows=12324 loops=1)
                          Buckets: 16384  Batches: 1  Memory Usage: 562kB
                          ->  Bitmap Heap Scan on "Order" o  (cost=231.61..3782.55 rows=12282 width=4) (actual time=15.444..22.312 rows=12324 loops=1)
                                Recheck Cond: (order_date >= (now() - '30 days'::interval))
                                Heap Blocks: exact=3270
                                ->  Bitmap Index Scan on idx_order_date  (cost=0.00..228.54 rows=12282 width=0) (actual time=15.064..15.065 rows=12324 loops=1)
                                      Index Cond: (order_date >= (now() - '30 days'::interval))
              ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.52 rows=1 width=8) (actual time=0.001..0.001 rows=1 loops=619)
                    Index Cond: (id = oi.variant_id)
Planning Time: 5.280 ms
Execution Time: 63.575 ms


==================================================
EXPLAIN ANALYZE — Query 31: Wskaźnik Lojalności (Repeat Purchase Rate) Użytkowników z Podziałem na Miasto Adresu Rozliczeniowego
==================================================
Sort  (cost=128699.75..128773.84 rows=29636 width=61) (actual time=5011.701..5195.223 rows=66456 loops=1)
  Sort Key: (round((((count(*) FILTER (WHERE (u.orders_count > 1)))::numeric * 100.0) / (NULLIF(count(DISTINCT o.user_id), 0))::numeric), 2)) DESC
  Sort Method: external merge  Disk: 3192kB
  ->  GroupAggregate  (cost=75171.04..126498.53 rows=29636 width=61) (actual time=4348.339..5048.083 rows=66456 loops=1)
        Group Key: a.city
        ->  Gather Merge  (cost=75171.04..121757.63 rows=400000 width=25) (actual time=4330.323..4849.312 rows=400000 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Sort  (cost=74171.01..74587.68 rows=166667 width=25) (actual time=4093.626..4185.709 rows=133333 loops=3)
                    Sort Key: a.city, o.user_id
                    Sort Method: external merge  Disk: 5456kB
                    Worker 0:  Sort Method: external merge  Disk: 5232kB
                    Worker 1:  Sort Method: external merge  Disk: 4640kB
                    ->  Parallel Hash Join  (cost=34868.03..55725.48 rows=166667 width=25) (actual time=1415.462..3505.975 rows=133333 loops=3)
                          Hash Cond: (a.id = o.billing_address_id)
                          ->  Parallel Seq Scan on "Address" a  (cost=0.00..18288.00 rows=500000 width=17) (actual time=7.491..1374.518 rows=400000 loops=3)
                          ->  Parallel Hash  (cost=32784.69..32784.69 rows=166667 width=16) (actual time=1405.497..1407.481 rows=133333 loops=3)
                                Buckets: 524288  Batches: 1  Memory Usage: 22912kB
                                ->  Hash Join  (cost=24635.51..32784.69 rows=166667 width=16) (actual time=804.869..1161.836 rows=133333 loops=3)
                                      Hash Cond: (o.user_id = u.user_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.016..110.001 rows=133333 loops=3)
                                      ->  Hash  (cost=19635.86..19635.86 rows=287572 width=12) (actual time=771.664..772.959 rows=329619 loops=3)
                                            Buckets: 262144  Batches: 4  Memory Usage: 5596kB
                                            ->  Subquery Scan on u  (cost=0.42..19635.86 rows=287572 width=12) (actual time=2.646..637.015 rows=329619 loops=3)
                                                  ->  GroupAggregate  (cost=0.42..16760.14 rows=287572 width=12) (actual time=2.645..603.032 rows=329619 loops=3)
                                                        Group Key: "Order".user_id
                                                        ->  Index Only Scan using idx_order_user on "Order"  (cost=0.42..11884.42 rows=400000 width=4) (actual time=2.630..505.687 rows=400000 loops=3)
                                                              Heap Fetches: 150240
Planning Time: 5.756 ms
Execution Time: 5286.946 ms

FINISHED — 2025-12-02 21:09:50.233144
========================================================================================================================
========================================================================================================================
START EXPLAIN RUN — 2025-12-02 21:12:08.489843
========================================================================================================================


==================================================
EXPLAIN ANALYZE — Query 1: Średnia Wartość Zamówienia (AOV) w Ostatnim Miesiącu
==================================================
Aggregate  (cost=4367.96..4367.97 rows=1 width=32) (actual time=448.989..448.991 rows=1 loops=1)
  ->  GroupAggregate  (cost=4344.93..4360.28 rows=614 width=36) (actual time=448.450..448.937 rows=608 loops=1)
        Group Key: o.id
        ->  Sort  (cost=4344.93..4346.47 rows=614 width=14) (actual time=448.429..448.476 rows=619 loops=1)
              Sort Key: o.id
              Sort Method: quicksort  Memory: 44kB
              ->  Hash Join  (cost=3936.00..4316.50 rows=614 width=14) (actual time=433.207..448.254 rows=619 loops=1)
                    Hash Cond: (oi.order_id = o.id)
                    ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=14) (actual time=1.204..13.386 rows=20000 loops=1)
                    ->  Hash  (cost=3782.50..3782.50 rows=12280 width=4) (actual time=431.935..431.936 rows=12322 loops=1)
                          Buckets: 16384  Batches: 1  Memory Usage: 562kB
                          ->  Bitmap Heap Scan on "Order" o  (cost=231.60..3782.50 rows=12280 width=4) (actual time=7.142..428.869 rows=12322 loops=1)
                                Recheck Cond: (order_date >= (now() - '1 mon'::interval))
                                Heap Blocks: exact=3270
                                ->  Bitmap Index Scan on idx_order_date  (cost=0.00..228.53 rows=12280 width=0) (actual time=6.174..6.174 rows=12322 loops=1)
                                      Index Cond: (order_date >= (now() - '1 mon'::interval))
Planning Time: 36.213 ms
Execution Time: 449.135 ms


==================================================
EXPLAIN ANALYZE — Query 2: Średnia wartość zamówienia per użytkownik - ZOPTYMALIZOWANA
==================================================
Sort  (cost=16166.87..16215.61 rows=19495 width=50) (actual time=4428.747..4462.324 rows=19296 loops=1)
  Sort Key: (round(avg(oi_sum.total_price), 2)) DESC
  Sort Method: quicksort  Memory: 1612kB
  ->  Finalize HashAggregate  (cost=14485.35..14777.77 rows=19495 width=50) (actual time=4390.908..4447.117 rows=19296 loops=1)
        Group Key: u.id
        Batches: 5  Memory Usage: 8241kB  Disk Usage: 224kB
        ->  Gather  (cost=12637.36..14363.50 rows=16246 width=50) (actual time=4239.748..4325.147 rows=19419 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial HashAggregate  (cost=11637.36..11738.90 rows=8123 width=50) (actual time=4225.714..4230.823 rows=6473 loops=3)
                    Group Key: u.id
                    Batches: 1  Memory Usage: 3217kB
                    Worker 0:  Batches: 1  Memory Usage: 2961kB
                    Worker 1:  Batches: 1  Memory Usage: 2961kB
                    ->  Nested Loop  (cost=1210.75..11596.75 rows=8123 width=50) (actual time=75.241..4141.050 rows=6498 loops=3)
                          ->  Hash Join  (cost=1210.33..6650.49 rows=8123 width=36) (actual time=59.307..231.152 rows=6498 loops=3)
                                Hash Cond: (o.id = oi_sum.order_id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.008..66.138 rows=133333 loops=3)
                                ->  Hash  (cost=966.64..966.64 rows=19495 width=36) (actual time=59.204..60.629 rows=19495 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1094kB
                                      ->  Subquery Scan on oi_sum  (cost=528.00..966.64 rows=19495 width=36) (actual time=41.390..54.964 rows=19495 loops=3)
                                            ->  HashAggregate  (cost=528.00..771.69 rows=19495 width=36) (actual time=41.390..53.133 rows=19495 loops=3)
                                                  Group Key: "OrderItem".order_id
                                                  Batches: 1  Memory Usage: 7953kB
                                                  Worker 0:  Batches: 1  Memory Usage: 7953kB
                                                  Worker 1:  Batches: 1  Memory Usage: 7953kB
                                                  ->  Seq Scan on "OrderItem"  (cost=0.00..328.00 rows=20000 width=14) (actual time=0.024..5.445 rows=20000 loops=3)
                          ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.595..0.595 rows=1 loops=19495)
                                Index Cond: (id = o.user_id)
Planning Time: 19.045 ms
Execution Time: 4497.770 ms


==================================================
EXPLAIN ANALYZE — Query 3: Top 10 Najlepiej Sprzedających Się Produktów (wg. Ilości Sprzedanych Jednostek) w Ostatnim Kwartale
==================================================
Limit  (cost=9140.17..9140.19 rows=10 width=46) (actual time=106.640..169.953 rows=1 loops=1)
  ->  Sort  (cost=9140.17..9150.12 rows=3980 width=46) (actual time=106.639..169.950 rows=1 loops=1)
        Sort Key: (sum(oi.quantity)) DESC
        Sort Method: quicksort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=9014.36..9054.16 rows=3980 width=46) (actual time=104.904..168.245 rows=1 loops=1)
              Group Key: p.name, m.name
              Batches: 1  Memory Usage: 217kB
              ->  Gather  (cost=8641.31..8989.49 rows=3316 width=46) (actual time=102.697..168.199 rows=3 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=7641.31..7657.89 rows=1658 width=46) (actual time=68.508..68.518 rows=1 loops=3)
                          Group Key: p.name, m.name
                          Batches: 1  Memory Usage: 73kB
                          Worker 0:  Batches: 1  Memory Usage: 73kB
                          Worker 1:  Batches: 1  Memory Usage: 73kB
                          ->  Hash Join  (cost=2077.32..7628.88 rows=1658 width=42) (actual time=35.424..64.451 rows=1324 loops=3)
                                Hash Cond: (p.manufacturer_id = m.id)
                                ->  Nested Loop  (cost=2071.94..7619.03 rows=1658 width=21) (actual time=34.705..63.395 rows=1324 loops=3)
                                      ->  Nested Loop  (cost=2071.66..7071.71 rows=1658 width=8) (actual time=31.464..54.152 rows=1324 loops=3)
                                            ->  Hash Join  (cost=2071.37..6211.71 rows=1658 width=8) (actual time=30.781..49.542 rows=1324 loops=3)
                                                  Hash Cond: (o.id = oi.order_id)
                                                  ->  Parallel Bitmap Heap Scan on "Order" o  (cost=1493.37..5409.82 rows=33169 width=4) (actual time=21.939..34.862 rows=26376 loops=3)
                                                        Recheck Cond: (order_date >= (now() - '3 mons'::interval))
                                                        Heap Blocks: exact=1819
                                                        ->  Bitmap Index Scan on idx_order_date  (cost=0.00..1473.46 rows=79605 width=0) (actual time=45.329..45.330 rows=79129 loops=1)
                                                              Index Cond: (order_date >= (now() - '3 mons'::interval))
                                                  ->  Hash  (cost=328.00..328.00 rows=20000 width=12) (actual time=7.214..7.215 rows=20000 loops=3)
                                                        Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                                        ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=12) (actual time=0.024..2.678 rows=20000 loops=3)
                                            ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.52 rows=1 width=8) (actual time=0.003..0.003 rows=1 loops=3972)
                                                  Index Cond: (id = oi.variant_id)
                                      ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=21) (actual time=0.004..0.004 rows=1 loops=3972)
                                            Index Cond: (id = v.product_id)
                                ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.468..0.468 rows=150 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 18kB
                                      ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.035..0.055 rows=150 loops=3)
Planning Time: 56.023 ms
Execution Time: 172.853 ms


==================================================
EXPLAIN ANALYZE — Query 4: Top 5 produktów z najwięcej recenzjami
==================================================
Limit  (cost=1792.59..1792.61 rows=5 width=25) (actual time=151.632..151.636 rows=5 loops=1)
  ->  Sort  (cost=1792.59..1842.59 rows=20000 width=25) (actual time=151.631..151.634 rows=5 loops=1)
        Sort Key: (COALESCE(r.count, '0'::bigint)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Hash Left Join  (cost=969.89..1460.40 rows=20000 width=25) (actual time=46.568..148.402 rows=20000 loops=1)
              Hash Cond: (p.id = r.product_id)
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.629..72.400 rows=20000 loops=1)
              ->  Hash  (cost=812.24..812.24 rows=12612 width=12) (actual time=45.291..45.293 rows=12612 loops=1)
                    Buckets: 16384  Batches: 1  Memory Usage: 670kB
                    ->  Subquery Scan on r  (cost=560.00..812.24 rows=12612 width=12) (actual time=39.030..42.621 rows=12612 loops=1)
                          ->  HashAggregate  (cost=560.00..686.12 rows=12612 width=12) (actual time=39.029..41.446 rows=12612 loops=1)
                                Group Key: "Review".product_id
                                Batches: 1  Memory Usage: 1425kB
                                ->  Seq Scan on "Review"  (cost=0.00..460.00 rows=20000 width=4) (actual time=1.226..32.339 rows=20000 loops=1)
Planning Time: 10.510 ms
Execution Time: 152.331 ms


==================================================
EXPLAIN ANALYZE — Query 5: Całkowity Przychód Pogrupowany Miesięcznie za Ostatni Rok
==================================================
Finalize GroupAggregate  (cost=9410.36..11923.60 rows=18977 width=36) (actual time=138.683..186.271 rows=12 loops=1)
  Group Key: ((date_trunc('month'::text, o.order_date))::date)
  ->  Gather Merge  (cost=9410.36..11472.90 rows=15814 width=36) (actual time=138.186..186.245 rows=36 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=8410.34..8647.55 rows=7907 width=36) (actual time=96.675..99.127 rows=12 loops=3)
              Group Key: ((date_trunc('month'::text, o.order_date))::date)
              ->  Sort  (cost=8410.34..8430.11 rows=7907 width=14) (actual time=95.174..95.749 rows=6310 loops=3)
                    Sort Key: ((date_trunc('month'::text, o.order_date))::date) DESC
                    Sort Method: quicksort  Memory: 721kB
                    Worker 0:  Sort Method: quicksort  Memory: 321kB
                    Worker 1:  Sort Method: quicksort  Memory: 223kB
                    ->  Parallel Hash Join  (cost=769.00..7898.40 rows=7907 width=14) (actual time=9.996..93.009 rows=6310 loops=3)
                          Hash Cond: (o.id = oi.order_id)
                          ->  Parallel Seq Scan on "Order" o  (cost=0.00..6252.67 rows=158139 width=12) (actual time=0.012..51.077 rows=126415 loops=3)
                                Filter: (order_date >= (now() - '1 year'::interval))
                                Rows Removed by Filter: 6918
                          ->  Parallel Hash  (cost=621.93..621.93 rows=11765 width=14) (actual time=9.302..9.302 rows=6667 loops=3)
                                Buckets: 32768  Batches: 1  Memory Usage: 1216kB
                                ->  Parallel Index Only Scan using idx_orderitem_variant_order_agg on "OrderItem" oi  (cost=0.29..621.93 rows=11765 width=14) (actual time=2.441..21.557 rows=20000 loops=1)
                                      Heap Fetches: 0
Planning Time: 2.317 ms
Execution Time: 188.992 ms


==================================================
EXPLAIN ANALYZE — Query 6: Produkty najczęściej dodawane do ulubionych
==================================================
Limit  (cost=14382.58..14382.60 rows=10 width=25) (actual time=518.828..574.232 rows=10 loops=1)
  ->  Sort  (cost=14382.58..14432.58 rows=20000 width=25) (actual time=518.820..572.878 rows=10 loops=1)
        Sort Key: (count(f.user_id)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=13750.38..13950.38 rows=20000 width=25) (actual time=509.842..567.219 rows=20000 loops=1)
              Group Key: p.id
              Batches: 1  Memory Usage: 2577kB
              ->  Gather  (cost=9350.38..13550.38 rows=40000 width=25) (actual time=418.011..540.352 rows=59997 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=8350.38..8550.38 rows=20000 width=25) (actual time=401.408..407.494 rows=19999 loops=3)
                          Group Key: p.id
                          Batches: 1  Memory Usage: 2577kB
                          Worker 0:  Batches: 1  Memory Usage: 2577kB
                          Worker 1:  Batches: 1  Memory Usage: 2577kB
                          ->  Hash Join  (cost=688.00..7100.38 rows=250000 width=21) (actual time=9.174..329.829 rows=200000 loops=3)
                                Hash Cond: (f.product_id = p.id)
                                ->  Parallel Seq Scan on "FavoriteProduct" f  (cost=0.00..5756.00 rows=250000 width=8) (actual time=0.564..235.845 rows=200000 loops=3)
                                ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=7.643..7.644 rows=20000 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1215kB
                                      ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.028..2.822 rows=20000 loops=3)
Planning Time: 11.408 ms
Execution Time: 581.415 ms


==================================================
EXPLAIN ANALYZE — Query 7: Dostępny Stan Magazynowy Wariantów Produktu Pogrupowany po Magazynach
==================================================
Finalize GroupAggregate  (cost=8886.64..10869.06 rows=16000 width=61) (actual time=1162.766..1710.661 rows=231755 loops=1)
  Group Key: p.name, w.name, v.sku
  ->  Gather Merge  (cost=8886.64..10575.72 rows=13334 width=61) (actual time=1160.537..1612.465 rows=267452 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=7886.61..8036.62 rows=6667 width=61) (actual time=1079.589..1211.243 rows=89151 loops=3)
              Group Key: p.name, w.name, v.sku
              ->  Sort  (cost=7886.61..7903.28 rows=6667 width=57) (actual time=1077.976..1163.621 rows=106667 loops=3)
                    Sort Key: p.name, w.name, v.sku
                    Sort Method: external merge  Disk: 8344kB
                    Worker 0:  Sort Method: external merge  Disk: 7824kB
                    Worker 1:  Sort Method: external merge  Disk: 5616kB
                    ->  Hash Join  (cost=2543.72..7463.16 rows=6667 width=57) (actual time=98.361..598.669 rows=106667 loops=3)
                          Hash Cond: (v.product_id = p.id)
                          ->  Hash Join  (cost=1855.72..6757.66 rows=6667 width=48) (actual time=91.181..547.590 rows=106667 loops=3)
                                Hash Cond: (ssi.variant_id = v.id)
                                ->  Hash Join  (cost=1.23..4885.66 rows=6667 width=25) (actual time=3.576..410.826 rows=106667 loops=3)
                                      Hash Cond: (ssi.warehouse_id = w.id)
                                      ->  Parallel Append  (cost=0.00..4527.02 rows=133333 width=12) (actual time=3.317..362.867 rows=106667 loops=3)
                                            ->  Parallel Seq Scan on "SerialStockItem" ssi  (cost=0.00..2001.16 rows=93816 width=12) (actual time=2.947..192.134 rows=53163 loops=3)
                                            ->  Parallel Seq Scan on "BulkStockItem" bsi  (cost=0.00..1859.19 rows=94419 width=12) (actual time=2.989..236.127 rows=80256 loops=2)
                                      ->  Hash  (cost=1.10..1.10 rows=10 width=21) (actual time=0.239..0.242 rows=10 loops=3)
                                            Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                            ->  Seq Scan on "Warehouse" w  (cost=0.00..1.10 rows=10 width=21) (actual time=0.230..0.232 rows=10 loops=3)
                                ->  Hash  (cost=1267.00..1267.00 rows=47000 width=31) (actual time=86.634..86.634 rows=47000 loops=3)
                                      Buckets: 65536  Batches: 1  Memory Usage: 3450kB
                                      ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=31) (actual time=0.471..70.928 rows=47000 loops=3)
                          ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=7.046..7.047 rows=20000 loops=3)
                                Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                                ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.066..2.779 rows=20000 loops=3)
Planning Time: 19.047 ms
Execution Time: 1735.997 ms


==================================================
EXPLAIN ANALYZE — Query 8: Stan magazynowy per produkt
==================================================
Sort  (cost=19267.36..19316.89 rows=19812 width=21) (actual time=477.390..479.239 rows=17954 loops=1)
  Sort Key: (sum("*SELECT* 1".quantity)) DESC
  Sort Method: quicksort  Memory: 1483kB
  ->  HashAggregate  (cost=17655.24..17853.36 rows=19812 width=21) (actual time=469.424..473.261 rows=17954 loops=1)
        Group Key: p.name
        Batches: 1  Memory Usage: 2065kB
        ->  Hash Join  (cost=2542.50..16055.24 rows=320000 width=17) (actual time=27.724..357.395 rows=320000 loops=1)
              Hash Cond: ("*SELECT* 1".product_id = p.id)
              ->  Append  (cost=1854.50..14527.07 rows=320000 width=8) (actual time=16.278..242.849 rows=320000 loops=1)
                    ->  Subquery Scan on "*SELECT* 1"  (cost=1854.50..6525.95 rows=159488 width=8) (actual time=16.276..114.834 rows=159488 loops=1)
                          ->  Hash Join  (cost=1854.50..4931.07 rows=159488 width=8) (actual time=16.275..99.428 rows=159488 loops=1)
                                Hash Cond: (ssi.variant_id = v.id)
                                ->  Seq Scan on "SerialStockItem" ssi  (cost=0.00..2657.88 rows=159488 width=4) (actual time=0.020..14.329 rows=159488 loops=1)
                                ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=16.233..16.234 rows=47000 loops=1)
                                      Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                      ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.006..8.517 rows=47000 loops=1)
                    ->  Subquery Scan on "*SELECT* 2"  (cost=1854.50..6401.12 rows=160512 width=8) (actual time=13.739..103.268 rows=160512 loops=1)
                          ->  Hash Join  (cost=1854.50..4796.00 rows=160512 width=8) (actual time=13.738..87.325 rows=160512 loops=1)
                                Hash Cond: (bsi.variant_id = v_1.id)
                                ->  Seq Scan on "BulkStockItem" bsi  (cost=0.00..2520.12 rows=160512 width=8) (actual time=0.016..12.677 rows=160512 loops=1)
                                ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=13.516..13.517 rows=47000 loops=1)
                                      Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                      ->  Seq Scan on "Variant" v_1  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.012..5.773 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=11.433..11.434 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.018..5.007 rows=20000 loops=1)
Planning Time: 38.487 ms
Execution Time: 481.980 ms


==================================================
EXPLAIN ANALYZE — Query 9: Najpopularniejsze Kategorie (wg. Całkowitego Przychodu)
==================================================
Limit  (cost=7440.92..7440.95 rows=10 width=44) (actual time=267.862..267.870 rows=1 loops=1)
  ->  Sort  (cost=7440.92..7441.30 rows=150 width=44) (actual time=267.861..267.868 rows=1 loops=1)
        Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
        Sort Method: quicksort  Memory: 25kB
        ->  HashAggregate  (cost=7435.81..7437.68 rows=150 width=44) (actual time=267.184..267.193 rows=1 loops=1)
              Group Key: c.name
              Batches: 1  Memory Usage: 40kB
              ->  Hash Join  (cost=3230.89..6435.81 rows=100000 width=22) (actual time=92.504..259.230 rows=20000 loops=1)
                    Hash Cond: (pc.category_id = c.id)
                    ->  Hash Join  (cost=3225.51..6160.51 rows=100000 width=14) (actual time=89.400..252.093 rows=20000 loops=1)
                          Hash Cond: (pc.product_id = p.id)
                          ->  Seq Scan on "ProductCategory" pc  (cost=0.00..1560.00 rows=100000 width=8) (actual time=2.540..200.780 rows=100000 loops=1)
                          ->  Hash  (cost=2975.51..2975.51 rows=20000 width=18) (actual time=34.416..34.421 rows=20000 loops=1)
                                Buckets: 32768  Batches: 1  Memory Usage: 1272kB
                                ->  Hash Join  (cost=2542.50..2975.51 rows=20000 width=18) (actual time=19.931..30.989 rows=20000 loops=1)
                                      Hash Cond: (v.product_id = p.id)
                                      ->  Hash Join  (cost=1854.50..2235.00 rows=20000 width=14) (actual time=15.156..22.811 rows=20000 loops=1)
                                            Hash Cond: (oi.variant_id = v.id)
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=14) (actual time=0.009..3.920 rows=20000 loops=1)
                                            ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=13.212..13.213 rows=47000 loops=1)
                                                  Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                                  ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.009..5.504 rows=47000 loops=1)
                                      ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=4.750..4.751 rows=20000 loops=1)
                                            Buckets: 32768  Batches: 1  Memory Usage: 960kB
                                            ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.010..2.074 rows=20000 loops=1)
                    ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=2.485..2.485 rows=150 loops=1)
                          Buckets: 1024  Batches: 1  Memory Usage: 16kB
                          ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=1.824..2.452 rows=150 loops=1)
Planning Time: 36.416 ms
Execution Time: 268.546 ms


==================================================
EXPLAIN ANALYZE — Query 10: Liczba produktów per kategoria
==================================================
Sort  (cost=2342.22..2342.59 rows=150 width=20) (actual time=49.280..49.289 rows=150 loops=1)
  Sort Key: (count(pc.product_id)) DESC
  Sort Method: quicksort  Memory: 30kB
  ->  HashAggregate  (cost=2335.30..2336.80 rows=150 width=20) (actual time=49.222..49.244 rows=150 loops=1)
        Group Key: c.name
        Batches: 1  Memory Usage: 48kB
        ->  Hash Right Join  (cost=5.38..1835.30 rows=100000 width=16) (actual time=0.069..28.776 rows=100000 loops=1)
              Hash Cond: (pc.category_id = c.id)
              ->  Seq Scan on "ProductCategory" pc  (cost=0.00..1560.00 rows=100000 width=8) (actual time=0.004..6.682 rows=100000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=0.059..0.060 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 16kB
                    ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=0.011..0.033 rows=150 loops=1)
Planning Time: 0.205 ms
Execution Time: 49.340 ms


==================================================
EXPLAIN ANALYZE — Query 11: Liczba zamówień per metoda płatności
==================================================
Sort  (cost=7798.49..7798.51 rows=6 width=50) (actual time=99.292..104.386 rows=6 loops=1)
  Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  Finalize GroupAggregate  (cost=7796.82..7798.41 rows=6 width=50) (actual time=98.724..103.829 rows=6 loops=1)
        Group Key: pm.name
        ->  Gather Merge  (cost=7796.82..7798.22 rows=12 width=50) (actual time=98.699..103.806 rows=18 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Sort  (cost=6796.80..6796.81 rows=6 width=50) (actual time=72.316..72.321 rows=6 loops=3)
                    Sort Key: pm.name
                    Sort Method: quicksort  Memory: 25kB
                    Worker 0:  Sort Method: quicksort  Memory: 25kB
                    Worker 1:  Sort Method: quicksort  Memory: 25kB
                    ->  Partial HashAggregate  (cost=6796.64..6796.72 rows=6 width=50) (actual time=70.420..70.426 rows=6 loops=3)
                          Group Key: pm.name
                          Batches: 1  Memory Usage: 24kB
                          Worker 0:  Batches: 1  Memory Usage: 24kB
                          Worker 1:  Batches: 1  Memory Usage: 24kB
                          ->  Hash Join  (cost=770.13..6692.48 rows=8333 width=24) (actual time=5.009..65.701 rows=6667 loops=3)
                                Hash Cond: (o.payment_method_id = pm.id)
                                ->  Parallel Hash Join  (cost=769.00..6654.02 rows=8333 width=18) (actual time=4.774..64.046 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.006..23.423 rows=133333 loops=3)
                                      ->  Parallel Hash  (cost=621.93..621.93 rows=11765 width=14) (actual time=4.387..4.388 rows=6667 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1216kB
                                            ->  Parallel Index Only Scan using idx_orderitem_variant_order_agg on "OrderItem" oi  (cost=0.29..621.93 rows=11765 width=14) (actual time=0.015..5.816 rows=20000 loops=1)
                                                  Heap Fetches: 0
                                ->  Hash  (cost=1.06..1.06 rows=6 width=14) (actual time=0.026..0.027 rows=6 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                      ->  Seq Scan on "PaymentMethod" pm  (cost=0.00..1.06 rows=6 width=14) (actual time=0.021..0.022 rows=6 loops=3)
Planning Time: 7.313 ms
Execution Time: 104.506 ms


==================================================
EXPLAIN ANALYZE — Query 12: Średnia ocena per producent
==================================================
Sort  (cost=1367.54..1367.91 rows=150 width=57) (actual time=47.911..47.922 rows=150 loops=1)
  Sort Key: (round(avg(r.rating), 2)) DESC NULLS LAST
  Sort Method: quicksort  Memory: 32kB
  ->  HashAggregate  (cost=1359.87..1362.12 rows=150 width=57) (actual time=47.793..47.856 rows=150 loops=1)
        Group Key: m.name
        Batches: 1  Memory Usage: 64kB
        ->  Hash Join  (cost=693.38..1259.87 rows=20000 width=29) (actual time=5.381..41.327 rows=27388 loops=1)
              Hash Cond: (p.manufacturer_id = m.id)
              ->  Hash Right Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=5.322..35.959 rows=27388 loops=1)
                    Hash Cond: (r.product_id = p.id)
                    ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=0.009..11.689 rows=20000 loops=1)
                    ->  Hash  (cost=438.00..438.00 rows=20000 width=8) (actual time=5.302..5.303 rows=20000 loops=1)
                          Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                          ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=8) (actual time=0.004..2.236 rows=20000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.054..0.055 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 18kB
                    ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.013..0.029 rows=150 loops=1)
Planning Time: 6.629 ms
Execution Time: 47.990 ms


==================================================
EXPLAIN ANALYZE — Query 13: Aktywne promocje i objęta nimi liczba wariantów
==================================================
Sort  (cost=587.95..588.05 rows=42 width=14) (actual time=12.690..12.693 rows=42 loops=1)
  Sort Key: (count(v.id)) DESC
  Sort Method: quicksort  Memory: 26kB
  ->  HashAggregate  (cost=586.40..586.82 rows=42 width=14) (actual time=11.955..11.963 rows=42 loops=1)
        Group Key: pr.name
        Batches: 1  Memory Usage: 24kB
        ->  Merge Join  (cost=7.46..535.87 rows=10105 width=10) (actual time=0.178..11.662 rows=1238 loops=1)
              Merge Cond: (v.promotion_id = pr.id)
              ->  Index Scan using idx_variant_promotion on "Variant" v  (cost=0.29..4233.14 rows=47000 width=8) (actual time=0.014..11.122 rows=5685 loops=1)
              ->  Sort  (cost=7.17..7.27 rows=43 width=10) (actual time=0.045..0.051 rows=43 loops=1)
                    Sort Key: pr.id
                    Sort Method: quicksort  Memory: 26kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=43 width=10) (actual time=0.011..0.034 rows=43 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 157
Planning Time: 13.703 ms
Execution Time: 12.751 ms


==================================================
EXPLAIN ANALYZE — Query 14: Najczęściej wybierane warianty w koszykach
==================================================
Limit  (cost=207700.11..207700.14 rows=10 width=44) (actual time=2476.030..2476.033 rows=10 loops=1)
  ->  Sort  (cost=207700.11..211450.11 rows=1500000 width=44) (actual time=2476.028..2476.030 rows=10 loops=1)
        Sort Key: (sum(ci.quantity)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  GroupAggregate  (cost=3.89..175285.65 rows=1500000 width=44) (actual time=12.036..2466.821 rows=47000 loops=1)
              Group Key: v.sku, p.name
              ->  Incremental Sort  (cost=3.89..149035.65 rows=1500000 width=40) (actual time=6.604..2178.136 rows=1500000 loops=1)
                    Sort Key: v.sku, p.name
                    Presorted Key: v.sku
                    Full-sort Groups: 31708  Sort Method: quicksort  Average Memory: 27kB  Peak Memory: 27kB
                    Pre-sorted Groups: 6442  Sort Method: quicksort  Average Memory: 26kB  Peak Memory: 26kB
                    ->  Nested Loop  (cost=1.14..91874.47 rows=1500000 width=40) (actual time=3.057..1725.546 rows=1500000 loops=1)
                          ->  Nested Loop  (cost=0.71..9221.47 rows=47000 width=40) (actual time=3.047..182.378 rows=47000 loops=1)
                                ->  Index Scan using uix_variant_sku on "Variant" v  (cost=0.41..2458.28 rows=47000 width=31) (actual time=3.017..46.424 rows=47000 loops=1)
                                ->  Memoize  (cost=0.30..0.34 rows=1 width=17) (actual time=0.003..0.003 rows=1 loops=47000)
                                      Cache Key: v.product_id
                                      Cache Mode: logical
                                      Hits: 28889  Misses: 18111  Evictions: 0  Overflows: 0  Memory Usage: 2099kB
                                      ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=17) (actual time=0.005..0.005 rows=1 loops=18111)
                                            Index Cond: (id = v.product_id)
                          ->  Index Only Scan using idx_cartitem_variant_quantity_cover on "CartItem" ci  (cost=0.43..1.43 rows=33 width=8) (actual time=0.003..0.030 rows=32 loops=47000)
                                Index Cond: (variant_id = v.id)
                                Heap Fetches: 150055
Planning Time: 19.056 ms
Execution Time: 2476.098 ms


==================================================
EXPLAIN ANALYZE — Query 15: Produkty z Największą Różnicą Między Ceną Podstawową a Ceną Wariantu
==================================================
Limit  (cost=3211.55..3211.58 rows=10 width=80) (actual time=45.129..45.133 rows=10 loops=1)
  ->  Sort  (cost=3211.55..3329.05 rows=47000 width=80) (actual time=45.128..45.130 rows=10 loops=1)
        Sort Key: v.price_modifier DESC
        Sort Method: top-N heapsort  Memory: 27kB
        ->  Hash Join  (cost=688.00..2195.90 rows=47000 width=80) (actual time=6.450..32.893 rows=47000 loops=1)
              Hash Cond: (v.product_id = p.id)
              ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=33) (actual time=0.011..6.150 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=6.422..6.423 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1381kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.004..2.685 rows=20000 loops=1)
Planning Time: 1.387 ms
Execution Time: 45.173 ms


==================================================
EXPLAIN ANALYZE — Query 16: Konwersja zamówień wg statusu
==================================================
Sort  (cost=7541.77..7541.79 rows=7 width=48) (actual time=137.603..188.078 rows=7 loops=1)
  Sort Key: (count(o.id)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  WindowAgg  (cost=7541.33..7541.67 rows=7 width=48) (actual time=137.589..188.070 rows=7 loops=1)
        ->  Finalize GroupAggregate  (cost=7539.74..7541.51 rows=7 width=16) (actual time=136.856..187.342 rows=7 loops=1)
              Group Key: s.name
              ->  Gather Merge  (cost=7539.74..7541.37 rows=14 width=16) (actual time=136.847..187.329 rows=21 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Sort  (cost=6539.71..6539.73 rows=7 width=16) (actual time=89.421..89.424 rows=7 loops=3)
                          Sort Key: s.name
                          Sort Method: quicksort  Memory: 25kB
                          Worker 0:  Sort Method: quicksort  Memory: 25kB
                          Worker 1:  Sort Method: quicksort  Memory: 25kB
                          ->  Partial HashAggregate  (cost=6539.55..6539.62 rows=7 width=16) (actual time=89.384..89.387 rows=7 loops=3)
                                Group Key: s.name
                                Batches: 1  Memory Usage: 24kB
                                Worker 0:  Batches: 1  Memory Usage: 24kB
                                Worker 1:  Batches: 1  Memory Usage: 24kB
                                ->  Hash Join  (cost=1.16..5706.21 rows=166667 width=12) (actual time=0.060..48.635 rows=133333 loops=3)
                                      Hash Cond: (o.status_id = s.id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.007..14.037 rows=133333 loops=3)
                                      ->  Hash  (cost=1.07..1.07 rows=7 width=12) (actual time=0.031..0.031 rows=7 loops=3)
                                            Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                            ->  Seq Scan on "Status" s  (cost=0.00..1.07 rows=7 width=12) (actual time=0.025..0.026 rows=7 loops=3)
Planning Time: 2.670 ms
Execution Time: 190.055 ms


==================================================
EXPLAIN ANALYZE — Query 17: Top klienci wg wydatków
==================================================
Limit  (cost=15389.43..15389.45 rows=10 width=50) (actual time=2778.640..2843.072 rows=10 loops=1)
  ->  Sort  (cost=15389.43..15439.43 rows=20000 width=50) (actual time=2778.639..2843.069 rows=10 loops=1)
        Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=14707.24..14957.24 rows=20000 width=50) (actual time=2743.249..2831.964 rows=19296 loops=1)
              Group Key: u.id
              Batches: 5  Memory Usage: 8241kB  Disk Usage: 224kB
              ->  Gather  (cost=12811.48..14582.24 rows=16666 width=50) (actual time=2518.300..2675.571 rows=19430 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=11811.48..11915.64 rows=8333 width=50) (actual time=2471.861..2485.330 rows=6477 loops=3)
                          Group Key: u.id
                          Batches: 1  Memory Usage: 2961kB
                          Worker 0:  Batches: 1  Memory Usage: 2961kB
                          Worker 1:  Batches: 1  Memory Usage: 2961kB
                          ->  Nested Loop  (cost=769.42..11728.15 rows=8333 width=28) (actual time=4.939..2430.742 rows=6667 loops=3)
                                ->  Parallel Hash Join  (cost=769.00..6654.02 rows=8333 width=14) (actual time=3.933..82.646 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.176..25.885 rows=133333 loops=3)
                                      ->  Parallel Hash  (cost=621.93..621.93 rows=11765 width=14) (actual time=2.988..3.731 rows=6667 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1216kB
                                            ->  Parallel Index Only Scan using idx_orderitem_variant_order_agg on "OrderItem" oi  (cost=0.29..621.93 rows=11765 width=14) (actual time=0.019..2.981 rows=20000 loops=1)
                                                  Heap Fetches: 0
                                ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.351..0.351 rows=1 loops=20000)
                                      Index Cond: (id = o.user_id)
Planning Time: 9.976 ms
Execution Time: 2857.201 ms


==================================================
EXPLAIN ANALYZE — Query 18: Produkty z wariantami objętymi promocją, z końcową ceną
==================================================
Sort  (cost=2074.11..2099.37 rows=10105 width=132) (actual time=67.867..67.998 rows=1238 loops=1)
  Sort Key: (round(((p.price + v.price_modifier) * ('1'::numeric - pr.discount_percentage)), 2))
  Sort Method: quicksort  Memory: 139kB
  ->  Hash Join  (cost=695.46..1401.98 rows=10105 width=132) (actual time=21.908..66.719 rows=1238 loops=1)
        Hash Cond: (v.product_id = p.id)
        ->  Merge Join  (cost=7.46..535.87 rows=10105 width=39) (actual time=7.344..50.667 rows=1238 loops=1)
              Merge Cond: (v.promotion_id = pr.id)
              ->  Index Scan using idx_variant_promotion on "Variant" v  (cost=0.29..4233.14 rows=47000 width=37) (actual time=0.664..48.837 rows=5685 loops=1)
              ->  Sort  (cost=7.17..7.27 rows=43 width=10) (actual time=1.308..1.317 rows=43 loops=1)
                    Sort Key: pr.id
                    Sort Method: quicksort  Memory: 26kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=43 width=10) (actual time=0.015..0.038 rows=43 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 157
        ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=13.993..13.993 rows=20000 loops=1)
              Buckets: 32768  Batches: 1  Memory Usage: 1381kB
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.010..9.659 rows=20000 loops=1)
Planning Time: 20.916 ms
Execution Time: 68.111 ms


==================================================
EXPLAIN ANALYZE — Query 19: Użytkownicy, Którzy Dodali Produkt do Koszyka, Ale Nie Złożyli Zamówienia (Potencjał Odbudowy Koszyka)
==================================================
Hash Join  (cost=46254.21..103988.81 rows=1068640 width=55) (actual time=3480.341..6084.608 rows=1005006 loops=1)
  Hash Cond: (v.product_id = p.id)
  ->  Hash Join  (cost=45566.21..100495.04 rows=1068640 width=46) (actual time=3471.519..5522.713 rows=1005006 loops=1)
        Hash Cond: (ci.variant_id = v.id)
        ->  Hash Join  (cost=43711.71..95835.11 rows=1068640 width=46) (actual time=3442.187..4741.295 rows=1005006 loops=1)
              Hash Cond: (ci.cart_id = c.id)
              ->  Seq Scan on "CartItem" ci  (cost=0.00..23152.00 rows=1500000 width=8) (actual time=0.756..497.036 rows=1500000 loops=1)
              ->  Hash  (cost=41435.91..41435.91 rows=106864 width=46) (actual time=3433.941..3444.772 rows=100414 loops=1)
                    Buckets: 131072  Batches: 2  Memory Usage: 4929kB
                    ->  Gather  (cost=25017.67..41435.91 rows=106864 width=46) (actual time=3125.895..3240.651 rows=100414 loops=1)
                          Workers Planned: 2
                          Workers Launched: 2
                          ->  Parallel Hash Right Anti Join  (cost=24017.67..29749.51 rows=44527 width=46) (actual time=2543.661..2557.429 rows=33471 loops=3)
                                Hash Cond: (o.user_id = u.id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=4) (actual time=1.404..291.015 rows=133333 loops=3)
                                ->  Parallel Hash  (cost=23236.42..23236.42 rows=62500 width=50) (actual time=1941.970..1942.473 rows=50000 loops=3)
                                      Buckets: 262144  Batches: 1  Memory Usage: 14720kB
                                      ->  Hash Join  (cost=4079.00..23236.42 rows=62500 width=50) (actual time=137.592..1712.533 rows=50000 loops=3)
                                            Hash Cond: (u.id = c.user_id)
                                            ->  Parallel Seq Scan on "User" u  (cost=0.00..18063.67 rows=416667 width=46) (actual time=0.020..1182.027 rows=333333 loops=3)
                                            ->  Hash  (cost=2204.00..2204.00 rows=150000 width=8) (actual time=130.340..130.341 rows=150000 loops=3)
                                                  Buckets: 262144  Batches: 1  Memory Usage: 7908kB
                                                  ->  Seq Scan on "Cart" c  (cost=0.00..2204.00 rows=150000 width=8) (actual time=14.151..60.256 rows=150000 loops=3)
        ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=26.027..26.599 rows=47000 loops=1)
              Buckets: 65536  Batches: 1  Memory Usage: 2348kB
              ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.012..17.047 rows=47000 loops=1)
  ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=5.660..5.661 rows=20000 loops=1)
        Buckets: 32768  Batches: 1  Memory Usage: 1245kB
        ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.014..2.399 rows=20000 loops=1)
Planning Time: 34.670 ms
Execution Time: 6150.831 ms


==================================================
EXPLAIN ANALYZE — Query 20: Wyszukiwanie produktów po nazwie lub opisie (parametryzowane)
==================================================
Bitmap Heap Scan on "Product"  (cost=43.00..57.51 rows=4 width=60) (actual time=5.714..28.417 rows=143 loops=1)
  Recheck Cond: (((name)::text ~~* '%test%'::text) OR (description ~~* '%test%'::text))
  Heap Blocks: exact=106
  ->  BitmapOr  (cost=43.00..43.00 rows=4 width=0) (actual time=5.124..5.125 rows=0 loops=1)
        ->  Bitmap Index Scan on idx_product_name_trgm  (cost=0.00..21.50 rows=2 width=0) (actual time=2.542..2.542 rows=42 loops=1)
              Index Cond: ((name)::text ~~* '%test%'::text)
        ->  Bitmap Index Scan on idx_product_description_trgm  (cost=0.00..21.50 rows=2 width=0) (actual time=2.576..2.576 rows=102 loops=1)
              Index Cond: (description ~~* '%test%'::text)
Planning Time: 132.835 ms
Execution Time: 32.467 ms


==================================================
EXPLAIN ANALYZE — Query 21: Użytkownicy, Którzy Zapisali Konkretny Produkt jako Ulubiony (np. Product ID=350259)
==================================================
Nested Loop  (cost=0.85..262.23 rows=30 width=56) (actual time=3.677..13.782 rows=26 loops=1)
  ->  Index Only Scan using idx_favoriteproduct_product_user on "FavoriteProduct" fp  (cost=0.42..8.95 rows=30 width=4) (actual time=1.942..1.962 rows=26 loops=1)
        Index Cond: (product_id = 35)
        Heap Fetches: 0
  ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..8.44 rows=1 width=60) (actual time=0.453..0.453 rows=1 loops=26)
        Index Cond: (id = fp.user_id)
Planning Time: 13.763 ms
Execution Time: 13.825 ms


==================================================
EXPLAIN ANALYZE — Query 22: Znajdź Magazyny, Które Posiadają Zapasy Konkretnego Wariantu (np. SKU='VR-000000-a637d44b7afd')
==================================================
Sort  (cost=27.64..27.64 rows=2 width=25) (actual time=3.774..3.777 rows=0 loops=1)
  Sort Key: (sum("*SELECT* 1".stock_units)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  GroupAggregate  (cost=27.51..27.63 rows=2 width=25) (actual time=3.131..3.133 rows=0 loops=1)
        Group Key: w.name
        Filter: (sum("*SELECT* 1".stock_units) > 0)
        ->  Sort  (cost=27.51..27.52 rows=6 width=21) (actual time=3.129..3.131 rows=0 loops=1)
              Sort Key: w.name
              Sort Method: quicksort  Memory: 25kB
              ->  Hash Join  (cost=2.06..27.43 rows=6 width=21) (actual time=1.933..1.935 rows=0 loops=1)
                    Hash Cond: ("*SELECT* 1".warehouse_id = w.id)
                    ->  Append  (cost=0.83..26.18 rows=6 width=8) (actual time=1.932..1.934 rows=0 loops=1)
                          ->  Subquery Scan on "*SELECT* 1"  (cost=0.83..13.08 rows=3 width=8) (actual time=1.912..1.912 rows=0 loops=1)
                                ->  Nested Loop  (cost=0.83..13.05 rows=3 width=8) (actual time=1.911..1.912 rows=0 loops=1)
                                      ->  Index Scan using uix_variant_sku on "Variant" v  (cost=0.41..8.43 rows=1 width=4) (actual time=1.910..1.910 rows=0 loops=1)
                                            Index Cond: ((sku)::text = 'VR-000001-2704de10f283'::text)
                                      ->  Index Only Scan using idx_bsi_variant_warehouse_qty on "BulkStockItem" bsi  (cost=0.42..4.54 rows=7 width=12) (never executed)
                                            Index Cond: (variant_id = v.id)
                                            Heap Fetches: 0
                          ->  Subquery Scan on "*SELECT* 2"  (cost=0.83..13.08 rows=3 width=8) (actual time=0.018..0.019 rows=0 loops=1)
                                ->  Nested Loop  (cost=0.83..13.05 rows=3 width=8) (actual time=0.018..0.018 rows=0 loops=1)
                                      ->  Index Scan using uix_variant_sku on "Variant" v_1  (cost=0.41..8.43 rows=1 width=4) (actual time=0.017..0.017 rows=0 loops=1)
                                            Index Cond: ((sku)::text = 'VR-000001-2704de10f283'::text)
                                      ->  Index Only Scan using idx_ssi_variant_warehouse on "SerialStockItem" ssi  (cost=0.42..4.54 rows=7 width=8) (never executed)
                                            Index Cond: (variant_id = v_1.id)
                                            Heap Fetches: 0
                    ->  Hash  (cost=1.10..1.10 rows=10 width=21) (never executed)
                          ->  Seq Scan on "Warehouse" w  (cost=0.00..1.10 rows=10 width=21) (never executed)
Planning Time: 18.385 ms
Execution Time: 4.528 ms


==================================================
EXPLAIN ANALYZE — Query 23: Warianty, Które Wymagają Uzyskania Konkretnej Opcji (np. 'Kolor'='Czerwony')
==================================================
Nested Loop  (cost=6.81..677.99 rows=8 width=36) (actual time=0.019..0.020 rows=0 loops=1)
  ->  Nested Loop  (cost=6.52..675.35 rows=8 width=27) (actual time=0.018..0.019 rows=0 loops=1)
        ->  Nested Loop  (cost=6.23..672.76 rows=8 width=4) (actual time=0.018..0.019 rows=0 loops=1)
              Join Filter: (opt.attribute_id = a.id)
              ->  Seq Scan on "Attribute" a  (cost=0.00..1.38 rows=1 width=4) (actual time=0.018..0.018 rows=0 loops=1)
                    Filter: ((name)::text = 'Attr_49_Century'::text)
                    Rows Removed by Filter: 30
              ->  Nested Loop  (cost=6.23..668.26 rows=250 width=8) (never executed)
                    ->  Seq Scan on "Option" opt  (cost=0.00..18.50 rows=1 width=8) (never executed)
                          Filter: ((value)::text = 'do'::text)
                    ->  Bitmap Heap Scan on "VariantOption" vo  (cost=6.23..647.26 rows=250 width=8) (never executed)
                          Recheck Cond: (option_id = opt.id)
                          ->  Bitmap Index Scan on idx_variantoption_option_id  (cost=0.00..6.17 rows=250 width=0) (never executed)
                                Index Cond: (option_id = opt.id)
        ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.32 rows=1 width=31) (never executed)
              Index Cond: (id = vo.variant_id)
  ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=17) (never executed)
        Index Cond: (id = v.product_id)
Planning Time: 35.269 ms
Execution Time: 0.118 ms


==================================================
EXPLAIN ANALYZE — Query 24: Znajdź Zamówienia Użytkownika (np. email='debbie.lane.16786.50af0753@example.com') o Statusie 'Paid'
==================================================
Nested Loop  (cost=0.98..17.07 rows=1 width=20) (actual time=2.375..2.376 rows=0 loops=1)
  ->  Nested Loop  (cost=0.85..16.89 rows=1 width=16) (actual time=2.374..2.375 rows=0 loops=1)
        ->  Index Scan using "User_email_key" on "User" u  (cost=0.42..8.44 rows=1 width=4) (actual time=2.374..2.374 rows=0 loops=1)
              Index Cond: ((email)::text = 'debbie.lane.16786.50af0753@example.com'::text)
        ->  Index Scan using idx_order_user on "Order" o  (cost=0.42..8.44 rows=1 width=20) (never executed)
              Index Cond: (user_id = u.id)
  ->  Index Scan using "Status_pkey" on "Status" s  (cost=0.13..0.15 rows=1 width=12) (never executed)
        Index Cond: (id = o.status_id)
        Filter: ((name)::text = 'Paid'::text)
Planning Time: 4.686 ms
Execution Time: 2.437 ms


==================================================
EXPLAIN ANALYZE — Query 25: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
Hash Left Join  (cost=6.97..48.34 rows=16 width=87) (actual time=2.754..5.346 rows=18 loops=1)
  Hash Cond: (opt.attribute_id = a.id)
  ->  Nested Loop Left Join  (cost=5.30..46.57 rows=16 width=45) (actual time=1.362..3.941 rows=18 loops=1)
        ->  Nested Loop Left Join  (cost=5.02..41.89 rows=16 width=39) (actual time=1.324..3.830 rows=18 loops=1)
              ->  Nested Loop  (cost=4.60..24.13 rows=3 width=39) (actual time=0.657..0.684 rows=4 loops=1)
                    ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..8.30 rows=1 width=10) (actual time=0.008..0.009 rows=1 loops=1)
                          Index Cond: (id = 35)
                    ->  Bitmap Heap Scan on "Variant" v  (cost=4.31..15.80 rows=3 width=37) (actual time=0.647..0.671 rows=4 loops=1)
                          Recheck Cond: (product_id = 35)
                          Heap Blocks: exact=4
                          ->  Bitmap Index Scan on idx_variant_product  (cost=0.00..4.31 rows=3 width=0) (actual time=0.020..0.020 rows=4 loops=1)
                                Index Cond: (product_id = 35)
              ->  Index Only Scan using uq_varopt_variant_option on "VariantOption" vo  (cost=0.42..5.86 rows=6 width=8) (actual time=0.783..0.785 rows=4 loops=4)
                    Index Cond: (variant_id = v.id)
                    Heap Fetches: 0
        ->  Index Scan using "Option_pkey" on "Option" opt  (cost=0.28..0.29 rows=1 width=14) (actual time=0.005..0.005 rows=1 loops=18)
              Index Cond: (id = vo.option_id)
  ->  Hash  (cost=1.30..1.30 rows=30 width=18) (actual time=0.023..0.023 rows=30 loops=1)
        Buckets: 1024  Batches: 1  Memory Usage: 10kB
        ->  Seq Scan on "Attribute" a  (cost=0.00..1.30 rows=30 width=18) (actual time=0.011..0.015 rows=30 loops=1)
Planning Time: 0.556 ms
Execution Time: 5.399 ms


==================================================
EXPLAIN ANALYZE — Query 26: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
Hash Left Join  (cost=6.97..48.42 rows=16 width=87) (actual time=0.007..0.008 rows=0 loops=1)
  Hash Cond: (opt.attribute_id = a.id)
  ->  Nested Loop Left Join  (cost=5.30..46.57 rows=16 width=45) (actual time=0.006..0.007 rows=0 loops=1)
        ->  Nested Loop Left Join  (cost=5.02..41.89 rows=16 width=39) (actual time=0.006..0.006 rows=0 loops=1)
              ->  Nested Loop  (cost=4.60..24.13 rows=3 width=39) (actual time=0.006..0.006 rows=0 loops=1)
                    ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..8.30 rows=1 width=10) (actual time=0.005..0.005 rows=0 loops=1)
                          Index Cond: (id = 350259)
                    ->  Bitmap Heap Scan on "Variant" v  (cost=4.31..15.80 rows=3 width=37) (never executed)
                          Recheck Cond: (product_id = 350259)
                          ->  Bitmap Index Scan on idx_variant_product  (cost=0.00..4.31 rows=3 width=0) (never executed)
                                Index Cond: (product_id = 350259)
              ->  Index Only Scan using uq_varopt_variant_option on "VariantOption" vo  (cost=0.42..5.86 rows=6 width=8) (never executed)
                    Index Cond: (variant_id = v.id)
                    Heap Fetches: 0
        ->  Index Scan using "Option_pkey" on "Option" opt  (cost=0.28..0.29 rows=1 width=14) (never executed)
              Index Cond: (id = vo.option_id)
  ->  Hash  (cost=1.30..1.30 rows=30 width=18) (never executed)
        ->  Seq Scan on "Attribute" a  (cost=0.00..1.30 rows=30 width=18) (never executed)
Planning Time: 0.557 ms
Execution Time: 0.047 ms


==================================================
EXPLAIN ANALYZE — Query 27: Lista Wszystkich Dziecięcych Kategorii (Podkategorii) dla Konkretnej Kategorii Nadrzędnej (np. ID=5)
==================================================
Seq Scan on "Category"  (cost=0.00..3.88 rows=3 width=12) (actual time=0.673..1.415 rows=3 loops=1)
  Filter: (parent_id = 5)
  Rows Removed by Filter: 147
Planning Time: 1.516 ms
Execution Time: 1.436 ms


==================================================
EXPLAIN ANALYZE — Query 28: Porównanie Średniej Oceny dla Promowanych i Niepromowanych Produktów
==================================================
HashAggregate  (cost=87850.51..87853.01 rows=200 width=64) (actual time=120.696..120.701 rows=2 loops=1)
  Group Key: CASE WHEN (ANY (p.id = (hashed SubPlan 2).col1)) THEN 'Promowany'::text ELSE 'Niepromowany'::text END
  Batches: 1  Memory Usage: 40kB
  ->  HashAggregate  (cost=1300.51..87550.51 rows=20000 width=68) (actual time=110.679..117.734 rows=12612 loops=1)
        Group Key: p.id
        Batches: 1  Memory Usage: 2577kB
        ->  Hash Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=55.711..89.725 rows=20000 loops=1)
              Hash Cond: (r.product_id = p.id)
              ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=1.262..27.191 rows=20000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=54.416..54.417 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 960kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.007..47.656 rows=20000 loops=1)
        SubPlan 2
          ->  Index Only Scan using idx_variant_product_promotion on "Variant" v2  (cost=0.28..215.94 rows=5577 width=4) (actual time=1.768..10.521 rows=5684 loops=1)
                Heap Fetches: 0
Planning Time: 4.693 ms
Execution Time: 121.453 ms


==================================================
EXPLAIN ANALYZE — Query 29: Top 5 Miast Generujących Największy Przychód (Wg. Adresu Wysyłki)
==================================================
Limit  (cost=15305.18..15305.19 rows=5 width=45) (actual time=3682.713..3775.326 rows=5 loops=1)
  ->  Sort  (cost=15305.18..15355.18 rows=20000 width=45) (actual time=3681.886..3774.495 rows=5 loops=1)
        Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=14722.99..14972.99 rows=20000 width=45) (actual time=3673.022..3770.923 rows=12950 loops=1)
              Group Key: a.city
              Batches: 1  Memory Usage: 5905kB
              ->  Gather  (cost=12827.23..14597.99 rows=16666 width=45) (actual time=3578.745..3717.039 rows=16129 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=11827.23..11931.39 rows=8333 width=45) (actual time=3555.292..3563.902 rows=5376 loops=3)
                          Group Key: a.city
                          Batches: 1  Memory Usage: 2449kB
                          Worker 0:  Batches: 1  Memory Usage: 2449kB
                          Worker 1:  Batches: 1  Memory Usage: 2449kB
                          ->  Nested Loop  (cost=769.42..11743.90 rows=8333 width=23) (actual time=17.398..3537.325 rows=6667 loops=3)
                                ->  Parallel Hash Join  (cost=769.00..6654.02 rows=8333 width=14) (actual time=14.592..92.201 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.011..21.692 rows=133333 loops=3)
                                      ->  Parallel Hash  (cost=621.93..621.93 rows=11765 width=14) (actual time=14.175..14.193 rows=6667 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1216kB
                                            ->  Parallel Index Only Scan using idx_orderitem_variant_order_agg on "OrderItem" oi  (cost=0.29..621.93 rows=11765 width=14) (actual time=2.809..11.489 rows=6667 loops=3)
                                                  Heap Fetches: 0
                                ->  Index Scan using "Address_pkey" on "Address" a  (cost=0.43..0.61 rows=1 width=17) (actual time=0.515..0.515 rows=1 loops=20000)
                                      Index Cond: (id = o.shipping_address_id)
Planning Time: 20.699 ms
Execution Time: 3778.614 ms


==================================================
EXPLAIN ANALYZE — Query 30: Porównanie Wolumenu Sprzedaży Produktów Promowanych vs. Niepromowanych (w Ostatnich 30 Dniach)
==================================================
GroupAggregate  (cost=4663.41..4670.02 rows=200 width=40) (actual time=69.845..69.848 rows=1 loops=1)
  Group Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
  ->  Sort  (cost=4663.41..4664.95 rows=614 width=36) (actual time=69.708..69.743 rows=619 loops=1)
        Sort Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
        Sort Method: quicksort  Memory: 49kB
        ->  Nested Loop  (cost=3936.29..4634.98 rows=614 width=36) (actual time=25.969..69.573 rows=619 loops=1)
              ->  Hash Join  (cost=3936.00..4316.50 rows=614 width=8) (actual time=25.940..68.336 rows=619 loops=1)
                    Hash Cond: (oi.order_id = o.id)
                    ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=12) (actual time=1.241..39.382 rows=20000 loops=1)
                    ->  Hash  (cost=3782.50..3782.50 rows=12280 width=4) (actual time=24.677..24.679 rows=12322 loops=1)
                          Buckets: 16384  Batches: 1  Memory Usage: 562kB
                          ->  Bitmap Heap Scan on "Order" o  (cost=231.60..3782.50 rows=12280 width=4) (actual time=14.840..22.582 rows=12322 loops=1)
                                Recheck Cond: (order_date >= (now() - '30 days'::interval))
                                Heap Blocks: exact=3270
                                ->  Bitmap Index Scan on idx_order_date  (cost=0.00..228.53 rows=12280 width=0) (actual time=14.461..14.461 rows=12322 loops=1)
                                      Index Cond: (order_date >= (now() - '30 days'::interval))
              ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.52 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=619)
                    Index Cond: (id = oi.variant_id)
Planning Time: 15.395 ms
Execution Time: 69.922 ms


==================================================
EXPLAIN ANALYZE — Query 31: Wskaźnik Lojalności (Repeat Purchase Rate) Użytkowników z Podziałem na Miasto Adresu Rozliczeniowego
==================================================
Sort  (cost=128699.75..128773.84 rows=29636 width=61) (actual time=5369.138..5494.626 rows=66456 loops=1)
  Sort Key: (round((((count(*) FILTER (WHERE (u.orders_count > 1)))::numeric * 100.0) / (NULLIF(count(DISTINCT o.user_id), 0))::numeric), 2)) DESC
  Sort Method: external merge  Disk: 3192kB
  ->  GroupAggregate  (cost=75171.04..126498.53 rows=29636 width=61) (actual time=4815.521..5367.640 rows=66456 loops=1)
        Group Key: a.city
        ->  Gather Merge  (cost=75171.04..121757.63 rows=400000 width=25) (actual time=4806.630..5232.639 rows=400000 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Sort  (cost=74171.01..74587.68 rows=166667 width=25) (actual time=4671.547..4762.677 rows=133333 loops=3)
                    Sort Key: a.city, o.user_id
                    Sort Method: external merge  Disk: 5432kB
                    Worker 0:  Sort Method: external merge  Disk: 5464kB
                    Worker 1:  Sort Method: external merge  Disk: 4432kB
                    ->  Parallel Hash Join  (cost=34868.03..55725.48 rows=166667 width=25) (actual time=1355.756..3915.783 rows=133333 loops=3)
                          Hash Cond: (a.id = o.billing_address_id)
                          ->  Parallel Seq Scan on "Address" a  (cost=0.00..18288.00 rows=500000 width=17) (actual time=22.920..1693.499 rows=400000 loops=3)
                          ->  Parallel Hash  (cost=32784.69..32784.69 rows=166667 width=16) (actual time=1317.514..1319.488 rows=133333 loops=3)
                                Buckets: 524288  Batches: 1  Memory Usage: 22912kB
                                ->  Hash Join  (cost=24635.51..32784.69 rows=166667 width=16) (actual time=618.191..1020.211 rows=133333 loops=3)
                                      Hash Cond: (o.user_id = u.user_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.013..74.894 rows=133333 loops=3)
                                      ->  Hash  (cost=19635.86..19635.86 rows=287572 width=12) (actual time=606.924..607.719 rows=329619 loops=3)
                                            Buckets: 262144  Batches: 4  Memory Usage: 5596kB
                                            ->  Subquery Scan on u  (cost=0.42..19635.86 rows=287572 width=12) (actual time=2.011..490.747 rows=329619 loops=3)
                                                  ->  GroupAggregate  (cost=0.42..16760.14 rows=287572 width=12) (actual time=2.009..456.647 rows=329619 loops=3)
                                                        Group Key: "Order".user_id
                                                        ->  Index Only Scan using idx_order_user on "Order"  (cost=0.42..11884.42 rows=400000 width=4) (actual time=1.997..364.282 rows=400000 loops=3)
                                                              Heap Fetches: 150240
Planning Time: 8.604 ms
Execution Time: 5545.635 ms

FINISHED — 2025-12-02 21:12:41.778954
========================================================================================================================
========================================================================================================================
START EXPLAIN RUN — 2025-12-02 21:15:53.209904
========================================================================================================================


==================================================
EXPLAIN ANALYZE — Query 1: Średnia Wartość Zamówienia (AOV) w Ostatnim Miesiącu
==================================================
Aggregate  (cost=4367.85..4367.86 rows=1 width=32) (actual time=712.697..712.700 rows=1 loops=1)
  ->  GroupAggregate  (cost=4344.82..4360.17 rows=614 width=36) (actual time=712.147..712.645 rows=608 loops=1)
        Group Key: o.id
        ->  Sort  (cost=4344.82..4346.35 rows=614 width=14) (actual time=711.440..711.502 rows=619 loops=1)
              Sort Key: o.id
              Sort Method: quicksort  Memory: 44kB
              ->  Hash Join  (cost=3935.88..4316.38 rows=614 width=14) (actual time=676.022..710.668 rows=619 loops=1)
                    Hash Cond: (oi.order_id = o.id)
                    ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=14) (actual time=0.012..30.919 rows=20000 loops=1)
                    ->  Hash  (cost=3782.42..3782.42 rows=12277 width=4) (actual time=675.946..675.947 rows=12322 loops=1)
                          Buckets: 16384  Batches: 1  Memory Usage: 562kB
                          ->  Bitmap Heap Scan on "Order" o  (cost=231.57..3782.42 rows=12277 width=4) (actual time=14.997..672.446 rows=12322 loops=1)
                                Recheck Cond: (order_date >= (now() - '1 mon'::interval))
                                Heap Blocks: exact=3270
                                ->  Bitmap Index Scan on idx_order_date  (cost=0.00..228.50 rows=12277 width=0) (actual time=13.982..13.982 rows=12322 loops=1)
                                      Index Cond: (order_date >= (now() - '1 mon'::interval))
Planning Time: 50.012 ms
Execution Time: 712.858 ms


==================================================
EXPLAIN ANALYZE — Query 2: Średnia wartość zamówienia per użytkownik - ZOPTYMALIZOWANA
==================================================
Sort  (cost=16166.87..16215.61 rows=19495 width=50) (actual time=4717.673..4741.053 rows=19296 loops=1)
  Sort Key: (round(avg(oi_sum.total_price), 2)) DESC
  Sort Method: quicksort  Memory: 1612kB
  ->  Finalize HashAggregate  (cost=14485.35..14777.77 rows=19495 width=50) (actual time=4687.063..4727.865 rows=19296 loops=1)
        Group Key: u.id
        Batches: 5  Memory Usage: 8241kB  Disk Usage: 224kB
        ->  Gather  (cost=12637.36..14363.50 rows=16246 width=50) (actual time=4530.995..4631.512 rows=19432 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial HashAggregate  (cost=11637.36..11738.90 rows=8123 width=50) (actual time=3912.991..3919.575 rows=6477 loops=3)
                    Group Key: u.id
                    Batches: 1  Memory Usage: 3217kB
                    Worker 0:  Batches: 1  Memory Usage: 2961kB
                    Worker 1:  Batches: 1  Memory Usage: 2961kB
                    ->  Nested Loop  (cost=1210.75..11596.75 rows=8123 width=50) (actual time=170.511..3861.395 rows=6498 loops=3)
                          ->  Hash Join  (cost=1210.33..6650.49 rows=8123 width=36) (actual time=132.006..358.474 rows=6498 loops=3)
                                Hash Cond: (o.id = oi_sum.order_id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.983..114.036 rows=133333 loops=3)
                                ->  Hash  (cost=966.64..966.64 rows=19495 width=36) (actual time=126.372..127.126 rows=19495 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1094kB
                                      ->  Subquery Scan on oi_sum  (cost=528.00..966.64 rows=19495 width=36) (actual time=58.628..92.796 rows=19495 loops=3)
                                            ->  HashAggregate  (cost=528.00..771.69 rows=19495 width=36) (actual time=58.626..85.916 rows=19495 loops=3)
                                                  Group Key: "OrderItem".order_id
                                                  Batches: 1  Memory Usage: 7953kB
                                                  Worker 0:  Batches: 1  Memory Usage: 7953kB
                                                  Worker 1:  Batches: 1  Memory Usage: 7953kB
                                                  ->  Seq Scan on "OrderItem"  (cost=0.00..328.00 rows=20000 width=14) (actual time=9.179..19.734 rows=20000 loops=3)
                          ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.534..0.534 rows=1 loops=19495)
                                Index Cond: (id = o.user_id)
Planning Time: 24.621 ms
Execution Time: 4779.040 ms


==================================================
EXPLAIN ANALYZE — Query 3: Top 10 Najlepiej Sprzedających Się Produktów (wg. Ilości Sprzedanych Jednostek) w Ostatnim Kwartale
==================================================
Limit  (cost=9140.12..9140.14 rows=10 width=46) (actual time=113.102..159.502 rows=1 loops=1)
  ->  Sort  (cost=9140.12..9150.07 rows=3980 width=46) (actual time=113.100..159.500 rows=1 loops=1)
        Sort Key: (sum(oi.quantity)) DESC
        Sort Method: quicksort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=9014.31..9054.11 rows=3980 width=46) (actual time=110.711..157.137 rows=1 loops=1)
              Group Key: p.name, m.name
              Batches: 1  Memory Usage: 217kB
              ->  Gather  (cost=8641.26..8989.44 rows=3316 width=46) (actual time=110.696..157.101 rows=3 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=7641.26..7657.84 rows=1658 width=46) (actual time=70.294..70.303 rows=1 loops=3)
                          Group Key: p.name, m.name
                          Batches: 1  Memory Usage: 73kB
                          Worker 0:  Batches: 1  Memory Usage: 73kB
                          Worker 1:  Batches: 1  Memory Usage: 73kB
                          ->  Hash Join  (cost=2077.30..7628.82 rows=1658 width=42) (actual time=38.155..69.587 rows=1324 loops=3)
                                Hash Cond: (p.manufacturer_id = m.id)
                                ->  Nested Loop  (cost=2071.92..7618.98 rows=1658 width=21) (actual time=37.571..68.669 rows=1324 loops=3)
                                      ->  Nested Loop  (cost=2071.63..7071.66 rows=1658 width=8) (actual time=36.750..65.422 rows=1324 loops=3)
                                            ->  Hash Join  (cost=2071.34..6211.65 rows=1658 width=8) (actual time=30.105..55.419 rows=1324 loops=3)
                                                  Hash Cond: (o.id = oi.order_id)
                                                  ->  Parallel Bitmap Heap Scan on "Order" o  (cost=1493.34..5409.77 rows=33168 width=4) (actual time=21.742..41.572 rows=26376 loops=3)
                                                        Recheck Cond: (order_date >= (now() - '3 mons'::interval))
                                                        Heap Blocks: exact=1406
                                                        ->  Bitmap Index Scan on idx_order_date  (cost=0.00..1473.44 rows=79602 width=0) (actual time=47.817..47.817 rows=79127 loops=1)
                                                              Index Cond: (order_date >= (now() - '3 mons'::interval))
                                                  ->  Hash  (cost=328.00..328.00 rows=20000 width=12) (actual time=6.757..6.757 rows=20000 loops=3)
                                                        Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                                        ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=12) (actual time=0.027..2.694 rows=20000 loops=3)
                                            ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.52 rows=1 width=8) (actual time=0.007..0.007 rows=1 loops=3972)
                                                  Index Cond: (id = oi.variant_id)
                                      ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=21) (actual time=0.002..0.002 rows=1 loops=3972)
                                            Index Cond: (id = v.product_id)
                                ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.508..0.509 rows=150 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 18kB
                                      ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.029..0.048 rows=150 loops=3)
Planning Time: 55.153 ms
Execution Time: 160.234 ms


==================================================
EXPLAIN ANALYZE — Query 4: Top 5 produktów z najwięcej recenzjami
==================================================
Limit  (cost=1792.59..1792.61 rows=5 width=25) (actual time=203.247..203.251 rows=5 loops=1)
  ->  Sort  (cost=1792.59..1842.59 rows=20000 width=25) (actual time=203.245..203.249 rows=5 loops=1)
        Sort Key: (COALESCE(r.count, '0'::bigint)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Hash Left Join  (cost=969.89..1460.40 rows=20000 width=25) (actual time=62.262..199.962 rows=20000 loops=1)
              Hash Cond: (p.id = r.product_id)
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=1.104..91.436 rows=20000 loops=1)
              ->  Hash  (cost=812.24..812.24 rows=12612 width=12) (actual time=61.147..61.149 rows=12612 loops=1)
                    Buckets: 16384  Batches: 1  Memory Usage: 670kB
                    ->  Subquery Scan on r  (cost=560.00..812.24 rows=12612 width=12) (actual time=55.419..59.219 rows=12612 loops=1)
                          ->  HashAggregate  (cost=560.00..686.12 rows=12612 width=12) (actual time=55.418..58.007 rows=12612 loops=1)
                                Group Key: "Review".product_id
                                Batches: 1  Memory Usage: 1425kB
                                ->  Seq Scan on "Review"  (cost=0.00..460.00 rows=20000 width=4) (actual time=1.203..48.299 rows=20000 loops=1)
Planning Time: 9.832 ms
Execution Time: 204.406 ms


==================================================
EXPLAIN ANALYZE — Query 5: Całkowity Przychód Pogrupowany Miesięcznie za Ostatni Rok
==================================================
Finalize GroupAggregate  (cost=9410.36..11923.60 rows=18977 width=36) (actual time=129.067..171.378 rows=12 loops=1)
  Group Key: ((date_trunc('month'::text, o.order_date))::date)
  ->  Gather Merge  (cost=9410.36..11472.90 rows=15814 width=36) (actual time=128.833..171.352 rows=36 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=8410.33..8647.54 rows=7907 width=36) (actual time=107.273..109.775 rows=12 loops=3)
              Group Key: ((date_trunc('month'::text, o.order_date))::date)
              ->  Sort  (cost=8410.33..8430.10 rows=7907 width=14) (actual time=105.176..105.766 rows=6310 loops=3)
                    Sort Key: ((date_trunc('month'::text, o.order_date))::date) DESC
                    Sort Method: quicksort  Memory: 349kB
                    Worker 0:  Sort Method: quicksort  Memory: 678kB
                    Worker 1:  Sort Method: quicksort  Memory: 335kB
                    ->  Parallel Hash Join  (cost=769.00..7898.40 rows=7907 width=14) (actual time=17.644..99.298 rows=6310 loops=3)
                          Hash Cond: (o.id = oi.order_id)
                          ->  Parallel Seq Scan on "Order" o  (cost=0.00..6252.67 rows=158138 width=12) (actual time=0.016..54.883 rows=126415 loops=3)
                                Filter: (order_date >= (now() - '1 year'::interval))
                                Rows Removed by Filter: 6919
                          ->  Parallel Hash  (cost=621.93..621.93 rows=11765 width=14) (actual time=15.452..15.452 rows=6667 loops=3)
                                Buckets: 32768  Batches: 1  Memory Usage: 1248kB
                                ->  Parallel Index Only Scan using idx_orderitem_variant_order_agg on "OrderItem" oi  (cost=0.29..621.93 rows=11765 width=14) (actual time=1.779..13.374 rows=6667 loops=3)
                                      Heap Fetches: 0
Planning Time: 3.006 ms
Execution Time: 173.462 ms


==================================================
EXPLAIN ANALYZE — Query 6: Produkty najczęściej dodawane do ulubionych
==================================================
Limit  (cost=14382.58..14382.60 rows=10 width=25) (actual time=640.281..703.878 rows=10 loops=1)
  ->  Sort  (cost=14382.58..14432.58 rows=20000 width=25) (actual time=639.527..702.346 rows=10 loops=1)
        Sort Key: (count(f.user_id)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=13750.38..13950.38 rows=20000 width=25) (actual time=631.310..698.401 rows=20000 loops=1)
              Group Key: p.id
              Batches: 1  Memory Usage: 2577kB
              ->  Gather  (cost=9350.38..13550.38 rows=40000 width=25) (actual time=556.613..670.635 rows=59998 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=8350.38..8550.38 rows=20000 width=25) (actual time=548.774..555.475 rows=19999 loops=3)
                          Group Key: p.id
                          Batches: 1  Memory Usage: 2577kB
                          Worker 0:  Batches: 1  Memory Usage: 2577kB
                          Worker 1:  Batches: 1  Memory Usage: 2577kB
                          ->  Hash Join  (cost=688.00..7100.38 rows=250000 width=21) (actual time=8.912..447.648 rows=200000 loops=3)
                                Hash Cond: (f.product_id = p.id)
                                ->  Parallel Seq Scan on "FavoriteProduct" f  (cost=0.00..5756.00 rows=250000 width=8) (actual time=1.080..331.168 rows=200000 loops=3)
                                ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=7.031..7.033 rows=20000 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1215kB
                                      ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.026..2.883 rows=20000 loops=3)
Planning Time: 15.105 ms
Execution Time: 710.652 ms


==================================================
EXPLAIN ANALYZE — Query 7: Dostępny Stan Magazynowy Wariantów Produktu Pogrupowany po Magazynach
==================================================
Finalize GroupAggregate  (cost=8886.64..10869.06 rows=16000 width=61) (actual time=1604.826..2159.536 rows=231755 loops=1)
  Group Key: p.name, w.name, v.sku
  ->  Gather Merge  (cost=8886.64..10575.72 rows=13334 width=61) (actual time=1602.470..2058.686 rows=266530 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=7886.61..8036.62 rows=6667 width=61) (actual time=1555.730..1694.379 rows=88843 loops=3)
              Group Key: p.name, w.name, v.sku
              ->  Sort  (cost=7886.61..7903.28 rows=6667 width=57) (actual time=1554.903..1646.837 rows=106667 loops=3)
                    Sort Key: p.name, w.name, v.sku
                    Sort Method: external merge  Disk: 7256kB
                    Worker 0:  Sort Method: external merge  Disk: 8400kB
                    Worker 1:  Sort Method: external merge  Disk: 6128kB
                    ->  Hash Join  (cost=2543.72..7463.16 rows=6667 width=57) (actual time=289.060..1023.656 rows=106667 loops=3)
                          Hash Cond: (v.product_id = p.id)
                          ->  Hash Join  (cost=1855.72..6757.66 rows=6667 width=48) (actual time=280.785..966.658 rows=106667 loops=3)
                                Hash Cond: (ssi.variant_id = v.id)
                                ->  Hash Join  (cost=1.23..4885.66 rows=6667 width=25) (actual time=3.788..615.137 rows=106667 loops=3)
                                      Hash Cond: (ssi.warehouse_id = w.id)
                                      ->  Parallel Append  (cost=0.00..4527.02 rows=133333 width=12) (actual time=3.411..531.065 rows=106667 loops=3)
                                            ->  Parallel Seq Scan on "SerialStockItem" ssi  (cost=0.00..2001.16 rows=93816 width=12) (actual time=13.687..226.711 rows=53163 loops=3)
                                            ->  Parallel Seq Scan on "BulkStockItem" bsi  (cost=0.00..1859.19 rows=94419 width=12) (actual time=2.546..437.164 rows=80256 loops=2)
                                      ->  Hash  (cost=1.10..1.10 rows=10 width=21) (actual time=0.350..0.354 rows=10 loops=3)
                                            Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                            ->  Seq Scan on "Warehouse" w  (cost=0.00..1.10 rows=10 width=21) (actual time=0.343..0.344 rows=10 loops=3)
                                ->  Hash  (cost=1267.00..1267.00 rows=47000 width=31) (actual time=275.108..275.108 rows=47000 loops=3)
                                      Buckets: 65536  Batches: 1  Memory Usage: 3450kB
                                      ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=31) (actual time=0.655..251.772 rows=47000 loops=3)
                          ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=7.670..7.671 rows=20000 loops=3)
                                Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                                ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.027..3.005 rows=20000 loops=3)
Planning Time: 26.449 ms
Execution Time: 2182.941 ms


==================================================
EXPLAIN ANALYZE — Query 8: Stan magazynowy per produkt
==================================================
Sort  (cost=19267.36..19316.89 rows=19812 width=21) (actual time=482.643..484.442 rows=17954 loops=1)
  Sort Key: (sum("*SELECT* 1".quantity)) DESC
  Sort Method: quicksort  Memory: 1483kB
  ->  HashAggregate  (cost=17655.24..17853.36 rows=19812 width=21) (actual time=475.398..479.196 rows=17954 loops=1)
        Group Key: p.name
        Batches: 1  Memory Usage: 2065kB
        ->  Hash Join  (cost=2542.50..16055.24 rows=320000 width=17) (actual time=31.702..362.949 rows=320000 loops=1)
              Hash Cond: ("*SELECT* 1".product_id = p.id)
              ->  Append  (cost=1854.50..14527.07 rows=320000 width=8) (actual time=20.457..248.267 rows=320000 loops=1)
                    ->  Subquery Scan on "*SELECT* 1"  (cost=1854.50..6525.95 rows=159488 width=8) (actual time=20.455..119.477 rows=159488 loops=1)
                          ->  Hash Join  (cost=1854.50..4931.07 rows=159488 width=8) (actual time=20.454..103.904 rows=159488 loops=1)
                                Hash Cond: (ssi.variant_id = v.id)
                                ->  Seq Scan on "SerialStockItem" ssi  (cost=0.00..2657.88 rows=159488 width=4) (actual time=0.019..13.277 rows=159488 loops=1)
                                ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=20.413..20.415 rows=47000 loops=1)
                                      Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                      ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.011..12.222 rows=47000 loops=1)
                    ->  Subquery Scan on "*SELECT* 2"  (cost=1854.50..6401.12 rows=160512 width=8) (actual time=13.486..104.192 rows=160512 loops=1)
                          ->  Hash Join  (cost=1854.50..4796.00 rows=160512 width=8) (actual time=13.485..88.952 rows=160512 loops=1)
                                Hash Cond: (bsi.variant_id = v_1.id)
                                ->  Seq Scan on "BulkStockItem" bsi  (cost=0.00..2520.12 rows=160512 width=8) (actual time=0.025..14.069 rows=160512 loops=1)
                                ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=13.267..13.268 rows=47000 loops=1)
                                      Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                      ->  Seq Scan on "Variant" v_1  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.008..5.498 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=11.232..11.232 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.020..2.587 rows=20000 loops=1)
Planning Time: 43.353 ms
Execution Time: 488.474 ms


==================================================
EXPLAIN ANALYZE — Query 9: Najpopularniejsze Kategorie (wg. Całkowitego Przychodu)
==================================================
Limit  (cost=7440.92..7440.95 rows=10 width=44) (actual time=148.900..148.907 rows=1 loops=1)
  ->  Sort  (cost=7440.92..7441.30 rows=150 width=44) (actual time=148.898..148.904 rows=1 loops=1)
        Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
        Sort Method: quicksort  Memory: 25kB
        ->  HashAggregate  (cost=7435.81..7437.68 rows=150 width=44) (actual time=148.065..148.072 rows=1 loops=1)
              Group Key: c.name
              Batches: 1  Memory Usage: 40kB
              ->  Hash Join  (cost=3230.89..6435.81 rows=100000 width=22) (actual time=64.513..140.187 rows=20000 loops=1)
                    Hash Cond: (pc.category_id = c.id)
                    ->  Hash Join  (cost=3225.51..6160.51 rows=100000 width=14) (actual time=63.181..135.004 rows=20000 loops=1)
                          Hash Cond: (pc.product_id = p.id)
                          ->  Seq Scan on "ProductCategory" pc  (cost=0.00..1560.00 rows=100000 width=8) (actual time=1.275..82.977 rows=100000 loops=1)
                          ->  Hash  (cost=2975.51..2975.51 rows=20000 width=18) (actual time=36.835..36.839 rows=20000 loops=1)
                                Buckets: 32768  Batches: 1  Memory Usage: 1272kB
                                ->  Hash Join  (cost=2542.50..2975.51 rows=20000 width=18) (actual time=20.384..33.394 rows=20000 loops=1)
                                      Hash Cond: (v.product_id = p.id)
                                      ->  Hash Join  (cost=1854.50..2235.00 rows=20000 width=14) (actual time=15.182..24.799 rows=20000 loops=1)
                                            Hash Cond: (oi.variant_id = v.id)
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=14) (actual time=0.019..5.922 rows=20000 loops=1)
                                            ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=13.849..13.849 rows=47000 loops=1)
                                                  Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                                  ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.011..5.713 rows=47000 loops=1)
                                      ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=5.193..5.194 rows=20000 loops=1)
                                            Buckets: 32768  Batches: 1  Memory Usage: 960kB
                                            ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.008..2.196 rows=20000 loops=1)
                    ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=0.733..0.733 rows=150 loops=1)
                          Buckets: 1024  Batches: 1  Memory Usage: 16kB
                          ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=0.683..0.704 rows=150 loops=1)
Planning Time: 29.738 ms
Execution Time: 149.005 ms


==================================================
EXPLAIN ANALYZE — Query 10: Liczba produktów per kategoria
==================================================
Sort  (cost=2342.22..2342.59 rows=150 width=20) (actual time=51.193..51.203 rows=150 loops=1)
  Sort Key: (count(pc.product_id)) DESC
  Sort Method: quicksort  Memory: 30kB
  ->  HashAggregate  (cost=2335.30..2336.80 rows=150 width=20) (actual time=50.489..50.511 rows=150 loops=1)
        Group Key: c.name
        Batches: 1  Memory Usage: 48kB
        ->  Hash Right Join  (cost=5.38..1835.30 rows=100000 width=16) (actual time=0.665..29.729 rows=100000 loops=1)
              Hash Cond: (pc.category_id = c.id)
              ->  Seq Scan on "ProductCategory" pc  (cost=0.00..1560.00 rows=100000 width=8) (actual time=0.005..6.808 rows=100000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=0.060..0.060 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 16kB
                    ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=0.016..0.033 rows=150 loops=1)
Planning Time: 0.217 ms
Execution Time: 51.254 ms


==================================================
EXPLAIN ANALYZE — Query 11: Liczba zamówień per metoda płatności
==================================================
Sort  (cost=7798.49..7798.51 rows=6 width=50) (actual time=140.354..145.428 rows=6 loops=1)
  Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  Finalize GroupAggregate  (cost=7796.82..7798.41 rows=6 width=50) (actual time=139.731..144.817 rows=6 loops=1)
        Group Key: pm.name
        ->  Gather Merge  (cost=7796.82..7798.22 rows=12 width=50) (actual time=139.711..144.790 rows=18 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Sort  (cost=6796.80..6796.81 rows=6 width=50) (actual time=113.630..113.634 rows=6 loops=3)
                    Sort Key: pm.name
                    Sort Method: quicksort  Memory: 25kB
                    Worker 0:  Sort Method: quicksort  Memory: 25kB
                    Worker 1:  Sort Method: quicksort  Memory: 25kB
                    ->  Partial HashAggregate  (cost=6796.64..6796.72 rows=6 width=50) (actual time=111.937..111.942 rows=6 loops=3)
                          Group Key: pm.name
                          Batches: 1  Memory Usage: 24kB
                          Worker 0:  Batches: 1  Memory Usage: 24kB
                          Worker 1:  Batches: 1  Memory Usage: 24kB
                          ->  Hash Join  (cost=770.13..6692.48 rows=8333 width=24) (actual time=2.883..108.546 rows=6667 loops=3)
                                Hash Cond: (o.payment_method_id = pm.id)
                                ->  Parallel Hash Join  (cost=769.00..6654.02 rows=8333 width=18) (actual time=2.834..107.024 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.007..53.196 rows=133333 loops=3)
                                      ->  Parallel Hash  (cost=621.93..621.93 rows=11765 width=14) (actual time=2.695..2.696 rows=6667 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1216kB
                                            ->  Parallel Index Only Scan using idx_orderitem_variant_order_agg on "OrderItem" oi  (cost=0.29..621.93 rows=11765 width=14) (actual time=0.017..3.847 rows=20000 loops=1)
                                                  Heap Fetches: 0
                                ->  Hash  (cost=1.06..1.06 rows=6 width=14) (actual time=0.028..0.029 rows=6 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                      ->  Seq Scan on "PaymentMethod" pm  (cost=0.00..1.06 rows=6 width=14) (actual time=0.023..0.024 rows=6 loops=3)
Planning Time: 6.104 ms
Execution Time: 145.528 ms


==================================================
EXPLAIN ANALYZE — Query 12: Średnia ocena per producent
==================================================
Sort  (cost=1367.54..1367.91 rows=150 width=57) (actual time=50.520..50.531 rows=150 loops=1)
  Sort Key: (round(avg(r.rating), 2)) DESC NULLS LAST
  Sort Method: quicksort  Memory: 32kB
  ->  HashAggregate  (cost=1359.87..1362.12 rows=150 width=57) (actual time=50.402..50.465 rows=150 loops=1)
        Group Key: m.name
        Batches: 1  Memory Usage: 64kB
        ->  Hash Join  (cost=693.38..1259.87 rows=20000 width=29) (actual time=5.937..43.955 rows=27388 loops=1)
              Hash Cond: (p.manufacturer_id = m.id)
              ->  Hash Right Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=5.288..38.009 rows=27388 loops=1)
                    Hash Cond: (r.product_id = p.id)
                    ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=0.009..11.394 rows=20000 loops=1)
                    ->  Hash  (cost=438.00..438.00 rows=20000 width=8) (actual time=5.267..5.268 rows=20000 loops=1)
                          Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                          ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=8) (actual time=0.005..2.239 rows=20000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.056..0.056 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 18kB
                    ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.015..0.031 rows=150 loops=1)
Planning Time: 8.520 ms
Execution Time: 50.605 ms


==================================================
EXPLAIN ANALYZE — Query 13: Aktywne promocje i objęta nimi liczba wariantów
==================================================
Sort  (cost=587.95..588.05 rows=42 width=14) (actual time=13.477..13.481 rows=42 loops=1)
  Sort Key: (count(v.id)) DESC
  Sort Method: quicksort  Memory: 26kB
  ->  HashAggregate  (cost=586.40..586.82 rows=42 width=14) (actual time=13.455..13.464 rows=42 loops=1)
        Group Key: pr.name
        Batches: 1  Memory Usage: 24kB
        ->  Merge Join  (cost=7.46..535.87 rows=10105 width=10) (actual time=0.186..13.156 rows=1238 loops=1)
              Merge Cond: (v.promotion_id = pr.id)
              ->  Index Scan using idx_variant_promotion on "Variant" v  (cost=0.29..4233.14 rows=47000 width=8) (actual time=0.014..12.602 rows=5685 loops=1)
              ->  Sort  (cost=7.17..7.27 rows=43 width=10) (actual time=0.049..0.056 rows=43 loops=1)
                    Sort Key: pr.id
                    Sort Method: quicksort  Memory: 26kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=43 width=10) (actual time=0.014..0.037 rows=43 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 157
Planning Time: 15.519 ms
Execution Time: 14.154 ms


==================================================
EXPLAIN ANALYZE — Query 14: Najczęściej wybierane warianty w koszykach
==================================================
Limit  (cost=207700.11..207700.14 rows=10 width=44) (actual time=2782.301..2782.304 rows=10 loops=1)
  ->  Sort  (cost=207700.11..211450.11 rows=1500000 width=44) (actual time=2782.300..2782.302 rows=10 loops=1)
        Sort Key: (sum(ci.quantity)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  GroupAggregate  (cost=3.89..175285.65 rows=1500000 width=44) (actual time=12.516..2773.068 rows=47000 loops=1)
              Group Key: v.sku, p.name
              ->  Incremental Sort  (cost=3.89..149035.65 rows=1500000 width=40) (actual time=8.526..2471.596 rows=1500000 loops=1)
                    Sort Key: v.sku, p.name
                    Presorted Key: v.sku
                    Full-sort Groups: 31708  Sort Method: quicksort  Average Memory: 27kB  Peak Memory: 27kB
                    Pre-sorted Groups: 6442  Sort Method: quicksort  Average Memory: 26kB  Peak Memory: 26kB
                    ->  Nested Loop  (cost=1.14..91874.47 rows=1500000 width=40) (actual time=3.688..2015.532 rows=1500000 loops=1)
                          ->  Nested Loop  (cost=0.71..9221.47 rows=47000 width=40) (actual time=3.675..183.208 rows=47000 loops=1)
                                ->  Index Scan using uix_variant_sku on "Variant" v  (cost=0.41..2458.28 rows=47000 width=31) (actual time=3.635..60.483 rows=47000 loops=1)
                                ->  Memoize  (cost=0.30..0.34 rows=1 width=17) (actual time=0.002..0.002 rows=1 loops=47000)
                                      Cache Key: v.product_id
                                      Cache Mode: logical
                                      Hits: 28889  Misses: 18111  Evictions: 0  Overflows: 0  Memory Usage: 2099kB
                                      ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=17) (actual time=0.004..0.004 rows=1 loops=18111)
                                            Index Cond: (id = v.product_id)
                          ->  Index Only Scan using idx_cartitem_variant_quantity_cover on "CartItem" ci  (cost=0.43..1.43 rows=33 width=8) (actual time=0.003..0.036 rows=32 loops=47000)
                                Index Cond: (variant_id = v.id)
                                Heap Fetches: 150055
Planning Time: 14.821 ms
Execution Time: 2782.364 ms


==================================================
EXPLAIN ANALYZE — Query 15: Produkty z Największą Różnicą Między Ceną Podstawową a Ceną Wariantu
==================================================
Limit  (cost=3211.55..3211.58 rows=10 width=80) (actual time=58.860..58.863 rows=10 loops=1)
  ->  Sort  (cost=3211.55..3329.05 rows=47000 width=80) (actual time=58.859..58.861 rows=10 loops=1)
        Sort Key: v.price_modifier DESC
        Sort Method: top-N heapsort  Memory: 27kB
        ->  Hash Join  (cost=688.00..2195.90 rows=47000 width=80) (actual time=8.938..46.636 rows=47000 loops=1)
              Hash Cond: (v.product_id = p.id)
              ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=33) (actual time=0.580..7.746 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=8.338..8.339 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1381kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.011..3.298 rows=20000 loops=1)
Planning Time: 3.444 ms
Execution Time: 58.915 ms


==================================================
EXPLAIN ANALYZE — Query 16: Konwersja zamówień wg statusu
==================================================
Sort  (cost=7541.77..7541.79 rows=7 width=48) (actual time=134.560..203.397 rows=7 loops=1)
  Sort Key: (count(o.id)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  WindowAgg  (cost=7541.33..7541.67 rows=7 width=48) (actual time=134.543..203.385 rows=7 loops=1)
        ->  Finalize GroupAggregate  (cost=7539.74..7541.51 rows=7 width=16) (actual time=133.427..202.274 rows=7 loops=1)
              Group Key: s.name
              ->  Gather Merge  (cost=7539.74..7541.37 rows=14 width=16) (actual time=133.416..202.259 rows=21 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Sort  (cost=6539.71..6539.73 rows=7 width=16) (actual time=92.259..92.262 rows=7 loops=3)
                          Sort Key: s.name
                          Sort Method: quicksort  Memory: 25kB
                          Worker 0:  Sort Method: quicksort  Memory: 25kB
                          Worker 1:  Sort Method: quicksort  Memory: 25kB
                          ->  Partial HashAggregate  (cost=6539.55..6539.62 rows=7 width=16) (actual time=90.698..90.702 rows=7 loops=3)
                                Group Key: s.name
                                Batches: 1  Memory Usage: 24kB
                                Worker 0:  Batches: 1  Memory Usage: 24kB
                                Worker 1:  Batches: 1  Memory Usage: 24kB
                                ->  Hash Join  (cost=1.16..5706.21 rows=166667 width=12) (actual time=0.118..53.218 rows=133333 loops=3)
                                      Hash Cond: (o.status_id = s.id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.007..14.027 rows=133333 loops=3)
                                      ->  Hash  (cost=1.07..1.07 rows=7 width=12) (actual time=0.025..0.026 rows=7 loops=3)
                                            Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                            ->  Seq Scan on "Status" s  (cost=0.00..1.07 rows=7 width=12) (actual time=0.020..0.021 rows=7 loops=3)
Planning Time: 10.154 ms
Execution Time: 205.291 ms


==================================================
EXPLAIN ANALYZE — Query 17: Top klienci wg wydatków
==================================================
Limit  (cost=15389.43..15389.45 rows=10 width=50) (actual time=3413.109..3498.702 rows=10 loops=1)
  ->  Sort  (cost=15389.43..15439.43 rows=20000 width=50) (actual time=3413.108..3498.699 rows=10 loops=1)
        Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=14707.24..14957.24 rows=20000 width=50) (actual time=3385.576..3489.784 rows=19296 loops=1)
              Group Key: u.id
              Batches: 5  Memory Usage: 8241kB  Disk Usage: 224kB
              ->  Gather  (cost=12811.48..14582.24 rows=16666 width=50) (actual time=2710.681..3002.746 rows=19431 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=11811.48..11915.64 rows=8333 width=50) (actual time=2646.742..2716.712 rows=6477 loops=3)
                          Group Key: u.id
                          Batches: 1  Memory Usage: 2961kB
                          Worker 0:  Batches: 1  Memory Usage: 2961kB
                          Worker 1:  Batches: 1  Memory Usage: 2961kB
                          ->  Nested Loop  (cost=769.42..11728.15 rows=8333 width=28) (actual time=4.533..2548.801 rows=6667 loops=3)
                                ->  Parallel Hash Join  (cost=769.00..6654.02 rows=8333 width=14) (actual time=3.290..102.389 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.008..36.097 rows=133333 loops=3)
                                      ->  Parallel Hash  (cost=621.93..621.93 rows=11765 width=14) (actual time=2.999..3.720 rows=6667 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1216kB
                                            ->  Parallel Index Only Scan using idx_orderitem_variant_order_agg on "OrderItem" oi  (cost=0.29..621.93 rows=11765 width=14) (actual time=0.016..3.024 rows=20000 loops=1)
                                                  Heap Fetches: 0
                                ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.361..0.361 rows=1 loops=20000)
                                      Index Cond: (id = o.user_id)
Planning Time: 10.273 ms
Execution Time: 3511.139 ms


==================================================
EXPLAIN ANALYZE — Query 18: Produkty z wariantami objętymi promocją, z końcową ceną
==================================================
Sort  (cost=2074.11..2099.37 rows=10105 width=132) (actual time=134.330..134.473 rows=1238 loops=1)
  Sort Key: (round(((p.price + v.price_modifier) * ('1'::numeric - pr.discount_percentage)), 2))
  Sort Method: quicksort  Memory: 139kB
  ->  Hash Join  (cost=695.46..1401.98 rows=10105 width=132) (actual time=44.096..131.862 rows=1238 loops=1)
        Hash Cond: (v.product_id = p.id)
        ->  Merge Join  (cost=7.46..535.87 rows=10105 width=39) (actual time=21.080..107.246 rows=1238 loops=1)
              Merge Cond: (v.promotion_id = pr.id)
              ->  Index Scan using idx_variant_promotion on "Variant" v  (cost=0.29..4233.14 rows=47000 width=37) (actual time=1.066..105.548 rows=5685 loops=1)
              ->  Sort  (cost=7.17..7.27 rows=43 width=10) (actual time=1.124..1.138 rows=43 loops=1)
                    Sort Key: pr.id
                    Sort Method: quicksort  Memory: 26kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=43 width=10) (actual time=0.016..0.039 rows=43 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 157
        ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=18.962..18.963 rows=20000 loops=1)
              Buckets: 32768  Batches: 1  Memory Usage: 1381kB
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.023..10.947 rows=20000 loops=1)
Planning Time: 33.279 ms
Execution Time: 134.589 ms


==================================================
EXPLAIN ANALYZE — Query 19: Użytkownicy, Którzy Dodali Produkt do Koszyka, Ale Nie Złożyli Zamówienia (Potencjał Odbudowy Koszyka)
==================================================
Hash Join  (cost=46254.21..103988.81 rows=1068640 width=55) (actual time=3789.028..6453.447 rows=1005006 loops=1)
  Hash Cond: (v.product_id = p.id)
  ->  Hash Join  (cost=45566.21..100495.04 rows=1068640 width=46) (actual time=3779.930..5899.883 rows=1005006 loops=1)
        Hash Cond: (ci.variant_id = v.id)
        ->  Hash Join  (cost=43711.71..95835.11 rows=1068640 width=46) (actual time=3718.160..5104.670 rows=1005006 loops=1)
              Hash Cond: (ci.cart_id = c.id)
              ->  Seq Scan on "CartItem" ci  (cost=0.00..23152.00 rows=1500000 width=8) (actual time=0.695..571.873 rows=1500000 loops=1)
              ->  Hash  (cost=41435.91..41435.91 rows=106864 width=46) (actual time=3708.433..3717.620 rows=100414 loops=1)
                    Buckets: 131072  Batches: 2  Memory Usage: 4929kB
                    ->  Gather  (cost=25017.67..41435.91 rows=106864 width=46) (actual time=3436.130..3515.835 rows=100414 loops=1)
                          Workers Planned: 2
                          Workers Launched: 2
                          ->  Parallel Hash Right Anti Join  (cost=24017.67..29749.51 rows=44527 width=46) (actual time=2773.363..2787.519 rows=33471 loops=3)
                                Hash Cond: (o.user_id = u.id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=4) (actual time=1.455..246.538 rows=133333 loops=3)
                                ->  Parallel Hash  (cost=23236.42..23236.42 rows=62500 width=50) (actual time=2243.494..2243.866 rows=50000 loops=3)
                                      Buckets: 262144  Batches: 1  Memory Usage: 14720kB
                                      ->  Hash Join  (cost=4079.00..23236.42 rows=62500 width=50) (actual time=205.041..2037.516 rows=50000 loops=3)
                                            Hash Cond: (u.id = c.user_id)
                                            ->  Parallel Seq Scan on "User" u  (cost=0.00..18063.67 rows=416667 width=46) (actual time=29.852..1327.539 rows=333333 loops=3)
                                            ->  Hash  (cost=2204.00..2204.00 rows=150000 width=8) (actual time=164.608..164.609 rows=150000 loops=3)
                                                  Buckets: 262144  Batches: 1  Memory Usage: 7908kB
                                                  ->  Seq Scan on "Cart" c  (cost=0.00..2204.00 rows=150000 width=8) (actual time=8.114..83.711 rows=150000 loops=3)
        ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=56.044..56.045 rows=47000 loops=1)
              Buckets: 65536  Batches: 1  Memory Usage: 2348kB
              ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.015..46.409 rows=47000 loops=1)
  ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=5.658..6.206 rows=20000 loops=1)
        Buckets: 32768  Batches: 1  Memory Usage: 1245kB
        ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.014..2.919 rows=20000 loops=1)
Planning Time: 43.637 ms
Execution Time: 6590.793 ms


==================================================
EXPLAIN ANALYZE — Query 20: Wyszukiwanie produktów po nazwie lub opisie (parametryzowane)
==================================================
Bitmap Heap Scan on "Product"  (cost=43.00..57.51 rows=4 width=60) (actual time=6.239..39.241 rows=143 loops=1)
  Recheck Cond: (((name)::text ~~* '%test%'::text) OR (description ~~* '%test%'::text))
  Heap Blocks: exact=106
  ->  BitmapOr  (cost=43.00..43.00 rows=4 width=0) (actual time=5.533..5.535 rows=0 loops=1)
        ->  Bitmap Index Scan on idx_product_name_trgm  (cost=0.00..21.50 rows=2 width=0) (actual time=2.474..2.474 rows=42 loops=1)
              Index Cond: ((name)::text ~~* '%test%'::text)
        ->  Bitmap Index Scan on idx_product_description_trgm  (cost=0.00..21.50 rows=2 width=0) (actual time=3.057..3.057 rows=102 loops=1)
              Index Cond: (description ~~* '%test%'::text)
Planning Time: 130.804 ms
Execution Time: 43.196 ms


==================================================
EXPLAIN ANALYZE — Query 21: Użytkownicy, Którzy Zapisali Konkretny Produkt jako Ulubiony (np. Product ID=350259)
==================================================
Nested Loop  (cost=0.85..262.23 rows=30 width=56) (actual time=2.535..11.149 rows=26 loops=1)
  ->  Index Only Scan using idx_favoriteproduct_product_user on "FavoriteProduct" fp  (cost=0.42..8.95 rows=30 width=4) (actual time=1.932..1.939 rows=26 loops=1)
        Index Cond: (product_id = 35)
        Heap Fetches: 0
  ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..8.44 rows=1 width=60) (actual time=0.353..0.353 rows=1 loops=26)
        Index Cond: (id = fp.user_id)
Planning Time: 14.328 ms
Execution Time: 11.184 ms


==================================================
EXPLAIN ANALYZE — Query 22: Znajdź Magazyny, Które Posiadają Zapasy Konkretnego Wariantu (np. SKU='VR-000000-a637d44b7afd')
==================================================
Sort  (cost=27.64..27.64 rows=2 width=25) (actual time=6.023..6.028 rows=0 loops=1)
  Sort Key: (sum("*SELECT* 1".stock_units)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  GroupAggregate  (cost=27.51..27.63 rows=2 width=25) (actual time=4.140..4.145 rows=0 loops=1)
        Group Key: w.name
        Filter: (sum("*SELECT* 1".stock_units) > 0)
        ->  Sort  (cost=27.51..27.52 rows=6 width=21) (actual time=4.139..4.144 rows=0 loops=1)
              Sort Key: w.name
              Sort Method: quicksort  Memory: 25kB
              ->  Hash Join  (cost=2.06..27.43 rows=6 width=21) (actual time=2.983..2.988 rows=0 loops=1)
                    Hash Cond: ("*SELECT* 1".warehouse_id = w.id)
                    ->  Append  (cost=0.83..26.18 rows=6 width=8) (actual time=2.982..2.984 rows=0 loops=1)
                          ->  Subquery Scan on "*SELECT* 1"  (cost=0.83..13.08 rows=3 width=8) (actual time=2.963..2.963 rows=0 loops=1)
                                ->  Nested Loop  (cost=0.83..13.05 rows=3 width=8) (actual time=2.962..2.962 rows=0 loops=1)
                                      ->  Index Scan using uix_variant_sku on "Variant" v  (cost=0.41..8.43 rows=1 width=4) (actual time=2.961..2.961 rows=0 loops=1)
                                            Index Cond: ((sku)::text = 'VR-000001-2704de10f283'::text)
                                      ->  Index Only Scan using idx_bsi_variant_warehouse_qty on "BulkStockItem" bsi  (cost=0.42..4.54 rows=7 width=12) (never executed)
                                            Index Cond: (variant_id = v.id)
                                            Heap Fetches: 0
                          ->  Subquery Scan on "*SELECT* 2"  (cost=0.83..13.08 rows=3 width=8) (actual time=0.017..0.018 rows=0 loops=1)
                                ->  Nested Loop  (cost=0.83..13.05 rows=3 width=8) (actual time=0.017..0.017 rows=0 loops=1)
                                      ->  Index Scan using uix_variant_sku on "Variant" v_1  (cost=0.41..8.43 rows=1 width=4) (actual time=0.016..0.016 rows=0 loops=1)
                                            Index Cond: ((sku)::text = 'VR-000001-2704de10f283'::text)
                                      ->  Index Only Scan using idx_ssi_variant_warehouse on "SerialStockItem" ssi  (cost=0.42..4.54 rows=7 width=8) (never executed)
                                            Index Cond: (variant_id = v_1.id)
                                            Heap Fetches: 0
                    ->  Hash  (cost=1.10..1.10 rows=10 width=21) (never executed)
                          ->  Seq Scan on "Warehouse" w  (cost=0.00..1.10 rows=10 width=21) (never executed)
Planning Time: 17.636 ms
Execution Time: 6.651 ms


==================================================
EXPLAIN ANALYZE — Query 23: Warianty, Które Wymagają Uzyskania Konkretnej Opcji (np. 'Kolor'='Czerwony')
==================================================
Nested Loop  (cost=6.81..677.99 rows=8 width=36) (actual time=0.013..0.014 rows=0 loops=1)
  ->  Nested Loop  (cost=6.52..675.35 rows=8 width=27) (actual time=0.013..0.014 rows=0 loops=1)
        ->  Nested Loop  (cost=6.23..672.76 rows=8 width=4) (actual time=0.013..0.013 rows=0 loops=1)
              Join Filter: (opt.attribute_id = a.id)
              ->  Seq Scan on "Attribute" a  (cost=0.00..1.38 rows=1 width=4) (actual time=0.013..0.013 rows=0 loops=1)
                    Filter: ((name)::text = 'Attr_49_Century'::text)
                    Rows Removed by Filter: 30
              ->  Nested Loop  (cost=6.23..668.26 rows=250 width=8) (never executed)
                    ->  Seq Scan on "Option" opt  (cost=0.00..18.50 rows=1 width=8) (never executed)
                          Filter: ((value)::text = 'do'::text)
                    ->  Bitmap Heap Scan on "VariantOption" vo  (cost=6.23..647.26 rows=250 width=8) (never executed)
                          Recheck Cond: (option_id = opt.id)
                          ->  Bitmap Index Scan on idx_variantoption_option_id  (cost=0.00..6.17 rows=250 width=0) (never executed)
                                Index Cond: (option_id = opt.id)
        ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.32 rows=1 width=31) (never executed)
              Index Cond: (id = vo.variant_id)
  ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=17) (never executed)
        Index Cond: (id = v.product_id)
Planning Time: 38.141 ms
Execution Time: 0.072 ms


==================================================
EXPLAIN ANALYZE — Query 24: Znajdź Zamówienia Użytkownika (np. email='debbie.lane.16786.50af0753@example.com') o Statusie 'Paid'
==================================================
Nested Loop  (cost=0.98..17.07 rows=1 width=20) (actual time=4.879..4.881 rows=0 loops=1)
  ->  Nested Loop  (cost=0.85..16.89 rows=1 width=16) (actual time=4.878..4.879 rows=0 loops=1)
        ->  Index Scan using "User_email_key" on "User" u  (cost=0.42..8.44 rows=1 width=4) (actual time=4.877..4.878 rows=0 loops=1)
              Index Cond: ((email)::text = 'debbie.lane.16786.50af0753@example.com'::text)
        ->  Index Scan using idx_order_user on "Order" o  (cost=0.42..8.44 rows=1 width=20) (never executed)
              Index Cond: (user_id = u.id)
  ->  Index Scan using "Status_pkey" on "Status" s  (cost=0.13..0.15 rows=1 width=12) (never executed)
        Index Cond: (id = o.status_id)
        Filter: ((name)::text = 'Paid'::text)
Planning Time: 2.136 ms
Execution Time: 4.915 ms


==================================================
EXPLAIN ANALYZE — Query 25: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
Hash Left Join  (cost=6.97..48.34 rows=16 width=87) (actual time=4.883..12.140 rows=18 loops=1)
  Hash Cond: (opt.attribute_id = a.id)
  ->  Nested Loop Left Join  (cost=5.30..46.57 rows=16 width=45) (actual time=3.305..10.547 rows=18 loops=1)
        ->  Nested Loop Left Join  (cost=5.02..41.89 rows=16 width=39) (actual time=2.565..7.349 rows=18 loops=1)
              ->  Nested Loop  (cost=4.60..24.13 rows=3 width=39) (actual time=0.691..1.833 rows=4 loops=1)
                    ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..8.30 rows=1 width=10) (actual time=0.017..0.018 rows=1 loops=1)
                          Index Cond: (id = 35)
                    ->  Bitmap Heap Scan on "Variant" v  (cost=4.31..15.80 rows=3 width=37) (actual time=0.671..1.811 rows=4 loops=1)
                          Recheck Cond: (product_id = 35)
                          Heap Blocks: exact=4
                          ->  Bitmap Index Scan on idx_variant_product  (cost=0.00..4.31 rows=3 width=0) (actual time=0.014..0.015 rows=4 loops=1)
                                Index Cond: (product_id = 35)
              ->  Index Only Scan using uq_varopt_variant_option on "VariantOption" vo  (cost=0.42..5.86 rows=6 width=8) (actual time=1.375..1.377 rows=4 loops=4)
                    Index Cond: (variant_id = v.id)
                    Heap Fetches: 0
        ->  Index Scan using "Option_pkey" on "Option" opt  (cost=0.28..0.29 rows=1 width=14) (actual time=0.177..0.177 rows=1 loops=18)
              Index Cond: (id = vo.option_id)
  ->  Hash  (cost=1.30..1.30 rows=30 width=18) (actual time=0.024..0.025 rows=30 loops=1)
        Buckets: 1024  Batches: 1  Memory Usage: 10kB
        ->  Seq Scan on "Attribute" a  (cost=0.00..1.30 rows=30 width=18) (actual time=0.013..0.016 rows=30 loops=1)
Planning Time: 0.552 ms
Execution Time: 12.193 ms


==================================================
EXPLAIN ANALYZE — Query 26: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
Hash Left Join  (cost=6.97..48.42 rows=16 width=87) (actual time=0.007..0.008 rows=0 loops=1)
  Hash Cond: (opt.attribute_id = a.id)
  ->  Nested Loop Left Join  (cost=5.30..46.57 rows=16 width=45) (actual time=0.006..0.007 rows=0 loops=1)
        ->  Nested Loop Left Join  (cost=5.02..41.89 rows=16 width=39) (actual time=0.006..0.007 rows=0 loops=1)
              ->  Nested Loop  (cost=4.60..24.13 rows=3 width=39) (actual time=0.006..0.007 rows=0 loops=1)
                    ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..8.30 rows=1 width=10) (actual time=0.006..0.006 rows=0 loops=1)
                          Index Cond: (id = 350259)
                    ->  Bitmap Heap Scan on "Variant" v  (cost=4.31..15.80 rows=3 width=37) (never executed)
                          Recheck Cond: (product_id = 350259)
                          ->  Bitmap Index Scan on idx_variant_product  (cost=0.00..4.31 rows=3 width=0) (never executed)
                                Index Cond: (product_id = 350259)
              ->  Index Only Scan using uq_varopt_variant_option on "VariantOption" vo  (cost=0.42..5.86 rows=6 width=8) (never executed)
                    Index Cond: (variant_id = v.id)
                    Heap Fetches: 0
        ->  Index Scan using "Option_pkey" on "Option" opt  (cost=0.28..0.29 rows=1 width=14) (never executed)
              Index Cond: (id = vo.option_id)
  ->  Hash  (cost=1.30..1.30 rows=30 width=18) (never executed)
        ->  Seq Scan on "Attribute" a  (cost=0.00..1.30 rows=30 width=18) (never executed)
Planning Time: 0.558 ms
Execution Time: 0.046 ms


==================================================
EXPLAIN ANALYZE — Query 27: Lista Wszystkich Dziecięcych Kategorii (Podkategorii) dla Konkretnej Kategorii Nadrzędnej (np. ID=5)
==================================================
Seq Scan on "Category"  (cost=0.00..3.88 rows=3 width=12) (actual time=1.786..1.798 rows=3 loops=1)
  Filter: (parent_id = 5)
  Rows Removed by Filter: 147
Planning Time: 0.815 ms
Execution Time: 1.814 ms


==================================================
EXPLAIN ANALYZE — Query 28: Porównanie Średniej Oceny dla Promowanych i Niepromowanych Produktów
==================================================
HashAggregate  (cost=87850.51..87853.01 rows=200 width=64) (actual time=114.900..114.905 rows=2 loops=1)
  Group Key: CASE WHEN (ANY (p.id = (hashed SubPlan 2).col1)) THEN 'Promowany'::text ELSE 'Niepromowany'::text END
  Batches: 1  Memory Usage: 40kB
  ->  HashAggregate  (cost=1300.51..87550.51 rows=20000 width=68) (actual time=104.947..111.865 rows=12612 loops=1)
        Group Key: p.id
        Batches: 1  Memory Usage: 2577kB
        ->  Hash Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=61.407..85.256 rows=20000 loops=1)
              Hash Cond: (r.product_id = p.id)
              ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=0.652..17.005 rows=20000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=60.719..60.720 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 960kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.006..54.978 rows=20000 loops=1)
        SubPlan 2
          ->  Index Only Scan using idx_variant_product_promotion on "Variant" v2  (cost=0.28..215.94 rows=5577 width=4) (actual time=1.831..10.326 rows=5684 loops=1)
                Heap Fetches: 0
Planning Time: 4.604 ms
Execution Time: 116.145 ms


==================================================
EXPLAIN ANALYZE — Query 29: Top 5 Miast Generujących Największy Przychód (Wg. Adresu Wysyłki)
==================================================
Limit  (cost=15305.18..15305.19 rows=5 width=45) (actual time=3813.889..3867.870 rows=5 loops=1)
  ->  Sort  (cost=15305.18..15355.18 rows=20000 width=45) (actual time=3813.879..3866.433 rows=5 loops=1)
        Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=14722.99..14972.99 rows=20000 width=45) (actual time=3803.825..3861.663 rows=12950 loops=1)
              Group Key: a.city
              Batches: 1  Memory Usage: 5905kB
              ->  Gather  (cost=12827.23..14597.99 rows=16666 width=45) (actual time=3621.582..3731.711 rows=16081 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=11827.23..11931.39 rows=8333 width=45) (actual time=3594.046..3601.956 rows=5360 loops=3)
                          Group Key: a.city
                          Batches: 1  Memory Usage: 2449kB
                          Worker 0:  Batches: 1  Memory Usage: 2449kB
                          Worker 1:  Batches: 1  Memory Usage: 2449kB
                          ->  Nested Loop  (cost=769.42..11743.90 rows=8333 width=23) (actual time=7.111..3570.125 rows=6667 loops=3)
                                ->  Parallel Hash Join  (cost=769.00..6654.02 rows=8333 width=14) (actual time=5.299..107.328 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.010..37.412 rows=133333 loops=3)
                                      ->  Parallel Hash  (cost=621.93..621.93 rows=11765 width=14) (actual time=5.136..6.373 rows=6667 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1216kB
                                            ->  Parallel Index Only Scan using idx_orderitem_variant_order_agg on "OrderItem" oi  (cost=0.29..621.93 rows=11765 width=14) (actual time=1.238..8.797 rows=20000 loops=1)
                                                  Heap Fetches: 0
                                ->  Index Scan using "Address_pkey" on "Address" a  (cost=0.43..0.61 rows=1 width=17) (actual time=0.518..0.518 rows=1 loops=20000)
                                      Index Cond: (id = o.shipping_address_id)
Planning Time: 19.376 ms
Execution Time: 3873.636 ms


==================================================
EXPLAIN ANALYZE — Query 30: Porównanie Wolumenu Sprzedaży Produktów Promowanych vs. Niepromowanych (w Ostatnich 30 Dniach)
==================================================
GroupAggregate  (cost=4663.30..4669.91 rows=200 width=40) (actual time=62.520..62.532 rows=1 loops=1)
  Group Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
  ->  Sort  (cost=4663.30..4664.84 rows=614 width=36) (actual time=62.395..62.438 rows=619 loops=1)
        Sort Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
        Sort Method: quicksort  Memory: 49kB
        ->  Nested Loop  (cost=3936.17..4634.87 rows=614 width=36) (actual time=22.780..62.277 rows=619 loops=1)
              ->  Hash Join  (cost=3935.88..4316.38 rows=614 width=8) (actual time=21.690..60.123 rows=619 loops=1)
                    Hash Cond: (oi.order_id = o.id)
                    ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=12) (actual time=1.404..36.224 rows=20000 loops=1)
                    ->  Hash  (cost=3782.42..3782.42 rows=12277 width=4) (actual time=20.264..20.265 rows=12322 loops=1)
                          Buckets: 16384  Batches: 1  Memory Usage: 562kB
                          ->  Bitmap Heap Scan on "Order" o  (cost=231.57..3782.42 rows=12277 width=4) (actual time=10.059..18.353 rows=12322 loops=1)
                                Recheck Cond: (order_date >= (now() - '30 days'::interval))
                                Heap Blocks: exact=3270
                                ->  Bitmap Index Scan on idx_order_date  (cost=0.00..228.50 rows=12277 width=0) (actual time=9.682..9.682 rows=12322 loops=1)
                                      Index Cond: (order_date >= (now() - '30 days'::interval))
              ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.52 rows=1 width=8) (actual time=0.003..0.003 rows=1 loops=619)
                    Index Cond: (id = oi.variant_id)
Planning Time: 18.068 ms
Execution Time: 63.214 ms


==================================================
EXPLAIN ANALYZE — Query 31: Wskaźnik Lojalności (Repeat Purchase Rate) Użytkowników z Podziałem na Miasto Adresu Rozliczeniowego
==================================================
Sort  (cost=128699.75..128773.84 rows=29636 width=61) (actual time=5253.634..5336.421 rows=66456 loops=1)
  Sort Key: (round((((count(*) FILTER (WHERE (u.orders_count > 1)))::numeric * 100.0) / (NULLIF(count(DISTINCT o.user_id), 0))::numeric), 2)) DESC
  Sort Method: external merge  Disk: 3192kB
  ->  GroupAggregate  (cost=75171.04..126498.53 rows=29636 width=61) (actual time=4614.085..5114.759 rows=66456 loops=1)
        Group Key: a.city
        ->  Gather Merge  (cost=75171.04..121757.63 rows=400000 width=25) (actual time=4604.775..4958.717 rows=400000 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Sort  (cost=74171.01..74587.68 rows=166667 width=25) (actual time=4183.928..4262.860 rows=133333 loops=3)
                    Sort Key: a.city, o.user_id
                    Sort Method: external merge  Disk: 4472kB
                    Worker 0:  Sort Method: external merge  Disk: 5408kB
                    Worker 1:  Sort Method: external merge  Disk: 5448kB
                    ->  Parallel Hash Join  (cost=34868.03..55725.48 rows=166667 width=25) (actual time=1252.636..3443.984 rows=133333 loops=3)
                          Hash Cond: (a.id = o.billing_address_id)
                          ->  Parallel Seq Scan on "Address" a  (cost=0.00..18288.00 rows=500000 width=17) (actual time=8.494..1468.042 rows=400000 loops=3)
                          ->  Parallel Hash  (cost=32784.69..32784.69 rows=166667 width=16) (actual time=1241.298..1243.483 rows=133333 loops=3)
                                Buckets: 524288  Batches: 1  Memory Usage: 22912kB
                                ->  Hash Join  (cost=24635.51..32784.69 rows=166667 width=16) (actual time=603.348..980.579 rows=133333 loops=3)
                                      Hash Cond: (o.user_id = u.user_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.017..118.186 rows=133333 loops=3)
                                      ->  Hash  (cost=19635.86..19635.86 rows=287572 width=12) (actual time=588.631..589.411 rows=329619 loops=3)
                                            Buckets: 262144  Batches: 4  Memory Usage: 5596kB
                                            ->  Subquery Scan on u  (cost=0.42..19635.86 rows=287572 width=12) (actual time=23.663..493.666 rows=329619 loops=3)
                                                  ->  GroupAggregate  (cost=0.42..16760.14 rows=287572 width=12) (actual time=23.662..461.338 rows=329619 loops=3)
                                                        Group Key: "Order".user_id
                                                        ->  Index Only Scan using idx_order_user on "Order"  (cost=0.42..11884.42 rows=400000 width=4) (actual time=23.645..368.523 rows=400000 loops=3)
                                                              Heap Fetches: 150240
Planning Time: 6.310 ms
Execution Time: 5423.846 ms

FINISHED — 2025-12-02 21:16:29.125882
========================================================================================================================
========================================================================================================================
START EXPLAIN RUN — 2025-12-02 21:19:52.480069
========================================================================================================================


==================================================
EXPLAIN ANALYZE — Query 1: Średnia Wartość Zamówienia (AOV) w Ostatnim Miesiącu
==================================================
Aggregate  (cost=4367.73..4367.74 rows=1 width=32) (actual time=496.943..496.946 rows=1 loops=1)
  ->  GroupAggregate  (cost=4344.71..4360.06 rows=614 width=36) (actual time=496.396..496.892 rows=608 loops=1)
        Group Key: o.id
        ->  Sort  (cost=4344.71..4346.24 rows=614 width=14) (actual time=496.375..496.433 rows=619 loops=1)
              Sort Key: o.id
              Sort Method: quicksort  Memory: 44kB
              ->  Hash Join  (cost=3935.77..4316.27 rows=614 width=14) (actual time=469.556..496.179 rows=619 loops=1)
                    Hash Cond: (oi.order_id = o.id)
                    ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=14) (actual time=0.011..23.027 rows=20000 loops=1)
                    ->  Hash  (cost=3782.35..3782.35 rows=12274 width=4) (actual time=469.315..469.316 rows=12321 loops=1)
                          Buckets: 16384  Batches: 1  Memory Usage: 562kB
                          ->  Bitmap Heap Scan on "Order" o  (cost=231.55..3782.35 rows=12274 width=4) (actual time=9.546..466.045 rows=12321 loops=1)
                                Recheck Cond: (order_date >= (now() - '1 mon'::interval))
                                Heap Blocks: exact=3270
                                ->  Bitmap Index Scan on idx_order_date  (cost=0.00..228.48 rows=12274 width=0) (actual time=9.157..9.158 rows=12321 loops=1)
                                      Index Cond: (order_date >= (now() - '1 mon'::interval))
Planning Time: 48.524 ms
Execution Time: 497.104 ms


==================================================
EXPLAIN ANALYZE — Query 2: Średnia wartość zamówienia per użytkownik - ZOPTYMALIZOWANA
==================================================
Sort  (cost=16166.87..16215.61 rows=19495 width=50) (actual time=4326.662..4378.294 rows=19296 loops=1)
  Sort Key: (round(avg(oi_sum.total_price), 2)) DESC
  Sort Method: quicksort  Memory: 1612kB
  ->  Finalize HashAggregate  (cost=14485.35..14777.77 rows=19495 width=50) (actual time=4283.563..4361.431 rows=19296 loops=1)
        Group Key: u.id
        Batches: 5  Memory Usage: 8241kB  Disk Usage: 224kB
        ->  Gather  (cost=12637.36..14363.50 rows=16246 width=50) (actual time=4096.085..4221.027 rows=19438 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial HashAggregate  (cost=11637.36..11738.90 rows=8123 width=50) (actual time=4082.013..4088.452 rows=6479 loops=3)
                    Group Key: u.id
                    Batches: 1  Memory Usage: 2961kB
                    Worker 0:  Batches: 1  Memory Usage: 2961kB
                    Worker 1:  Batches: 1  Memory Usage: 2961kB
                    ->  Nested Loop  (cost=1210.75..11596.75 rows=8123 width=50) (actual time=163.455..4029.670 rows=6498 loops=3)
                          ->  Hash Join  (cost=1210.33..6650.49 rows=8123 width=36) (actual time=125.484..266.371 rows=6498 loops=3)
                                Hash Cond: (o.id = oi_sum.order_id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.007..45.602 rows=133333 loops=3)
                                ->  Hash  (cost=966.64..966.64 rows=19495 width=36) (actual time=125.094..126.665 rows=19495 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1094kB
                                      ->  Subquery Scan on oi_sum  (cost=528.00..966.64 rows=19495 width=36) (actual time=101.460..115.636 rows=19495 loops=3)
                                            ->  HashAggregate  (cost=528.00..771.69 rows=19495 width=36) (actual time=101.459..112.617 rows=19495 loops=3)
                                                  Group Key: "OrderItem".order_id
                                                  Batches: 1  Memory Usage: 7953kB
                                                  Worker 0:  Batches: 1  Memory Usage: 7953kB
                                                  Worker 1:  Batches: 1  Memory Usage: 7953kB
                                                  ->  Seq Scan on "OrderItem"  (cost=0.00..328.00 rows=20000 width=14) (actual time=0.027..25.397 rows=20000 loops=3)
                          ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.570..0.570 rows=1 loops=19495)
                                Index Cond: (id = o.user_id)
Planning Time: 21.565 ms
Execution Time: 4419.397 ms


==================================================
EXPLAIN ANALYZE — Query 3: Top 10 Najlepiej Sprzedających Się Produktów (wg. Ilości Sprzedanych Jednostek) w Ostatnim Kwartale
==================================================
Limit  (cost=9140.06..9140.08 rows=10 width=46) (actual time=108.911..185.967 rows=1 loops=1)
  ->  Sort  (cost=9140.06..9150.01 rows=3980 width=46) (actual time=108.909..185.965 rows=1 loops=1)
        Sort Key: (sum(oi.quantity)) DESC
        Sort Method: quicksort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=9014.25..9054.05 rows=3980 width=46) (actual time=106.560..183.646 rows=1 loops=1)
              Group Key: p.name, m.name
              Batches: 1  Memory Usage: 217kB
              ->  Gather  (cost=8641.20..8989.38 rows=3316 width=46) (actual time=103.898..183.595 rows=3 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=7641.20..7657.78 rows=1658 width=46) (actual time=54.082..54.091 rows=1 loops=3)
                          Group Key: p.name, m.name
                          Batches: 1  Memory Usage: 73kB
                          Worker 0:  Batches: 1  Memory Usage: 73kB
                          Worker 1:  Batches: 1  Memory Usage: 73kB
                          ->  Hash Join  (cost=2077.27..7628.77 rows=1658 width=42) (actual time=23.109..53.593 rows=1324 loops=3)
                                Hash Cond: (p.manufacturer_id = m.id)
                                ->  Nested Loop  (cost=2071.90..7618.92 rows=1658 width=21) (actual time=22.323..52.476 rows=1324 loops=3)
                                      ->  Nested Loop  (cost=2071.61..7071.60 rows=1658 width=8) (actual time=21.914..49.753 rows=1324 loops=3)
                                            ->  Hash Join  (cost=2071.32..6211.60 rows=1658 width=8) (actual time=21.719..47.003 rows=1324 loops=3)
                                                  Hash Cond: (o.id = oi.order_id)
                                                  ->  Parallel Bitmap Heap Scan on "Order" o  (cost=1493.32..5409.73 rows=33166 width=4) (actual time=13.394..30.334 rows=26373 loops=3)
                                                        Recheck Cond: (order_date >= (now() - '3 mons'::interval))
                                                        Heap Blocks: exact=1605
                                                        ->  Bitmap Index Scan on idx_order_date  (cost=0.00..1473.42 rows=79599 width=0) (actual time=39.459..39.460 rows=79120 loops=1)
                                                              Index Cond: (order_date >= (now() - '3 mons'::interval))
                                                  ->  Hash  (cost=328.00..328.00 rows=20000 width=12) (actual time=7.210..7.211 rows=20000 loops=3)
                                                        Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                                        ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=12) (actual time=0.273..2.870 rows=20000 loops=3)
                                            ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.52 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=3972)
                                                  Index Cond: (id = oi.variant_id)
                                      ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=21) (actual time=0.002..0.002 rows=1 loops=3972)
                                            Index Cond: (id = v.product_id)
                                ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.667..0.667 rows=150 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 18kB
                                      ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.030..0.048 rows=150 loops=3)
Planning Time: 50.505 ms
Execution Time: 188.286 ms


==================================================
EXPLAIN ANALYZE — Query 4: Top 5 produktów z najwięcej recenzjami
==================================================
Limit  (cost=1792.59..1792.61 rows=5 width=25) (actual time=124.401..124.405 rows=5 loops=1)
  ->  Sort  (cost=1792.59..1842.59 rows=20000 width=25) (actual time=124.399..124.403 rows=5 loops=1)
        Sort Key: (COALESCE(r.count, '0'::bigint)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Hash Left Join  (cost=969.89..1460.40 rows=20000 width=25) (actual time=43.145..121.183 rows=20000 loops=1)
              Hash Cond: (p.id = r.product_id)
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.011..44.865 rows=20000 loops=1)
              ->  Hash  (cost=812.24..812.24 rows=12612 width=12) (actual time=43.123..43.125 rows=12612 loops=1)
                    Buckets: 16384  Batches: 1  Memory Usage: 670kB
                    ->  Subquery Scan on r  (cost=560.00..812.24 rows=12612 width=12) (actual time=37.477..41.177 rows=12612 loops=1)
                          ->  HashAggregate  (cost=560.00..686.12 rows=12612 width=12) (actual time=37.476..39.990 rows=12612 loops=1)
                                Group Key: "Review".product_id
                                Batches: 1  Memory Usage: 1425kB
                                ->  Seq Scan on "Review"  (cost=0.00..460.00 rows=20000 width=4) (actual time=1.195..30.357 rows=20000 loops=1)
Planning Time: 16.019 ms
Execution Time: 125.053 ms


==================================================
EXPLAIN ANALYZE — Query 5: Całkowity Przychód Pogrupowany Miesięcznie za Ostatni Rok
==================================================
Finalize GroupAggregate  (cost=9410.35..11923.58 rows=18976 width=36) (actual time=147.239..220.879 rows=12 loops=1)
  Group Key: ((date_trunc('month'::text, o.order_date))::date)
  ->  Gather Merge  (cost=9410.35..11472.89 rows=15814 width=36) (actual time=146.699..220.843 rows=36 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=8410.33..8647.54 rows=7907 width=36) (actual time=88.246..90.797 rows=12 loops=3)
              Group Key: ((date_trunc('month'::text, o.order_date))::date)
              ->  Sort  (cost=8410.33..8430.10 rows=7907 width=14) (actual time=86.612..87.247 rows=6310 loops=3)
                    Sort Key: ((date_trunc('month'::text, o.order_date))::date) DESC
                    Sort Method: quicksort  Memory: 774kB
                    Worker 0:  Sort Method: quicksort  Memory: 202kB
                    Worker 1:  Sort Method: quicksort  Memory: 194kB
                    ->  Parallel Hash Join  (cost=769.00..7898.39 rows=7907 width=14) (actual time=7.469..84.684 rows=6310 loops=3)
                          Hash Cond: (o.id = oi.order_id)
                          ->  Parallel Seq Scan on "Order" o  (cost=0.00..6252.67 rows=158137 width=12) (actual time=0.013..52.907 rows=126415 loops=3)
                                Filter: (order_date >= (now() - '1 year'::interval))
                                Rows Removed by Filter: 6919
                          ->  Parallel Hash  (cost=621.93..621.93 rows=11765 width=14) (actual time=6.931..6.932 rows=6667 loops=3)
                                Buckets: 32768  Batches: 1  Memory Usage: 1216kB
                                ->  Parallel Index Only Scan using idx_orderitem_variant_order_agg on "OrderItem" oi  (cost=0.29..621.93 rows=11765 width=14) (actual time=1.688..15.177 rows=20000 loops=1)
                                      Heap Fetches: 0
Planning Time: 3.111 ms
Execution Time: 222.809 ms


==================================================
EXPLAIN ANALYZE — Query 6: Produkty najczęściej dodawane do ulubionych
==================================================
Limit  (cost=14382.58..14382.60 rows=10 width=25) (actual time=544.093..610.207 rows=10 loops=1)
  ->  Sort  (cost=14382.58..14432.58 rows=20000 width=25) (actual time=544.078..609.492 rows=10 loops=1)
        Sort Key: (count(f.user_id)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=13750.38..13950.38 rows=20000 width=25) (actual time=534.723..604.350 rows=20000 loops=1)
              Group Key: p.id
              Batches: 1  Memory Usage: 2577kB
              ->  Gather  (cost=9350.38..13550.38 rows=40000 width=25) (actual time=456.161..573.954 rows=59994 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=8350.38..8550.38 rows=20000 width=25) (actual time=404.136..411.488 rows=19998 loops=3)
                          Group Key: p.id
                          Batches: 1  Memory Usage: 2577kB
                          Worker 0:  Batches: 1  Memory Usage: 2577kB
                          Worker 1:  Batches: 1  Memory Usage: 2577kB
                          ->  Hash Join  (cost=688.00..7100.38 rows=250000 width=21) (actual time=8.783..330.128 rows=200000 loops=3)
                                Hash Cond: (f.product_id = p.id)
                                ->  Parallel Seq Scan on "FavoriteProduct" f  (cost=0.00..5756.00 rows=250000 width=8) (actual time=1.347..242.859 rows=200000 loops=3)
                                ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=7.144..7.145 rows=20000 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1215kB
                                      ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.027..2.855 rows=20000 loops=3)
Planning Time: 19.902 ms
Execution Time: 612.812 ms


==================================================
EXPLAIN ANALYZE — Query 7: Dostępny Stan Magazynowy Wariantów Produktu Pogrupowany po Magazynach
==================================================
Finalize GroupAggregate  (cost=8886.64..10869.06 rows=16000 width=61) (actual time=1498.893..2048.098 rows=231755 loops=1)
  Group Key: p.name, w.name, v.sku
  ->  Gather Merge  (cost=8886.64..10575.72 rows=13334 width=61) (actual time=1496.783..1951.140 rows=266752 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=7886.61..8036.62 rows=6667 width=61) (actual time=1451.140..1588.711 rows=88917 loops=3)
              Group Key: p.name, w.name, v.sku
              ->  Sort  (cost=7886.61..7903.28 rows=6667 width=57) (actual time=1448.083..1537.721 rows=106667 loops=3)
                    Sort Key: p.name, w.name, v.sku
                    Sort Method: external merge  Disk: 6648kB
                    Worker 0:  Sort Method: external merge  Disk: 6824kB
                    Worker 1:  Sort Method: external merge  Disk: 8304kB
                    ->  Hash Join  (cost=2543.72..7463.16 rows=6667 width=57) (actual time=118.612..882.422 rows=106667 loops=3)
                          Hash Cond: (v.product_id = p.id)
                          ->  Hash Join  (cost=1855.72..6757.66 rows=6667 width=48) (actual time=111.536..810.792 rows=106667 loops=3)
                                Hash Cond: (ssi.variant_id = v.id)
                                ->  Hash Join  (cost=1.23..4885.66 rows=6667 width=25) (actual time=2.934..622.551 rows=106667 loops=3)
                                      Hash Cond: (ssi.warehouse_id = w.id)
                                      ->  Parallel Append  (cost=0.00..4527.02 rows=133333 width=12) (actual time=2.671..551.382 rows=106667 loops=3)
                                            ->  Parallel Seq Scan on "SerialStockItem" ssi  (cost=0.00..2001.16 rows=93816 width=12) (actual time=3.680..236.719 rows=53163 loops=3)
                                            ->  Parallel Seq Scan on "BulkStockItem" bsi  (cost=0.00..1859.19 rows=94419 width=12) (actual time=2.147..456.142 rows=80256 loops=2)
                                      ->  Hash  (cost=1.10..1.10 rows=10 width=21) (actual time=0.243..0.777 rows=10 loops=3)
                                            Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                            ->  Seq Scan on "Warehouse" w  (cost=0.00..1.10 rows=10 width=21) (actual time=0.235..0.237 rows=10 loops=3)
                                ->  Hash  (cost=1267.00..1267.00 rows=47000 width=31) (actual time=106.418..106.419 rows=47000 loops=3)
                                      Buckets: 65536  Batches: 1  Memory Usage: 3450kB
                                      ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=31) (actual time=0.862..92.208 rows=47000 loops=3)
                          ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=6.860..6.861 rows=20000 loops=3)
                                Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                                ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.025..2.979 rows=20000 loops=3)
Planning Time: 20.531 ms
Execution Time: 2069.314 ms


==================================================
EXPLAIN ANALYZE — Query 8: Stan magazynowy per produkt
==================================================
Sort  (cost=19267.36..19316.89 rows=19812 width=21) (actual time=585.887..587.821 rows=17954 loops=1)
  Sort Key: (sum("*SELECT* 1".quantity)) DESC
  Sort Method: quicksort  Memory: 1483kB
  ->  HashAggregate  (cost=17655.24..17853.36 rows=19812 width=21) (actual time=577.839..581.771 rows=17954 loops=1)
        Group Key: p.name
        Batches: 1  Memory Usage: 2065kB
        ->  Hash Join  (cost=2542.50..16055.24 rows=320000 width=17) (actual time=40.241..441.113 rows=320000 loops=1)
              Hash Cond: ("*SELECT* 1".product_id = p.id)
              ->  Append  (cost=1854.50..14527.07 rows=320000 width=8) (actual time=28.476..301.600 rows=320000 loops=1)
                    ->  Subquery Scan on "*SELECT* 1"  (cost=1854.50..6525.95 rows=159488 width=8) (actual time=28.474..156.152 rows=159488 loops=1)
                          ->  Hash Join  (cost=1854.50..4931.07 rows=159488 width=8) (actual time=28.473..139.077 rows=159488 loops=1)
                                Hash Cond: (ssi.variant_id = v.id)
                                ->  Seq Scan on "SerialStockItem" ssi  (cost=0.00..2657.88 rows=159488 width=4) (actual time=0.022..19.748 rows=159488 loops=1)
                                ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=28.427..28.429 rows=47000 loops=1)
                                      Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                      ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.005..19.035 rows=47000 loops=1)
                    ->  Subquery Scan on "*SELECT* 2"  (cost=1854.50..6401.12 rows=160512 width=8) (actual time=14.307..120.103 rows=160512 loops=1)
                          ->  Hash Join  (cost=1854.50..4796.00 rows=160512 width=8) (actual time=14.305..104.882 rows=160512 loops=1)
                                Hash Cond: (bsi.variant_id = v_1.id)
                                ->  Seq Scan on "BulkStockItem" bsi  (cost=0.00..2520.12 rows=160512 width=8) (actual time=0.018..20.497 rows=160512 loops=1)
                                ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=14.087..14.087 rows=47000 loops=1)
                                      Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                      ->  Seq Scan on "Variant" v_1  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.008..5.501 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=11.750..11.751 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.022..4.039 rows=20000 loops=1)
Planning Time: 40.044 ms
Execution Time: 591.972 ms


==================================================
EXPLAIN ANALYZE — Query 9: Najpopularniejsze Kategorie (wg. Całkowitego Przychodu)
==================================================
Limit  (cost=7440.92..7440.95 rows=10 width=44) (actual time=219.597..219.605 rows=1 loops=1)
  ->  Sort  (cost=7440.92..7441.30 rows=150 width=44) (actual time=219.596..219.603 rows=1 loops=1)
        Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
        Sort Method: quicksort  Memory: 25kB
        ->  HashAggregate  (cost=7435.81..7437.68 rows=150 width=44) (actual time=219.132..219.140 rows=1 loops=1)
              Group Key: c.name
              Batches: 1  Memory Usage: 40kB
              ->  Hash Join  (cost=3230.89..6435.81 rows=100000 width=22) (actual time=96.294..211.217 rows=20000 loops=1)
                    Hash Cond: (pc.category_id = c.id)
                    ->  Hash Join  (cost=3225.51..6160.51 rows=100000 width=14) (actual time=93.804..204.716 rows=20000 loops=1)
                          Hash Cond: (pc.product_id = p.id)
                          ->  Seq Scan on "ProductCategory" pc  (cost=0.00..1560.00 rows=100000 width=8) (actual time=1.269..138.824 rows=100000 loops=1)
                          ->  Hash  (cost=2975.51..2975.51 rows=20000 width=18) (actual time=49.886..49.890 rows=20000 loops=1)
                                Buckets: 32768  Batches: 1  Memory Usage: 1272kB
                                ->  Hash Join  (cost=2542.50..2975.51 rows=20000 width=18) (actual time=19.579..46.423 rows=20000 loops=1)
                                      Hash Cond: (v.product_id = p.id)
                                      ->  Hash Join  (cost=1854.50..2235.00 rows=20000 width=14) (actual time=14.690..38.170 rows=20000 loops=1)
                                            Hash Cond: (oi.variant_id = v.id)
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=14) (actual time=0.012..19.836 rows=20000 loops=1)
                                            ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=13.356..13.357 rows=47000 loops=1)
                                                  Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                                  ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.009..5.437 rows=47000 loops=1)
                                      ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=4.879..4.880 rows=20000 loops=1)
                                            Buckets: 32768  Batches: 1  Memory Usage: 960kB
                                            ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.007..2.062 rows=20000 loops=1)
                    ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=1.887..1.888 rows=150 loops=1)
                          Buckets: 1024  Batches: 1  Memory Usage: 16kB
                          ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=0.642..1.858 rows=150 loops=1)
Planning Time: 33.876 ms
Execution Time: 219.714 ms


==================================================
EXPLAIN ANALYZE — Query 10: Liczba produktów per kategoria
==================================================
Sort  (cost=2342.22..2342.59 rows=150 width=20) (actual time=50.383..50.393 rows=150 loops=1)
  Sort Key: (count(pc.product_id)) DESC
  Sort Method: quicksort  Memory: 30kB
  ->  HashAggregate  (cost=2335.30..2336.80 rows=150 width=20) (actual time=49.735..49.758 rows=150 loops=1)
        Group Key: c.name
        Batches: 1  Memory Usage: 48kB
        ->  Hash Right Join  (cost=5.38..1835.30 rows=100000 width=16) (actual time=0.617..29.297 rows=100000 loops=1)
              Hash Cond: (pc.category_id = c.id)
              ->  Seq Scan on "ProductCategory" pc  (cost=0.00..1560.00 rows=100000 width=8) (actual time=0.004..6.663 rows=100000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=0.057..0.057 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 16kB
                    ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=0.012..0.029 rows=150 loops=1)
Planning Time: 0.211 ms
Execution Time: 50.444 ms


==================================================
EXPLAIN ANALYZE — Query 11: Liczba zamówień per metoda płatności
==================================================
Sort  (cost=7798.49..7798.51 rows=6 width=50) (actual time=121.597..127.423 rows=6 loops=1)
  Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  Finalize GroupAggregate  (cost=7796.82..7798.41 rows=6 width=50) (actual time=121.056..126.893 rows=6 loops=1)
        Group Key: pm.name
        ->  Gather Merge  (cost=7796.82..7798.22 rows=12 width=50) (actual time=121.042..126.872 rows=18 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Sort  (cost=6796.80..6796.81 rows=6 width=50) (actual time=102.697..102.702 rows=6 loops=3)
                    Sort Key: pm.name
                    Sort Method: quicksort  Memory: 25kB
                    Worker 0:  Sort Method: quicksort  Memory: 25kB
                    Worker 1:  Sort Method: quicksort  Memory: 25kB
                    ->  Partial HashAggregate  (cost=6796.64..6796.72 rows=6 width=50) (actual time=100.695..100.701 rows=6 loops=3)
                          Group Key: pm.name
                          Batches: 1  Memory Usage: 24kB
                          Worker 0:  Batches: 1  Memory Usage: 24kB
                          Worker 1:  Batches: 1  Memory Usage: 24kB
                          ->  Hash Join  (cost=770.13..6692.48 rows=8333 width=24) (actual time=5.722..97.337 rows=6667 loops=3)
                                Hash Cond: (o.payment_method_id = pm.id)
                                ->  Parallel Hash Join  (cost=769.00..6654.02 rows=8333 width=18) (actual time=5.132..95.293 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.010..49.846 rows=133333 loops=3)
                                      ->  Parallel Hash  (cost=621.93..621.93 rows=11765 width=14) (actual time=4.322..4.323 rows=6667 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1216kB
                                            ->  Parallel Index Only Scan using idx_orderitem_variant_order_agg on "OrderItem" oi  (cost=0.29..621.93 rows=11765 width=14) (actual time=0.483..2.651 rows=6667 loops=3)
                                                  Heap Fetches: 0
                                ->  Hash  (cost=1.06..1.06 rows=6 width=14) (actual time=0.034..0.035 rows=6 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                      ->  Seq Scan on "PaymentMethod" pm  (cost=0.00..1.06 rows=6 width=14) (actual time=0.029..0.030 rows=6 loops=3)
Planning Time: 6.502 ms
Execution Time: 127.503 ms


==================================================
EXPLAIN ANALYZE — Query 12: Średnia ocena per producent
==================================================
Sort  (cost=1367.54..1367.91 rows=150 width=57) (actual time=30.735..30.746 rows=150 loops=1)
  Sort Key: (round(avg(r.rating), 2)) DESC NULLS LAST
  Sort Method: quicksort  Memory: 32kB
  ->  HashAggregate  (cost=1359.87..1362.12 rows=150 width=57) (actual time=30.615..30.679 rows=150 loops=1)
        Group Key: m.name
        Batches: 1  Memory Usage: 64kB
        ->  Hash Join  (cost=693.38..1259.87 rows=20000 width=29) (actual time=5.942..24.247 rows=27388 loops=1)
              Hash Cond: (p.manufacturer_id = m.id)
              ->  Hash Right Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=5.281..18.316 rows=27388 loops=1)
                    Hash Cond: (r.product_id = p.id)
                    ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=0.008..2.203 rows=20000 loops=1)
                    ->  Hash  (cost=438.00..438.00 rows=20000 width=8) (actual time=5.259..5.260 rows=20000 loops=1)
                          Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                          ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=8) (actual time=0.005..2.223 rows=20000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.056..0.056 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 18kB
                    ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.015..0.031 rows=150 loops=1)
Planning Time: 5.930 ms
Execution Time: 30.816 ms


==================================================
EXPLAIN ANALYZE — Query 13: Aktywne promocje i objęta nimi liczba wariantów
==================================================
Sort  (cost=587.95..588.05 rows=42 width=14) (actual time=7.549..7.553 rows=42 loops=1)
  Sort Key: (count(v.id)) DESC
  Sort Method: quicksort  Memory: 26kB
  ->  HashAggregate  (cost=586.40..586.82 rows=42 width=14) (actual time=7.528..7.536 rows=42 loops=1)
        Group Key: pr.name
        Batches: 1  Memory Usage: 24kB
        ->  Merge Join  (cost=7.46..535.87 rows=10105 width=10) (actual time=0.167..7.240 rows=1238 loops=1)
              Merge Cond: (v.promotion_id = pr.id)
              ->  Index Scan using idx_variant_promotion on "Variant" v  (cost=0.29..4233.14 rows=47000 width=8) (actual time=0.010..6.702 rows=5685 loops=1)
              ->  Sort  (cost=7.17..7.27 rows=43 width=10) (actual time=0.045..0.050 rows=43 loops=1)
                    Sort Key: pr.id
                    Sort Method: quicksort  Memory: 26kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=43 width=10) (actual time=0.012..0.035 rows=43 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 157
Planning Time: 11.517 ms
Execution Time: 7.607 ms


==================================================
EXPLAIN ANALYZE — Query 14: Najczęściej wybierane warianty w koszykach
==================================================
Limit  (cost=33355.13..33355.15 rows=10 width=44) (actual time=702.457..703.246 rows=10 loops=1)
  ->  Sort  (cost=33355.13..33470.31 rows=46072 width=44) (actual time=702.456..703.235 rows=10 loops=1)
        Sort Key: rci.total_quantity DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Hash Join  (cost=30848.18..32359.53 rows=46072 width=44) (actual time=654.954..694.662 rows=47000 loops=1)
              Hash Cond: (v.product_id = p.id)
              ->  Hash Join  (cost=30160.18..31550.57 rows=46072 width=35) (actual time=649.270..674.201 rows=47000 loops=1)
                    Hash Cond: (v.id = rci.variant_id)
                    ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=31) (actual time=0.011..6.650 rows=47000 loops=1)
                    ->  Hash  (cost=29584.28..29584.28 rows=46072 width=12) (actual time=649.239..650.011 rows=47000 loops=1)
                          Buckets: 65536  Batches: 1  Memory Usage: 2532kB
                          ->  Subquery Scan on rci  (cost=28662.84..29584.28 rows=46072 width=12) (actual time=626.319..640.496 rows=47000 loops=1)
                                ->  Finalize HashAggregate  (cost=28662.84..29123.56 rows=46072 width=12) (actual time=626.317..636.099 rows=47000 loops=1)
                                      Group Key: "CartItem".variant_id
                                      Batches: 1  Memory Usage: 4625kB
                                      ->  Gather  (cost=18527.00..28202.12 rows=92144 width=12) (actual time=544.302..581.617 rows=140998 loops=1)
                                            Workers Planned: 2
                                            Workers Launched: 2
                                            ->  Partial HashAggregate  (cost=17527.00..17987.72 rows=46072 width=12) (actual time=539.098..553.316 rows=46999 loops=3)
                                                  Group Key: "CartItem".variant_id
                                                  Batches: 1  Memory Usage: 4625kB
                                                  Worker 0:  Batches: 1  Memory Usage: 4625kB
                                                  Worker 1:  Batches: 1  Memory Usage: 4625kB
                                                  ->  Parallel Seq Scan on "CartItem"  (cost=0.00..14402.00 rows=625000 width=8) (actual time=0.524..340.828 rows=500000 loops=3)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=5.673..5.673 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.013..2.356 rows=20000 loops=1)
Planning Time: 6.645 ms
Execution Time: 704.716 ms


==================================================
EXPLAIN ANALYZE — Query 15: Produkty z Największą Różnicą Między Ceną Podstawową a Ceną Wariantu
==================================================
Limit  (cost=3211.55..3211.58 rows=10 width=80) (actual time=44.783..44.786 rows=10 loops=1)
  ->  Sort  (cost=3211.55..3329.05 rows=47000 width=80) (actual time=44.781..44.783 rows=10 loops=1)
        Sort Key: v.price_modifier DESC
        Sort Method: top-N heapsort  Memory: 27kB
        ->  Hash Join  (cost=688.00..2195.90 rows=47000 width=80) (actual time=6.269..32.349 rows=47000 loops=1)
              Hash Cond: (v.product_id = p.id)
              ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=33) (actual time=0.011..6.277 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=6.241..6.241 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1381kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.004..2.651 rows=20000 loops=1)
Planning Time: 3.124 ms
Execution Time: 44.827 ms


==================================================
EXPLAIN ANALYZE — Query 16: Konwersja zamówień wg statusu
==================================================
Sort  (cost=7541.77..7541.79 rows=7 width=48) (actual time=115.580..120.101 rows=7 loops=1)
  Sort Key: (count(o.id)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  WindowAgg  (cost=7541.33..7541.67 rows=7 width=48) (actual time=115.569..120.094 rows=7 loops=1)
        ->  Finalize GroupAggregate  (cost=7539.74..7541.51 rows=7 width=16) (actual time=115.545..120.073 rows=7 loops=1)
              Group Key: s.name
              ->  Gather Merge  (cost=7539.74..7541.37 rows=14 width=16) (actual time=115.534..120.060 rows=21 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Sort  (cost=6539.71..6539.73 rows=7 width=16) (actual time=98.139..98.142 rows=7 loops=3)
                          Sort Key: s.name
                          Sort Method: quicksort  Memory: 25kB
                          Worker 0:  Sort Method: quicksort  Memory: 25kB
                          Worker 1:  Sort Method: quicksort  Memory: 25kB
                          ->  Partial HashAggregate  (cost=6539.55..6539.62 rows=7 width=16) (actual time=97.042..97.045 rows=7 loops=3)
                                Group Key: s.name
                                Batches: 1  Memory Usage: 24kB
                                Worker 0:  Batches: 1  Memory Usage: 24kB
                                Worker 1:  Batches: 1  Memory Usage: 24kB
                                ->  Hash Join  (cost=1.16..5706.21 rows=166667 width=12) (actual time=0.262..66.553 rows=133333 loops=3)
                                      Hash Cond: (o.status_id = s.id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.007..11.990 rows=133333 loops=3)
                                      ->  Hash  (cost=1.07..1.07 rows=7 width=12) (actual time=0.027..0.028 rows=7 loops=3)
                                            Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                            ->  Seq Scan on "Status" s  (cost=0.00..1.07 rows=7 width=12) (actual time=0.022..0.023 rows=7 loops=3)
Planning Time: 6.382 ms
Execution Time: 120.184 ms


==================================================
EXPLAIN ANALYZE — Query 17: Top klienci wg wydatków
==================================================
Limit  (cost=15389.43..15389.45 rows=10 width=50) (actual time=2537.678..2542.793 rows=10 loops=1)
  ->  Sort  (cost=15389.43..15439.43 rows=20000 width=50) (actual time=2537.677..2542.790 rows=10 loops=1)
        Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=14707.24..14957.24 rows=20000 width=50) (actual time=2521.735..2535.934 rows=19296 loops=1)
              Group Key: u.id
              Batches: 5  Memory Usage: 8241kB  Disk Usage: 216kB
              ->  Gather  (cost=12811.48..14582.24 rows=16666 width=50) (actual time=2236.933..2447.640 rows=19438 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=11811.48..11915.64 rows=8333 width=50) (actual time=2228.963..2286.178 rows=6479 loops=3)
                          Group Key: u.id
                          Batches: 1  Memory Usage: 2961kB
                          Worker 0:  Batches: 1  Memory Usage: 2961kB
                          Worker 1:  Batches: 1  Memory Usage: 2961kB
                          ->  Nested Loop  (cost=769.42..11728.15 rows=8333 width=28) (actual time=5.216..2199.322 rows=6667 loops=3)
                                ->  Parallel Hash Join  (cost=769.00..6654.02 rows=8333 width=14) (actual time=4.954..69.311 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.010..13.752 rows=133333 loops=3)
                                      ->  Parallel Hash  (cost=621.93..621.93 rows=11765 width=14) (actual time=4.746..5.253 rows=6667 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1248kB
                                            ->  Parallel Index Only Scan using idx_orderitem_variant_order_agg on "OrderItem" oi  (cost=0.29..621.93 rows=11765 width=14) (actual time=0.019..1.012 rows=6667 loops=3)
                                                  Heap Fetches: 0
                                ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.318..0.318 rows=1 loops=20000)
                                      Index Cond: (id = o.user_id)
Planning Time: 2.326 ms
Execution Time: 2551.809 ms


==================================================
EXPLAIN ANALYZE — Query 18: Produkty z wariantami objętymi promocją, z końcową ceną
==================================================
Sort  (cost=2074.11..2099.37 rows=10105 width=132) (actual time=45.948..46.057 rows=1238 loops=1)
  Sort Key: (round(((p.price + v.price_modifier) * ('1'::numeric - pr.discount_percentage)), 2))
  Sort Method: quicksort  Memory: 139kB
  ->  Hash Join  (cost=695.46..1401.98 rows=10105 width=132) (actual time=27.726..44.863 rows=1238 loops=1)
        Hash Cond: (v.product_id = p.id)
        ->  Merge Join  (cost=7.46..535.87 rows=10105 width=39) (actual time=1.970..17.687 rows=1238 loops=1)
              Merge Cond: (v.promotion_id = pr.id)
              ->  Index Scan using idx_variant_promotion on "Variant" v  (cost=0.29..4233.14 rows=47000 width=37) (actual time=1.142..17.135 rows=5685 loops=1)
              ->  Sort  (cost=7.17..7.27 rows=43 width=10) (actual time=0.047..0.054 rows=43 loops=1)
                    Sort Key: pr.id
                    Sort Method: quicksort  Memory: 26kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=43 width=10) (actual time=0.014..0.037 rows=43 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 157
        ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=22.265..22.265 rows=20000 loops=1)
              Buckets: 32768  Batches: 1  Memory Usage: 1381kB
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.017..17.229 rows=20000 loops=1)
Planning Time: 21.667 ms
Execution Time: 46.787 ms


==================================================
EXPLAIN ANALYZE — Query 19: Użytkownicy, Którzy Dodali Produkt do Koszyka, Ale Nie Złożyli Zamówienia (Potencjał Odbudowy Koszyka)
==================================================
Hash Join  (cost=46254.21..103988.81 rows=1068640 width=55) (actual time=6650.299..9025.187 rows=1005006 loops=1)
  Hash Cond: (v.product_id = p.id)
  ->  Hash Join  (cost=45566.21..100495.04 rows=1068640 width=46) (actual time=6641.130..8476.172 rows=1005006 loops=1)
        Hash Cond: (ci.variant_id = v.id)
        ->  Hash Join  (cost=43711.71..95835.11 rows=1068640 width=46) (actual time=6616.971..7691.251 rows=1005006 loops=1)
              Hash Cond: (ci.cart_id = c.id)
              ->  Seq Scan on "CartItem" ci  (cost=0.00..23152.00 rows=1500000 width=8) (actual time=0.735..269.786 rows=1500000 loops=1)
              ->  Hash  (cost=41435.91..41435.91 rows=106864 width=46) (actual time=6608.999..6626.858 rows=100414 loops=1)
                    Buckets: 131072  Batches: 2  Memory Usage: 4929kB
                    ->  Gather  (cost=25017.67..41435.91 rows=106864 width=46) (actual time=6305.861..6377.544 rows=100414 loops=1)
                          Workers Planned: 2
                          Workers Launched: 2
                          ->  Parallel Hash Right Anti Join  (cost=24017.67..29749.51 rows=44527 width=46) (actual time=5320.757..5335.049 rows=33471 loops=3)
                                Hash Cond: (o.user_id = u.id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=4) (actual time=1.539..428.166 rows=133333 loops=3)
                                ->  Parallel Hash  (cost=23236.42..23236.42 rows=62500 width=50) (actual time=4409.042..4409.664 rows=50000 loops=3)
                                      Buckets: 262144  Batches: 1  Memory Usage: 14720kB
                                      ->  Hash Join  (cost=4079.00..23236.42 rows=62500 width=50) (actual time=387.749..3817.728 rows=50000 loops=3)
                                            Hash Cond: (u.id = c.user_id)
                                            ->  Parallel Seq Scan on "User" u  (cost=0.00..18063.67 rows=416667 width=46) (actual time=33.142..2125.866 rows=333333 loops=3)
                                            ->  Hash  (cost=2204.00..2204.00 rows=150000 width=8) (actual time=333.015..333.016 rows=150000 loops=3)
                                                  Buckets: 262144  Batches: 1  Memory Usage: 7908kB
                                                  ->  Seq Scan on "Cart" c  (cost=0.00..2204.00 rows=150000 width=8) (actual time=13.426..203.582 rows=150000 loops=3)
        ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=21.065..21.068 rows=47000 loops=1)
              Buckets: 65536  Batches: 1  Memory Usage: 2348kB
              ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.013..13.129 rows=47000 loops=1)
  ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=5.746..5.747 rows=20000 loops=1)
        Buckets: 32768  Batches: 1  Memory Usage: 1245kB
        ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.015..2.391 rows=20000 loops=1)
Planning Time: 38.704 ms
Execution Time: 9107.915 ms


==================================================
EXPLAIN ANALYZE — Query 20: Wyszukiwanie produktów po nazwie lub opisie (parametryzowane)
==================================================
Bitmap Heap Scan on "Product"  (cost=43.00..57.51 rows=4 width=60) (actual time=9.192..32.666 rows=143 loops=1)
  Recheck Cond: (((name)::text ~~* '%test%'::text) OR (description ~~* '%test%'::text))
  Heap Blocks: exact=106
  ->  BitmapOr  (cost=43.00..43.00 rows=4 width=0) (actual time=9.149..9.150 rows=0 loops=1)
        ->  Bitmap Index Scan on idx_product_name_trgm  (cost=0.00..21.50 rows=2 width=0) (actual time=3.910..3.910 rows=42 loops=1)
              Index Cond: ((name)::text ~~* '%test%'::text)
        ->  Bitmap Index Scan on idx_product_description_trgm  (cost=0.00..21.50 rows=2 width=0) (actual time=5.233..5.233 rows=102 loops=1)
              Index Cond: (description ~~* '%test%'::text)
Planning Time: 120.991 ms
Execution Time: 36.227 ms


==================================================
EXPLAIN ANALYZE — Query 21: Użytkownicy, Którzy Zapisali Konkretny Produkt jako Ulubiony (np. Product ID=350259)
==================================================
Nested Loop  (cost=0.85..262.23 rows=30 width=56) (actual time=5.157..20.451 rows=26 loops=1)
  ->  Index Only Scan using idx_favoriteproduct_product_user on "FavoriteProduct" fp  (cost=0.42..8.95 rows=30 width=4) (actual time=3.964..3.974 rows=26 loops=1)
        Index Cond: (product_id = 35)
        Heap Fetches: 0
  ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..8.44 rows=1 width=60) (actual time=0.633..0.633 rows=1 loops=26)
        Index Cond: (id = fp.user_id)
Planning Time: 13.643 ms
Execution Time: 20.488 ms


==================================================
EXPLAIN ANALYZE — Query 22: Znajdź Magazyny, Które Posiadają Zapasy Konkretnego Wariantu (np. SKU='VR-000000-a637d44b7afd')
==================================================
Sort  (cost=27.64..27.64 rows=2 width=25) (actual time=5.494..5.498 rows=0 loops=1)
  Sort Key: (sum("*SELECT* 1".stock_units)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  GroupAggregate  (cost=27.51..27.63 rows=2 width=25) (actual time=4.263..4.266 rows=0 loops=1)
        Group Key: w.name
        Filter: (sum("*SELECT* 1".stock_units) > 0)
        ->  Sort  (cost=27.51..27.52 rows=6 width=21) (actual time=4.262..4.265 rows=0 loops=1)
              Sort Key: w.name
              Sort Method: quicksort  Memory: 25kB
              ->  Hash Join  (cost=2.06..27.43 rows=6 width=21) (actual time=3.613..3.616 rows=0 loops=1)
                    Hash Cond: ("*SELECT* 1".warehouse_id = w.id)
                    ->  Append  (cost=0.83..26.18 rows=6 width=8) (actual time=3.612..3.614 rows=0 loops=1)
                          ->  Subquery Scan on "*SELECT* 1"  (cost=0.83..13.08 rows=3 width=8) (actual time=3.585..3.586 rows=0 loops=1)
                                ->  Nested Loop  (cost=0.83..13.05 rows=3 width=8) (actual time=3.584..3.585 rows=0 loops=1)
                                      ->  Index Scan using uix_variant_sku on "Variant" v  (cost=0.41..8.43 rows=1 width=4) (actual time=3.584..3.584 rows=0 loops=1)
                                            Index Cond: ((sku)::text = 'VR-000001-2704de10f283'::text)
                                      ->  Index Only Scan using idx_bsi_variant_warehouse_qty on "BulkStockItem" bsi  (cost=0.42..4.54 rows=7 width=12) (never executed)
                                            Index Cond: (variant_id = v.id)
                                            Heap Fetches: 0
                          ->  Subquery Scan on "*SELECT* 2"  (cost=0.83..13.08 rows=3 width=8) (actual time=0.025..0.025 rows=0 loops=1)
                                ->  Nested Loop  (cost=0.83..13.05 rows=3 width=8) (actual time=0.024..0.024 rows=0 loops=1)
                                      ->  Index Scan using uix_variant_sku on "Variant" v_1  (cost=0.41..8.43 rows=1 width=4) (actual time=0.023..0.023 rows=0 loops=1)
                                            Index Cond: ((sku)::text = 'VR-000001-2704de10f283'::text)
                                      ->  Index Only Scan using idx_ssi_variant_warehouse on "SerialStockItem" ssi  (cost=0.42..4.54 rows=7 width=8) (never executed)
                                            Index Cond: (variant_id = v_1.id)
                                            Heap Fetches: 0
                    ->  Hash  (cost=1.10..1.10 rows=10 width=21) (never executed)
                          ->  Seq Scan on "Warehouse" w  (cost=0.00..1.10 rows=10 width=21) (never executed)
Planning Time: 9.402 ms
Execution Time: 5.576 ms


==================================================
EXPLAIN ANALYZE — Query 23: Warianty, Które Wymagają Uzyskania Konkretnej Opcji (np. 'Kolor'='Czerwony')
==================================================
Nested Loop  (cost=6.81..677.99 rows=8 width=36) (actual time=0.016..0.017 rows=0 loops=1)
  ->  Nested Loop  (cost=6.52..675.35 rows=8 width=27) (actual time=0.016..0.016 rows=0 loops=1)
        ->  Nested Loop  (cost=6.23..672.76 rows=8 width=4) (actual time=0.015..0.016 rows=0 loops=1)
              Join Filter: (opt.attribute_id = a.id)
              ->  Seq Scan on "Attribute" a  (cost=0.00..1.38 rows=1 width=4) (actual time=0.015..0.015 rows=0 loops=1)
                    Filter: ((name)::text = 'Attr_49_Century'::text)
                    Rows Removed by Filter: 30
              ->  Nested Loop  (cost=6.23..668.26 rows=250 width=8) (never executed)
                    ->  Seq Scan on "Option" opt  (cost=0.00..18.50 rows=1 width=8) (never executed)
                          Filter: ((value)::text = 'do'::text)
                    ->  Bitmap Heap Scan on "VariantOption" vo  (cost=6.23..647.26 rows=250 width=8) (never executed)
                          Recheck Cond: (option_id = opt.id)
                          ->  Bitmap Index Scan on idx_variantoption_option_id  (cost=0.00..6.17 rows=250 width=0) (never executed)
                                Index Cond: (option_id = opt.id)
        ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.32 rows=1 width=31) (never executed)
              Index Cond: (id = vo.variant_id)
  ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=17) (never executed)
        Index Cond: (id = v.product_id)
Planning Time: 40.085 ms
Execution Time: 0.083 ms


==================================================
EXPLAIN ANALYZE — Query 24: Znajdź Zamówienia Użytkownika (np. email='debbie.lane.16786.50af0753@example.com') o Statusie 'Paid'
==================================================
Nested Loop  (cost=0.98..17.07 rows=1 width=20) (actual time=3.594..3.595 rows=0 loops=1)
  ->  Nested Loop  (cost=0.85..16.89 rows=1 width=16) (actual time=3.594..3.595 rows=0 loops=1)
        ->  Index Scan using "User_email_key" on "User" u  (cost=0.42..8.44 rows=1 width=4) (actual time=3.594..3.594 rows=0 loops=1)
              Index Cond: ((email)::text = 'debbie.lane.16786.50af0753@example.com'::text)
        ->  Index Scan using idx_order_user on "Order" o  (cost=0.42..8.44 rows=1 width=20) (never executed)
              Index Cond: (user_id = u.id)
  ->  Index Scan using "Status_pkey" on "Status" s  (cost=0.13..0.15 rows=1 width=12) (never executed)
        Index Cond: (id = o.status_id)
        Filter: ((name)::text = 'Paid'::text)
Planning Time: 2.895 ms
Execution Time: 3.629 ms


==================================================
EXPLAIN ANALYZE — Query 25: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
Hash Left Join  (cost=6.97..48.34 rows=16 width=87) (actual time=2.023..10.363 rows=18 loops=1)
  Hash Cond: (opt.attribute_id = a.id)
  ->  Nested Loop Left Join  (cost=5.30..46.57 rows=16 width=45) (actual time=1.366..9.690 rows=18 loops=1)
        ->  Nested Loop Left Join  (cost=5.02..41.89 rows=16 width=39) (actual time=0.691..7.242 rows=18 loops=1)
              ->  Nested Loop  (cost=4.60..24.13 rows=3 width=39) (actual time=0.035..1.264 rows=4 loops=1)
                    ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..8.30 rows=1 width=10) (actual time=0.007..0.009 rows=1 loops=1)
                          Index Cond: (id = 35)
                    ->  Bitmap Heap Scan on "Variant" v  (cost=4.31..15.80 rows=3 width=37) (actual time=0.026..1.252 rows=4 loops=1)
                          Recheck Cond: (product_id = 35)
                          Heap Blocks: exact=4
                          ->  Bitmap Index Scan on idx_variant_product  (cost=0.00..4.31 rows=3 width=0) (actual time=0.012..0.012 rows=4 loops=1)
                                Index Cond: (product_id = 35)
              ->  Index Only Scan using uq_varopt_variant_option on "VariantOption" vo  (cost=0.42..5.86 rows=6 width=8) (actual time=1.491..1.493 rows=4 loops=4)
                    Index Cond: (variant_id = v.id)
                    Heap Fetches: 0
        ->  Index Scan using "Option_pkey" on "Option" opt  (cost=0.28..0.29 rows=1 width=14) (actual time=0.135..0.135 rows=1 loops=18)
              Index Cond: (id = vo.option_id)
  ->  Hash  (cost=1.30..1.30 rows=30 width=18) (actual time=0.022..0.023 rows=30 loops=1)
        Buckets: 1024  Batches: 1  Memory Usage: 10kB
        ->  Seq Scan on "Attribute" a  (cost=0.00..1.30 rows=30 width=18) (actual time=0.012..0.015 rows=30 loops=1)
Planning Time: 0.541 ms
Execution Time: 10.422 ms


==================================================
EXPLAIN ANALYZE — Query 26: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
Hash Left Join  (cost=6.97..48.42 rows=16 width=87) (actual time=0.006..0.008 rows=0 loops=1)
  Hash Cond: (opt.attribute_id = a.id)
  ->  Nested Loop Left Join  (cost=5.30..46.57 rows=16 width=45) (actual time=0.006..0.007 rows=0 loops=1)
        ->  Nested Loop Left Join  (cost=5.02..41.89 rows=16 width=39) (actual time=0.006..0.006 rows=0 loops=1)
              ->  Nested Loop  (cost=4.60..24.13 rows=3 width=39) (actual time=0.006..0.006 rows=0 loops=1)
                    ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..8.30 rows=1 width=10) (actual time=0.005..0.005 rows=0 loops=1)
                          Index Cond: (id = 350259)
                    ->  Bitmap Heap Scan on "Variant" v  (cost=4.31..15.80 rows=3 width=37) (never executed)
                          Recheck Cond: (product_id = 350259)
                          ->  Bitmap Index Scan on idx_variant_product  (cost=0.00..4.31 rows=3 width=0) (never executed)
                                Index Cond: (product_id = 350259)
              ->  Index Only Scan using uq_varopt_variant_option on "VariantOption" vo  (cost=0.42..5.86 rows=6 width=8) (never executed)
                    Index Cond: (variant_id = v.id)
                    Heap Fetches: 0
        ->  Index Scan using "Option_pkey" on "Option" opt  (cost=0.28..0.29 rows=1 width=14) (never executed)
              Index Cond: (id = vo.option_id)
  ->  Hash  (cost=1.30..1.30 rows=30 width=18) (never executed)
        ->  Seq Scan on "Attribute" a  (cost=0.00..1.30 rows=30 width=18) (never executed)
Planning Time: 0.576 ms
Execution Time: 0.045 ms


==================================================
EXPLAIN ANALYZE — Query 27: Lista Wszystkich Dziecięcych Kategorii (Podkategorii) dla Konkretnej Kategorii Nadrzędnej (np. ID=5)
==================================================
Seq Scan on "Category"  (cost=0.00..3.88 rows=3 width=12) (actual time=0.658..0.668 rows=3 loops=1)
  Filter: (parent_id = 5)
  Rows Removed by Filter: 147
Planning Time: 0.693 ms
Execution Time: 0.685 ms


==================================================
EXPLAIN ANALYZE — Query 28: Porównanie Średniej Oceny dla Promowanych i Niepromowanych Produktów
==================================================
HashAggregate  (cost=87850.51..87853.01 rows=200 width=64) (actual time=211.315..211.319 rows=2 loops=1)
  Group Key: CASE WHEN (ANY (p.id = (hashed SubPlan 2).col1)) THEN 'Promowany'::text ELSE 'Niepromowany'::text END
  Batches: 1  Memory Usage: 40kB
  ->  HashAggregate  (cost=1300.51..87550.51 rows=20000 width=68) (actual time=201.355..208.335 rows=12612 loops=1)
        Group Key: p.id
        Batches: 1  Memory Usage: 2577kB
        ->  Hash Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=40.765..164.603 rows=20000 loops=1)
              Hash Cond: (r.product_id = p.id)
              ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=0.016..59.899 rows=20000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=40.710..40.711 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 960kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.005..34.636 rows=20000 loops=1)
        SubPlan 2
          ->  Index Only Scan using idx_variant_product_promotion on "Variant" v2  (cost=0.28..215.94 rows=5577 width=4) (actual time=4.836..26.064 rows=5684 loops=1)
                Heap Fetches: 0
Planning Time: 4.570 ms
Execution Time: 211.419 ms


==================================================
EXPLAIN ANALYZE — Query 29: Top 5 Miast Generujących Największy Przychód (Wg. Adresu Wysyłki)
==================================================
Limit  (cost=15305.18..15305.19 rows=5 width=45) (actual time=3970.115..4059.948 rows=5 loops=1)
  ->  Sort  (cost=15305.18..15355.18 rows=20000 width=45) (actual time=3969.068..4057.878 rows=5 loops=1)
        Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=14722.99..14972.99 rows=20000 width=45) (actual time=3960.863..4054.970 rows=12950 loops=1)
              Group Key: a.city
              Batches: 1  Memory Usage: 5905kB
              ->  Gather  (cost=12827.23..14597.99 rows=16666 width=45) (actual time=3908.217..4035.287 rows=16065 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=11827.23..11931.39 rows=8333 width=45) (actual time=3879.392..3882.344 rows=5355 loops=3)
                          Group Key: a.city
                          Batches: 1  Memory Usage: 2449kB
                          Worker 0:  Batches: 1  Memory Usage: 2449kB
                          Worker 1:  Batches: 1  Memory Usage: 2449kB
                          ->  Nested Loop  (cost=769.42..11743.90 rows=8333 width=23) (actual time=22.609..3853.373 rows=6667 loops=3)
                                ->  Parallel Hash Join  (cost=769.00..6654.02 rows=8333 width=14) (actual time=18.546..90.717 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.011..19.427 rows=133333 loops=3)
                                      ->  Parallel Hash  (cost=621.93..621.93 rows=11765 width=14) (actual time=18.370..18.372 rows=6667 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1248kB
                                            ->  Parallel Index Only Scan using idx_orderitem_variant_order_agg on "OrderItem" oi  (cost=0.29..621.93 rows=11765 width=14) (actual time=1.177..16.630 rows=6667 loops=3)
                                                  Heap Fetches: 0
                                ->  Index Scan using "Address_pkey" on "Address" a  (cost=0.43..0.61 rows=1 width=17) (actual time=0.563..0.563 rows=1 loops=20000)
                                      Index Cond: (id = o.shipping_address_id)
Planning Time: 25.243 ms
Execution Time: 4064.464 ms


==================================================
EXPLAIN ANALYZE — Query 30: Porównanie Wolumenu Sprzedaży Produktów Promowanych vs. Niepromowanych (w Ostatnich 30 Dniach)
==================================================
GroupAggregate  (cost=4663.19..4669.79 rows=200 width=40) (actual time=59.950..59.952 rows=1 loops=1)
  Group Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
  ->  Sort  (cost=4663.19..4664.72 rows=614 width=36) (actual time=59.826..59.860 rows=619 loops=1)
        Sort Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
        Sort Method: quicksort  Memory: 49kB
        ->  Nested Loop  (cost=3936.06..4634.75 rows=614 width=36) (actual time=19.178..59.689 rows=619 loops=1)
              ->  Hash Join  (cost=3935.77..4316.27 rows=614 width=8) (actual time=18.525..57.968 rows=619 loops=1)
                    Hash Cond: (oi.order_id = o.id)
                    ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=12) (actual time=0.012..35.918 rows=20000 loops=1)
                    ->  Hash  (cost=3782.35..3782.35 rows=12274 width=4) (actual time=18.494..18.495 rows=12321 loops=1)
                          Buckets: 16384  Batches: 1  Memory Usage: 562kB
                          ->  Bitmap Heap Scan on "Order" o  (cost=231.55..3782.35 rows=12274 width=4) (actual time=9.232..16.580 rows=12321 loops=1)
                                Recheck Cond: (order_date >= (now() - '30 days'::interval))
                                Heap Blocks: exact=3270
                                ->  Bitmap Index Scan on idx_order_date  (cost=0.00..228.48 rows=12274 width=0) (actual time=8.855..8.856 rows=12321 loops=1)
                                      Index Cond: (order_date >= (now() - '30 days'::interval))
              ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.52 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=619)
                    Index Cond: (id = oi.variant_id)
Planning Time: 6.852 ms
Execution Time: 60.019 ms


==================================================
EXPLAIN ANALYZE — Query 31: Wskaźnik Lojalności (Repeat Purchase Rate) Użytkowników z Podziałem na Miasto Adresu Rozliczeniowego
==================================================
Sort  (cost=128699.75..128773.84 rows=29636 width=61) (actual time=5851.396..5968.660 rows=66456 loops=1)
  Sort Key: (round((((count(*) FILTER (WHERE (u.orders_count > 1)))::numeric * 100.0) / (NULLIF(count(DISTINCT o.user_id), 0))::numeric), 2)) DESC
  Sort Method: external merge  Disk: 3192kB
  ->  GroupAggregate  (cost=75171.04..126498.53 rows=29636 width=61) (actual time=5247.449..5816.449 rows=66456 loops=1)
        Group Key: a.city
        ->  Gather Merge  (cost=75171.04..121757.63 rows=400000 width=25) (actual time=5207.931..5628.556 rows=400000 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Sort  (cost=74171.01..74587.68 rows=166667 width=25) (actual time=4945.328..5049.053 rows=133333 loops=3)
                    Sort Key: a.city, o.user_id
                    Sort Method: external merge  Disk: 5248kB
                    Worker 0:  Sort Method: external merge  Disk: 5296kB
                    Worker 1:  Sort Method: external merge  Disk: 4792kB
                    ->  Parallel Hash Join  (cost=34868.03..55725.48 rows=166667 width=25) (actual time=1291.154..3995.728 rows=133333 loops=3)
                          Hash Cond: (a.id = o.billing_address_id)
                          ->  Parallel Seq Scan on "Address" a  (cost=0.00..18288.00 rows=500000 width=17) (actual time=34.300..1820.273 rows=400000 loops=3)
                          ->  Parallel Hash  (cost=32784.69..32784.69 rows=166667 width=16) (actual time=1236.320..1238.404 rows=133333 loops=3)
                                Buckets: 524288  Batches: 1  Memory Usage: 22944kB
                                ->  Hash Join  (cost=24635.51..32784.69 rows=166667 width=16) (actual time=468.368..923.092 rows=133333 loops=3)
                                      Hash Cond: (o.user_id = u.user_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.014..71.044 rows=133333 loops=3)
                                      ->  Hash  (cost=19635.86..19635.86 rows=287572 width=12) (actual time=457.398..458.768 rows=329619 loops=3)
                                            Buckets: 262144  Batches: 4  Memory Usage: 5596kB
                                            ->  Subquery Scan on u  (cost=0.42..19635.86 rows=287572 width=12) (actual time=1.104..344.779 rows=329619 loops=3)
                                                  ->  GroupAggregate  (cost=0.42..16760.14 rows=287572 width=12) (actual time=1.103..312.136 rows=329619 loops=3)
                                                        Group Key: "Order".user_id
                                                        ->  Index Only Scan using idx_order_user on "Order"  (cost=0.42..11884.42 rows=400000 width=4) (actual time=1.088..217.598 rows=400000 loops=3)
                                                              Heap Fetches: 150240
Planning Time: 5.368 ms
Execution Time: 6041.179 ms

FINISHED — 2025-12-02 21:20:27.810600
========================================================================================================================
========================================================================================================================
START EXPLAIN RUN — 2025-12-02 21:21:50.500898
========================================================================================================================


==================================================
EXPLAIN ANALYZE — Query 1: Średnia Wartość Zamówienia (AOV) w Ostatnim Miesiącu
==================================================
Aggregate  (cost=4367.66..4367.67 rows=1 width=32) (actual time=1531.943..1531.945 rows=1 loops=1)
  ->  GroupAggregate  (cost=4344.63..4359.98 rows=614 width=36) (actual time=1531.399..1531.892 rows=608 loops=1)
        Group Key: o.id
        ->  Sort  (cost=4344.63..4346.17 rows=614 width=14) (actual time=1531.379..1531.428 rows=619 loops=1)
              Sort Key: o.id
              Sort Method: quicksort  Memory: 44kB
              ->  Hash Join  (cost=3935.70..4316.20 rows=614 width=14) (actual time=1479.206..1531.167 rows=619 loops=1)
                    Hash Cond: (oi.order_id = o.id)
                    ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=14) (actual time=0.017..48.068 rows=20000 loops=1)
                    ->  Hash  (cost=3782.30..3782.30 rows=12272 width=4) (actual time=1479.124..1479.125 rows=12318 loops=1)
                          Buckets: 16384  Batches: 1  Memory Usage: 562kB
                          ->  Bitmap Heap Scan on "Order" o  (cost=231.54..3782.30 rows=12272 width=4) (actual time=25.218..1474.959 rows=12318 loops=1)
                                Recheck Cond: (order_date >= (now() - '1 mon'::interval))
                                Heap Blocks: exact=3270
                                ->  Bitmap Index Scan on idx_order_date  (cost=0.00..228.47 rows=12272 width=0) (actual time=24.303..24.303 rows=12318 loops=1)
                                      Index Cond: (order_date >= (now() - '1 mon'::interval))
Planning Time: 47.596 ms
Execution Time: 1532.100 ms


==================================================
EXPLAIN ANALYZE — Query 2: Średnia wartość zamówienia per użytkownik - ZOPTYMALIZOWANA
==================================================
Sort  (cost=16166.87..16215.61 rows=19495 width=50) (actual time=5043.336..5103.653 rows=19296 loops=1)
  Sort Key: (round(avg(oi_sum.total_price), 2)) DESC
  Sort Method: quicksort  Memory: 1612kB
  ->  Finalize HashAggregate  (cost=14485.35..14777.77 rows=19495 width=50) (actual time=4996.621..5081.749 rows=19296 loops=1)
        Group Key: u.id
        Batches: 5  Memory Usage: 8241kB  Disk Usage: 224kB
        ->  Gather  (cost=12637.36..14363.50 rows=16246 width=50) (actual time=4713.910..4877.070 rows=19445 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial HashAggregate  (cost=11637.36..11738.90 rows=8123 width=50) (actual time=4703.876..4714.036 rows=6482 loops=3)
                    Group Key: u.id
                    Batches: 1  Memory Usage: 3217kB
                    Worker 0:  Batches: 1  Memory Usage: 2961kB
                    Worker 1:  Batches: 1  Memory Usage: 2961kB
                    ->  Nested Loop  (cost=1210.75..11596.75 rows=8123 width=50) (actual time=107.609..4641.011 rows=6498 loops=3)
                          ->  Hash Join  (cost=1210.33..6650.49 rows=8123 width=36) (actual time=66.582..246.659 rows=6498 loops=3)
                                Hash Cond: (o.id = oi_sum.order_id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.007..61.076 rows=133333 loops=3)
                                ->  Hash  (cost=966.64..966.64 rows=19495 width=36) (actual time=64.215..65.398 rows=19495 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1094kB
                                      ->  Subquery Scan on oi_sum  (cost=528.00..966.64 rows=19495 width=36) (actual time=42.023..54.118 rows=19495 loops=3)
                                            ->  HashAggregate  (cost=528.00..771.69 rows=19495 width=36) (actual time=40.229..50.470 rows=19495 loops=3)
                                                  Group Key: "OrderItem".order_id
                                                  Batches: 1  Memory Usage: 7953kB
                                                  Worker 0:  Batches: 1  Memory Usage: 7953kB
                                                  Worker 1:  Batches: 1  Memory Usage: 7953kB
                                                  ->  Seq Scan on "OrderItem"  (cost=0.00..328.00 rows=20000 width=14) (actual time=1.093..4.199 rows=20000 loops=3)
                          ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.668..0.668 rows=1 loops=19495)
                                Index Cond: (id = o.user_id)
Planning Time: 23.365 ms
Execution Time: 5138.824 ms


==================================================
EXPLAIN ANALYZE — Query 3: Top 10 Najlepiej Sprzedających Się Produktów (wg. Ilości Sprzedanych Jednostek) w Ostatnim Kwartale
==================================================
Limit  (cost=9140.02..9140.05 rows=10 width=46) (actual time=162.698..233.588 rows=1 loops=1)
  ->  Sort  (cost=9140.02..9149.97 rows=3980 width=46) (actual time=162.696..233.585 rows=1 loops=1)
        Sort Key: (sum(oi.quantity)) DESC
        Sort Method: quicksort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=9014.22..9054.02 rows=3980 width=46) (actual time=160.843..231.766 rows=1 loops=1)
              Group Key: p.name, m.name
              Batches: 1  Memory Usage: 217kB
              ->  Gather  (cost=8641.17..8989.35 rows=3316 width=46) (actual time=150.003..230.767 rows=3 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=7641.17..7657.75 rows=1658 width=46) (actual time=94.775..94.784 rows=1 loops=3)
                          Group Key: p.name, m.name
                          Batches: 1  Memory Usage: 73kB
                          Worker 0:  Batches: 1  Memory Usage: 73kB
                          Worker 1:  Batches: 1  Memory Usage: 73kB
                          ->  Hash Join  (cost=2077.26..7628.73 rows=1658 width=42) (actual time=57.880..91.941 rows=1324 loops=3)
                                Hash Cond: (p.manufacturer_id = m.id)
                                ->  Nested Loop  (cost=2071.88..7618.88 rows=1658 width=21) (actual time=57.346..91.074 rows=1324 loops=3)
                                      ->  Nested Loop  (cost=2071.59..7071.56 rows=1658 width=8) (actual time=55.668..86.855 rows=1324 loops=3)
                                            ->  Hash Join  (cost=2071.30..6211.56 rows=1658 width=8) (actual time=54.357..82.801 rows=1324 loops=3)
                                                  Hash Cond: (o.id = oi.order_id)
                                                  ->  Parallel Bitmap Heap Scan on "Order" o  (cost=1493.30..5409.70 rows=33165 width=4) (actual time=45.765..67.641 rows=26373 loops=3)
                                                        Recheck Cond: (order_date >= (now() - '3 mons'::interval))
                                                        Heap Blocks: exact=768
                                                        ->  Bitmap Index Scan on idx_order_date  (cost=0.00..1473.40 rows=79597 width=0) (actual time=85.661..85.662 rows=79119 loops=1)
                                                              Index Cond: (order_date >= (now() - '3 mons'::interval))
                                                  ->  Hash  (cost=328.00..328.00 rows=20000 width=12) (actual time=7.160..7.161 rows=20000 loops=3)
                                                        Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                                        ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=12) (actual time=0.347..3.230 rows=20000 loops=3)
                                            ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.52 rows=1 width=8) (actual time=0.003..0.003 rows=1 loops=3972)
                                                  Index Cond: (id = oi.variant_id)
                                      ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=21) (actual time=0.003..0.003 rows=1 loops=3972)
                                            Index Cond: (id = v.product_id)
                                ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.288..0.288 rows=150 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 18kB
                                      ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.030..0.048 rows=150 loops=3)
Planning Time: 61.389 ms
Execution Time: 236.963 ms


==================================================
EXPLAIN ANALYZE — Query 4: Top 5 produktów z najwięcej recenzjami
==================================================
Limit  (cost=1792.59..1792.61 rows=5 width=25) (actual time=179.064..179.069 rows=5 loops=1)
  ->  Sort  (cost=1792.59..1842.59 rows=20000 width=25) (actual time=179.062..179.066 rows=5 loops=1)
        Sort Key: (COALESCE(r.count, '0'::bigint)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Hash Left Join  (cost=969.89..1460.40 rows=20000 width=25) (actual time=102.810..175.815 rows=20000 loops=1)
              Hash Cond: (p.id = r.product_id)
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=2.451..67.752 rows=20000 loops=1)
              ->  Hash  (cost=812.24..812.24 rows=12612 width=12) (actual time=100.341..100.343 rows=12612 loops=1)
                    Buckets: 16384  Batches: 1  Memory Usage: 670kB
                    ->  Subquery Scan on r  (cost=560.00..812.24 rows=12612 width=12) (actual time=94.625..98.348 rows=12612 loops=1)
                          ->  HashAggregate  (cost=560.00..686.12 rows=12612 width=12) (actual time=94.624..97.138 rows=12612 loops=1)
                                Group Key: "Review".product_id
                                Batches: 1  Memory Usage: 1425kB
                                ->  Seq Scan on "Review"  (cost=0.00..460.00 rows=20000 width=4) (actual time=2.073..87.648 rows=20000 loops=1)
Planning Time: 27.522 ms
Execution Time: 179.785 ms


==================================================
EXPLAIN ANALYZE — Query 5: Całkowity Przychód Pogrupowany Miesięcznie za Ostatni Rok
==================================================
Finalize GroupAggregate  (cost=9410.35..11923.57 rows=18976 width=36) (actual time=159.133..249.991 rows=12 loops=1)
  Group Key: ((date_trunc('month'::text, o.order_date))::date)
  ->  Gather Merge  (cost=9410.35..11472.89 rows=15814 width=36) (actual time=158.604..249.954 rows=36 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=8410.32..8647.53 rows=7907 width=36) (actual time=96.257..98.717 rows=12 loops=3)
              Group Key: ((date_trunc('month'::text, o.order_date))::date)
              ->  Sort  (cost=8410.32..8430.09 rows=7907 width=14) (actual time=94.996..95.577 rows=6310 loops=3)
                    Sort Key: ((date_trunc('month'::text, o.order_date))::date) DESC
                    Sort Method: quicksort  Memory: 757kB
                    Worker 0:  Sort Method: quicksort  Memory: 195kB
                    Worker 1:  Sort Method: quicksort  Memory: 217kB
                    ->  Parallel Hash Join  (cost=769.00..7898.39 rows=7907 width=14) (actual time=14.044..90.069 rows=6310 loops=3)
                          Hash Cond: (o.id = oi.order_id)
                          ->  Parallel Seq Scan on "Order" o  (cost=0.00..6252.67 rows=158136 width=12) (actual time=0.683..52.793 rows=126415 loops=3)
                                Filter: (order_date >= (now() - '1 year'::interval))
                                Rows Removed by Filter: 6919
                          ->  Parallel Hash  (cost=621.93..621.93 rows=11765 width=14) (actual time=12.770..12.770 rows=6667 loops=3)
                                Buckets: 32768  Batches: 1  Memory Usage: 1216kB
                                ->  Parallel Index Only Scan using idx_orderitem_variant_order_agg on "OrderItem" oi  (cost=0.29..621.93 rows=11765 width=14) (actual time=1.737..31.361 rows=20000 loops=1)
                                      Heap Fetches: 0
Planning Time: 3.491 ms
Execution Time: 253.299 ms


==================================================
EXPLAIN ANALYZE — Query 6: Produkty najczęściej dodawane do ulubionych
==================================================
Limit  (cost=14382.58..14382.60 rows=10 width=25) (actual time=742.287..818.369 rows=10 loops=1)
  ->  Sort  (cost=14382.58..14432.58 rows=20000 width=25) (actual time=741.558..816.522 rows=10 loops=1)
        Sort Key: (count(f.user_id)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=13750.38..13950.38 rows=20000 width=25) (actual time=734.015..812.062 rows=20000 loops=1)
              Group Key: p.id
              Batches: 1  Memory Usage: 2577kB
              ->  Gather  (cost=9350.38..13550.38 rows=40000 width=25) (actual time=646.239..783.730 rows=59994 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=8350.38..8550.38 rows=20000 width=25) (actual time=607.159..614.196 rows=19998 loops=3)
                          Group Key: p.id
                          Batches: 1  Memory Usage: 2577kB
                          Worker 0:  Batches: 1  Memory Usage: 2577kB
                          Worker 1:  Batches: 1  Memory Usage: 2577kB
                          ->  Hash Join  (cost=688.00..7100.38 rows=250000 width=21) (actual time=8.649..516.925 rows=200000 loops=3)
                                Hash Cond: (f.product_id = p.id)
                                ->  Parallel Seq Scan on "FavoriteProduct" f  (cost=0.00..5756.00 rows=250000 width=8) (actual time=0.827..416.927 rows=200000 loops=3)
                                ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=7.583..7.584 rows=20000 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1215kB
                                      ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.023..2.828 rows=20000 loops=3)
Planning Time: 11.499 ms
Execution Time: 827.571 ms


==================================================
EXPLAIN ANALYZE — Query 7: Dostępny Stan Magazynowy Wariantów Produktu Pogrupowany po Magazynach
==================================================
Finalize GroupAggregate  (cost=8886.64..10869.06 rows=16000 width=61) (actual time=1456.620..1980.513 rows=231755 loops=1)
  Group Key: p.name, w.name, v.sku
  ->  Gather Merge  (cost=8886.64..10575.72 rows=13334 width=61) (actual time=1455.459..1880.546 rows=271358 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=7886.61..8036.62 rows=6667 width=61) (actual time=1423.923..1562.423 rows=90453 loops=3)
              Group Key: p.name, w.name, v.sku
              ->  Sort  (cost=7886.61..7903.28 rows=6667 width=57) (actual time=1421.884..1511.651 rows=106667 loops=3)
                    Sort Key: p.name, w.name, v.sku
                    Sort Method: external merge  Disk: 7000kB
                    Worker 0:  Sort Method: external merge  Disk: 7288kB
                    Worker 1:  Sort Method: external merge  Disk: 7496kB
                    ->  Hash Join  (cost=2543.72..7463.16 rows=6667 width=57) (actual time=112.983..880.384 rows=106667 loops=3)
                          Hash Cond: (v.product_id = p.id)
                          ->  Hash Join  (cost=1855.72..6757.66 rows=6667 width=48) (actual time=105.311..816.918 rows=106667 loops=3)
                                Hash Cond: (ssi.variant_id = v.id)
                                ->  Hash Join  (cost=1.23..4885.66 rows=6667 width=25) (actual time=3.488..647.399 rows=106667 loops=3)
                                      Hash Cond: (ssi.warehouse_id = w.id)
                                      ->  Parallel Append  (cost=0.00..4527.02 rows=133333 width=12) (actual time=3.196..552.350 rows=106667 loops=3)
                                            ->  Parallel Seq Scan on "SerialStockItem" ssi  (cost=0.00..2001.16 rows=93816 width=12) (actual time=10.881..275.899 rows=53163 loops=3)
                                            ->  Parallel Seq Scan on "BulkStockItem" bsi  (cost=0.00..1859.19 rows=94419 width=12) (actual time=2.283..396.707 rows=80256 loops=2)
                                      ->  Hash  (cost=1.10..1.10 rows=10 width=21) (actual time=0.222..0.790 rows=10 loops=3)
                                            Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                            ->  Seq Scan on "Warehouse" w  (cost=0.00..1.10 rows=10 width=21) (actual time=0.214..0.216 rows=10 loops=3)
                                ->  Hash  (cost=1267.00..1267.00 rows=47000 width=31) (actual time=99.776..99.777 rows=47000 loops=3)
                                      Buckets: 65536  Batches: 1  Memory Usage: 3450kB
                                      ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=31) (actual time=0.502..85.111 rows=47000 loops=3)
                          ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=7.487..7.488 rows=20000 loops=3)
                                Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                                ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.322..3.149 rows=20000 loops=3)
Planning Time: 15.927 ms
Execution Time: 1998.008 ms


==================================================
EXPLAIN ANALYZE — Query 8: Stan magazynowy per produkt
==================================================
Sort  (cost=19267.36..19316.89 rows=19812 width=21) (actual time=527.355..529.272 rows=17954 loops=1)
  Sort Key: (sum("*SELECT* 1".quantity)) DESC
  Sort Method: quicksort  Memory: 1483kB
  ->  HashAggregate  (cost=17655.24..17853.36 rows=19812 width=21) (actual time=519.949..523.828 rows=17954 loops=1)
        Group Key: p.name
        Batches: 1  Memory Usage: 2065kB
        ->  Hash Join  (cost=2542.50..16055.24 rows=320000 width=17) (actual time=23.672..397.890 rows=320000 loops=1)
              Hash Cond: ("*SELECT* 1".product_id = p.id)
              ->  Append  (cost=1854.50..14527.07 rows=320000 width=8) (actual time=15.833..273.183 rows=320000 loops=1)
                    ->  Subquery Scan on "*SELECT* 1"  (cost=1854.50..6525.95 rows=159488 width=8) (actual time=15.831..127.693 rows=159488 loops=1)
                          ->  Hash Join  (cost=1854.50..4931.07 rows=159488 width=8) (actual time=15.829..112.497 rows=159488 loops=1)
                                Hash Cond: (ssi.variant_id = v.id)
                                ->  Seq Scan on "SerialStockItem" ssi  (cost=0.00..2657.88 rows=159488 width=4) (actual time=0.014..19.406 rows=159488 loops=1)
                                ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=15.793..15.794 rows=47000 loops=1)
                                      Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                      ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.006..8.165 rows=47000 loops=1)
                    ->  Subquery Scan on "*SELECT* 2"  (cost=1854.50..6401.12 rows=160512 width=8) (actual time=14.012..120.535 rows=160512 loops=1)
                          ->  Hash Join  (cost=1854.50..4796.00 rows=160512 width=8) (actual time=14.011..104.836 rows=160512 loops=1)
                                Hash Cond: (bsi.variant_id = v_1.id)
                                ->  Seq Scan on "BulkStockItem" bsi  (cost=0.00..2520.12 rows=160512 width=8) (actual time=0.023..18.006 rows=160512 loops=1)
                                ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=13.800..13.801 rows=47000 loops=1)
                                      Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                      ->  Seq Scan on "Variant" v_1  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.009..5.530 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=7.828..7.829 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.018..4.374 rows=20000 loops=1)
Planning Time: 36.947 ms
Execution Time: 532.742 ms


==================================================
EXPLAIN ANALYZE — Query 9: Najpopularniejsze Kategorie (wg. Całkowitego Przychodu)
==================================================
Limit  (cost=7440.92..7440.95 rows=10 width=44) (actual time=256.669..256.677 rows=1 loops=1)
  ->  Sort  (cost=7440.92..7441.30 rows=150 width=44) (actual time=256.667..256.675 rows=1 loops=1)
        Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
        Sort Method: quicksort  Memory: 25kB
        ->  HashAggregate  (cost=7435.81..7437.68 rows=150 width=44) (actual time=255.904..255.914 rows=1 loops=1)
              Group Key: c.name
              Batches: 1  Memory Usage: 40kB
              ->  Hash Join  (cost=3230.89..6435.81 rows=100000 width=22) (actual time=83.581..248.040 rows=20000 loops=1)
                    Hash Cond: (pc.category_id = c.id)
                    ->  Hash Join  (cost=3225.51..6160.51 rows=100000 width=14) (actual time=80.145..240.550 rows=20000 loops=1)
                          Hash Cond: (pc.product_id = p.id)
                          ->  Seq Scan on "ProductCategory" pc  (cost=0.00..1560.00 rows=100000 width=8) (actual time=1.776..192.356 rows=100000 loops=1)
                          ->  Hash  (cost=2975.51..2975.51 rows=20000 width=18) (actual time=31.541..31.545 rows=20000 loops=1)
                                Buckets: 32768  Batches: 1  Memory Usage: 1272kB
                                ->  Hash Join  (cost=2542.50..2975.51 rows=20000 width=18) (actual time=18.286..28.130 rows=20000 loops=1)
                                      Hash Cond: (v.product_id = p.id)
                                      ->  Hash Join  (cost=1854.50..2235.00 rows=20000 width=14) (actual time=13.437..19.705 rows=20000 loops=1)
                                            Hash Cond: (oi.variant_id = v.id)
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=14) (actual time=0.012..2.545 rows=20000 loops=1)
                                            ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=13.253..13.254 rows=47000 loops=1)
                                                  Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                                  ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.006..5.469 rows=47000 loops=1)
                                      ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=4.838..4.839 rows=20000 loops=1)
                                            Buckets: 32768  Batches: 1  Memory Usage: 960kB
                                            ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.007..2.109 rows=20000 loops=1)
                    ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=2.894..2.895 rows=150 loops=1)
                          Buckets: 1024  Batches: 1  Memory Usage: 16kB
                          ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=1.798..2.864 rows=150 loops=1)
Planning Time: 35.068 ms
Execution Time: 257.375 ms


==================================================
EXPLAIN ANALYZE — Query 10: Liczba produktów per kategoria
==================================================
Sort  (cost=2342.22..2342.59 rows=150 width=20) (actual time=49.839..49.849 rows=150 loops=1)
  Sort Key: (count(pc.product_id)) DESC
  Sort Method: quicksort  Memory: 30kB
  ->  HashAggregate  (cost=2335.30..2336.80 rows=150 width=20) (actual time=49.783..49.806 rows=150 loops=1)
        Group Key: c.name
        Batches: 1  Memory Usage: 48kB
        ->  Hash Right Join  (cost=5.38..1835.30 rows=100000 width=16) (actual time=0.689..29.274 rows=100000 loops=1)
              Hash Cond: (pc.category_id = c.id)
              ->  Seq Scan on "ProductCategory" pc  (cost=0.00..1560.00 rows=100000 width=8) (actual time=0.004..6.625 rows=100000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=0.057..0.058 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 16kB
                    ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=0.014..0.031 rows=150 loops=1)
Planning Time: 0.212 ms
Execution Time: 49.902 ms


==================================================
EXPLAIN ANALYZE — Query 11: Liczba zamówień per metoda płatności
==================================================
Sort  (cost=7798.49..7798.51 rows=6 width=50) (actual time=108.068..112.263 rows=6 loops=1)
  Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  Finalize GroupAggregate  (cost=7796.82..7798.41 rows=6 width=50) (actual time=107.493..111.699 rows=6 loops=1)
        Group Key: pm.name
        ->  Gather Merge  (cost=7796.82..7798.22 rows=12 width=50) (actual time=107.478..111.678 rows=18 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Sort  (cost=6796.80..6796.81 rows=6 width=50) (actual time=85.667..85.672 rows=6 loops=3)
                    Sort Key: pm.name
                    Sort Method: quicksort  Memory: 25kB
                    Worker 0:  Sort Method: quicksort  Memory: 25kB
                    Worker 1:  Sort Method: quicksort  Memory: 25kB
                    ->  Partial HashAggregate  (cost=6796.64..6796.72 rows=6 width=50) (actual time=84.607..84.612 rows=6 loops=3)
                          Group Key: pm.name
                          Batches: 1  Memory Usage: 24kB
                          Worker 0:  Batches: 1  Memory Usage: 24kB
                          Worker 1:  Batches: 1  Memory Usage: 24kB
                          ->  Hash Join  (cost=770.13..6692.48 rows=8333 width=24) (actual time=3.204..81.186 rows=6667 loops=3)
                                Hash Cond: (o.payment_method_id = pm.id)
                                ->  Parallel Hash Join  (cost=769.00..6654.02 rows=8333 width=18) (actual time=3.153..79.711 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.005..31.156 rows=133333 loops=3)
                                      ->  Parallel Hash  (cost=621.93..621.93 rows=11765 width=14) (actual time=3.015..3.016 rows=6667 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1216kB
                                            ->  Parallel Index Only Scan using idx_orderitem_variant_order_agg on "OrderItem" oi  (cost=0.29..621.93 rows=11765 width=14) (actual time=0.015..3.210 rows=20000 loops=1)
                                                  Heap Fetches: 0
                                ->  Hash  (cost=1.06..1.06 rows=6 width=14) (actual time=0.029..0.030 rows=6 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                      ->  Seq Scan on "PaymentMethod" pm  (cost=0.00..1.06 rows=6 width=14) (actual time=0.024..0.025 rows=6 loops=3)
Planning Time: 6.546 ms
Execution Time: 112.343 ms


==================================================
EXPLAIN ANALYZE — Query 12: Średnia ocena per producent
==================================================
Sort  (cost=1367.54..1367.91 rows=150 width=57) (actual time=37.997..38.008 rows=150 loops=1)
  Sort Key: (round(avg(r.rating), 2)) DESC NULLS LAST
  Sort Method: quicksort  Memory: 32kB
  ->  HashAggregate  (cost=1359.87..1362.12 rows=150 width=57) (actual time=37.879..37.942 rows=150 loops=1)
        Group Key: m.name
        Batches: 1  Memory Usage: 64kB
        ->  Hash Join  (cost=693.38..1259.87 rows=20000 width=29) (actual time=5.455..31.362 rows=27388 loops=1)
              Hash Cond: (p.manufacturer_id = m.id)
              ->  Hash Right Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=5.384..25.968 rows=27388 loops=1)
                    Hash Cond: (r.product_id = p.id)
                    ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=0.021..7.027 rows=20000 loops=1)
                    ->  Hash  (cost=438.00..438.00 rows=20000 width=8) (actual time=5.350..5.351 rows=20000 loops=1)
                          Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                          ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=8) (actual time=0.005..2.279 rows=20000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.056..0.057 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 18kB
                    ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.014..0.031 rows=150 loops=1)
Planning Time: 5.462 ms
Execution Time: 38.080 ms


==================================================
EXPLAIN ANALYZE — Query 13: Aktywne promocje i objęta nimi liczba wariantów
==================================================
Sort  (cost=587.95..588.05 rows=42 width=14) (actual time=10.928..10.931 rows=42 loops=1)
  Sort Key: (count(v.id)) DESC
  Sort Method: quicksort  Memory: 26kB
  ->  HashAggregate  (cost=586.40..586.82 rows=42 width=14) (actual time=10.326..10.335 rows=42 loops=1)
        Group Key: pr.name
        Batches: 1  Memory Usage: 24kB
        ->  Merge Join  (cost=7.46..535.87 rows=10105 width=10) (actual time=0.186..10.029 rows=1238 loops=1)
              Merge Cond: (v.promotion_id = pr.id)
              ->  Index Scan using idx_variant_promotion on "Variant" v  (cost=0.29..4233.14 rows=47000 width=8) (actual time=0.020..9.486 rows=5685 loops=1)
              ->  Sort  (cost=7.17..7.27 rows=43 width=10) (actual time=0.051..0.057 rows=43 loops=1)
                    Sort Key: pr.id
                    Sort Method: quicksort  Memory: 26kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=43 width=10) (actual time=0.018..0.041 rows=43 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 157
Planning Time: 14.686 ms
Execution Time: 11.582 ms


==================================================
EXPLAIN ANALYZE — Query 14: Najczęściej wybierane warianty w koszykach
==================================================
Limit  (cost=33355.13..33355.15 rows=10 width=44) (actual time=719.920..720.056 rows=10 loops=1)
  ->  Sort  (cost=33355.13..33470.31 rows=46072 width=44) (actual time=719.919..720.053 rows=10 loops=1)
        Sort Key: rci.total_quantity DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Hash Join  (cost=30848.18..32359.53 rows=46072 width=44) (actual time=674.024..711.812 rows=47000 loops=1)
              Hash Cond: (v.product_id = p.id)
              ->  Hash Join  (cost=30160.18..31550.57 rows=46072 width=35) (actual time=668.247..691.572 rows=47000 loops=1)
                    Hash Cond: (v.id = rci.variant_id)
                    ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=31) (actual time=0.010..6.043 rows=47000 loops=1)
                    ->  Hash  (cost=29584.28..29584.28 rows=46072 width=12) (actual time=668.203..668.334 rows=47000 loops=1)
                          Buckets: 65536  Batches: 1  Memory Usage: 2532kB
                          ->  Subquery Scan on rci  (cost=28662.84..29584.28 rows=46072 width=12) (actual time=646.817..658.781 rows=47000 loops=1)
                                ->  Finalize HashAggregate  (cost=28662.84..29123.56 rows=46072 width=12) (actual time=646.816..654.344 rows=47000 loops=1)
                                      Group Key: "CartItem".variant_id
                                      Batches: 1  Memory Usage: 4625kB
                                      ->  Gather  (cost=18527.00..28202.12 rows=92144 width=12) (actual time=555.979..602.290 rows=140999 loops=1)
                                            Workers Planned: 2
                                            Workers Launched: 2
                                            ->  Partial HashAggregate  (cost=17527.00..17987.72 rows=46072 width=12) (actual time=552.543..564.171 rows=47000 loops=3)
                                                  Group Key: "CartItem".variant_id
                                                  Batches: 1  Memory Usage: 4625kB
                                                  Worker 0:  Batches: 1  Memory Usage: 4625kB
                                                  Worker 1:  Batches: 1  Memory Usage: 4625kB
                                                  ->  Parallel Seq Scan on "CartItem"  (cost=0.00..14402.00 rows=625000 width=8) (actual time=1.072..356.299 rows=500000 loops=3)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=5.766..5.767 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.013..2.397 rows=20000 loops=1)
Planning Time: 12.444 ms
Execution Time: 721.835 ms


==================================================
EXPLAIN ANALYZE — Query 15: Produkty z Największą Różnicą Między Ceną Podstawową a Ceną Wariantu
==================================================
Limit  (cost=3211.55..3211.58 rows=10 width=80) (actual time=46.997..47.000 rows=10 loops=1)
  ->  Sort  (cost=3211.55..3329.05 rows=47000 width=80) (actual time=46.995..46.997 rows=10 loops=1)
        Sort Key: v.price_modifier DESC
        Sort Method: top-N heapsort  Memory: 27kB
        ->  Hash Join  (cost=688.00..2195.90 rows=47000 width=80) (actual time=6.407..33.080 rows=47000 loops=1)
              Hash Cond: (v.product_id = p.id)
              ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=33) (actual time=0.018..6.315 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=6.370..6.371 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1381kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.006..2.731 rows=20000 loops=1)
Planning Time: 6.591 ms
Execution Time: 47.042 ms


==================================================
EXPLAIN ANALYZE — Query 16: Konwersja zamówień wg statusu
==================================================
Sort  (cost=7541.77..7541.79 rows=7 width=48) (actual time=116.345..119.511 rows=7 loops=1)
  Sort Key: (count(o.id)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  WindowAgg  (cost=7541.33..7541.67 rows=7 width=48) (actual time=116.334..119.504 rows=7 loops=1)
        ->  Finalize GroupAggregate  (cost=7539.74..7541.51 rows=7 width=16) (actual time=116.309..119.482 rows=7 loops=1)
              Group Key: s.name
              ->  Gather Merge  (cost=7539.74..7541.37 rows=14 width=16) (actual time=116.298..119.469 rows=21 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Sort  (cost=6539.71..6539.73 rows=7 width=16) (actual time=95.652..95.655 rows=7 loops=3)
                          Sort Key: s.name
                          Sort Method: quicksort  Memory: 25kB
                          Worker 0:  Sort Method: quicksort  Memory: 25kB
                          Worker 1:  Sort Method: quicksort  Memory: 25kB
                          ->  Partial HashAggregate  (cost=6539.55..6539.62 rows=7 width=16) (actual time=94.581..94.584 rows=7 loops=3)
                                Group Key: s.name
                                Batches: 1  Memory Usage: 24kB
                                Worker 0:  Batches: 1  Memory Usage: 24kB
                                Worker 1:  Batches: 1  Memory Usage: 24kB
                                ->  Hash Join  (cost=1.16..5706.21 rows=166667 width=12) (actual time=0.224..63.150 rows=133333 loops=3)
                                      Hash Cond: (o.status_id = s.id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.006..16.435 rows=133333 loops=3)
                                      ->  Hash  (cost=1.07..1.07 rows=7 width=12) (actual time=0.026..0.027 rows=7 loops=3)
                                            Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                            ->  Seq Scan on "Status" s  (cost=0.00..1.07 rows=7 width=12) (actual time=0.020..0.021 rows=7 loops=3)
Planning Time: 5.204 ms
Execution Time: 119.602 ms


==================================================
EXPLAIN ANALYZE — Query 17: Top klienci wg wydatków
==================================================
Limit  (cost=15389.43..15389.45 rows=10 width=50) (actual time=2525.704..2640.910 rows=10 loops=1)
  ->  Sort  (cost=15389.43..15439.43 rows=20000 width=50) (actual time=2525.703..2640.907 rows=10 loops=1)
        Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=14707.24..14957.24 rows=20000 width=50) (actual time=2498.064..2633.748 rows=19296 loops=1)
              Group Key: u.id
              Batches: 5  Memory Usage: 8241kB  Disk Usage: 224kB
              ->  Gather  (cost=12811.48..14582.24 rows=16666 width=50) (actual time=2185.013..2488.562 rows=19424 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=11811.48..11915.64 rows=8333 width=50) (actual time=2175.461..2228.196 rows=6475 loops=3)
                          Group Key: u.id
                          Batches: 1  Memory Usage: 2961kB
                          Worker 0:  Batches: 1  Memory Usage: 2961kB
                          Worker 1:  Batches: 1  Memory Usage: 2961kB
                          ->  Nested Loop  (cost=769.42..11728.15 rows=8333 width=28) (actual time=3.711..2117.366 rows=6667 loops=3)
                                ->  Parallel Hash Join  (cost=769.00..6654.02 rows=8333 width=14) (actual time=3.487..92.674 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.008..27.566 rows=133333 loops=3)
                                      ->  Parallel Hash  (cost=621.93..621.93 rows=11765 width=14) (actual time=2.846..5.082 rows=6667 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1248kB
                                            ->  Parallel Index Only Scan using idx_orderitem_variant_order_agg on "OrderItem" oi  (cost=0.29..621.93 rows=11765 width=14) (actual time=0.018..4.563 rows=10000 loops=2)
                                                  Heap Fetches: 0
                                ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.299..0.299 rows=1 loops=20000)
                                      Index Cond: (id = o.user_id)
Planning Time: 3.130 ms
Execution Time: 2656.529 ms


==================================================
EXPLAIN ANALYZE — Query 18: Produkty z wariantami objętymi promocją, z końcową ceną
==================================================
Sort  (cost=2074.11..2099.37 rows=10105 width=132) (actual time=75.638..75.750 rows=1238 loops=1)
  Sort Key: (round(((p.price + v.price_modifier) * ('1'::numeric - pr.discount_percentage)), 2))
  Sort Method: quicksort  Memory: 139kB
  ->  Hash Join  (cost=695.46..1401.98 rows=10105 width=132) (actual time=49.980..74.464 rows=1238 loops=1)
        Hash Cond: (v.product_id = p.id)
        ->  Merge Join  (cost=7.46..535.87 rows=10105 width=39) (actual time=4.230..27.234 rows=1238 loops=1)
              Merge Cond: (v.promotion_id = pr.id)
              ->  Index Scan using idx_variant_promotion on "Variant" v  (cost=0.29..4233.14 rows=47000 width=37) (actual time=0.677..26.651 rows=5685 loops=1)
              ->  Sort  (cost=7.17..7.27 rows=43 width=10) (actual time=0.055..0.064 rows=43 loops=1)
                    Sort Key: pr.id
                    Sort Method: quicksort  Memory: 26kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=43 width=10) (actual time=0.017..0.040 rows=43 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 157
        ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=43.878..43.878 rows=20000 loops=1)
              Buckets: 32768  Batches: 1  Memory Usage: 1381kB
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.018..38.624 rows=20000 loops=1)
Planning Time: 29.475 ms
Execution Time: 76.472 ms


==================================================
EXPLAIN ANALYZE — Query 19: Użytkownicy, Którzy Dodali Produkt do Koszyka, Ale Nie Złożyli Zamówienia (Potencjał Odbudowy Koszyka)
==================================================
Hash Join  (cost=46254.21..103988.81 rows=1068640 width=55) (actual time=4948.024..7334.668 rows=1005006 loops=1)
  Hash Cond: (v.product_id = p.id)
  ->  Hash Join  (cost=45566.21..100495.04 rows=1068640 width=46) (actual time=4939.299..6793.993 rows=1005006 loops=1)
        Hash Cond: (ci.variant_id = v.id)
        ->  Hash Join  (cost=43711.71..95835.11 rows=1068640 width=46) (actual time=4893.002..6036.641 rows=1005006 loops=1)
              Hash Cond: (ci.cart_id = c.id)
              ->  Seq Scan on "CartItem" ci  (cost=0.00..23152.00 rows=1500000 width=8) (actual time=2.019..308.263 rows=1500000 loops=1)
              ->  Hash  (cost=41435.91..41435.91 rows=106864 width=46) (actual time=4883.582..4901.241 rows=100414 loops=1)
                    Buckets: 131072  Batches: 2  Memory Usage: 4929kB
                    ->  Gather  (cost=25017.67..41435.91 rows=106864 width=46) (actual time=4566.019..4694.873 rows=100414 loops=1)
                          Workers Planned: 2
                          Workers Launched: 2
                          ->  Parallel Hash Right Anti Join  (cost=24017.67..29749.51 rows=44527 width=46) (actual time=3859.307..3872.882 rows=33471 loops=3)
                                Hash Cond: (o.user_id = u.id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=4) (actual time=1.981..262.556 rows=133333 loops=3)
                                ->  Parallel Hash  (cost=23236.42..23236.42 rows=62500 width=50) (actual time=3330.353..3331.004 rows=50000 loops=3)
                                      Buckets: 262144  Batches: 1  Memory Usage: 14720kB
                                      ->  Hash Join  (cost=4079.00..23236.42 rows=62500 width=50) (actual time=477.892..2907.996 rows=50000 loops=3)
                                            Hash Cond: (u.id = c.user_id)
                                            ->  Parallel Seq Scan on "User" u  (cost=0.00..18063.67 rows=416667 width=46) (actual time=35.588..1539.540 rows=333333 loops=3)
                                            ->  Hash  (cost=2204.00..2204.00 rows=150000 width=8) (actual time=343.179..343.367 rows=150000 loops=3)
                                                  Buckets: 262144  Batches: 1  Memory Usage: 7908kB
                                                  ->  Seq Scan on "Cart" c  (cost=0.00..2204.00 rows=150000 width=8) (actual time=68.163..261.578 rows=150000 loops=3)
        ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=39.904..40.465 rows=47000 loops=1)
              Buckets: 65536  Batches: 1  Memory Usage: 2348kB
              ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.017..30.643 rows=47000 loops=1)
  ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=5.722..5.723 rows=20000 loops=1)
        Buckets: 32768  Batches: 1  Memory Usage: 1245kB
        ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.014..2.395 rows=20000 loops=1)
Planning Time: 103.445 ms
Execution Time: 7477.959 ms


==================================================
EXPLAIN ANALYZE — Query 20: Wyszukiwanie produktów po nazwie lub opisie (parametryzowane)
==================================================
Bitmap Heap Scan on "Product"  (cost=43.00..57.51 rows=4 width=60) (actual time=11.789..48.931 rows=143 loops=1)
  Recheck Cond: (((name)::text ~~* '%test%'::text) OR (description ~~* '%test%'::text))
  Heap Blocks: exact=106
  ->  BitmapOr  (cost=43.00..43.00 rows=4 width=0) (actual time=11.204..11.205 rows=0 loops=1)
        ->  Bitmap Index Scan on idx_product_name_trgm  (cost=0.00..21.50 rows=2 width=0) (actual time=5.046..5.046 rows=42 loops=1)
              Index Cond: ((name)::text ~~* '%test%'::text)
        ->  Bitmap Index Scan on idx_product_description_trgm  (cost=0.00..21.50 rows=2 width=0) (actual time=6.151..6.151 rows=102 loops=1)
              Index Cond: (description ~~* '%test%'::text)
Planning Time: 135.307 ms
Execution Time: 54.157 ms


==================================================
EXPLAIN ANALYZE — Query 21: Użytkownicy, Którzy Zapisali Konkretny Produkt jako Ulubiony (np. Product ID=350259)
==================================================
Nested Loop  (cost=0.85..262.23 rows=30 width=56) (actual time=3.413..16.662 rows=26 loops=1)
  ->  Index Only Scan using idx_favoriteproduct_product_user on "FavoriteProduct" fp  (cost=0.42..8.95 rows=30 width=4) (actual time=3.379..3.396 rows=26 loops=1)
        Index Cond: (product_id = 35)
        Heap Fetches: 0
  ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..8.44 rows=1 width=60) (actual time=0.508..0.508 rows=1 loops=26)
        Index Cond: (id = fp.user_id)
Planning Time: 17.128 ms
Execution Time: 16.705 ms


==================================================
EXPLAIN ANALYZE — Query 22: Znajdź Magazyny, Które Posiadają Zapasy Konkretnego Wariantu (np. SKU='VR-000000-a637d44b7afd')
==================================================
Sort  (cost=27.64..27.64 rows=2 width=25) (actual time=7.079..7.083 rows=0 loops=1)
  Sort Key: (sum("*SELECT* 1".stock_units)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  GroupAggregate  (cost=27.51..27.63 rows=2 width=25) (actual time=7.056..7.059 rows=0 loops=1)
        Group Key: w.name
        Filter: (sum("*SELECT* 1".stock_units) > 0)
        ->  Sort  (cost=27.51..27.52 rows=6 width=21) (actual time=7.054..7.057 rows=0 loops=1)
              Sort Key: w.name
              Sort Method: quicksort  Memory: 25kB
              ->  Hash Join  (cost=2.06..27.43 rows=6 width=21) (actual time=6.355..6.358 rows=0 loops=1)
                    Hash Cond: ("*SELECT* 1".warehouse_id = w.id)
                    ->  Append  (cost=0.83..26.18 rows=6 width=8) (actual time=6.354..6.356 rows=0 loops=1)
                          ->  Subquery Scan on "*SELECT* 1"  (cost=0.83..13.08 rows=3 width=8) (actual time=6.321..6.322 rows=0 loops=1)
                                ->  Nested Loop  (cost=0.83..13.05 rows=3 width=8) (actual time=6.320..6.321 rows=0 loops=1)
                                      ->  Index Scan using uix_variant_sku on "Variant" v  (cost=0.41..8.43 rows=1 width=4) (actual time=6.320..6.320 rows=0 loops=1)
                                            Index Cond: ((sku)::text = 'VR-000001-2704de10f283'::text)
                                      ->  Index Only Scan using idx_bsi_variant_warehouse_qty on "BulkStockItem" bsi  (cost=0.42..4.54 rows=7 width=12) (never executed)
                                            Index Cond: (variant_id = v.id)
                                            Heap Fetches: 0
                          ->  Subquery Scan on "*SELECT* 2"  (cost=0.83..13.08 rows=3 width=8) (actual time=0.030..0.031 rows=0 loops=1)
                                ->  Nested Loop  (cost=0.83..13.05 rows=3 width=8) (actual time=0.029..0.029 rows=0 loops=1)
                                      ->  Index Scan using uix_variant_sku on "Variant" v_1  (cost=0.41..8.43 rows=1 width=4) (actual time=0.028..0.028 rows=0 loops=1)
                                            Index Cond: ((sku)::text = 'VR-000001-2704de10f283'::text)
                                      ->  Index Only Scan using idx_ssi_variant_warehouse on "SerialStockItem" ssi  (cost=0.42..4.54 rows=7 width=8) (never executed)
                                            Index Cond: (variant_id = v_1.id)
                                            Heap Fetches: 0
                    ->  Hash  (cost=1.10..1.10 rows=10 width=21) (never executed)
                          ->  Seq Scan on "Warehouse" w  (cost=0.00..1.10 rows=10 width=21) (never executed)
Planning Time: 9.337 ms
Execution Time: 7.745 ms


==================================================
EXPLAIN ANALYZE — Query 23: Warianty, Które Wymagają Uzyskania Konkretnej Opcji (np. 'Kolor'='Czerwony')
==================================================
Nested Loop  (cost=6.81..677.99 rows=8 width=36) (actual time=0.020..0.021 rows=0 loops=1)
  ->  Nested Loop  (cost=6.52..675.35 rows=8 width=27) (actual time=0.020..0.021 rows=0 loops=1)
        ->  Nested Loop  (cost=6.23..672.76 rows=8 width=4) (actual time=0.020..0.020 rows=0 loops=1)
              Join Filter: (opt.attribute_id = a.id)
              ->  Seq Scan on "Attribute" a  (cost=0.00..1.38 rows=1 width=4) (actual time=0.020..0.020 rows=0 loops=1)
                    Filter: ((name)::text = 'Attr_49_Century'::text)
                    Rows Removed by Filter: 30
              ->  Nested Loop  (cost=6.23..668.26 rows=250 width=8) (never executed)
                    ->  Seq Scan on "Option" opt  (cost=0.00..18.50 rows=1 width=8) (never executed)
                          Filter: ((value)::text = 'do'::text)
                    ->  Bitmap Heap Scan on "VariantOption" vo  (cost=6.23..647.26 rows=250 width=8) (never executed)
                          Recheck Cond: (option_id = opt.id)
                          ->  Bitmap Index Scan on idx_variantoption_option_id  (cost=0.00..6.17 rows=250 width=0) (never executed)
                                Index Cond: (option_id = opt.id)
        ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.32 rows=1 width=31) (never executed)
              Index Cond: (id = vo.variant_id)
  ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=17) (never executed)
        Index Cond: (id = v.product_id)
Planning Time: 47.521 ms
Execution Time: 0.098 ms


==================================================
EXPLAIN ANALYZE — Query 24: Znajdź Zamówienia Użytkownika (np. email='debbie.lane.16786.50af0753@example.com') o Statusie 'Paid'
==================================================
Nested Loop  (cost=0.98..17.07 rows=1 width=20) (actual time=3.787..3.788 rows=0 loops=1)
  ->  Nested Loop  (cost=0.85..16.89 rows=1 width=16) (actual time=3.786..3.787 rows=0 loops=1)
        ->  Index Scan using "User_email_key" on "User" u  (cost=0.42..8.44 rows=1 width=4) (actual time=3.786..3.786 rows=0 loops=1)
              Index Cond: ((email)::text = 'debbie.lane.16786.50af0753@example.com'::text)
        ->  Index Scan using idx_order_user on "Order" o  (cost=0.42..8.44 rows=1 width=20) (never executed)
              Index Cond: (user_id = u.id)
  ->  Index Scan using "Status_pkey" on "Status" s  (cost=0.13..0.15 rows=1 width=12) (never executed)
        Index Cond: (id = o.status_id)
        Filter: ((name)::text = 'Paid'::text)
Planning Time: 2.124 ms
Execution Time: 3.825 ms


==================================================
EXPLAIN ANALYZE — Query 25: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
Hash Left Join  (cost=6.97..48.34 rows=16 width=87) (actual time=2.033..7.646 rows=18 loops=1)
  Hash Cond: (opt.attribute_id = a.id)
  ->  Nested Loop Left Join  (cost=5.30..46.57 rows=16 width=45) (actual time=1.371..6.967 rows=18 loops=1)
        ->  Nested Loop Left Join  (cost=5.02..41.89 rows=16 width=39) (actual time=0.726..5.670 rows=18 loops=1)
              ->  Nested Loop  (cost=4.60..24.13 rows=3 width=39) (actual time=0.035..0.633 rows=4 loops=1)
                    ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..8.30 rows=1 width=10) (actual time=0.009..0.010 rows=1 loops=1)
                          Index Cond: (id = 35)
                    ->  Bitmap Heap Scan on "Variant" v  (cost=4.31..15.80 rows=3 width=37) (actual time=0.024..0.619 rows=4 loops=1)
                          Recheck Cond: (product_id = 35)
                          Heap Blocks: exact=4
                          ->  Bitmap Index Scan on idx_variant_product  (cost=0.00..4.31 rows=3 width=0) (actual time=0.013..0.013 rows=4 loops=1)
                                Index Cond: (product_id = 35)
              ->  Index Only Scan using uq_varopt_variant_option on "VariantOption" vo  (cost=0.42..5.86 rows=6 width=8) (actual time=1.256..1.257 rows=4 loops=4)
                    Index Cond: (variant_id = v.id)
                    Heap Fetches: 0
        ->  Index Scan using "Option_pkey" on "Option" opt  (cost=0.28..0.29 rows=1 width=14) (actual time=0.071..0.071 rows=1 loops=18)
              Index Cond: (id = vo.option_id)
  ->  Hash  (cost=1.30..1.30 rows=30 width=18) (actual time=0.023..0.024 rows=30 loops=1)
        Buckets: 1024  Batches: 1  Memory Usage: 10kB
        ->  Seq Scan on "Attribute" a  (cost=0.00..1.30 rows=30 width=18) (actual time=0.011..0.015 rows=30 loops=1)
Planning Time: 0.558 ms
Execution Time: 7.719 ms


==================================================
EXPLAIN ANALYZE — Query 26: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
Hash Left Join  (cost=6.97..48.42 rows=16 width=87) (actual time=0.008..0.009 rows=0 loops=1)
  Hash Cond: (opt.attribute_id = a.id)
  ->  Nested Loop Left Join  (cost=5.30..46.57 rows=16 width=45) (actual time=0.007..0.007 rows=0 loops=1)
        ->  Nested Loop Left Join  (cost=5.02..41.89 rows=16 width=39) (actual time=0.007..0.007 rows=0 loops=1)
              ->  Nested Loop  (cost=4.60..24.13 rows=3 width=39) (actual time=0.006..0.007 rows=0 loops=1)
                    ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..8.30 rows=1 width=10) (actual time=0.006..0.006 rows=0 loops=1)
                          Index Cond: (id = 350259)
                    ->  Bitmap Heap Scan on "Variant" v  (cost=4.31..15.80 rows=3 width=37) (never executed)
                          Recheck Cond: (product_id = 350259)
                          ->  Bitmap Index Scan on idx_variant_product  (cost=0.00..4.31 rows=3 width=0) (never executed)
                                Index Cond: (product_id = 350259)
              ->  Index Only Scan using uq_varopt_variant_option on "VariantOption" vo  (cost=0.42..5.86 rows=6 width=8) (never executed)
                    Index Cond: (variant_id = v.id)
                    Heap Fetches: 0
        ->  Index Scan using "Option_pkey" on "Option" opt  (cost=0.28..0.29 rows=1 width=14) (never executed)
              Index Cond: (id = vo.option_id)
  ->  Hash  (cost=1.30..1.30 rows=30 width=18) (never executed)
        ->  Seq Scan on "Attribute" a  (cost=0.00..1.30 rows=30 width=18) (never executed)
Planning Time: 0.562 ms
Execution Time: 0.047 ms


==================================================
EXPLAIN ANALYZE — Query 27: Lista Wszystkich Dziecięcych Kategorii (Podkategorii) dla Konkretnej Kategorii Nadrzędnej (np. ID=5)
==================================================
Seq Scan on "Category"  (cost=0.00..3.88 rows=3 width=12) (actual time=0.023..0.031 rows=3 loops=1)
  Filter: (parent_id = 5)
  Rows Removed by Filter: 147
Planning Time: 1.362 ms
Execution Time: 0.051 ms


==================================================
EXPLAIN ANALYZE — Query 28: Porównanie Średniej Oceny dla Promowanych i Niepromowanych Produktów
==================================================
HashAggregate  (cost=87850.51..87853.01 rows=200 width=64) (actual time=260.761..260.766 rows=2 loops=1)
  Group Key: CASE WHEN (ANY (p.id = (hashed SubPlan 2).col1)) THEN 'Promowany'::text ELSE 'Niepromowany'::text END
  Batches: 1  Memory Usage: 40kB
  ->  HashAggregate  (cost=1300.51..87550.51 rows=20000 width=68) (actual time=250.914..257.815 rows=12612 loops=1)
        Group Key: p.id
        Batches: 1  Memory Usage: 2577kB
        ->  Hash Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=82.805..218.510 rows=20000 loops=1)
              Hash Cond: (r.product_id = p.id)
              ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=2.612..121.929 rows=20000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=80.152..80.153 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 960kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.009..73.424 rows=20000 loops=1)
        SubPlan 2
          ->  Index Only Scan using idx_variant_product_promotion on "Variant" v2  (cost=0.28..215.94 rows=5577 width=4) (actual time=3.716..21.327 rows=5684 loops=1)
                Heap Fetches: 0
Planning Time: 2.289 ms
Execution Time: 261.432 ms


==================================================
EXPLAIN ANALYZE — Query 29: Top 5 Miast Generujących Największy Przychód (Wg. Adresu Wysyłki)
==================================================
Limit  (cost=15305.18..15305.19 rows=5 width=45) (actual time=3710.454..3814.754 rows=5 loops=1)
  ->  Sort  (cost=15305.18..15355.18 rows=20000 width=45) (actual time=3710.443..3813.332 rows=5 loops=1)
        Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=14722.99..14972.99 rows=20000 width=45) (actual time=3701.024..3809.328 rows=12950 loops=1)
              Group Key: a.city
              Batches: 1  Memory Usage: 5905kB
              ->  Gather  (cost=12827.23..14597.99 rows=16666 width=45) (actual time=3625.122..3771.442 rows=16116 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=11827.23..11931.39 rows=8333 width=45) (actual time=3601.399..3608.416 rows=5372 loops=3)
                          Group Key: a.city
                          Batches: 1  Memory Usage: 2449kB
                          Worker 0:  Batches: 1  Memory Usage: 2449kB
                          Worker 1:  Batches: 1  Memory Usage: 2449kB
                          ->  Nested Loop  (cost=769.42..11743.90 rows=8333 width=23) (actual time=29.070..3578.981 rows=6667 loops=3)
                                ->  Parallel Hash Join  (cost=769.00..6654.02 rows=8333 width=14) (actual time=25.160..100.764 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.010..20.267 rows=133333 loops=3)
                                      ->  Parallel Hash  (cost=621.93..621.93 rows=11765 width=14) (actual time=24.955..25.396 rows=6667 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1248kB
                                            ->  Parallel Index Only Scan using idx_orderitem_variant_order_agg on "OrderItem" oi  (cost=0.29..621.93 rows=11765 width=14) (actual time=0.032..20.141 rows=6667 loops=3)
                                                  Heap Fetches: 0
                                ->  Index Scan using "Address_pkey" on "Address" a  (cost=0.43..0.61 rows=1 width=17) (actual time=0.520..0.520 rows=1 loops=20000)
                                      Index Cond: (id = o.shipping_address_id)
Planning Time: 28.814 ms
Execution Time: 3820.973 ms


==================================================
EXPLAIN ANALYZE — Query 30: Porównanie Wolumenu Sprzedaży Produktów Promowanych vs. Niepromowanych (w Ostatnich 30 Dniach)
==================================================
GroupAggregate  (cost=4663.11..4669.72 rows=200 width=40) (actual time=31.705..31.708 rows=1 loops=1)
  Group Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
  ->  Sort  (cost=4663.11..4664.65 rows=614 width=36) (actual time=31.581..31.615 rows=619 loops=1)
        Sort Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
        Sort Method: quicksort  Memory: 49kB
        ->  Nested Loop  (cost=3935.99..4634.68 rows=614 width=36) (actual time=16.962..30.712 rows=619 loops=1)
              ->  Hash Join  (cost=3935.70..4316.20 rows=614 width=8) (actual time=16.239..29.015 rows=619 loops=1)
                    Hash Cond: (oi.order_id = o.id)
                    ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=12) (actual time=0.015..9.974 rows=20000 loops=1)
                    ->  Hash  (cost=3782.30..3782.30 rows=12272 width=4) (actual time=16.206..16.207 rows=12318 loops=1)
                          Buckets: 16384  Batches: 1  Memory Usage: 562kB
                          ->  Bitmap Heap Scan on "Order" o  (cost=231.54..3782.30 rows=12272 width=4) (actual time=7.279..14.303 rows=12318 loops=1)
                                Recheck Cond: (order_date >= (now() - '30 days'::interval))
                                Heap Blocks: exact=3270
                                ->  Bitmap Index Scan on idx_order_date  (cost=0.00..228.47 rows=12272 width=0) (actual time=6.903..6.904 rows=12318 loops=1)
                                      Index Cond: (order_date >= (now() - '30 days'::interval))
              ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.52 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=619)
                    Index Cond: (id = oi.variant_id)
Planning Time: 11.809 ms
Execution Time: 31.774 ms


==================================================
EXPLAIN ANALYZE — Query 31: Wskaźnik Lojalności (Repeat Purchase Rate) Użytkowników z Podziałem na Miasto Adresu Rozliczeniowego
==================================================
Sort  (cost=128699.75..128773.84 rows=29636 width=61) (actual time=4582.988..4695.285 rows=66456 loops=1)
  Sort Key: (round((((count(*) FILTER (WHERE (u.orders_count > 1)))::numeric * 100.0) / (NULLIF(count(DISTINCT o.user_id), 0))::numeric), 2)) DESC
  Sort Method: external merge  Disk: 3192kB
  ->  GroupAggregate  (cost=75171.04..126498.53 rows=29636 width=61) (actual time=4123.888..4578.167 rows=66456 loops=1)
        Group Key: a.city
        ->  Gather Merge  (cost=75171.04..121757.63 rows=400000 width=25) (actual time=4113.133..4458.119 rows=400000 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Sort  (cost=74171.01..74587.68 rows=166667 width=25) (actual time=3912.907..3984.060 rows=133333 loops=3)
                    Sort Key: a.city, o.user_id
                    Sort Method: external merge  Disk: 5184kB
                    Worker 0:  Sort Method: external merge  Disk: 4968kB
                    Worker 1:  Sort Method: external merge  Disk: 5176kB
                    ->  Parallel Hash Join  (cost=34868.03..55725.48 rows=166667 width=25) (actual time=1239.196..3196.594 rows=133333 loops=3)
                          Hash Cond: (a.id = o.billing_address_id)
                          ->  Parallel Seq Scan on "Address" a  (cost=0.00..18288.00 rows=500000 width=17) (actual time=19.781..1324.765 rows=400000 loops=3)
                          ->  Parallel Hash  (cost=32784.69..32784.69 rows=166667 width=16) (actual time=1207.302..1209.624 rows=133333 loops=3)
                                Buckets: 524288  Batches: 1  Memory Usage: 22912kB
                                ->  Hash Join  (cost=24635.51..32784.69 rows=166667 width=16) (actual time=427.543..884.132 rows=133333 loops=3)
                                      Hash Cond: (o.user_id = u.user_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.516..75.003 rows=133333 loops=3)
                                      ->  Hash  (cost=19635.86..19635.86 rows=287572 width=12) (actual time=411.732..412.914 rows=329619 loops=3)
                                            Buckets: 262144  Batches: 4  Memory Usage: 5596kB
                                            ->  Subquery Scan on u  (cost=0.42..19635.86 rows=287572 width=12) (actual time=1.589..300.128 rows=329619 loops=3)
                                                  ->  GroupAggregate  (cost=0.42..16760.14 rows=287572 width=12) (actual time=1.587..265.666 rows=329619 loops=3)
                                                        Group Key: "Order".user_id
                                                        ->  Index Only Scan using idx_order_user on "Order"  (cost=0.42..11884.42 rows=400000 width=4) (actual time=1.573..174.220 rows=400000 loops=3)
                                                              Heap Fetches: 150240
Planning Time: 7.966 ms
Execution Time: 4784.903 ms

FINISHED — 2025-12-02 21:22:25.222911
========================================================================================================================
========================================================================================================================
START EXPLAIN RUN — 2025-12-03 15:28:59.873006
========================================================================================================================


==================================================
EXPLAIN ANALYZE — Query 1: Średnia Wartość Zamówienia (AOV) w Ostatnim Miesiącu
==================================================
Aggregate  (cost=4323.09..4323.10 rows=1 width=32) (actual time=2584.498..2584.501 rows=1 loops=1)
  ->  GroupAggregate  (cost=4301.71..4315.96 rows=570 width=36) (actual time=2583.993..2584.451 rows=563 loops=1)
        Group Key: o.id
        ->  Sort  (cost=4301.71..4303.13 rows=570 width=14) (actual time=2583.972..2584.021 rows=573 loops=1)
              Sort Key: o.id
              Sort Method: quicksort  Memory: 42kB
              ->  Hash Join  (cost=3895.12..4275.62 rows=570 width=14) (actual time=2519.488..2583.766 rows=573 loops=1)
                    Hash Cond: (oi.order_id = o.id)
                    ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=14) (actual time=0.023..60.548 rows=20000 loops=1)
                    ->  Hash  (cost=3752.50..3752.50 rows=11409 width=4) (actual time=2519.233..2519.234 rows=11455 loops=1)
                          Buckets: 16384  Batches: 1  Memory Usage: 531kB
                          ->  Bitmap Heap Scan on "Order" o  (cost=216.85..3752.50 rows=11409 width=4) (actual time=40.750..2513.769 rows=11455 loops=1)
                                Recheck Cond: (order_date >= (now() - '1 mon'::interval))
                                Heap Blocks: exact=3246
                                ->  Bitmap Index Scan on idx_order_date  (cost=0.00..214.00 rows=11409 width=0) (actual time=39.684..39.685 rows=11455 loops=1)
                                      Index Cond: (order_date >= (now() - '1 mon'::interval))
Planning Time: 150.213 ms
Execution Time: 2584.677 ms


==================================================
EXPLAIN ANALYZE — Query 2: Średnia wartość zamówienia per użytkownik - ZOPTYMALIZOWANA
==================================================
Sort  (cost=16166.87..16215.61 rows=19495 width=50) (actual time=5065.711..5086.067 rows=19296 loops=1)
  Sort Key: (round(avg(oi_sum.total_price), 2)) DESC
  Sort Method: quicksort  Memory: 1612kB
  ->  Finalize HashAggregate  (cost=14485.35..14777.77 rows=19495 width=50) (actual time=5042.127..5074.353 rows=19296 loops=1)
        Group Key: u.id
        Batches: 5  Memory Usage: 8241kB  Disk Usage: 224kB
        ->  Gather  (cost=12637.36..14363.50 rows=16246 width=50) (actual time=4893.746..4981.962 rows=19426 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial HashAggregate  (cost=11637.36..11738.90 rows=8123 width=50) (actual time=4863.783..4870.389 rows=6475 loops=3)
                    Group Key: u.id
                    Batches: 1  Memory Usage: 3217kB
                    Worker 0:  Batches: 1  Memory Usage: 2961kB
                    Worker 1:  Batches: 1  Memory Usage: 2961kB
                    ->  Nested Loop  (cost=1210.75..11596.75 rows=8123 width=50) (actual time=30.517..4809.034 rows=6498 loops=3)
                          ->  Hash Join  (cost=1210.33..6650.49 rows=8123 width=36) (actual time=28.027..194.629 rows=6498 loops=3)
                                Hash Cond: (o.id = oi_sum.order_id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.006..44.590 rows=133333 loops=3)
                                ->  Hash  (cost=966.64..966.64 rows=19495 width=36) (actual time=27.788..30.390 rows=19495 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1094kB
                                      ->  Subquery Scan on oi_sum  (cost=528.00..966.64 rows=19495 width=36) (actual time=14.997..25.629 rows=19495 loops=3)
                                            ->  HashAggregate  (cost=528.00..771.69 rows=19495 width=36) (actual time=14.996..23.790 rows=19495 loops=3)
                                                  Group Key: "OrderItem".order_id
                                                  Batches: 1  Memory Usage: 7953kB
                                                  Worker 0:  Batches: 1  Memory Usage: 7953kB
                                                  Worker 1:  Batches: 1  Memory Usage: 7953kB
                                                  ->  Seq Scan on "OrderItem"  (cost=0.00..328.00 rows=20000 width=14) (actual time=0.024..3.617 rows=20000 loops=3)
                          ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.703..0.703 rows=1 loops=19495)
                                Index Cond: (id = o.user_id)
Planning Time: 28.044 ms
Execution Time: 5120.585 ms


==================================================
EXPLAIN ANALYZE — Query 3: Top 10 Najlepiej Sprzedających Się Produktów (wg. Ilości Sprzedanych Jednostek) w Ostatnim Kwartale
==================================================
Limit  (cost=9097.15..9097.18 rows=10 width=46) (actual time=151.478..156.273 rows=1 loops=1)
  ->  Sort  (cost=9097.15..9107.00 rows=3938 width=46) (actual time=151.477..156.271 rows=1 loops=1)
        Sort Key: (sum(oi.quantity)) DESC
        Sort Method: quicksort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=8972.67..9012.05 rows=3938 width=46) (actual time=151.426..156.245 rows=1 loops=1)
              Group Key: p.name, m.name
              Batches: 1  Memory Usage: 217kB
              ->  Gather  (cost=8603.45..8948.06 rows=3282 width=46) (actual time=151.409..156.209 rows=3 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=7603.45..7619.86 rows=1641 width=46) (actual time=124.988..124.997 rows=1 loops=3)
                          Group Key: p.name, m.name
                          Batches: 1  Memory Usage: 73kB
                          Worker 0:  Batches: 1  Memory Usage: 73kB
                          Worker 1:  Batches: 1  Memory Usage: 73kB
                          ->  Hash Join  (cost=2062.69..7591.14 rows=1641 width=42) (actual time=93.437..124.505 rows=1311 loops=3)
                                Hash Cond: (p.manufacturer_id = m.id)
                                ->  Nested Loop  (cost=2057.32..7581.34 rows=1641 width=21) (actual time=92.940..123.678 rows=1311 loops=3)
                                      ->  Nested Loop  (cost=2057.03..7039.63 rows=1641 width=8) (actual time=91.476..119.761 rows=1311 loops=3)
                                            ->  Hash Join  (cost=2056.74..6188.44 rows=1641 width=8) (actual time=87.940..113.547 rows=1311 loops=3)
                                                  Hash Cond: (o.id = oi.order_id)
                                                  ->  Parallel Bitmap Heap Scan on "Order" o  (cost=1478.74..5388.96 rows=32812 width=4) (actual time=80.102..97.603 rows=26089 loops=3)
                                                        Recheck Cond: (order_date >= (now() - '3 mons'::interval))
                                                        Heap Blocks: exact=838
                                                        ->  Bitmap Index Scan on idx_order_date  (cost=0.00..1459.05 rows=78750 width=0) (actual time=89.330..89.330 rows=78268 loops=1)
                                                              Index Cond: (order_date >= (now() - '3 mons'::interval))
                                                  ->  Hash  (cost=328.00..328.00 rows=20000 width=12) (actual time=5.829..5.830 rows=20000 loops=3)
                                                        Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                                        ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=12) (actual time=0.022..2.571 rows=20000 loops=3)
                                            ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.52 rows=1 width=8) (actual time=0.004..0.004 rows=1 loops=3932)
                                                  Index Cond: (id = oi.variant_id)
                                      ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=21) (actual time=0.003..0.003 rows=1 loops=3932)
                                            Index Cond: (id = v.product_id)
                                ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.287..0.287 rows=150 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 18kB
                                      ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.034..0.053 rows=150 loops=3)
Planning Time: 69.450 ms
Execution Time: 158.147 ms


==================================================
EXPLAIN ANALYZE — Query 4: Top 5 produktów z najwięcej recenzjami
==================================================
Limit  (cost=1792.59..1792.61 rows=5 width=25) (actual time=203.483..203.487 rows=5 loops=1)
  ->  Sort  (cost=1792.59..1842.59 rows=20000 width=25) (actual time=203.482..203.485 rows=5 loops=1)
        Sort Key: (COALESCE(r.count, '0'::bigint)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Hash Left Join  (cost=969.89..1460.40 rows=20000 width=25) (actual time=107.518..200.231 rows=20000 loops=1)
              Hash Cond: (p.id = r.product_id)
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.011..84.372 rows=20000 loops=1)
              ->  Hash  (cost=812.24..812.24 rows=12612 width=12) (actual time=107.496..107.497 rows=12612 loops=1)
                    Buckets: 16384  Batches: 1  Memory Usage: 670kB
                    ->  Subquery Scan on r  (cost=560.00..812.24 rows=12612 width=12) (actual time=100.858..104.759 rows=12612 loops=1)
                          ->  HashAggregate  (cost=560.00..686.12 rows=12612 width=12) (actual time=100.857..103.565 rows=12612 loops=1)
                                Group Key: "Review".product_id
                                Batches: 1  Memory Usage: 1425kB
                                ->  Seq Scan on "Review"  (cost=0.00..460.00 rows=20000 width=4) (actual time=1.158..93.907 rows=20000 loops=1)
Planning Time: 9.224 ms
Execution Time: 203.556 ms


==================================================
EXPLAIN ANALYZE — Query 5: Całkowity Przychód Pogrupowany Miesięcznie za Ostatni Rok
==================================================
Finalize GroupAggregate  (cost=9407.41..11915.56 rows=18938 width=36) (actual time=140.545..143.163 rows=12 loops=1)
  Group Key: ((date_trunc('month'::text, o.order_date))::date)
  ->  Gather Merge  (cost=9407.41..11465.78 rows=15782 width=36) (actual time=140.282..143.135 rows=36 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=8407.39..8644.12 rows=7891 width=36) (actual time=127.291..129.892 rows=12 loops=3)
              Group Key: ((date_trunc('month'::text, o.order_date))::date)
              ->  Sort  (cost=8407.39..8427.12 rows=7891 width=14) (actual time=127.159..127.859 rows=6293 loops=3)
                    Sort Key: ((date_trunc('month'::text, o.order_date))::date) DESC
                    Sort Method: quicksort  Memory: 370kB
                    Worker 0:  Sort Method: quicksort  Memory: 653kB
                    Worker 1:  Sort Method: quicksort  Memory: 337kB
                    ->  Parallel Hash Join  (cost=769.00..7896.60 rows=7891 width=14) (actual time=41.266..121.760 rows=6293 loops=3)
                          Hash Cond: (o.id = oi.order_id)
                          ->  Parallel Seq Scan on "Order" o  (cost=0.00..6252.67 rows=157813 width=12) (actual time=0.019..42.859 rows=126118 loops=3)
                                Filter: (order_date >= (now() - '1 year'::interval))
                                Rows Removed by Filter: 7216
                          ->  Parallel Hash  (cost=621.93..621.93 rows=11765 width=14) (actual time=38.707..38.708 rows=6667 loops=3)
                                Buckets: 32768  Batches: 1  Memory Usage: 1280kB
                                ->  Parallel Index Only Scan using idx_orderitem_variant_order_agg on "OrderItem" oi  (cost=0.29..621.93 rows=11765 width=14) (actual time=2.256..34.662 rows=6667 loops=3)
                                      Heap Fetches: 0
Planning Time: 0.329 ms
Execution Time: 145.675 ms


==================================================
EXPLAIN ANALYZE — Query 6: Produkty najczęściej dodawane do ulubionych
==================================================
Limit  (cost=14382.58..14382.60 rows=10 width=25) (actual time=639.116..678.759 rows=10 loops=1)
  ->  Sort  (cost=14382.58..14432.58 rows=20000 width=25) (actual time=639.108..678.745 rows=10 loops=1)
        Sort Key: (count(f.user_id)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=13750.38..13950.38 rows=20000 width=25) (actual time=631.659..675.578 rows=20000 loops=1)
              Group Key: p.id
              Batches: 1  Memory Usage: 2577kB
              ->  Gather  (cost=9350.38..13550.38 rows=40000 width=25) (actual time=572.446..650.526 rows=59997 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=8350.38..8550.38 rows=20000 width=25) (actual time=570.382..574.988 rows=19999 loops=3)
                          Group Key: p.id
                          Batches: 1  Memory Usage: 2577kB
                          Worker 0:  Batches: 1  Memory Usage: 2577kB
                          Worker 1:  Batches: 1  Memory Usage: 2577kB
                          ->  Hash Join  (cost=688.00..7100.38 rows=250000 width=21) (actual time=10.412..497.642 rows=200000 loops=3)
                                Hash Cond: (f.product_id = p.id)
                                ->  Parallel Seq Scan on "FavoriteProduct" f  (cost=0.00..5756.00 rows=250000 width=8) (actual time=3.985..410.072 rows=200000 loops=3)
                                ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=6.353..6.354 rows=20000 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1215kB
                                      ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.026..2.763 rows=20000 loops=3)
Planning Time: 15.122 ms
Execution Time: 680.491 ms


==================================================
EXPLAIN ANALYZE — Query 7: Dostępny Stan Magazynowy Wariantów Produktu Pogrupowany po Magazynach
==================================================
Finalize GroupAggregate  (cost=8886.64..10869.06 rows=16000 width=61) (actual time=1185.314..1838.194 rows=231755 loops=1)
  Group Key: p.name, w.name, v.sku
  ->  Gather Merge  (cost=8886.64..10575.72 rows=13334 width=61) (actual time=1184.240..1724.825 rows=273001 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=7886.61..8036.62 rows=6667 width=61) (actual time=1161.878..1332.581 rows=91000 loops=3)
              Group Key: p.name, w.name, v.sku
              ->  Sort  (cost=7886.61..7903.28 rows=6667 width=57) (actual time=1159.149..1273.417 rows=106667 loops=3)
                    Sort Key: p.name, w.name, v.sku
                    Sort Method: external merge  Disk: 7536kB
                    Worker 0:  Sort Method: external merge  Disk: 7448kB
                    Worker 1:  Sort Method: external merge  Disk: 6800kB
                    ->  Hash Join  (cost=2543.72..7463.16 rows=6667 width=57) (actual time=87.560..669.322 rows=106667 loops=3)
                          Hash Cond: (v.product_id = p.id)
                          ->  Hash Join  (cost=1855.72..6757.66 rows=6667 width=48) (actual time=80.375..618.334 rows=106667 loops=3)
                                Hash Cond: (ssi.variant_id = v.id)
                                ->  Hash Join  (cost=1.23..4885.66 rows=6667 width=25) (actual time=1.316..490.062 rows=106667 loops=3)
                                      Hash Cond: (ssi.warehouse_id = w.id)
                                      ->  Parallel Append  (cost=0.00..4527.02 rows=133333 width=12) (actual time=1.064..456.349 rows=106667 loops=3)
                                            ->  Parallel Seq Scan on "SerialStockItem" ssi  (cost=0.00..2001.16 rows=93816 width=12) (actual time=8.620..261.213 rows=53163 loops=3)
                                            ->  Parallel Seq Scan on "BulkStockItem" bsi  (cost=0.00..1859.19 rows=94419 width=12) (actual time=0.975..271.171 rows=80256 loops=2)
                                      ->  Hash  (cost=1.10..1.10 rows=10 width=21) (actual time=0.234..0.860 rows=10 loops=3)
                                            Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                            ->  Seq Scan on "Warehouse" w  (cost=0.00..1.10 rows=10 width=21) (actual time=0.227..0.228 rows=10 loops=3)
                                ->  Hash  (cost=1267.00..1267.00 rows=47000 width=31) (actual time=78.696..78.696 rows=47000 loops=3)
                                      Buckets: 65536  Batches: 1  Memory Usage: 3450kB
                                      ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=31) (actual time=0.395..62.441 rows=47000 loops=3)
                          ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=6.993..6.993 rows=20000 loops=3)
                                Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                                ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.223..3.082 rows=20000 loops=3)
Planning Time: 27.522 ms
Execution Time: 1861.922 ms


==================================================
EXPLAIN ANALYZE — Query 8: Stan magazynowy per produkt
==================================================
Sort  (cost=19267.36..19316.89 rows=19812 width=21) (actual time=500.473..502.294 rows=17954 loops=1)
  Sort Key: (sum("*SELECT* 1".quantity)) DESC
  Sort Method: quicksort  Memory: 1483kB
  ->  HashAggregate  (cost=17655.24..17853.36 rows=19812 width=21) (actual time=492.630..497.007 rows=17954 loops=1)
        Group Key: p.name
        Batches: 1  Memory Usage: 2065kB
        ->  Hash Join  (cost=2542.50..16055.24 rows=320000 width=17) (actual time=22.185..369.642 rows=320000 loops=1)
              Hash Cond: ("*SELECT* 1".product_id = p.id)
              ->  Append  (cost=1854.50..14527.07 rows=320000 width=8) (actual time=14.543..248.549 rows=320000 loops=1)
                    ->  Subquery Scan on "*SELECT* 1"  (cost=1854.50..6525.95 rows=159488 width=8) (actual time=14.541..113.025 rows=159488 loops=1)
                          ->  Hash Join  (cost=1854.50..4931.07 rows=159488 width=8) (actual time=14.540..97.185 rows=159488 loops=1)
                                Hash Cond: (ssi.variant_id = v.id)
                                ->  Seq Scan on "SerialStockItem" ssi  (cost=0.00..2657.88 rows=159488 width=4) (actual time=0.016..12.893 rows=159488 loops=1)
                                ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=14.503..14.504 rows=47000 loops=1)
                                      Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                      ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.006..6.962 rows=47000 loops=1)
                    ->  Subquery Scan on "*SELECT* 2"  (cost=1854.50..6401.12 rows=160512 width=8) (actual time=13.911..110.896 rows=160512 loops=1)
                          ->  Hash Join  (cost=1854.50..4796.00 rows=160512 width=8) (actual time=13.910..94.937 rows=160512 loops=1)
                                Hash Cond: (bsi.variant_id = v_1.id)
                                ->  Seq Scan on "BulkStockItem" bsi  (cost=0.00..2520.12 rows=160512 width=8) (actual time=0.014..14.788 rows=160512 loops=1)
                                ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=13.074..13.075 rows=47000 loops=1)
                                      Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                      ->  Seq Scan on "Variant" v_1  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.012..5.522 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=7.630..7.631 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.015..2.402 rows=20000 loops=1)
Planning Time: 36.888 ms
Execution Time: 505.282 ms


==================================================
EXPLAIN ANALYZE — Query 9: Najpopularniejsze Kategorie (wg. Całkowitego Przychodu)
==================================================
Limit  (cost=7440.92..7440.95 rows=10 width=44) (actual time=387.011..387.019 rows=1 loops=1)
  ->  Sort  (cost=7440.92..7441.30 rows=150 width=44) (actual time=387.010..387.017 rows=1 loops=1)
        Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
        Sort Method: quicksort  Memory: 25kB
        ->  HashAggregate  (cost=7435.81..7437.68 rows=150 width=44) (actual time=386.993..387.001 rows=1 loops=1)
              Group Key: c.name
              Batches: 1  Memory Usage: 40kB
              ->  Hash Join  (cost=3230.89..6435.81 rows=100000 width=22) (actual time=140.341..379.091 rows=20000 loops=1)
                    Hash Cond: (pc.category_id = c.id)
                    ->  Hash Join  (cost=3225.51..6160.51 rows=100000 width=14) (actual time=136.988..371.688 rows=20000 loops=1)
                          Hash Cond: (pc.product_id = p.id)
                          ->  Seq Scan on "ProductCategory" pc  (cost=0.00..1560.00 rows=100000 width=8) (actual time=1.879..311.825 rows=100000 loops=1)
                          ->  Hash  (cost=2975.51..2975.51 rows=20000 width=18) (actual time=43.143..43.147 rows=20000 loops=1)
                                Buckets: 32768  Batches: 1  Memory Usage: 1272kB
                                ->  Hash Join  (cost=2542.50..2975.51 rows=20000 width=18) (actual time=17.889..39.699 rows=20000 loops=1)
                                      Hash Cond: (v.product_id = p.id)
                                      ->  Hash Join  (cost=1854.50..2235.00 rows=20000 width=14) (actual time=13.073..31.395 rows=20000 loops=1)
                                            Hash Cond: (oi.variant_id = v.id)
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..328.00 rows=20000 width=14) (actual time=0.018..14.651 rows=20000 loops=1)
                                            ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=12.907..12.908 rows=47000 loops=1)
                                                  Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                                  ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.006..5.413 rows=47000 loops=1)
                                      ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=4.807..4.808 rows=20000 loops=1)
                                            Buckets: 32768  Batches: 1  Memory Usage: 960kB
                                            ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.006..2.105 rows=20000 loops=1)
                    ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=2.807..2.807 rows=150 loops=1)
                          Buckets: 1024  Batches: 1  Memory Usage: 16kB
                          ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=1.638..2.777 rows=150 loops=1)
Planning Time: 40.334 ms
Execution Time: 387.117 ms


==================================================
EXPLAIN ANALYZE — Query 10: Liczba produktów per kategoria
==================================================
Sort  (cost=2342.22..2342.59 rows=150 width=20) (actual time=53.922..53.932 rows=150 loops=1)
  Sort Key: (count(pc.product_id)) DESC
  Sort Method: quicksort  Memory: 30kB
  ->  HashAggregate  (cost=2335.30..2336.80 rows=150 width=20) (actual time=53.864..53.887 rows=150 loops=1)
        Group Key: c.name
        Batches: 1  Memory Usage: 48kB
        ->  Hash Right Join  (cost=5.38..1835.30 rows=100000 width=16) (actual time=0.619..31.769 rows=100000 loops=1)
              Hash Cond: (pc.category_id = c.id)
              ->  Seq Scan on "ProductCategory" pc  (cost=0.00..1560.00 rows=100000 width=8) (actual time=0.005..7.403 rows=100000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=0.059..0.060 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 16kB
                    ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=0.017..0.034 rows=150 loops=1)
Planning Time: 0.214 ms
Execution Time: 53.990 ms


==================================================
EXPLAIN ANALYZE — Query 11: Liczba zamówień per metoda płatności
==================================================
Sort  (cost=7798.49..7798.51 rows=6 width=50) (actual time=191.039..212.352 rows=6 loops=1)
  Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  Finalize GroupAggregate  (cost=7796.82..7798.41 rows=6 width=50) (actual time=191.020..212.343 rows=6 loops=1)
        Group Key: pm.name
        ->  Gather Merge  (cost=7796.82..7798.22 rows=12 width=50) (actual time=191.005..212.322 rows=18 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Sort  (cost=6796.80..6796.81 rows=6 width=50) (actual time=145.642..145.646 rows=6 loops=3)
                    Sort Key: pm.name
                    Sort Method: quicksort  Memory: 25kB
                    Worker 0:  Sort Method: quicksort  Memory: 25kB
                    Worker 1:  Sort Method: quicksort  Memory: 25kB
                    ->  Partial HashAggregate  (cost=6796.64..6796.72 rows=6 width=50) (actual time=144.385..144.391 rows=6 loops=3)
                          Group Key: pm.name
                          Batches: 1  Memory Usage: 24kB
                          Worker 0:  Batches: 1  Memory Usage: 24kB
                          Worker 1:  Batches: 1  Memory Usage: 24kB
                          ->  Hash Join  (cost=770.13..6692.48 rows=8333 width=24) (actual time=3.928..141.068 rows=6667 loops=3)
                                Hash Cond: (o.payment_method_id = pm.id)
                                ->  Parallel Hash Join  (cost=769.00..6654.02 rows=8333 width=18) (actual time=3.613..139.309 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.007..89.025 rows=133333 loops=3)
                                      ->  Parallel Hash  (cost=621.93..621.93 rows=11765 width=14) (actual time=3.292..3.292 rows=6667 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1216kB
                                            ->  Parallel Index Only Scan using idx_orderitem_variant_order_agg on "OrderItem" oi  (cost=0.29..621.93 rows=11765 width=14) (actual time=0.017..5.044 rows=20000 loops=1)
                                                  Heap Fetches: 0
                                ->  Hash  (cost=1.06..1.06 rows=6 width=14) (actual time=0.026..0.026 rows=6 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                      ->  Seq Scan on "PaymentMethod" pm  (cost=0.00..1.06 rows=6 width=14) (actual time=0.020..0.021 rows=6 loops=3)
Planning Time: 5.917 ms
Execution Time: 212.436 ms


==================================================
EXPLAIN ANALYZE — Query 12: Średnia ocena per producent
==================================================
Sort  (cost=1367.54..1367.91 rows=150 width=57) (actual time=28.893..28.904 rows=150 loops=1)
  Sort Key: (round(avg(r.rating), 2)) DESC NULLS LAST
  Sort Method: quicksort  Memory: 32kB
  ->  HashAggregate  (cost=1359.87..1362.12 rows=150 width=57) (actual time=28.776..28.841 rows=150 loops=1)
        Group Key: m.name
        Batches: 1  Memory Usage: 64kB
        ->  Hash Join  (cost=693.38..1259.87 rows=20000 width=29) (actual time=5.368..22.243 rows=27388 loops=1)
              Hash Cond: (p.manufacturer_id = m.id)
              ->  Hash Right Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=5.308..16.904 rows=27388 loops=1)
                    Hash Cond: (r.product_id = p.id)
                    ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=0.009..2.605 rows=20000 loops=1)
                    ->  Hash  (cost=438.00..438.00 rows=20000 width=8) (actual time=5.287..5.288 rows=20000 loops=1)
                          Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                          ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=8) (actual time=0.004..2.219 rows=20000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.054..0.055 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 18kB
                    ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.013..0.029 rows=150 loops=1)
Planning Time: 4.597 ms
Execution Time: 28.973 ms


==================================================
EXPLAIN ANALYZE — Query 13: Aktywne promocje i objęta nimi liczba wariantów
==================================================
Sort  (cost=587.95..588.05 rows=42 width=14) (actual time=13.103..13.106 rows=42 loops=1)
  Sort Key: (count(v.id)) DESC
  Sort Method: quicksort  Memory: 26kB
  ->  HashAggregate  (cost=586.40..586.82 rows=42 width=14) (actual time=12.451..12.460 rows=42 loops=1)
        Group Key: pr.name
        Batches: 1  Memory Usage: 24kB
        ->  Merge Join  (cost=7.46..535.87 rows=10105 width=10) (actual time=0.177..12.146 rows=1238 loops=1)
              Merge Cond: (v.promotion_id = pr.id)
              ->  Index Scan using idx_variant_promotion on "Variant" v  (cost=0.29..4233.14 rows=47000 width=8) (actual time=0.014..11.599 rows=5685 loops=1)
              ->  Sort  (cost=7.17..7.27 rows=43 width=10) (actual time=0.047..0.053 rows=43 loops=1)
                    Sort Key: pr.id
                    Sort Method: quicksort  Memory: 26kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=43 width=10) (actual time=0.014..0.037 rows=43 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 157
Planning Time: 16.664 ms
Execution Time: 13.163 ms


==================================================
EXPLAIN ANALYZE — Query 14: Najczęściej wybierane warianty w koszykach
==================================================
Limit  (cost=33355.13..33355.15 rows=10 width=44) (actual time=747.619..749.760 rows=10 loops=1)
  ->  Sort  (cost=33355.13..33470.31 rows=46072 width=44) (actual time=747.618..748.859 rows=10 loops=1)
        Sort Key: rci.total_quantity DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Hash Join  (cost=30848.18..32359.53 rows=46072 width=44) (actual time=697.843..740.647 rows=47000 loops=1)
              Hash Cond: (v.product_id = p.id)
              ->  Hash Join  (cost=30160.18..31550.57 rows=46072 width=35) (actual time=692.132..719.505 rows=47000 loops=1)
                    Hash Cond: (v.id = rci.variant_id)
                    ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=31) (actual time=0.009..7.651 rows=47000 loops=1)
                    ->  Hash  (cost=29584.28..29584.28 rows=46072 width=12) (actual time=692.104..693.341 rows=47000 loops=1)
                          Buckets: 65536  Batches: 1  Memory Usage: 2532kB
                          ->  Subquery Scan on rci  (cost=28662.84..29584.28 rows=46072 width=12) (actual time=662.182..678.858 rows=47000 loops=1)
                                ->  Finalize HashAggregate  (cost=28662.84..29123.56 rows=46072 width=12) (actual time=661.567..673.838 rows=47000 loops=1)
                                      Group Key: "CartItem".variant_id
                                      Batches: 1  Memory Usage: 4625kB
                                      ->  Gather  (cost=18527.00..28202.12 rows=92144 width=12) (actual time=558.948..612.774 rows=140998 loops=1)
                                            Workers Planned: 2
                                            Workers Launched: 2
                                            ->  Partial HashAggregate  (cost=17527.00..17987.72 rows=46072 width=12) (actual time=548.678..561.753 rows=46999 loops=3)
                                                  Group Key: "CartItem".variant_id
                                                  Batches: 1  Memory Usage: 4625kB
                                                  Worker 0:  Batches: 1  Memory Usage: 4625kB
                                                  Worker 1:  Batches: 1  Memory Usage: 4625kB
                                                  ->  Parallel Seq Scan on "CartItem"  (cost=0.00..14402.00 rows=625000 width=8) (actual time=1.201..356.014 rows=500000 loops=3)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=5.700..5.700 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.012..2.358 rows=20000 loops=1)
Planning Time: 9.746 ms
Execution Time: 754.175 ms


==================================================
EXPLAIN ANALYZE — Query 15: Produkty z Największą Różnicą Między Ceną Podstawową a Ceną Wariantu
==================================================
Limit  (cost=3211.55..3211.58 rows=10 width=80) (actual time=44.758..44.762 rows=10 loops=1)
  ->  Sort  (cost=3211.55..3329.05 rows=47000 width=80) (actual time=44.757..44.759 rows=10 loops=1)
        Sort Key: v.price_modifier DESC
        Sort Method: top-N heapsort  Memory: 27kB
        ->  Hash Join  (cost=688.00..2195.90 rows=47000 width=80) (actual time=7.108..32.904 rows=47000 loops=1)
              Hash Cond: (v.product_id = p.id)
              ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=33) (actual time=0.012..6.390 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=6.292..6.293 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1381kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.004..2.676 rows=20000 loops=1)
Planning Time: 7.946 ms
Execution Time: 44.802 ms


==================================================
EXPLAIN ANALYZE — Query 16: Konwersja zamówień wg statusu
==================================================
Sort  (cost=7541.77..7541.79 rows=7 width=48) (actual time=123.083..131.798 rows=7 loops=1)
  Sort Key: (count(o.id)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  WindowAgg  (cost=7541.33..7541.67 rows=7 width=48) (actual time=123.065..131.790 rows=7 loops=1)
        ->  Finalize GroupAggregate  (cost=7539.74..7541.51 rows=7 width=16) (actual time=123.042..131.764 rows=7 loops=1)
              Group Key: s.name
              ->  Gather Merge  (cost=7539.74..7541.37 rows=14 width=16) (actual time=123.032..131.752 rows=21 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Sort  (cost=6539.71..6539.73 rows=7 width=16) (actual time=102.937..102.940 rows=7 loops=3)
                          Sort Key: s.name
                          Sort Method: quicksort  Memory: 25kB
                          Worker 0:  Sort Method: quicksort  Memory: 25kB
                          Worker 1:  Sort Method: quicksort  Memory: 25kB
                          ->  Partial HashAggregate  (cost=6539.55..6539.62 rows=7 width=16) (actual time=102.042..102.045 rows=7 loops=3)
                                Group Key: s.name
                                Batches: 1  Memory Usage: 24kB
                                Worker 0:  Batches: 1  Memory Usage: 24kB
                                Worker 1:  Batches: 1  Memory Usage: 24kB
                                ->  Hash Join  (cost=1.16..5706.21 rows=166667 width=12) (actual time=0.052..68.761 rows=133333 loops=3)
                                      Hash Cond: (o.status_id = s.id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.009..20.086 rows=133333 loops=3)
                                      ->  Hash  (cost=1.07..1.07 rows=7 width=12) (actual time=0.022..0.022 rows=7 loops=3)
                                            Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                            ->  Seq Scan on "Status" s  (cost=0.00..1.07 rows=7 width=12) (actual time=0.016..0.017 rows=7 loops=3)
Planning Time: 6.519 ms
Execution Time: 131.877 ms


==================================================
EXPLAIN ANALYZE — Query 17: Top klienci wg wydatków
==================================================
========================================================================================================================
START EXPLAIN RUN — 2025-12-07 22:15:16.604339
========================================================================================================================


==================================================
EXPLAIN ANALYZE — Query 1: Średnia Wartość Zamówienia (AOV) w Ostatnim Miesiącu
==================================================
Aggregate  (cost=8326.46..8326.47 rows=1 width=32) (actual time=864.363..1024.361 rows=1 loops=1)
  ->  Finalize GroupAggregate  (cost=8101.48..8306.05 rows=1632 width=36) (actual time=849.744..1022.320 rows=1610 loops=1)
        Group Key: o.id
        ->  Gather Merge  (cost=8101.48..8275.45 rows=1360 width=36) (actual time=849.712..1016.662 rows=1610 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial GroupAggregate  (cost=7101.45..7118.45 rows=680 width=36) (actual time=830.183..834.209 rows=537 loops=3)
                    Group Key: o.id
                    ->  Sort  (cost=7101.45..7103.15 rows=680 width=14) (actual time=823.215..824.101 rows=548 loops=3)
                          Sort Key: o.id
                          Sort Method: quicksort  Memory: 41kB
                          Worker 0:  Sort Method: quicksort  Memory: 44kB
                          Worker 1:  Sort Method: quicksort  Memory: 40kB
                          ->  Hash Join  (cost=725.00..7069.46 rows=680 width=14) (actual time=12.735..805.685 rows=548 loops=3)
                                Hash Cond: (o.id = oi.order_id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..6252.67 rows=13599 width=4) (actual time=0.433..754.630 rows=10946 loops=3)
                                      Filter: (order_date >= (now() - '1 mon'::interval))
                                      Rows Removed by Filter: 122388
                                ->  Hash  (cost=475.00..475.00 rows=20000 width=14) (actual time=9.020..9.623 rows=20000 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1194kB
                                      ->  Seq Scan on "OrderItem" oi  (cost=0.00..475.00 rows=20000 width=14) (actual time=0.232..3.332 rows=20000 loops=3)
Planning Time: 28.354 ms
Execution Time: 1030.579 ms


==================================================
EXPLAIN ANALYZE — Query 2: Średnia wartość zamówienia per użytkownik - ZOPTYMALIZOWANA
==================================================
Sort  (cost=16309.57..16358.30 rows=19495 width=50) (actual time=5999.495..6007.142 rows=19296 loops=1)
  Sort Key: (round(avg(oi_sum.total_price), 2)) DESC
  Sort Method: quicksort  Memory: 1612kB
  ->  Finalize HashAggregate  (cost=14628.04..14920.47 rows=19495 width=50) (actual time=5963.636..5990.978 rows=19296 loops=1)
        Group Key: u.id
        Batches: 5  Memory Usage: 8241kB  Disk Usage: 224kB
        ->  Gather  (cost=12780.06..14506.20 rows=16246 width=50) (actual time=5585.154..5800.784 rows=19424 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial HashAggregate  (cost=11780.06..11881.60 rows=8123 width=50) (actual time=5267.643..5367.874 rows=6475 loops=3)
                    Group Key: u.id
                    Batches: 1  Memory Usage: 3217kB
                    Worker 0:  Batches: 1  Memory Usage: 2961kB
                    Worker 1:  Batches: 1  Memory Usage: 2961kB
                    ->  Nested Loop  (cost=1357.75..11739.44 rows=8123 width=50) (actual time=150.898..5169.055 rows=6498 loops=3)
                          ->  Hash Join  (cost=1357.33..6797.49 rows=8123 width=36) (actual time=99.050..551.886 rows=6498 loops=3)
                                Hash Cond: (o.id = oi_sum.order_id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.011..325.277 rows=133333 loops=3)
                                ->  Hash  (cost=1113.64..1113.64 rows=19495 width=36) (actual time=92.961..94.341 rows=19495 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1094kB
                                      ->  Subquery Scan on oi_sum  (cost=675.00..1113.64 rows=19495 width=36) (actual time=75.723..85.783 rows=19495 loops=3)
                                            ->  HashAggregate  (cost=675.00..918.69 rows=19495 width=36) (actual time=75.719..83.920 rows=19495 loops=3)
                                                  Group Key: "OrderItem".order_id
                                                  Batches: 1  Memory Usage: 7953kB
                                                  Worker 0:  Batches: 1  Memory Usage: 7953kB
                                                  Worker 1:  Batches: 1  Memory Usage: 7953kB
                                                  ->  Seq Scan on "OrderItem"  (cost=0.00..475.00 rows=20000 width=14) (actual time=4.295..18.052 rows=20000 loops=3)
                          ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.694..0.694 rows=1 loops=19495)
                                Index Cond: (id = o.user_id)
Planning Time: 17.655 ms
Execution Time: 6031.903 ms


==================================================
EXPLAIN ANALYZE — Query 3: Top 10 Najlepiej Sprzedających Się Produktów (wg. Ilości Sprzedanych Jednostek) w Ostatnim Kwartale
==================================================
Limit  (cost=10634.84..10634.87 rows=10 width=46) (actual time=726.418..856.082 rows=10 loops=1)
  ->  Sort  (cost=10634.84..10647.13 rows=4914 width=46) (actual time=726.413..856.073 rows=10 loops=1)
        Sort Key: (sum(oi.quantity)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=10479.51..10528.65 rows=4914 width=46) (actual time=722.568..853.188 rows=4240 loops=1)
              Group Key: p.name, m.name
              Batches: 1  Memory Usage: 721kB
              ->  Gather  (cost=10018.71..10448.79 rows=4096 width=46) (actual time=625.492..815.245 rows=4743 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=9018.71..9039.19 rows=2048 width=46) (actual time=385.259..389.286 rows=1581 loops=3)
                          Group Key: p.name, m.name
                          Batches: 1  Memory Usage: 369kB
                          Worker 0:  Batches: 1  Memory Usage: 369kB
                          Worker 1:  Batches: 1  Memory Usage: 369kB
                          ->  Hash Join  (cost=730.95..9003.35 rows=2048 width=42) (actual time=56.028..373.361 rows=1666 loops=3)
                                Hash Cond: (p.manufacturer_id = m.id)
                                ->  Nested Loop  (cost=725.58..8992.45 rows=2048 width=21) (actual time=51.337..367.785 rows=1666 loops=3)
                                      ->  Nested Loop  (cost=725.29..8316.39 rows=2048 width=8) (actual time=49.344..289.564 rows=1666 loops=3)
                                            ->  Hash Join  (cost=725.00..7254.09 rows=2048 width=8) (actual time=40.216..215.165 rows=1666 loops=3)
                                                  Hash Cond: (o.id = oi.order_id)
                                                  ->  Parallel Seq Scan on "Order" o  (cost=0.00..6252.67 rows=40951 width=4) (actual time=8.510..174.250 rows=33239 loops=3)
                                                        Filter: (order_date >= (now() - '3 mons'::interval))
                                                        Rows Removed by Filter: 100095
                                                  ->  Hash  (cost=475.00..475.00 rows=20000 width=12) (actual time=27.646..28.329 rows=20000 loops=3)
                                                        Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                                        ->  Seq Scan on "OrderItem" oi  (cost=0.00..475.00 rows=20000 width=12) (actual time=6.469..14.997 rows=20000 loops=3)
                                            ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.52 rows=1 width=8) (actual time=0.043..0.043 rows=1 loops=4998)
                                                  Index Cond: (id = oi.variant_id)
                                      ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=21) (actual time=0.046..0.046 rows=1 loops=4998)
                                            Index Cond: (id = v.product_id)
                                ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=4.646..4.646 rows=150 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 18kB
                                      ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=4.593..4.612 rows=150 loops=3)
Planning Time: 58.815 ms
Execution Time: 862.391 ms


==================================================
EXPLAIN ANALYZE — Query 4: Top 5 produktów z najwięcej recenzjami
==================================================
Limit  (cost=1792.98..1793.00 rows=5 width=25) (actual time=46.329..47.188 rows=5 loops=1)
  ->  Sort  (cost=1792.98..1842.98 rows=20000 width=25) (actual time=46.327..46.331 rows=5 loops=1)
        Sort Key: (COALESCE(r.count, '0'::bigint)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Hash Left Join  (cost=970.28..1460.79 rows=20000 width=25) (actual time=34.536..41.804 rows=20000 loops=1)
              Hash Cond: (p.id = r.product_id)
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=1.676..3.155 rows=20000 loops=1)
              ->  Hash  (cost=812.48..812.48 rows=12624 width=12) (actual time=31.767..31.769 rows=12624 loops=1)
                    Buckets: 16384  Batches: 1  Memory Usage: 671kB
                    ->  Subquery Scan on r  (cost=560.00..812.48 rows=12624 width=12) (actual time=23.232..27.118 rows=12624 loops=1)
                          ->  HashAggregate  (cost=560.00..686.24 rows=12624 width=12) (actual time=23.230..25.922 rows=12624 loops=1)
                                Group Key: "Review".product_id
                                Batches: 1  Memory Usage: 1425kB
                                ->  Seq Scan on "Review"  (cost=0.00..460.00 rows=20000 width=4) (actual time=1.266..14.692 rows=20000 loops=1)
Planning Time: 16.717 ms
Execution Time: 53.203 ms


==================================================
EXPLAIN ANALYZE — Query 5: Całkowity Przychód Pogrupowany Miesięcznie za Ostatni Rok
==================================================
Finalize GroupAggregate  (cost=9685.69..12332.41 rows=19984 width=36) (actual time=161.553..271.952 rows=13 loops=1)
  Group Key: ((date_trunc('month'::text, o.order_date))::date)
  ->  Gather Merge  (cost=9685.69..11857.78 rows=16654 width=36) (actual time=160.892..270.835 rows=39 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=8685.66..8935.47 rows=8327 width=36) (actual time=87.662..90.400 rows=13 loops=3)
              Group Key: ((date_trunc('month'::text, o.order_date))::date)
              ->  Sort  (cost=8685.66..8706.48 rows=8327 width=14) (actual time=85.787..86.429 rows=6662 loops=3)
                    Sort Key: ((date_trunc('month'::text, o.order_date))::date) DESC
                    Sort Method: quicksort  Memory: 889kB
                    Worker 0:  Sort Method: quicksort  Memory: 105kB
                    Worker 1:  Sort Method: quicksort  Memory: 161kB
                    ->  Hash Join  (cost=725.00..8143.43 rows=8327 width=14) (actual time=11.164..83.449 rows=6662 loops=3)
                          Hash Cond: (o.id = oi.order_id)
                          ->  Parallel Seq Scan on "Order" o  (cost=0.00..6252.67 rows=166537 width=12) (actual time=0.015..40.704 rows=133222 loops=3)
                                Filter: (order_date >= (now() - '1 year'::interval))
                                Rows Removed by Filter: 112
                          ->  Hash  (cost=475.00..475.00 rows=20000 width=14) (actual time=10.779..10.781 rows=20000 loops=3)
                                Buckets: 32768  Batches: 1  Memory Usage: 1194kB
                                ->  Seq Scan on "OrderItem" oi  (cost=0.00..475.00 rows=20000 width=14) (actual time=0.242..3.082 rows=20000 loops=3)
Planning Time: 8.439 ms
Execution Time: 280.150 ms


==================================================
EXPLAIN ANALYZE — Query 6: Produkty najczęściej dodawane do ulubionych
==================================================
Limit  (cost=14382.58..14382.60 rows=10 width=25) (actual time=864.649..952.831 rows=10 loops=1)
  ->  Sort  (cost=14382.58..14432.58 rows=20000 width=25) (actual time=864.081..952.258 rows=10 loops=1)
        Sort Key: (count(f.user_id)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=13750.38..13950.38 rows=20000 width=25) (actual time=856.099..948.143 rows=20000 loops=1)
              Group Key: p.id
              Batches: 1  Memory Usage: 2577kB
              ->  Gather  (cost=9350.38..13550.38 rows=40000 width=25) (actual time=740.077..879.850 rows=59984 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=8350.38..8550.38 rows=20000 width=25) (actual time=649.182..656.020 rows=19995 loops=3)
                          Group Key: p.id
                          Batches: 1  Memory Usage: 2577kB
                          Worker 0:  Batches: 1  Memory Usage: 2577kB
                          Worker 1:  Batches: 1  Memory Usage: 2577kB
                          ->  Hash Join  (cost=688.00..7100.38 rows=250000 width=21) (actual time=40.472..539.948 rows=200000 loops=3)
                                Hash Cond: (f.product_id = p.id)
                                ->  Parallel Seq Scan on "FavoriteProduct" f  (cost=0.00..5756.00 rows=250000 width=8) (actual time=14.792..423.191 rows=200000 loops=3)
                                ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=24.501..24.735 rows=20000 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1215kB
                                      ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=7.453..10.436 rows=20000 loops=3)
Planning Time: 16.727 ms
Execution Time: 956.995 ms


==================================================
EXPLAIN ANALYZE — Query 7: Dostępny Stan Magazynowy Wariantów Produktu Pogrupowany po Magazynach
==================================================
Finalize GroupAggregate  (cost=37241.37..77098.70 rows=321700 width=262) (actual time=1630.959..2174.425 rows=231755 loops=1)
  Group Key: p.name, w.name, v.sku
  ->  Gather Merge  (cost=37241.37..71200.86 rows=268084 width=262) (actual time=1629.829..2065.120 rows=285540 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=36241.34..39257.29 rows=134042 width=262) (actual time=1506.991..1653.314 rows=95180 loops=3)
              Group Key: p.name, w.name, v.sku
              ->  Sort  (cost=36241.34..36576.45 rows=134042 width=258) (actual time=1503.551..1597.903 rows=106667 loops=3)
                    Sort Key: p.name, w.name, v.sku
                    Sort Method: external merge  Disk: 5800kB
                    Worker 0:  Sort Method: external merge  Disk: 8016kB
                    Worker 1:  Sort Method: external merge  Disk: 7960kB
                    ->  Hash Join  (cost=2559.70..8330.61 rows=134042 width=258) (actual time=84.992..841.597 rows=106667 loops=3)
                          Hash Cond: (ssi.warehouse_id = w.id)
                          ->  Hash Join  (cost=2542.50..7956.89 rows=134042 width=44) (actual time=80.787..806.699 rows=106667 loops=3)
                                Hash Cond: (v.product_id = p.id)
                                ->  Hash Join  (cost=1854.50..6916.95 rows=134042 width=35) (actual time=70.458..744.009 rows=106667 loops=3)
                                      Hash Cond: (ssi.variant_id = v.id)
                                      ->  Parallel Append  (cost=0.00..4710.56 rows=134041 width=12) (actual time=0.400..579.921 rows=106667 loops=3)
                                            ->  Parallel Seq Scan on "SerialStockItem" ssi  (cost=0.00..4020.35 rows=188235 width=12) (actual time=0.399..567.646 rows=106667 loops=3)
                                            ->  Parallel Seq Scan on "BulkStockItem" bsi  (cost=0.00..20.00 rows=1000 width=12) (actual time=0.001..0.002 rows=0 loops=1)
                                      ->  Hash  (cost=1267.00..1267.00 rows=47000 width=31) (actual time=68.263..69.120 rows=47000 loops=3)
                                            Buckets: 65536  Batches: 1  Memory Usage: 3450kB
                                            ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=31) (actual time=44.799..51.463 rows=47000 loops=3)
                                ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=10.070..10.071 rows=20000 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                                      ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.029..5.742 rows=20000 loops=3)
                          ->  Hash  (cost=13.20..13.20 rows=320 width=222) (actual time=4.167..4.168 rows=10 loops=3)
                                Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                ->  Seq Scan on "Warehouse" w  (cost=0.00..13.20 rows=320 width=222) (actual time=1.093..1.096 rows=10 loops=3)
Planning Time: 8.095 ms
Execution Time: 2191.181 ms


==================================================
EXPLAIN ANALYZE — Query 8: Stan magazynowy per produkt
==================================================
Sort  (cost=19497.29..19546.82 rows=19812 width=21) (actual time=498.426..500.214 rows=17954 loops=1)
  Sort Key: (sum("*SELECT* 1".quantity)) DESC
  Sort Method: quicksort  Memory: 1483kB
  ->  HashAggregate  (cost=17885.18..18083.30 rows=19812 width=21) (actual time=491.709..495.537 rows=17954 loops=1)
        Group Key: p.name
        Batches: 1  Memory Usage: 2065kB
        ->  Hash Join  (cost=2542.50..16276.68 rows=321700 width=17) (actual time=27.676..372.582 rows=320000 loops=1)
              Hash Cond: ("*SELECT* 1".product_id = p.id)
              ->  Append  (cost=1854.50..14744.04 rows=321700 width=8) (actual time=18.235..251.604 rows=320000 loops=1)
                    ->  Subquery Scan on "*SELECT* 1"  (cost=1854.50..11232.58 rows=320000 width=8) (actual time=18.233..226.211 rows=320000 loops=1)
                          ->  Hash Join  (cost=1854.50..8032.58 rows=320000 width=8) (actual time=18.232..193.030 rows=320000 loops=1)
                                Hash Cond: (ssi.variant_id = v.id)
                                ->  Seq Scan on "SerialStockItem" ssi  (cost=0.00..5338.00 rows=320000 width=4) (actual time=0.012..28.786 rows=320000 loops=1)
                                ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=18.198..18.199 rows=47000 loops=1)
                                      Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                      ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.270..10.306 rows=47000 loops=1)
                    ->  Subquery Scan on "*SELECT* 2"  (cost=1854.50..1902.96 rows=1700 width=8) (actual time=0.014..0.015 rows=0 loops=1)
                          ->  Hash Join  (cost=1854.50..1885.96 rows=1700 width=8) (actual time=0.013..0.014 rows=0 loops=1)
                                Hash Cond: (bsi.variant_id = v_1.id)
                                ->  Seq Scan on "BulkStockItem" bsi  (cost=0.00..27.00 rows=1700 width=8) (actual time=0.013..0.013 rows=0 loops=1)
                                ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (never executed)
                                      ->  Seq Scan on "Variant" v_1  (cost=0.00..1267.00 rows=47000 width=8) (never executed)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=9.429..9.429 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.016..5.671 rows=20000 loops=1)
Planning Time: 22.849 ms
Execution Time: 507.669 ms


==================================================
EXPLAIN ANALYZE — Query 9: Najpopularniejsze Kategorie (wg. Całkowitego Przychodu)
==================================================
Limit  (cost=7587.92..7587.95 rows=10 width=44) (actual time=324.919..324.927 rows=10 loops=1)
  ->  Sort  (cost=7587.92..7588.30 rows=150 width=44) (actual time=324.917..324.924 rows=10 loops=1)
        Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  HashAggregate  (cost=7582.81..7584.68 rows=150 width=44) (actual time=324.290..324.341 rows=150 loops=1)
              Group Key: c.name
              Batches: 1  Memory Usage: 96kB
              ->  Hash Join  (cost=3377.89..6582.81 rows=100000 width=22) (actual time=47.794..280.336 rows=100096 loops=1)
                    Hash Cond: (pc.category_id = c.id)
                    ->  Hash Join  (cost=3372.51..6307.51 rows=100000 width=14) (actual time=46.392..258.406 rows=100096 loops=1)
                          Hash Cond: (pc.product_id = p.id)
                          ->  Seq Scan on "ProductCategory" pc  (cost=0.00..1560.00 rows=100000 width=8) (actual time=2.257..167.516 rows=100000 loops=1)
                          ->  Hash  (cost=3122.51..3122.51 rows=20000 width=18) (actual time=44.121..44.126 rows=20000 loops=1)
                                Buckets: 32768  Batches: 1  Memory Usage: 1272kB
                                ->  Hash Join  (cost=2542.50..3122.51 rows=20000 width=18) (actual time=21.559..40.056 rows=20000 loops=1)
                                      Hash Cond: (v.product_id = p.id)
                                      ->  Hash Join  (cost=1854.50..2382.00 rows=20000 width=14) (actual time=16.675..28.865 rows=20000 loops=1)
                                            Hash Cond: (oi.variant_id = v.id)
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..475.00 rows=20000 width=14) (actual time=3.896..5.994 rows=20000 loops=1)
                                            ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=12.756..12.757 rows=47000 loops=1)
                                                  Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                                  ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.253..5.358 rows=47000 loops=1)
                                      ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=4.872..4.873 rows=20000 loops=1)
                                            Buckets: 32768  Batches: 1  Memory Usage: 960kB
                                            ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.007..2.100 rows=20000 loops=1)
                    ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=0.770..0.770 rows=150 loops=1)
                          Buckets: 1024  Batches: 1  Memory Usage: 16kB
                          ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=0.720..0.740 rows=150 loops=1)
Planning Time: 19.239 ms
Execution Time: 325.025 ms


==================================================
EXPLAIN ANALYZE — Query 10: Liczba produktów per kategoria
==================================================
Sort  (cost=2342.22..2342.59 rows=150 width=20) (actual time=56.099..56.110 rows=150 loops=1)
  Sort Key: (count(pc.product_id)) DESC
  Sort Method: quicksort  Memory: 30kB
  ->  HashAggregate  (cost=2335.30..2336.80 rows=150 width=20) (actual time=55.432..55.455 rows=150 loops=1)
        Group Key: c.name
        Batches: 1  Memory Usage: 48kB
        ->  Hash Right Join  (cost=5.38..1835.30 rows=100000 width=16) (actual time=0.079..31.733 rows=100000 loops=1)
              Hash Cond: (pc.category_id = c.id)
              ->  Seq Scan on "ProductCategory" pc  (cost=0.00..1560.00 rows=100000 width=8) (actual time=0.004..7.393 rows=100000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=0.065..0.066 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 16kB
                    ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=0.017..0.038 rows=150 loops=1)
Planning Time: 0.187 ms
Execution Time: 56.171 ms


==================================================
EXPLAIN ANALYZE — Query 11: Liczba zamówień per metoda płatności
==================================================
Sort  (cost=8111.92..8112.72 rows=320 width=258) (actual time=224.831..283.351 rows=6 loops=1)
  Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  Finalize GroupAggregate  (cost=8013.53..8098.60 rows=320 width=258) (actual time=224.811..283.341 rows=6 loops=1)
        Group Key: pm.name
        ->  Gather Merge  (cost=8013.53..8088.20 rows=640 width=258) (actual time=224.797..283.320 rows=18 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Sort  (cost=7013.51..7014.31 rows=320 width=258) (actual time=179.998..180.002 rows=6 loops=3)
                    Sort Key: pm.name
                    Sort Method: quicksort  Memory: 25kB
                    Worker 0:  Sort Method: quicksort  Memory: 25kB
                    Worker 1:  Sort Method: quicksort  Memory: 25kB
                    ->  Partial HashAggregate  (cost=6996.19..7000.19 rows=320 width=258) (actual time=177.505..177.512 rows=6 loops=3)
                          Group Key: pm.name
                          Batches: 1  Memory Usage: 37kB
                          Worker 0:  Batches: 1  Memory Usage: 37kB
                          Worker 1:  Batches: 1  Memory Usage: 37kB
                          ->  Hash Join  (cost=742.20..6892.03 rows=8333 width=232) (actual time=7.973..173.478 rows=6667 loops=3)
                                Hash Cond: (o.payment_method_id = pm.id)
                                ->  Hash Join  (cost=725.00..6852.67 rows=8333 width=18) (actual time=7.699..171.718 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.221..80.043 rows=133333 loops=3)
                                      ->  Hash  (cost=475.00..475.00 rows=20000 width=14) (actual time=7.233..7.234 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1194kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..475.00 rows=20000 width=14) (actual time=0.189..3.053 rows=20000 loops=3)
                                ->  Hash  (cost=13.20..13.20 rows=320 width=222) (actual time=0.248..0.248 rows=6 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                      ->  Seq Scan on "PaymentMethod" pm  (cost=0.00..13.20 rows=320 width=222) (actual time=0.239..0.243 rows=6 loops=3)
Planning Time: 3.661 ms
Execution Time: 284.549 ms


==================================================
EXPLAIN ANALYZE — Query 12: Średnia ocena per producent
==================================================
Sort  (cost=1367.54..1367.91 rows=150 width=57) (actual time=49.068..49.079 rows=150 loops=1)
  Sort Key: (round(avg(r.rating), 2)) DESC NULLS LAST
  Sort Method: quicksort  Memory: 32kB
  ->  HashAggregate  (cost=1359.87..1362.12 rows=150 width=57) (actual time=48.948..49.011 rows=150 loops=1)
        Group Key: m.name
        Batches: 1  Memory Usage: 64kB
        ->  Hash Join  (cost=693.38..1259.87 rows=20000 width=29) (actual time=5.408..42.507 rows=27376 loops=1)
              Hash Cond: (p.manufacturer_id = m.id)
              ->  Hash Right Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=5.344..37.124 rows=27376 loops=1)
                    Hash Cond: (r.product_id = p.id)
                    ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=0.010..11.102 rows=20000 loops=1)
                    ->  Hash  (cost=438.00..438.00 rows=20000 width=8) (actual time=5.323..5.323 rows=20000 loops=1)
                          Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                          ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=8) (actual time=0.006..2.284 rows=20000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.058..0.059 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 18kB
                    ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.017..0.033 rows=150 loops=1)
Planning Time: 18.139 ms
Execution Time: 49.780 ms


==================================================
EXPLAIN ANALYZE — Query 13: Aktywne promocje i objęta nimi liczba wariantów
==================================================
Sort  (cost=1461.64..1461.77 rows=52 width=14) (actual time=9.247..9.252 rows=51 loops=1)
  Sort Key: (count(v.id)) DESC
  Sort Method: quicksort  Memory: 26kB
  ->  HashAggregate  (cost=1459.64..1460.16 rows=52 width=14) (actual time=9.223..9.232 rows=51 loops=1)
        Group Key: pr.name
        Batches: 1  Memory Usage: 24kB
        ->  Hash Join  (cost=6.66..1397.36 rows=12455 width=10) (actual time=0.337..8.825 rows=1492 loops=1)
              Hash Cond: (v.promotion_id = pr.id)
              ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.269..6.115 rows=47000 loops=1)
              ->  Hash  (cost=6.00..6.00 rows=53 width=10) (actual time=0.041..0.041 rows=52 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 11kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=53 width=10) (actual time=0.007..0.030 rows=52 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 148
Planning Time: 10.643 ms
Execution Time: 9.308 ms


==================================================
EXPLAIN ANALYZE — Query 14: Najczęściej wybierane warianty w koszykach
==================================================
Limit  (cost=33315.91..33315.94 rows=10 width=44) (actual time=853.929..855.513 rows=10 loops=1)
  ->  Sort  (cost=33315.91..33430.39 rows=45791 width=44) (actual time=853.919..855.498 rows=10 loops=1)
        Sort Key: rci.total_quantity DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Hash Join  (cost=30815.77..32326.38 rows=45791 width=44) (actual time=805.050..847.407 rows=47000 loops=1)
              Hash Cond: (v.product_id = p.id)
              ->  Hash Join  (cost=30127.77..31518.16 rows=45791 width=35) (actual time=799.382..826.719 rows=47000 loops=1)
                    Hash Cond: (v.id = rci.variant_id)
                    ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=31) (actual time=0.256..7.961 rows=47000 loops=1)
                    ->  Hash  (cost=29555.39..29555.39 rows=45791 width=12) (actual time=799.108..800.683 rows=47000 loops=1)
                          Buckets: 65536  Batches: 1  Memory Usage: 2532kB
                          ->  Subquery Scan on rci  (cost=28639.57..29555.39 rows=45791 width=12) (actual time=723.991..739.215 rows=47000 loops=1)
                                ->  Finalize HashAggregate  (cost=28639.57..29097.48 rows=45791 width=12) (actual time=723.990..734.641 rows=47000 loops=1)
                                      Group Key: "CartItem".variant_id
                                      Batches: 1  Memory Usage: 4625kB
                                      ->  Gather  (cost=18565.55..28181.66 rows=91582 width=12) (actual time=607.368..665.165 rows=140996 loops=1)
                                            Workers Planned: 2
                                            Workers Launched: 2
                                            ->  Partial HashAggregate  (cost=17565.55..18023.46 rows=45791 width=12) (actual time=570.891..584.450 rows=46999 loops=3)
                                                  Group Key: "CartItem".variant_id
                                                  Batches: 1  Memory Usage: 4625kB
                                                  Worker 0:  Batches: 1  Memory Usage: 4625kB
                                                  Worker 1:  Batches: 1  Memory Usage: 4625kB
                                                  ->  Parallel Seq Scan on "CartItem"  (cost=0.00..14427.70 rows=627570 width=8) (actual time=1.544..365.427 rows=500000 loops=3)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=5.657..5.657 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.012..2.376 rows=20000 loops=1)
Planning Time: 4.236 ms
Execution Time: 855.685 ms


==================================================
EXPLAIN ANALYZE — Query 15: Produkty z Największą Różnicą Między Ceną Podstawową a Ceną Wariantu
==================================================
Limit  (cost=3211.55..3211.58 rows=10 width=80) (actual time=45.046..45.760 rows=10 loops=1)
  ->  Sort  (cost=3211.55..3329.05 rows=47000 width=80) (actual time=45.044..45.047 rows=10 loops=1)
        Sort Key: v.price_modifier DESC
        Sort Method: top-N heapsort  Memory: 27kB
        ->  Hash Join  (cost=688.00..2195.90 rows=47000 width=80) (actual time=6.478..32.099 rows=47000 loops=1)
              Hash Cond: (v.product_id = p.id)
              ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=33) (actual time=0.280..6.263 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=6.183..6.183 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1381kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.005..2.648 rows=20000 loops=1)
Planning Time: 12.167 ms
Execution Time: 47.757 ms


==================================================
EXPLAIN ANALYZE — Query 16: Konwersja zamówień wg statusu
==================================================
Sort  (cost=7349.92..7350.27 rows=140 width=556) (actual time=560.061..799.159 rows=7 loops=1)
  Sort Key: (count(o.id)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  WindowAgg  (cost=7343.26..7344.92 rows=140 width=556) (actual time=560.044..799.145 rows=7 loops=1)
        ->  Finalize GroupAggregate  (cost=7306.31..7341.77 rows=140 width=524) (actual time=558.634..797.737 rows=7 loops=1)
              Group Key: s.name
              ->  Gather Merge  (cost=7306.31..7338.97 rows=280 width=524) (actual time=557.169..796.268 rows=7 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Sort  (cost=6306.28..6306.63 rows=140 width=524) (actual time=76.278..76.283 rows=2 loops=3)
                          Sort Key: s.name
                          Sort Method: quicksort  Memory: 25kB
                          Worker 0:  Sort Method: quicksort  Memory: 25kB
                          Worker 1:  Sort Method: quicksort  Memory: 25kB
                          ->  Partial HashAggregate  (cost=6299.89..6301.29 rows=140 width=524) (actual time=73.133..73.137 rows=2 loops=3)
                                Group Key: s.name
                                Batches: 1  Memory Usage: 40kB
                                Worker 0:  Batches: 1  Memory Usage: 40kB
                                Worker 1:  Batches: 1  Memory Usage: 40kB
                                ->  Hash Join  (cost=13.15..5466.56 rows=166667 width=520) (actual time=1.548..45.071 rows=133333 loops=3)
                                      Hash Cond: (o.status_id = s.id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.007..13.487 rows=133333 loops=3)
                                      ->  Hash  (cost=11.40..11.40 rows=140 width=520) (actual time=3.487..3.487 rows=7 loops=1)
                                            Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                            ->  Seq Scan on "Status" s  (cost=0.00..11.40 rows=140 width=520) (actual time=2.345..2.349 rows=7 loops=1)
Planning Time: 27.560 ms
Execution Time: 805.993 ms


==================================================
EXPLAIN ANALYZE — Query 17: Top klienci wg wydatków
==================================================
Limit  (cost=15583.66..15583.68 rows=10 width=50) (actual time=3987.921..3995.261 rows=10 loops=1)
  ->  Sort  (cost=15583.66..15633.66 rows=20000 width=50) (actual time=3987.919..3994.391 rows=10 loops=1)
        Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=14901.47..15151.47 rows=20000 width=50) (actual time=3969.395..3985.264 rows=19296 loops=1)
              Group Key: u.id
              Batches: 5  Memory Usage: 8241kB  Disk Usage: 224kB
              ->  Gather  (cost=13005.71..14776.47 rows=16666 width=50) (actual time=3450.074..3575.067 rows=19432 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=12005.71..12109.87 rows=8333 width=50) (actual time=3380.706..3488.701 rows=6477 loops=3)
                          Group Key: u.id
                          Batches: 1  Memory Usage: 2961kB
                          Worker 0:  Batches: 1  Memory Usage: 2961kB
                          Worker 1:  Batches: 1  Memory Usage: 2961kB
                          ->  Nested Loop  (cost=725.42..11922.38 rows=8333 width=28) (actual time=13.257..3305.147 rows=6667 loops=3)
                                ->  Hash Join  (cost=725.00..6852.67 rows=8333 width=14) (actual time=7.734..128.646 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.064..41.495 rows=133333 loops=3)
                                      ->  Hash  (cost=475.00..475.00 rows=20000 width=14) (actual time=7.486..8.068 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1194kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..475.00 rows=20000 width=14) (actual time=0.211..3.029 rows=20000 loops=3)
                                ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.471..0.471 rows=1 loops=20000)
                                      Index Cond: (id = o.user_id)
Planning Time: 25.150 ms
Execution Time: 4015.774 ms


==================================================
EXPLAIN ANALYZE — Query 18: Produkty z wariantami objętymi promocją, z końcową ceną
==================================================
Sort  (cost=3152.11..3183.24 rows=12455 width=132) (actual time=175.594..177.055 rows=1492 loops=1)
  Sort Key: (round(((p.price + v.price_modifier) * ('1'::numeric - pr.discount_percentage)), 2))
  Sort Method: quicksort  Memory: 157kB
  ->  Hash Join  (cost=694.66..2304.89 rows=12455 width=132) (actual time=102.947..168.417 rows=1492 loops=1)
        Hash Cond: (v.product_id = p.id)
        ->  Hash Join  (cost=6.66..1397.36 rows=12455 width=39) (actual time=32.073..95.782 rows=1492 loops=1)
              Hash Cond: (v.promotion_id = pr.id)
              ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=37) (actual time=22.685..83.678 rows=47000 loops=1)
              ->  Hash  (cost=6.00..6.00 rows=53 width=10) (actual time=3.582..3.584 rows=52 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 11kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=53 width=10) (actual time=2.434..2.463 rows=52 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 148
        ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=65.979..65.980 rows=20000 loops=1)
              Buckets: 32768  Batches: 1  Memory Usage: 1381kB
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.017..59.242 rows=20000 loops=1)
Planning Time: 120.354 ms
Execution Time: 208.757 ms


==================================================
EXPLAIN ANALYZE — Query 19: Użytkownicy, Którzy Dodali Produkt do Koszyka, Ale Nie Złożyli Zamówienia (Potencjał Odbudowy Koszyka)
==================================================
Hash Join  (cost=46245.38..104238.85 rows=1076709 width=54) (actual time=3952.399..6544.056 rows=1005006 loops=1)
  Hash Cond: (v.product_id = p.id)
  ->  Hash Join  (cost=45557.38..100723.88 rows=1076709 width=45) (actual time=3934.821..5937.182 rows=1005006 loops=1)
        Hash Cond: (ci.variant_id = v.id)
        ->  Hash Join  (cost=43702.88..96042.77 rows=1076709 width=45) (actual time=3915.816..5089.339 rows=1005006 loops=1)
              Hash Cond: (ci.cart_id = c.id)
              ->  Seq Scan on "CartItem" ci  (cost=0.00..23213.67 rows=1506167 width=8) (actual time=2.744..354.673 rows=1500000 loops=1)
              ->  Hash  (cost=41419.51..41419.51 rows=107230 width=45) (actual time=3902.280..3919.831 rows=100414 loops=1)
                    Buckets: 131072  Batches: 2  Memory Usage: 4929kB
                    ->  Gather  (cost=24964.67..41419.51 rows=107230 width=45) (actual time=3396.605..3530.300 rows=100414 loops=1)
                          Workers Planned: 2
                          Workers Launched: 2
                          ->  Parallel Hash Right Anti Join  (cost=23964.67..29696.51 rows=44679 width=45) (actual time=2818.574..2837.906 rows=33471 loops=3)
                                Hash Cond: (o.user_id = u.id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=4) (actual time=2.310..337.138 rows=133333 loops=3)
                                ->  Parallel Hash  (cost=23183.42..23183.42 rows=62500 width=49) (actual time=2183.203..2185.491 rows=50000 loops=3)
                                      Buckets: 262144  Batches: 1  Memory Usage: 14720kB
                                      ->  Hash Join  (cost=4079.00..23183.42 rows=62500 width=49) (actual time=257.858..1977.675 rows=50000 loops=3)
                                            Hash Cond: (u.id = c.user_id)
                                            ->  Parallel Seq Scan on "User" u  (cost=0.00..18010.67 rows=416667 width=45) (actual time=4.610..1194.267 rows=333333 loops=3)
                                            ->  Hash  (cost=2204.00..2204.00 rows=150000 width=8) (actual time=241.440..242.124 rows=150000 loops=3)
                                                  Buckets: 262144  Batches: 1  Memory Usage: 7908kB
                                                  ->  Seq Scan on "Cart" c  (cost=0.00..2204.00 rows=150000 width=8) (actual time=22.314..166.987 rows=150000 loops=3)
        ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=15.495..16.026 rows=47000 loops=1)
              Buckets: 65536  Batches: 1  Memory Usage: 2348kB
              ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.299..5.469 rows=47000 loops=1)
  ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=14.777..14.777 rows=20000 loops=1)
        Buckets: 32768  Batches: 1  Memory Usage: 1245kB
        ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=7.402..9.765 rows=20000 loops=1)
Planning Time: 281.159 ms
Execution Time: 6633.797 ms


==================================================
EXPLAIN ANALYZE — Query 20: Wyszukiwanie produktów po nazwie lub opisie (parametryzowane)
==================================================
Seq Scan on "Product"  (cost=0.00..538.00 rows=4 width=60) (actual time=0.723..148.144 rows=143 loops=1)
  Filter: (((name)::text ~~* '%test%'::text) OR (description ~~* '%test%'::text))
  Rows Removed by Filter: 19857
Planning Time: 64.832 ms
Execution Time: 148.215 ms


==================================================
EXPLAIN ANALYZE — Query 21: Użytkownicy, Którzy Zapisali Konkretny Produkt jako Ulubiony (np. Product ID=350259)
==================================================
Gather  (cost=1000.42..7485.31 rows=30 width=55) (actual time=231.551..899.322 rows=23 loops=1)
  Workers Planned: 2
  Workers Launched: 2
  ->  Nested Loop  (cost=0.42..6482.31 rows=12 width=55) (actual time=120.033..639.282 rows=8 loops=3)
        ->  Parallel Seq Scan on "FavoriteProduct" fp  (cost=0.00..6381.00 rows=12 width=4) (actual time=119.314..632.878 rows=8 loops=3)
              Filter: (product_id = 35)
              Rows Removed by Filter: 199992
        ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..8.44 rows=1 width=59) (actual time=0.774..0.774 rows=1 loops=23)
              Index Cond: (id = fp.user_id)
Planning Time: 26.620 ms
Execution Time: 907.475 ms


==================================================
EXPLAIN ANALYZE — Query 22: Znajdź Magazyny, Które Posiadają Zapasy Konkretnego Wariantu (np. SKU='VR-000000-a637d44b7afd')
==================================================
Sort  (cost=98.54..98.55 rows=3 width=226) (actual time=11.089..11.825 rows=0 loops=1)
  Sort Key: (sum("*SELECT* 1".stock_units)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  GroupAggregate  (cost=98.36..98.52 rows=3 width=226) (actual time=10.483..10.488 rows=0 loops=1)
        Group Key: w.name
        Filter: (sum("*SELECT* 1".stock_units) > 0)
        ->  Sort  (cost=98.36..98.38 rows=8 width=222) (actual time=10.481..10.486 rows=0 loops=1)
              Sort Key: w.name
              Sort Method: quicksort  Memory: 25kB
              ->  Hash Join  (cost=83.76..98.24 rows=8 width=222) (actual time=8.515..8.520 rows=0 loops=1)
                    Hash Cond: (w.id = "*SELECT* 1".warehouse_id)
                    ->  Seq Scan on "Warehouse" w  (cost=0.00..13.20 rows=320 width=222) (actual time=0.603..0.604 rows=1 loops=1)
                    ->  Hash  (cost=83.66..83.66 rows=8 width=8) (actual time=7.906..7.910 rows=0 loops=1)
                          Buckets: 1024  Batches: 1  Memory Usage: 8kB
                          ->  Append  (cost=8.44..83.66 rows=8 width=8) (actual time=7.905..7.909 rows=0 loops=1)
                                ->  Subquery Scan on "*SELECT* 1"  (cost=8.44..39.92 rows=1 width=8) (actual time=0.004..0.006 rows=0 loops=1)
                                      ->  Hash Join  (cost=8.44..39.91 rows=1 width=8) (actual time=0.003..0.005 rows=0 loops=1)
                                            Hash Cond: (bsi.variant_id = v.id)
                                            ->  Seq Scan on "BulkStockItem" bsi  (cost=0.00..27.00 rows=1700 width=12) (actual time=0.003..0.003 rows=0 loops=1)
                                            ->  Hash  (cost=8.43..8.43 rows=1 width=4) (never executed)
                                                  ->  Index Scan using "Variant_sku_key" on "Variant" v  (cost=0.41..8.43 rows=1 width=4) (never executed)
                                                        Index Cond: ((sku)::text = 'VR-000001-2704de10f283'::text)
                                ->  Subquery Scan on "*SELECT* 2"  (cost=4.90..43.70 rows=7 width=8) (actual time=7.901..7.902 rows=0 loops=1)
                                      ->  Nested Loop  (cost=4.90..43.63 rows=7 width=8) (actual time=7.900..7.901 rows=0 loops=1)
                                            ->  Index Scan using "Variant_sku_key" on "Variant" v_1  (cost=0.41..8.43 rows=1 width=4) (actual time=7.899..7.899 rows=0 loops=1)
                                                  Index Cond: ((sku)::text = 'VR-000001-2704de10f283'::text)
                                            ->  Bitmap Heap Scan on "SerialStockItem" ssi  (cost=4.48..35.12 rows=8 width=8) (never executed)
                                                  Recheck Cond: (variant_id = v_1.id)
                                                  ->  Bitmap Index Scan on uq_serialstockitem_variant_serial  (cost=0.00..4.48 rows=8 width=0) (never executed)
                                                        Index Cond: (variant_id = v_1.id)
Planning Time: 24.694 ms
Execution Time: 13.327 ms


==================================================
EXPLAIN ANALYZE — Query 23: Warianty, Które Wymagają Uzyskania Konkretnej Opcji (np. 'Kolor'='Czerwony')
==================================================
Gather  (cost=1020.48..7497.45 rows=17 width=36) (actual time=174.040..287.471 rows=0 loops=1)
  Workers Planned: 1
  Workers Launched: 1
  ->  Nested Loop  (cost=20.48..6495.75 rows=10 width=36) (actual time=1.148..1.153 rows=0 loops=2)
        ->  Nested Loop  (cost=20.19..6492.45 rows=10 width=27) (actual time=1.148..1.152 rows=0 loops=2)
              ->  Hash Join  (cost=19.90..6489.29 rows=10 width=4) (actual time=1.147..1.151 rows=0 loops=2)
                    Hash Cond: (opt.attribute_id = a.id)
                    ->  Hash Join  (cost=18.51..6487.02 rows=294 width=8) (never executed)
                          Hash Cond: (vo.option_id = opt.id)
                          ->  Parallel Seq Scan on "VariantOption" vo  (cost=0.00..5693.18 rows=294118 width=8) (never executed)
                          ->  Hash  (cost=18.50..18.50 rows=1 width=8) (never executed)
                                ->  Seq Scan on "Option" opt  (cost=0.00..18.50 rows=1 width=8) (never executed)
                                      Filter: ((value)::text = 'do'::text)
                    ->  Hash  (cost=1.38..1.38 rows=1 width=4) (actual time=0.550..0.550 rows=0 loops=2)
                          Buckets: 1024  Batches: 1  Memory Usage: 8kB
                          ->  Seq Scan on "Attribute" a  (cost=0.00..1.38 rows=1 width=4) (actual time=0.549..0.550 rows=0 loops=2)
                                Filter: ((name)::text = 'Attr_49_Century'::text)
                                Rows Removed by Filter: 30
              ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.32 rows=1 width=31) (never executed)
                    Index Cond: (id = vo.variant_id)
        ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=17) (never executed)
              Index Cond: (id = v.product_id)
Planning Time: 72.658 ms
Execution Time: 296.813 ms


==================================================
EXPLAIN ANALYZE — Query 24: Znajdź Zamówienia Użytkownika (np. email='debbie.lane.16786.50af0753@example.com') o Statusie 'Paid'
==================================================
Gather  (cost=1008.60..7188.83 rows=1 width=528) (actual time=2961.015..3103.248 rows=0 loops=1)
  Workers Planned: 2
  Workers Launched: 2
  ->  Nested Loop  (cost=8.60..6188.73 rows=1 width=528) (actual time=2782.621..2783.658 rows=0 loops=3)
        ->  Hash Join  (cost=8.17..5461.58 rows=1190 width=532) (actual time=21.098..156.236 rows=19028 loops=3)
              Hash Cond: (o.status_id = s.id)
              ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=20) (actual time=0.015..62.433 rows=133333 loops=3)
              ->  Hash  (cost=8.16..8.16 rows=1 width=520) (actual time=20.603..20.604 rows=1 loops=3)
                    Buckets: 1024  Batches: 1  Memory Usage: 9kB
                    ->  Index Scan using "Status_name_key" on "Status" s  (cost=0.14..8.16 rows=1 width=520) (actual time=20.591..20.593 rows=1 loops=3)
                          Index Cond: ((name)::text = 'Paid'::text)
        ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=4) (actual time=0.137..0.137 rows=0 loops=57084)
              Index Cond: (id = o.user_id)
              Filter: ((email)::text = 'debbie.lane.16786.50af0753@example.com'::text)
              Rows Removed by Filter: 1
Planning Time: 17.227 ms
Execution Time: 3112.727 ms


==================================================
EXPLAIN ANALYZE — Query 25: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
Nested Loop Left Join  (cost=13.59..1411.12 rows=32 width=87) (actual time=62.325..162.579 rows=51 loops=1)
  ->  Nested Loop  (cost=0.29..1392.83 rows=3 width=39) (actual time=50.465..143.161 rows=4 loops=1)
        ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..8.30 rows=1 width=10) (actual time=1.096..1.100 rows=1 loops=1)
              Index Cond: (id = 35)
        ->  Seq Scan on "Variant" v  (cost=0.00..1384.50 rows=3 width=37) (actual time=49.366..142.055 rows=4 loops=1)
              Filter: (product_id = 35)
              Rows Removed by Filter: 46996
  ->  Hash Right Join  (cost=13.30..14.83 rows=11 width=24) (actual time=4.357..4.369 rows=13 loops=4)
        Hash Cond: (a.id = opt.attribute_id)
        ->  Seq Scan on "Attribute" a  (cost=0.00..1.30 rows=30 width=18) (actual time=0.006..0.008 rows=30 loops=4)
        ->  Hash  (cost=13.17..13.17 rows=11 width=14) (actual time=3.820..3.821 rows=13 loops=4)
              Buckets: 1024  Batches: 1  Memory Usage: 9kB
              ->  Nested Loop Left Join  (cost=0.70..13.17 rows=11 width=14) (actual time=1.704..3.686 rows=13 loops=4)
                    ->  Index Only Scan using uq_varopt_variant_option on "VariantOption" vo  (cost=0.42..9.95 rows=11 width=8) (actual time=1.432..2.684 rows=13 loops=4)
                          Index Cond: (variant_id = v.id)
                          Heap Fetches: 7
                    ->  Index Scan using "Option_pkey" on "Option" opt  (cost=0.28..0.29 rows=1 width=14) (actual time=0.078..0.078 rows=1 loops=51)
                          Index Cond: (id = vo.option_id)
Planning Time: 36.849 ms
Execution Time: 170.089 ms


==================================================
EXPLAIN ANALYZE — Query 26: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
Nested Loop Left Join  (cost=13.59..1411.28 rows=32 width=87) (actual time=0.015..0.016 rows=0 loops=1)
  ->  Nested Loop  (cost=0.29..1392.83 rows=3 width=39) (actual time=0.015..0.015 rows=0 loops=1)
        ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..8.30 rows=1 width=10) (actual time=0.014..0.015 rows=0 loops=1)
              Index Cond: (id = 350259)
        ->  Seq Scan on "Variant" v  (cost=0.00..1384.50 rows=3 width=37) (never executed)
              Filter: (product_id = 350259)
  ->  Hash Right Join  (cost=13.30..14.83 rows=11 width=24) (never executed)
        Hash Cond: (a.id = opt.attribute_id)
        ->  Seq Scan on "Attribute" a  (cost=0.00..1.30 rows=30 width=18) (never executed)
        ->  Hash  (cost=13.17..13.17 rows=11 width=14) (never executed)
              ->  Nested Loop Left Join  (cost=0.70..13.17 rows=11 width=14) (never executed)
                    ->  Index Only Scan using uq_varopt_variant_option on "VariantOption" vo  (cost=0.42..9.95 rows=11 width=8) (never executed)
                          Index Cond: (variant_id = v.id)
                          Heap Fetches: 0
                    ->  Index Scan using "Option_pkey" on "Option" opt  (cost=0.28..0.29 rows=1 width=14) (never executed)
                          Index Cond: (id = vo.option_id)
Planning Time: 33.933 ms
Execution Time: 7.718 ms


==================================================
EXPLAIN ANALYZE — Query 27: Lista Wszystkich Dziecięcych Kategorii (Podkategorii) dla Konkretnej Kategorii Nadrzędnej (np. ID=5)
==================================================
Seq Scan on "Category"  (cost=0.00..3.88 rows=3 width=12) (actual time=2.100..2.112 rows=3 loops=1)
  Filter: (parent_id = 5)
  Rows Removed by Filter: 147
Planning Time: 16.756 ms
Execution Time: 7.092 ms


==================================================
EXPLAIN ANALYZE — Query 28: Porównanie Średniej Oceny dla Promowanych i Niepromowanych Produktów
==================================================
GroupAggregate  (cost=27693179.28..27693331.78 rows=200 width=64) (actual time=201.106..201.874 rows=2 loops=1)
  Group Key: sub.promotion_status
  ->  Sort  (cost=27693179.28..27693229.28 rows=20000 width=64) (actual time=198.394..199.074 rows=12624 loops=1)
        Sort Key: sub.promotion_status
        Sort Method: quicksort  Memory: 864kB
        ->  Subquery Scan on sub  (cost=1300.51..27691750.51 rows=20000 width=64) (actual time=140.832..149.392 rows=12624 loops=1)
              ->  HashAggregate  (cost=1300.51..27691550.51 rows=20000 width=68) (actual time=140.830..148.176 rows=12624 loops=1)
                    Group Key: p.id
                    Batches: 1  Memory Usage: 2577kB
                    ->  Hash Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=49.659..71.863 rows=20000 loops=1)
                          Hash Cond: (r.product_id = p.id)
                          ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=9.882..23.707 rows=20000 loops=1)
                          ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=30.684..30.684 rows=20000 loops=1)
                                Buckets: 32768  Batches: 1  Memory Usage: 960kB
                                ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.683..3.917 rows=20000 loops=1)
                    SubPlan 2
                      ->  Seq Scan on "Variant" v2  (cost=0.00..1267.00 rows=5736 width=4) (actual time=0.924..5.156 rows=5684 loops=1)
                            Filter: (promotion_id IS NOT NULL)
                            Rows Removed by Filter: 41316
Planning Time: 25.795 ms
Execution Time: 234.981 ms


==================================================
EXPLAIN ANALYZE — Query 29: Top 5 Miast Generujących Największy Przychód (Wg. Adresu Wysyłki)
==================================================
Limit  (cost=15500.49..15500.50 rows=5 width=45) (actual time=5118.482..5189.125 rows=5 loops=1)
  ->  Sort  (cost=15500.49..15550.49 rows=20000 width=45) (actual time=5117.511..5186.964 rows=5 loops=1)
        Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=14918.30..15168.30 rows=20000 width=45) (actual time=5101.780..5176.638 rows=12950 loops=1)
              Group Key: a.city
              Batches: 1  Memory Usage: 5905kB
              ->  Gather  (cost=13022.54..14793.30 rows=16666 width=45) (actual time=4821.562..4954.900 rows=16142 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=12022.54..12126.70 rows=8333 width=45) (actual time=4534.603..4570.955 rows=5381 loops=3)
                          Group Key: a.city
                          Batches: 1  Memory Usage: 2449kB
                          Worker 0:  Batches: 1  Memory Usage: 2449kB
                          Worker 1:  Batches: 1  Memory Usage: 2449kB
                          ->  Nested Loop  (cost=725.43..11939.21 rows=8333 width=23) (actual time=100.097..4308.064 rows=6667 loops=3)
                                ->  Hash Join  (cost=725.00..6852.67 rows=8333 width=14) (actual time=58.752..459.428 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.012..309.813 rows=133333 loops=3)
                                      ->  Hash  (cost=475.00..475.00 rows=20000 width=14) (actual time=57.074..57.686 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1194kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..475.00 rows=20000 width=14) (actual time=19.522..44.632 rows=20000 loops=3)
                                ->  Index Scan using "Address_pkey" on "Address" a  (cost=0.43..0.61 rows=1 width=17) (actual time=0.564..0.564 rows=1 loops=20000)
                                      Index Cond: (id = o.shipping_address_id)
Planning Time: 66.284 ms
Execution Time: 5202.320 ms


==================================================
EXPLAIN ANALYZE — Query 30: Porównanie Wolumenu Sprzedaży Produktów Promowanych vs. Niepromowanych (w Ostatnich 30 Dniach)
==================================================
Finalize GroupAggregate  (cost=8454.19..8511.46 rows=200 width=40) (actual time=1014.492..1212.996 rows=2 loops=1)
  Group Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
  ->  Gather Merge  (cost=8454.19..8507.46 rows=400 width=40) (actual time=1008.748..1208.909 rows=6 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=7454.17..7461.27 rows=200 width=40) (actual time=440.411..441.410 rows=2 loops=3)
              Group Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
              ->  Sort  (cost=7454.17..7455.87 rows=680 width=36) (actual time=436.335..436.815 rows=548 loops=3)
                    Sort Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
                    Sort Method: quicksort  Memory: 54kB
                    Worker 0:  Sort Method: quicksort  Memory: 39kB
                    Worker 1:  Sort Method: quicksort  Memory: 44kB
                    ->  Nested Loop  (cost=725.29..7422.18 rows=680 width=36) (actual time=135.446..396.771 rows=548 loops=3)
                          ->  Hash Join  (cost=725.00..7069.46 rows=680 width=8) (actual time=128.417..298.405 rows=548 loops=3)
                                Hash Cond: (o.id = oi.order_id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..6252.67 rows=13599 width=4) (actual time=24.479..201.208 rows=10946 loops=3)
                                      Filter: (order_date >= (now() - '30 days'::interval))
                                      Rows Removed by Filter: 122388
                                ->  Hash  (cost=475.00..475.00 rows=20000 width=12) (actual time=87.577..88.012 rows=20000 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                      ->  Seq Scan on "OrderItem" oi  (cost=0.00..475.00 rows=20000 width=12) (actual time=58.183..80.589 rows=20000 loops=3)
                          ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.52 rows=1 width=8) (actual time=0.172..0.172 rows=1 loops=1645)
                                Index Cond: (id = oi.variant_id)
Planning Time: 56.477 ms
Execution Time: 1240.763 ms


==================================================
EXPLAIN ANALYZE — Query 31: Wskaźnik Lojalności (Repeat Purchase Rate) Użytkowników z Podziałem na Miasto Adresu Rozliczeniowego
==================================================
Sort  (cost=147659.76..147734.83 rows=30028 width=61) (actual time=8374.120..8511.169 rows=66456 loops=1)
  Sort Key: (round((((count(*) FILTER (WHERE (u.orders_count > 1)))::numeric * 100.0) / (NULLIF(count(DISTINCT o.user_id), 0))::numeric), 2)) DESC
  Sort Method: external merge  Disk: 3192kB
  ->  GroupAggregate  (cost=94089.28..145426.58 rows=30028 width=61) (actual time=7880.400..8368.002 rows=66456 loops=1)
        Group Key: a.city
        ->  Gather Merge  (cost=94089.28..140675.88 rows=400000 width=25) (actual time=7871.870..8241.203 rows=400000 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Sort  (cost=93089.26..93505.93 rows=166667 width=25) (actual time=6958.567..7032.000 rows=133333 loops=3)
                    Sort Key: a.city, o.user_id
                    Sort Method: external merge  Disk: 4680kB
                    Worker 0:  Sort Method: external merge  Disk: 5208kB
                    Worker 1:  Sort Method: external merge  Disk: 5440kB
                    ->  Parallel Hash Join  (cost=53841.40..74643.72 rows=166667 width=25) (actual time=2988.148..6262.591 rows=133333 loops=3)
                          Hash Cond: (a.id = o.billing_address_id)
                          ->  Parallel Seq Scan on "Address" a  (cost=0.00..18237.00 rows=498900 width=17) (actual time=5.064..1950.262 rows=400000 loops=3)
                          ->  Parallel Hash  (cost=51758.07..51758.07 rows=166667 width=16) (actual time=2976.824..2979.124 rows=133333 loops=3)
                                Buckets: 524288  Batches: 1  Memory Usage: 22912kB
                                ->  Hash Join  (cost=43620.89..51758.07 rows=166667 width=16) (actual time=1938.505..2257.469 rows=133333 loops=3)
                                      Hash Cond: (o.user_id = u.user_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=3.654..47.517 rows=133333 loops=3)
                                      ->  Hash  (cost=38663.70..38663.70 rows=285135 width=12) (actual time=1864.963..1866.693 rows=329619 loops=3)
                                            Buckets: 262144  Batches: 4  Memory Usage: 5596kB
                                            ->  Subquery Scan on u  (cost=29836.00..38663.70 rows=285135 width=12) (actual time=1018.642..1420.633 rows=329619 loops=3)
                                                  ->  HashAggregate  (cost=29836.00..35812.35 rows=285135 width=12) (actual time=1016.995..1363.463 rows=329619 loops=3)
                                                        Group Key: "Order".user_id
                                                        Planned Partitions: 4  Batches: 5  Memory Usage: 8241kB  Disk Usage: 7672kB
                                                        Worker 0:  Batches: 5  Memory Usage: 8241kB  Disk Usage: 7672kB
                                                        Worker 1:  Batches: 5  Memory Usage: 8241kB  Disk Usage: 7672kB
                                                        ->  Seq Scan on "Order"  (cost=0.00..7336.00 rows=400000 width=4) (actual time=5.882..247.322 rows=400000 loops=3)
Planning Time: 15.822 ms
Execution Time: 8639.403 ms

FINISHED — 2025-12-07 22:16:06.873894
========================================================================================================================
========================================================================================================================
START EXPLAIN RUN — 2025-12-07 22:22:10.962923
========================================================================================================================


==================================================
EXPLAIN ANALYZE — Query 1: Średnia Wartość Zamówienia (AOV) w Ostatnim Miesiącu
==================================================
Aggregate  (cost=8326.44..8326.45 rows=1 width=32) (actual time=452.048..545.317 rows=1 loops=1)
  ->  Finalize GroupAggregate  (cost=8101.46..8306.04 rows=1632 width=36) (actual time=450.289..545.183 rows=1610 loops=1)
        Group Key: o.id
        ->  Gather Merge  (cost=8101.46..8275.44 rows=1360 width=36) (actual time=450.280..543.254 rows=1610 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial GroupAggregate  (cost=7101.44..7118.44 rows=680 width=36) (actual time=439.899..440.357 rows=537 loops=3)
                    Group Key: o.id
                    ->  Sort  (cost=7101.44..7103.14 rows=680 width=14) (actual time=439.880..439.922 rows=548 loops=3)
                          Sort Key: o.id
                          Sort Method: quicksort  Memory: 41kB
                          Worker 0:  Sort Method: quicksort  Memory: 42kB
                          Worker 1:  Sort Method: quicksort  Memory: 42kB
                          ->  Hash Join  (cost=725.00..7069.45 rows=680 width=14) (actual time=88.606..436.309 rows=548 loops=3)
                                Hash Cond: (o.id = oi.order_id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..6252.67 rows=13597 width=4) (actual time=0.435..345.077 rows=10944 loops=3)
                                      Filter: (order_date >= (now() - '1 mon'::interval))
                                      Rows Removed by Filter: 122389
                                ->  Hash  (cost=475.00..475.00 rows=20000 width=14) (actual time=87.609..87.610 rows=20000 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1194kB
                                      ->  Seq Scan on "OrderItem" oi  (cost=0.00..475.00 rows=20000 width=14) (actual time=40.925..82.563 rows=20000 loops=3)
Planning Time: 35.101 ms
Execution Time: 551.116 ms


==================================================
EXPLAIN ANALYZE — Query 2: Średnia wartość zamówienia per użytkownik - ZOPTYMALIZOWANA
==================================================
Sort  (cost=16309.57..16358.30 rows=19495 width=50) (actual time=5600.411..5615.996 rows=19296 loops=1)
  Sort Key: (round(avg(oi_sum.total_price), 2)) DESC
  Sort Method: quicksort  Memory: 1612kB
  ->  Finalize HashAggregate  (cost=14628.04..14920.47 rows=19495 width=50) (actual time=5572.839..5599.275 rows=19296 loops=1)
        Group Key: u.id
        Batches: 5  Memory Usage: 8241kB  Disk Usage: 224kB
        ->  Gather  (cost=12780.06..14506.20 rows=16246 width=50) (actual time=5027.799..5342.978 rows=19430 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Partial HashAggregate  (cost=11780.06..11881.60 rows=8123 width=50) (actual time=4687.333..4802.491 rows=6477 loops=3)
                    Group Key: u.id
                    Batches: 1  Memory Usage: 2961kB
                    Worker 0:  Batches: 1  Memory Usage: 3217kB
                    Worker 1:  Batches: 1  Memory Usage: 2961kB
                    ->  Nested Loop  (cost=1357.75..11739.44 rows=8123 width=50) (actual time=168.121..4642.072 rows=6498 loops=3)
                          ->  Hash Join  (cost=1357.33..6797.49 rows=8123 width=36) (actual time=112.455..282.541 rows=6498 loops=3)
                                Hash Cond: (o.id = oi_sum.order_id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.011..73.548 rows=133333 loops=3)
                                ->  Hash  (cost=1113.64..1113.64 rows=19495 width=36) (actual time=107.160..108.431 rows=19495 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1094kB
                                      ->  Subquery Scan on oi_sum  (cost=675.00..1113.64 rows=19495 width=36) (actual time=91.416..101.644 rows=19495 loops=3)
                                            ->  HashAggregate  (cost=675.00..918.69 rows=19495 width=36) (actual time=91.219..99.480 rows=19495 loops=3)
                                                  Group Key: "OrderItem".order_id
                                                  Batches: 1  Memory Usage: 7953kB
                                                  Worker 0:  Batches: 1  Memory Usage: 7953kB
                                                  Worker 1:  Batches: 1  Memory Usage: 7953kB
                                                  ->  Seq Scan on "OrderItem"  (cost=0.00..475.00 rows=20000 width=14) (actual time=9.259..22.470 rows=20000 loops=3)
                          ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.664..0.664 rows=1 loops=19495)
                                Index Cond: (id = o.user_id)
Planning Time: 33.041 ms
Execution Time: 5658.213 ms


==================================================
EXPLAIN ANALYZE — Query 3: Top 10 Najlepiej Sprzedających Się Produktów (wg. Ilości Sprzedanych Jednostek) w Ostatnim Kwartale
==================================================
Limit  (cost=10634.82..10634.84 rows=10 width=46) (actual time=905.625..1004.304 rows=10 loops=1)
  ->  Sort  (cost=10634.82..10647.10 rows=4914 width=46) (actual time=904.820..1002.188 rows=10 loops=1)
        Sort Key: (sum(oi.quantity)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=10479.49..10528.63 rows=4914 width=46) (actual time=899.511..997.734 rows=4240 loops=1)
              Group Key: p.name, m.name
              Batches: 1  Memory Usage: 721kB
              ->  Gather  (cost=10018.69..10448.77 rows=4096 width=46) (actual time=798.636..948.905 rows=4707 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=9018.69..9039.17 rows=2048 width=46) (actual time=438.373..440.748 rows=1569 loops=3)
                          Group Key: p.name, m.name
                          Batches: 1  Memory Usage: 369kB
                          Worker 0:  Batches: 1  Memory Usage: 369kB
                          Worker 1:  Batches: 1  Memory Usage: 369kB
                          ->  Hash Join  (cost=730.95..9003.33 rows=2048 width=42) (actual time=32.998..429.753 rows=1666 loops=3)
                                Hash Cond: (p.manufacturer_id = m.id)
                                ->  Nested Loop  (cost=725.58..8992.42 rows=2048 width=21) (actual time=31.829..427.341 rows=1666 loops=3)
                                      ->  Nested Loop  (cost=725.29..8316.37 rows=2048 width=8) (actual time=23.545..319.930 rows=1666 loops=3)
                                            ->  Hash Join  (cost=725.00..7254.07 rows=2048 width=8) (actual time=18.005..170.072 rows=1666 loops=3)
                                                  Hash Cond: (o.id = oi.order_id)
                                                  ->  Parallel Seq Scan on "Order" o  (cost=0.00..6252.67 rows=40949 width=4) (actual time=0.011..142.540 rows=33237 loops=3)
                                                        Filter: (order_date >= (now() - '3 mons'::interval))
                                                        Rows Removed by Filter: 100096
                                                  ->  Hash  (cost=475.00..475.00 rows=20000 width=12) (actual time=16.662..16.962 rows=20000 loops=3)
                                                        Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                                        ->  Seq Scan on "OrderItem" oi  (cost=0.00..475.00 rows=20000 width=12) (actual time=0.536..4.389 rows=20000 loops=3)
                                            ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.52 rows=1 width=8) (actual time=0.089..0.089 rows=1 loops=4998)
                                                  Index Cond: (id = oi.variant_id)
                                      ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=21) (actual time=0.064..0.064 rows=1 loops=4998)
                                            Index Cond: (id = v.product_id)
                                ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.542..0.543 rows=150 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 18kB
                                      ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.034..0.060 rows=150 loops=3)
Planning Time: 66.932 ms
Execution Time: 1021.431 ms


==================================================
EXPLAIN ANALYZE — Query 4: Top 5 produktów z najwięcej recenzjami
==================================================
Limit  (cost=1792.98..1793.00 rows=5 width=25) (actual time=137.738..138.691 rows=5 loops=1)
  ->  Sort  (cost=1792.98..1842.98 rows=20000 width=25) (actual time=137.736..137.740 rows=5 loops=1)
        Sort Key: (COALESCE(r.count, '0'::bigint)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Hash Left Join  (cost=970.28..1460.79 rows=20000 width=25) (actual time=126.376..133.435 rows=20000 loops=1)
              Hash Cond: (p.id = r.product_id)
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.012..1.481 rows=20000 loops=1)
              ->  Hash  (cost=812.48..812.48 rows=12624 width=12) (actual time=126.352..126.354 rows=12624 loops=1)
                    Buckets: 16384  Batches: 1  Memory Usage: 671kB
                    ->  Subquery Scan on r  (cost=560.00..812.48 rows=12624 width=12) (actual time=117.982..121.767 rows=12624 loops=1)
                          ->  HashAggregate  (cost=560.00..686.24 rows=12624 width=12) (actual time=117.981..120.587 rows=12624 loops=1)
                                Group Key: "Review".product_id
                                Batches: 1  Memory Usage: 1425kB
                                ->  Seq Scan on "Review"  (cost=0.00..460.00 rows=20000 width=4) (actual time=1.313..110.454 rows=20000 loops=1)
Planning Time: 8.676 ms
Execution Time: 141.306 ms


==================================================
EXPLAIN ANALYZE — Query 5: Całkowity Przychód Pogrupowany Miesięcznie za Ostatni Rok
==================================================
Finalize GroupAggregate  (cost=9685.68..12332.40 rows=19984 width=36) (actual time=185.188..302.312 rows=13 loops=1)
  Group Key: ((date_trunc('month'::text, o.order_date))::date)
  ->  Gather Merge  (cost=9685.68..11857.77 rows=16654 width=36) (actual time=184.518..301.286 rows=39 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=8685.65..8935.46 rows=8327 width=36) (actual time=92.733..95.439 rows=13 loops=3)
              Group Key: ((date_trunc('month'::text, o.order_date))::date)
              ->  Sort  (cost=8685.65..8706.47 rows=8327 width=14) (actual time=90.802..91.472 rows=6662 loops=3)
                    Sort Key: ((date_trunc('month'::text, o.order_date))::date) DESC
                    Sort Method: quicksort  Memory: 1291kB
                    Worker 0:  Sort Method: quicksort  Memory: 86kB
                    Worker 1:  Sort Method: quicksort  Memory: 161kB
                    ->  Hash Join  (cost=725.00..8143.42 rows=8327 width=14) (actual time=12.008..80.165 rows=6662 loops=3)
                          Hash Cond: (o.id = oi.order_id)
                          ->  Parallel Seq Scan on "Order" o  (cost=0.00..6252.67 rows=166535 width=12) (actual time=0.209..45.727 rows=133220 loops=3)
                                Filter: (order_date >= (now() - '1 year'::interval))
                                Rows Removed by Filter: 113
                          ->  Hash  (cost=475.00..475.00 rows=20000 width=14) (actual time=11.139..11.140 rows=20000 loops=3)
                                Buckets: 32768  Batches: 1  Memory Usage: 1194kB
                                ->  Seq Scan on "OrderItem" oi  (cost=0.00..475.00 rows=20000 width=14) (actual time=0.217..3.057 rows=20000 loops=3)
Planning Time: 15.312 ms
Execution Time: 308.983 ms


==================================================
EXPLAIN ANALYZE — Query 6: Produkty najczęściej dodawane do ulubionych
==================================================
Limit  (cost=14382.58..14382.60 rows=10 width=25) (actual time=844.220..983.022 rows=10 loops=1)
  ->  Sort  (cost=14382.58..14432.58 rows=20000 width=25) (actual time=843.053..981.850 rows=10 loops=1)
        Sort Key: (count(f.user_id)) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=13750.38..13950.38 rows=20000 width=25) (actual time=834.382..976.261 rows=20000 loops=1)
              Group Key: p.id
              Batches: 1  Memory Usage: 2577kB
              ->  Gather  (cost=9350.38..13550.38 rows=40000 width=25) (actual time=713.811..907.581 rows=59998 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=8350.38..8550.38 rows=20000 width=25) (actual time=640.432..645.750 rows=19999 loops=3)
                          Group Key: p.id
                          Batches: 1  Memory Usage: 2577kB
                          Worker 0:  Batches: 1  Memory Usage: 2577kB
                          Worker 1:  Batches: 1  Memory Usage: 2577kB
                          ->  Hash Join  (cost=688.00..7100.38 rows=250000 width=21) (actual time=20.163..536.088 rows=200000 loops=3)
                                Hash Cond: (f.product_id = p.id)
                                ->  Parallel Seq Scan on "FavoriteProduct" f  (cost=0.00..5756.00 rows=250000 width=8) (actual time=9.762..431.850 rows=200000 loops=3)
                                ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=10.163..10.526 rows=20000 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1215kB
                                      ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.039..3.141 rows=20000 loops=3)
Planning Time: 13.112 ms
Execution Time: 987.931 ms


==================================================
EXPLAIN ANALYZE — Query 7: Dostępny Stan Magazynowy Wariantów Produktu Pogrupowany po Magazynach
==================================================
Finalize GroupAggregate  (cost=37241.37..77098.70 rows=321700 width=262) (actual time=1865.258..2419.814 rows=231755 loops=1)
  Group Key: p.name, w.name, v.sku
  ->  Gather Merge  (cost=37241.37..71200.86 rows=268084 width=262) (actual time=1864.202..2317.471 rows=285824 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=36241.34..39257.29 rows=134042 width=262) (actual time=1743.360..1879.622 rows=95275 loops=3)
              Group Key: p.name, w.name, v.sku
              ->  Sort  (cost=36241.34..36576.45 rows=134042 width=258) (actual time=1737.939..1825.045 rows=106667 loops=3)
                    Sort Key: p.name, w.name, v.sku
                    Sort Method: external merge  Disk: 7816kB
                    Worker 0:  Sort Method: external merge  Disk: 7720kB
                    Worker 1:  Sort Method: external merge  Disk: 6240kB
                    ->  Hash Join  (cost=2559.70..8330.61 rows=134042 width=258) (actual time=94.222..1074.647 rows=106667 loops=3)
                          Hash Cond: (ssi.warehouse_id = w.id)
                          ->  Hash Join  (cost=2542.50..7956.89 rows=134042 width=44) (actual time=93.747..1036.201 rows=106667 loops=3)
                                Hash Cond: (v.product_id = p.id)
                                ->  Hash Join  (cost=1854.50..6916.95 rows=134042 width=35) (actual time=79.409..954.943 rows=106667 loops=3)
                                      Hash Cond: (ssi.variant_id = v.id)
                                      ->  Parallel Append  (cost=0.00..4710.56 rows=134041 width=12) (actual time=13.004..716.894 rows=106667 loops=3)
                                            ->  Parallel Seq Scan on "SerialStockItem" ssi  (cost=0.00..4020.35 rows=188235 width=12) (actual time=13.002..699.114 rows=106667 loops=3)
                                            ->  Parallel Seq Scan on "BulkStockItem" bsi  (cost=0.00..20.00 rows=1000 width=12) (actual time=0.002..0.002 rows=0 loops=1)
                                      ->  Hash  (cost=1267.00..1267.00 rows=47000 width=31) (actual time=60.375..62.950 rows=47000 loops=3)
                                            Buckets: 65536  Batches: 1  Memory Usage: 3450kB
                                            ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=31) (actual time=32.164..41.563 rows=47000 loops=3)
                                ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=11.806..11.807 rows=20000 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                                      ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.019..3.092 rows=20000 loops=3)
                          ->  Hash  (cost=13.20..13.20 rows=320 width=222) (actual time=0.444..0.445 rows=10 loops=3)
                                Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                ->  Seq Scan on "Warehouse" w  (cost=0.00..13.20 rows=320 width=222) (actual time=0.438..0.439 rows=10 loops=3)
Planning Time: 18.078 ms
Execution Time: 2434.035 ms


==================================================
EXPLAIN ANALYZE — Query 8: Stan magazynowy per produkt
==================================================
Sort  (cost=19497.29..19546.82 rows=19812 width=21) (actual time=519.263..520.969 rows=17954 loops=1)
  Sort Key: (sum("*SELECT* 1".quantity)) DESC
  Sort Method: quicksort  Memory: 1483kB
  ->  HashAggregate  (cost=17885.18..18083.30 rows=19812 width=21) (actual time=512.591..516.386 rows=17954 loops=1)
        Group Key: p.name
        Batches: 1  Memory Usage: 2065kB
        ->  Hash Join  (cost=2542.50..16276.68 rows=321700 width=17) (actual time=29.651..394.138 rows=320000 loops=1)
              Hash Cond: ("*SELECT* 1".product_id = p.id)
              ->  Append  (cost=1854.50..14744.04 rows=321700 width=8) (actual time=21.181..274.338 rows=320000 loops=1)
                    ->  Subquery Scan on "*SELECT* 1"  (cost=1854.50..11232.58 rows=320000 width=8) (actual time=21.179..249.682 rows=320000 loops=1)
                          ->  Hash Join  (cost=1854.50..8032.58 rows=320000 width=8) (actual time=21.178..219.479 rows=320000 loops=1)
                                Hash Cond: (ssi.variant_id = v.id)
                                ->  Seq Scan on "SerialStockItem" ssi  (cost=0.00..5338.00 rows=320000 width=4) (actual time=0.011..45.549 rows=320000 loops=1)
                                ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=21.147..21.148 rows=47000 loops=1)
                                      Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                      ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=8) (actual time=6.949..13.578 rows=47000 loops=1)
                    ->  Subquery Scan on "*SELECT* 2"  (cost=1854.50..1902.96 rows=1700 width=8) (actual time=0.015..0.017 rows=0 loops=1)
                          ->  Hash Join  (cost=1854.50..1885.96 rows=1700 width=8) (actual time=0.014..0.016 rows=0 loops=1)
                                Hash Cond: (bsi.variant_id = v_1.id)
                                ->  Seq Scan on "BulkStockItem" bsi  (cost=0.00..27.00 rows=1700 width=8) (actual time=0.013..0.013 rows=0 loops=1)
                                ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (never executed)
                                      ->  Seq Scan on "Variant" v_1  (cost=0.00..1267.00 rows=47000 width=8) (never executed)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=8.459..8.460 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.013..5.059 rows=20000 loops=1)
Planning Time: 16.220 ms
Execution Time: 522.306 ms


==================================================
EXPLAIN ANALYZE — Query 9: Najpopularniejsze Kategorie (wg. Całkowitego Przychodu)
==================================================
Limit  (cost=7587.92..7587.95 rows=10 width=44) (actual time=316.963..316.971 rows=10 loops=1)
  ->  Sort  (cost=7587.92..7588.30 rows=150 width=44) (actual time=316.962..316.969 rows=10 loops=1)
        Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  HashAggregate  (cost=7582.81..7584.68 rows=150 width=44) (actual time=315.638..315.696 rows=150 loops=1)
              Group Key: c.name
              Batches: 1  Memory Usage: 96kB
              ->  Hash Join  (cost=3377.89..6582.81 rows=100000 width=22) (actual time=41.777..272.666 rows=100096 loops=1)
                    Hash Cond: (pc.category_id = c.id)
                    ->  Hash Join  (cost=3372.51..6307.51 rows=100000 width=14) (actual time=40.351..250.580 rows=100096 loops=1)
                          Hash Cond: (pc.product_id = p.id)
                          ->  Seq Scan on "ProductCategory" pc  (cost=0.00..1560.00 rows=100000 width=8) (actual time=1.259..165.437 rows=100000 loops=1)
                          ->  Hash  (cost=3122.51..3122.51 rows=20000 width=18) (actual time=39.078..39.082 rows=20000 loops=1)
                                Buckets: 32768  Batches: 1  Memory Usage: 1272kB
                                ->  Hash Join  (cost=2542.50..3122.51 rows=20000 width=18) (actual time=19.322..35.051 rows=20000 loops=1)
                                      Hash Cond: (v.product_id = p.id)
                                      ->  Hash Join  (cost=1854.50..2382.00 rows=20000 width=14) (actual time=13.843..23.565 rows=20000 loops=1)
                                            Hash Cond: (oi.variant_id = v.id)
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..475.00 rows=20000 width=14) (actual time=0.085..1.572 rows=20000 loops=1)
                                            ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=12.620..12.621 rows=47000 loops=1)
                                                  Buckets: 65536  Batches: 1  Memory Usage: 2348kB
                                                  ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.246..5.110 rows=47000 loops=1)
                                      ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=4.840..4.841 rows=20000 loops=1)
                                            Buckets: 32768  Batches: 1  Memory Usage: 960kB
                                            ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.008..2.099 rows=20000 loops=1)
                    ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=1.415..1.416 rows=150 loops=1)
                          Buckets: 1024  Batches: 1  Memory Usage: 16kB
                          ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=0.734..1.385 rows=150 loops=1)
Planning Time: 18.802 ms
Execution Time: 317.081 ms


==================================================
EXPLAIN ANALYZE — Query 10: Liczba produktów per kategoria
==================================================
Sort  (cost=2342.22..2342.59 rows=150 width=20) (actual time=49.791..49.801 rows=150 loops=1)
  Sort Key: (count(pc.product_id)) DESC
  Sort Method: quicksort  Memory: 30kB
  ->  HashAggregate  (cost=2335.30..2336.80 rows=150 width=20) (actual time=49.736..49.759 rows=150 loops=1)
        Group Key: c.name
        Batches: 1  Memory Usage: 48kB
        ->  Hash Right Join  (cost=5.38..1835.30 rows=100000 width=16) (actual time=0.609..29.360 rows=100000 loops=1)
              Hash Cond: (pc.category_id = c.id)
              ->  Seq Scan on "ProductCategory" pc  (cost=0.00..1560.00 rows=100000 width=8) (actual time=0.004..6.677 rows=100000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=16) (actual time=0.058..0.060 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 16kB
                    ->  Seq Scan on "Category" c  (cost=0.00..3.50 rows=150 width=16) (actual time=0.012..0.031 rows=150 loops=1)
Planning Time: 0.170 ms
Execution Time: 49.853 ms


==================================================
EXPLAIN ANALYZE — Query 11: Liczba zamówień per metoda płatności
==================================================
Sort  (cost=8111.92..8112.72 rows=320 width=258) (actual time=195.682..240.582 rows=6 loops=1)
  Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  Finalize GroupAggregate  (cost=8013.53..8098.60 rows=320 width=258) (actual time=195.662..240.574 rows=6 loops=1)
        Group Key: pm.name
        ->  Gather Merge  (cost=8013.53..8088.20 rows=640 width=258) (actual time=195.647..240.551 rows=18 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Sort  (cost=7013.51..7014.31 rows=320 width=258) (actual time=148.528..148.532 rows=6 loops=3)
                    Sort Key: pm.name
                    Sort Method: quicksort  Memory: 25kB
                    Worker 0:  Sort Method: quicksort  Memory: 25kB
                    Worker 1:  Sort Method: quicksort  Memory: 25kB
                    ->  Partial HashAggregate  (cost=6996.19..7000.19 rows=320 width=258) (actual time=146.996..147.002 rows=6 loops=3)
                          Group Key: pm.name
                          Batches: 1  Memory Usage: 37kB
                          Worker 0:  Batches: 1  Memory Usage: 37kB
                          Worker 1:  Batches: 1  Memory Usage: 37kB
                          ->  Hash Join  (cost=742.20..6892.03 rows=8333 width=232) (actual time=10.718..143.352 rows=6667 loops=3)
                                Hash Cond: (o.payment_method_id = pm.id)
                                ->  Hash Join  (cost=725.00..6852.67 rows=8333 width=18) (actual time=10.257..141.455 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.005..64.275 rows=133333 loops=3)
                                      ->  Hash  (cost=475.00..475.00 rows=20000 width=14) (actual time=10.046..10.047 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1194kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..475.00 rows=20000 width=14) (actual time=0.124..2.887 rows=20000 loops=3)
                                ->  Hash  (cost=13.20..13.20 rows=320 width=222) (actual time=0.389..0.390 rows=6 loops=3)
                                      Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                      ->  Seq Scan on "PaymentMethod" pm  (cost=0.00..13.20 rows=320 width=222) (actual time=0.384..0.385 rows=6 loops=3)
Planning Time: 3.099 ms
Execution Time: 241.843 ms


==================================================
EXPLAIN ANALYZE — Query 12: Średnia ocena per producent
==================================================
Sort  (cost=1367.54..1367.91 rows=150 width=57) (actual time=50.487..50.498 rows=150 loops=1)
  Sort Key: (round(avg(r.rating), 2)) DESC NULLS LAST
  Sort Method: quicksort  Memory: 32kB
  ->  HashAggregate  (cost=1359.87..1362.12 rows=150 width=57) (actual time=50.359..50.422 rows=150 loops=1)
        Group Key: m.name
        Batches: 1  Memory Usage: 64kB
        ->  Hash Join  (cost=693.38..1259.87 rows=20000 width=29) (actual time=5.380..43.904 rows=27376 loops=1)
              Hash Cond: (p.manufacturer_id = m.id)
              ->  Hash Right Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=5.322..38.456 rows=27376 loops=1)
                    Hash Cond: (r.product_id = p.id)
                    ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=0.008..14.882 rows=20000 loops=1)
                    ->  Hash  (cost=438.00..438.00 rows=20000 width=8) (actual time=5.301..5.302 rows=20000 loops=1)
                          Buckets: 32768  Batches: 1  Memory Usage: 1038kB
                          ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=8) (actual time=0.005..2.241 rows=20000 loops=1)
              ->  Hash  (cost=3.50..3.50 rows=150 width=29) (actual time=0.054..0.055 rows=150 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 18kB
                    ->  Seq Scan on "Manufacturer" m  (cost=0.00..3.50 rows=150 width=29) (actual time=0.012..0.028 rows=150 loops=1)
Planning Time: 4.338 ms
Execution Time: 50.562 ms


==================================================
EXPLAIN ANALYZE — Query 13: Aktywne promocje i objęta nimi liczba wariantów
==================================================
Sort  (cost=1461.64..1461.77 rows=52 width=14) (actual time=9.172..9.177 rows=51 loops=1)
  Sort Key: (count(v.id)) DESC
  Sort Method: quicksort  Memory: 26kB
  ->  HashAggregate  (cost=1459.64..1460.16 rows=52 width=14) (actual time=9.149..9.158 rows=51 loops=1)
        Group Key: pr.name
        Batches: 1  Memory Usage: 24kB
        ->  Hash Join  (cost=6.66..1397.36 rows=12455 width=10) (actual time=0.337..8.802 rows=1492 loops=1)
              Hash Cond: (v.promotion_id = pr.id)
              ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.266..6.117 rows=47000 loops=1)
              ->  Hash  (cost=6.00..6.00 rows=53 width=10) (actual time=0.044..0.045 rows=52 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 11kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=53 width=10) (actual time=0.008..0.031 rows=52 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 148
Planning Time: 11.694 ms
Execution Time: 9.235 ms


==================================================
EXPLAIN ANALYZE — Query 14: Najczęściej wybierane warianty w koszykach
==================================================
Limit  (cost=33315.91..33315.94 rows=10 width=44) (actual time=780.927..781.052 rows=10 loops=1)
  ->  Sort  (cost=33315.91..33430.39 rows=45791 width=44) (actual time=780.926..781.050 rows=10 loops=1)
        Sort Key: rci.total_quantity DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Hash Join  (cost=30815.77..32326.38 rows=45791 width=44) (actual time=735.020..773.531 rows=47000 loops=1)
              Hash Cond: (v.product_id = p.id)
              ->  Hash Join  (cost=30127.77..31518.16 rows=45791 width=35) (actual time=729.392..753.086 rows=47000 loops=1)
                    Hash Cond: (v.id = rci.variant_id)
                    ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=31) (actual time=0.246..6.098 rows=47000 loops=1)
                    ->  Hash  (cost=29555.39..29555.39 rows=45791 width=12) (actual time=729.127..729.247 rows=47000 loops=1)
                          Buckets: 65536  Batches: 1  Memory Usage: 2532kB
                          ->  Subquery Scan on rci  (cost=28639.57..29555.39 rows=45791 width=12) (actual time=654.102..665.830 rows=47000 loops=1)
                                ->  Finalize HashAggregate  (cost=28639.57..29097.48 rows=45791 width=12) (actual time=654.100..661.402 rows=47000 loops=1)
                                      Group Key: "CartItem".variant_id
                                      Batches: 1  Memory Usage: 4625kB
                                      ->  Gather  (cost=18565.55..28181.66 rows=91582 width=12) (actual time=570.122..599.395 rows=140995 loops=1)
                                            Workers Planned: 2
                                            Workers Launched: 2
                                            ->  Partial HashAggregate  (cost=17565.55..18023.46 rows=45791 width=12) (actual time=558.755..569.933 rows=46998 loops=3)
                                                  Group Key: "CartItem".variant_id
                                                  Batches: 1  Memory Usage: 4625kB
                                                  Worker 0:  Batches: 1  Memory Usage: 4625kB
                                                  Worker 1:  Batches: 1  Memory Usage: 4625kB
                                                  ->  Parallel Seq Scan on "CartItem"  (cost=0.00..14427.70 rows=627570 width=8) (actual time=1.016..362.346 rows=500000 loops=3)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=5.618..5.618 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1245kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=0.011..2.360 rows=20000 loops=1)
Planning Time: 3.072 ms
Execution Time: 782.536 ms


==================================================
EXPLAIN ANALYZE — Query 15: Produkty z Największą Różnicą Między Ceną Podstawową a Ceną Wariantu
==================================================
Limit  (cost=3211.55..3211.58 rows=10 width=80) (actual time=43.809..43.813 rows=10 loops=1)
  ->  Sort  (cost=3211.55..3329.05 rows=47000 width=80) (actual time=43.808..43.810 rows=10 loops=1)
        Sort Key: v.price_modifier DESC
        Sort Method: top-N heapsort  Memory: 27kB
        ->  Hash Join  (cost=688.00..2195.90 rows=47000 width=80) (actual time=6.547..31.986 rows=47000 loops=1)
              Hash Cond: (v.product_id = p.id)
              ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=33) (actual time=0.251..6.246 rows=47000 loops=1)
              ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=6.238..6.239 rows=20000 loops=1)
                    Buckets: 32768  Batches: 1  Memory Usage: 1381kB
                    ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.004..2.637 rows=20000 loops=1)
Planning Time: 0.256 ms
Execution Time: 43.849 ms


==================================================
EXPLAIN ANALYZE — Query 16: Konwersja zamówień wg statusu
==================================================
Sort  (cost=7349.92..7350.27 rows=140 width=556) (actual time=120.217..183.930 rows=7 loops=1)
  Sort Key: (count(o.id)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  WindowAgg  (cost=7343.26..7344.92 rows=140 width=556) (actual time=120.202..183.923 rows=7 loops=1)
        ->  Finalize GroupAggregate  (cost=7306.31..7341.77 rows=140 width=524) (actual time=119.300..183.021 rows=7 loops=1)
              Group Key: s.name
              ->  Gather Merge  (cost=7306.31..7338.97 rows=280 width=524) (actual time=119.292..183.009 rows=21 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Sort  (cost=6306.28..6306.63 rows=140 width=524) (actual time=104.399..104.402 rows=7 loops=3)
                          Sort Key: s.name
                          Sort Method: quicksort  Memory: 25kB
                          Worker 0:  Sort Method: quicksort  Memory: 25kB
                          Worker 1:  Sort Method: quicksort  Memory: 25kB
                          ->  Partial HashAggregate  (cost=6299.89..6301.29 rows=140 width=524) (actual time=103.182..103.186 rows=7 loops=3)
                                Group Key: s.name
                                Batches: 1  Memory Usage: 40kB
                                Worker 0:  Batches: 1  Memory Usage: 40kB
                                Worker 1:  Batches: 1  Memory Usage: 40kB
                                ->  Hash Join  (cost=13.15..5466.56 rows=166667 width=520) (actual time=0.412..60.726 rows=133333 loops=3)
                                      Hash Cond: (o.status_id = s.id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.006..18.027 rows=133333 loops=3)
                                      ->  Hash  (cost=11.40..11.40 rows=140 width=520) (actual time=0.385..0.386 rows=7 loops=3)
                                            Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                            ->  Seq Scan on "Status" s  (cost=0.00..11.40 rows=140 width=520) (actual time=0.379..0.380 rows=7 loops=3)
Planning Time: 4.031 ms
Execution Time: 185.268 ms


==================================================
EXPLAIN ANALYZE — Query 17: Top klienci wg wydatków
==================================================
Limit  (cost=15583.66..15583.68 rows=10 width=50) (actual time=3733.303..3738.091 rows=10 loops=1)
  ->  Sort  (cost=15583.66..15633.66 rows=20000 width=50) (actual time=3733.301..3738.089 rows=10 loops=1)
        Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
        Sort Method: top-N heapsort  Memory: 26kB
        ->  Finalize HashAggregate  (cost=14901.47..15151.47 rows=20000 width=50) (actual time=3708.900..3731.841 rows=19296 loops=1)
              Group Key: u.id
              Batches: 5  Memory Usage: 8241kB  Disk Usage: 216kB
              ->  Gather  (cost=13005.71..14776.47 rows=16666 width=50) (actual time=3328.234..3415.179 rows=19438 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=12005.71..12109.87 rows=8333 width=50) (actual time=3284.896..3330.113 rows=6479 loops=3)
                          Group Key: u.id
                          Batches: 1  Memory Usage: 2961kB
                          Worker 0:  Batches: 1  Memory Usage: 2961kB
                          Worker 1:  Batches: 1  Memory Usage: 3217kB
                          ->  Nested Loop  (cost=725.42..11922.38 rows=8333 width=28) (actual time=17.758..3213.992 rows=6667 loops=3)
                                ->  Hash Join  (cost=725.00..6852.67 rows=8333 width=14) (actual time=15.991..146.876 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.009..57.300 rows=133333 loops=3)
                                      ->  Hash  (cost=475.00..475.00 rows=20000 width=14) (actual time=14.435..14.731 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1194kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..475.00 rows=20000 width=14) (actual time=0.122..5.566 rows=20000 loops=3)
                                ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=18) (actual time=0.453..0.453 rows=1 loops=20000)
                                      Index Cond: (id = o.user_id)
Planning Time: 10.901 ms
Execution Time: 3746.011 ms


==================================================
EXPLAIN ANALYZE — Query 18: Produkty z wariantami objętymi promocją, z końcową ceną
==================================================
Sort  (cost=3152.11..3183.24 rows=12455 width=132) (actual time=81.554..82.655 rows=1492 loops=1)
  Sort Key: (round(((p.price + v.price_modifier) * ('1'::numeric - pr.discount_percentage)), 2))
  Sort Method: quicksort  Memory: 157kB
  ->  Hash Join  (cost=694.66..2304.89 rows=12455 width=132) (actual time=37.493..76.346 rows=1492 loops=1)
        Hash Cond: (v.product_id = p.id)
        ->  Hash Join  (cost=6.66..1397.36 rows=12455 width=39) (actual time=14.669..51.567 rows=1492 loops=1)
              Hash Cond: (v.promotion_id = pr.id)
              ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=37) (actual time=14.568..48.503 rows=47000 loops=1)
              ->  Hash  (cost=6.00..6.00 rows=53 width=10) (actual time=0.059..0.060 rows=52 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 11kB
                    ->  Seq Scan on "Promotion" pr  (cost=0.00..6.00 rows=53 width=10) (actual time=0.021..0.046 rows=52 loops=1)
                          Filter: ((start_date <= now()) AND (end_date >= now()))
                          Rows Removed by Filter: 148
        ->  Hash  (cost=438.00..438.00 rows=20000 width=23) (actual time=22.795..22.795 rows=20000 loops=1)
              Buckets: 32768  Batches: 1  Memory Usage: 1381kB
              ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=23) (actual time=0.006..16.465 rows=20000 loops=1)
Planning Time: 48.165 ms
Execution Time: 84.829 ms


==================================================
EXPLAIN ANALYZE — Query 19: Użytkownicy, Którzy Dodali Produkt do Koszyka, Ale Nie Złożyli Zamówienia (Potencjał Odbudowy Koszyka)
==================================================
Hash Join  (cost=46245.38..104238.85 rows=1076709 width=54) (actual time=5479.209..8525.142 rows=1005006 loops=1)
  Hash Cond: (v.product_id = p.id)
  ->  Hash Join  (cost=45557.38..100723.88 rows=1076709 width=45) (actual time=5469.273..7921.166 rows=1005006 loops=1)
        Hash Cond: (ci.variant_id = v.id)
        ->  Hash Join  (cost=43702.88..96042.77 rows=1076709 width=45) (actual time=5451.961..7110.585 rows=1005006 loops=1)
              Hash Cond: (ci.cart_id = c.id)
              ->  Seq Scan on "CartItem" ci  (cost=0.00..23213.67 rows=1506167 width=8) (actual time=1.662..645.968 rows=1500000 loops=1)
              ->  Hash  (cost=41419.51..41419.51 rows=107230 width=45) (actual time=5440.259..5450.992 rows=100414 loops=1)
                    Buckets: 131072  Batches: 2  Memory Usage: 4929kB
                    ->  Gather  (cost=24964.67..41419.51 rows=107230 width=45) (actual time=4921.632..5082.956 rows=100414 loops=1)
                          Workers Planned: 2
                          Workers Launched: 2
                          ->  Parallel Hash Right Anti Join  (cost=23964.67..29696.51 rows=44679 width=45) (actual time=4362.991..4395.834 rows=33471 loops=3)
                                Hash Cond: (o.user_id = u.id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=4) (actual time=4.663..419.848 rows=133333 loops=3)
                                ->  Parallel Hash  (cost=23183.42..23183.42 rows=62500 width=49) (actual time=3393.179..3395.008 rows=50000 loops=3)
                                      Buckets: 262144  Batches: 1  Memory Usage: 14752kB
                                      ->  Hash Join  (cost=4079.00..23183.42 rows=62500 width=49) (actual time=268.657..2789.241 rows=50000 loops=3)
                                            Hash Cond: (u.id = c.user_id)
                                            ->  Parallel Seq Scan on "User" u  (cost=0.00..18010.67 rows=416667 width=45) (actual time=3.740..1662.395 rows=333333 loops=3)
                                            ->  Hash  (cost=2204.00..2204.00 rows=150000 width=8) (actual time=255.127..255.631 rows=150000 loops=3)
                                                  Buckets: 262144  Batches: 1  Memory Usage: 7908kB
                                                  ->  Seq Scan on "Cart" c  (cost=0.00..2204.00 rows=150000 width=8) (actual time=35.435..168.447 rows=150000 loops=3)
        ->  Hash  (cost=1267.00..1267.00 rows=47000 width=8) (actual time=13.583..13.586 rows=47000 loops=1)
              Buckets: 65536  Batches: 1  Memory Usage: 2348kB
              ->  Seq Scan on "Variant" v  (cost=0.00..1267.00 rows=47000 width=8) (actual time=0.239..5.340 rows=47000 loops=1)
  ->  Hash  (cost=438.00..438.00 rows=20000 width=17) (actual time=7.390..7.390 rows=20000 loops=1)
        Buckets: 32768  Batches: 1  Memory Usage: 1245kB
        ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=17) (actual time=1.052..3.396 rows=20000 loops=1)
Planning Time: 70.118 ms
Execution Time: 8683.853 ms


==================================================
EXPLAIN ANALYZE — Query 20: Wyszukiwanie produktów po nazwie lub opisie (parametryzowane)
==================================================
Seq Scan on "Product"  (cost=0.00..538.00 rows=4 width=60) (actual time=1.266..123.858 rows=143 loops=1)
  Filter: (((name)::text ~~* '%test%'::text) OR (description ~~* '%test%'::text))
  Rows Removed by Filter: 19857
Planning Time: 52.573 ms
Execution Time: 124.389 ms


==================================================
EXPLAIN ANALYZE — Query 21: Użytkownicy, Którzy Zapisali Konkretny Produkt jako Ulubiony (np. Product ID=350259)
==================================================
Gather  (cost=1000.42..7485.31 rows=30 width=55) (actual time=126.890..673.870 rows=23 loops=1)
  Workers Planned: 2
  Workers Launched: 2
  ->  Nested Loop  (cost=0.42..6482.31 rows=12 width=55) (actual time=148.549..568.499 rows=8 loops=3)
        ->  Parallel Seq Scan on "FavoriteProduct" fp  (cost=0.00..6381.00 rows=12 width=4) (actual time=147.901..564.010 rows=8 loops=3)
              Filter: (product_id = 35)
              Rows Removed by Filter: 199992
        ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..8.44 rows=1 width=59) (actual time=0.578..0.579 rows=1 loops=23)
              Index Cond: (id = fp.user_id)
Planning Time: 20.734 ms
Execution Time: 673.938 ms


==================================================
EXPLAIN ANALYZE — Query 22: Znajdź Magazyny, Które Posiadają Zapasy Konkretnego Wariantu (np. SKU='VR-000000-a637d44b7afd')
==================================================
Sort  (cost=81.52..81.52 rows=3 width=226) (actual time=5.641..5.646 rows=0 loops=1)
  Sort Key: (sum("*SELECT* 1".stock_units)) DESC
  Sort Method: quicksort  Memory: 25kB
  ->  GroupAggregate  (cost=81.33..81.49 rows=3 width=226) (actual time=5.631..5.635 rows=0 loops=1)
        Group Key: w.name
        Filter: (sum("*SELECT* 1".stock_units) > 0)
        ->  Sort  (cost=81.33..81.35 rows=8 width=222) (actual time=5.629..5.633 rows=0 loops=1)
              Sort Key: w.name
              Sort Method: quicksort  Memory: 25kB
              ->  Hash Join  (cost=66.73..81.21 rows=8 width=222) (actual time=5.591..5.595 rows=0 loops=1)
                    Hash Cond: (w.id = "*SELECT* 1".warehouse_id)
                    ->  Seq Scan on "Warehouse" w  (cost=0.00..13.20 rows=320 width=222) (actual time=0.024..0.024 rows=1 loops=1)
                    ->  Hash  (cost=66.63..66.63 rows=8 width=8) (actual time=5.558..5.561 rows=0 loops=1)
                          Buckets: 1024  Batches: 1  Memory Usage: 8kB
                          ->  Append  (cost=4.63..66.63 rows=8 width=8) (actual time=5.558..5.560 rows=0 loops=1)
                                ->  Subquery Scan on "*SELECT* 1"  (cost=4.63..22.89 rows=1 width=8) (actual time=5.535..5.536 rows=0 loops=1)
                                      ->  Nested Loop  (cost=4.63..22.88 rows=1 width=8) (actual time=5.534..5.535 rows=0 loops=1)
                                            ->  Index Scan using "Variant_sku_key" on "Variant" v  (cost=0.41..8.43 rows=1 width=4) (actual time=5.533..5.534 rows=0 loops=1)
                                                  Index Cond: ((sku)::text = 'VR-000001-2704de10f283'::text)
                                            ->  Bitmap Heap Scan on "BulkStockItem" bsi  (cost=4.21..14.37 rows=8 width=12) (never executed)
                                                  Recheck Cond: (variant_id = v.id)
                                                  ->  Bitmap Index Scan on idx_bulkstockitem_variant_warehouse  (cost=0.00..4.21 rows=8 width=0) (never executed)
                                                        Index Cond: (variant_id = v.id)
                                ->  Subquery Scan on "*SELECT* 2"  (cost=4.90..43.70 rows=7 width=8) (actual time=0.021..0.022 rows=0 loops=1)
                                      ->  Nested Loop  (cost=4.90..43.63 rows=7 width=8) (actual time=0.020..0.020 rows=0 loops=1)
                                            ->  Index Scan using "Variant_sku_key" on "Variant" v_1  (cost=0.41..8.43 rows=1 width=4) (actual time=0.019..0.019 rows=0 loops=1)
                                                  Index Cond: ((sku)::text = 'VR-000001-2704de10f283'::text)
                                            ->  Bitmap Heap Scan on "SerialStockItem" ssi  (cost=4.48..35.12 rows=8 width=8) (never executed)
                                                  Recheck Cond: (variant_id = v_1.id)
                                                  ->  Bitmap Index Scan on uq_serialstockitem_variant_serial  (cost=0.00..4.48 rows=8 width=0) (never executed)
                                                        Index Cond: (variant_id = v_1.id)
Planning Time: 21.207 ms
Execution Time: 7.429 ms


==================================================
EXPLAIN ANALYZE — Query 23: Warianty, Które Wymagają Uzyskania Konkretnej Opcji (np. 'Kolor'='Czerwony')
==================================================
Gather  (cost=1020.48..7497.45 rows=17 width=36) (actual time=41.873..94.316 rows=0 loops=1)
  Workers Planned: 1
  Workers Launched: 1
  ->  Nested Loop  (cost=20.48..6495.75 rows=10 width=36) (actual time=0.348..0.350 rows=0 loops=2)
        ->  Nested Loop  (cost=20.19..6492.45 rows=10 width=27) (actual time=0.348..0.350 rows=0 loops=2)
              ->  Hash Join  (cost=19.90..6489.29 rows=10 width=4) (actual time=0.347..0.349 rows=0 loops=2)
                    Hash Cond: (opt.attribute_id = a.id)
                    ->  Hash Join  (cost=18.51..6487.02 rows=294 width=8) (never executed)
                          Hash Cond: (vo.option_id = opt.id)
                          ->  Parallel Seq Scan on "VariantOption" vo  (cost=0.00..5693.18 rows=294118 width=8) (never executed)
                          ->  Hash  (cost=18.50..18.50 rows=1 width=8) (never executed)
                                ->  Seq Scan on "Option" opt  (cost=0.00..18.50 rows=1 width=8) (never executed)
                                      Filter: ((value)::text = 'do'::text)
                    ->  Hash  (cost=1.38..1.38 rows=1 width=4) (actual time=0.034..0.035 rows=0 loops=2)
                          Buckets: 1024  Batches: 1  Memory Usage: 8kB
                          ->  Seq Scan on "Attribute" a  (cost=0.00..1.38 rows=1 width=4) (actual time=0.034..0.034 rows=0 loops=2)
                                Filter: ((name)::text = 'Attr_49_Century'::text)
                                Rows Removed by Filter: 30
              ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.32 rows=1 width=31) (never executed)
                    Index Cond: (id = vo.variant_id)
        ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..0.33 rows=1 width=17) (never executed)
              Index Cond: (id = v.product_id)
Planning Time: 36.039 ms
Execution Time: 94.377 ms


==================================================
EXPLAIN ANALYZE — Query 24: Znajdź Zamówienia Użytkownika (np. email='debbie.lane.16786.50af0753@example.com') o Statusie 'Paid'
==================================================
Gather  (cost=1008.60..7188.83 rows=1 width=528) (actual time=3700.517..3895.521 rows=0 loops=1)
  Workers Planned: 2
  Workers Launched: 2
  ->  Nested Loop  (cost=8.60..6188.73 rows=1 width=528) (actual time=3601.994..3603.125 rows=0 loops=3)
        ->  Hash Join  (cost=8.17..5461.58 rows=1190 width=532) (actual time=2.724..209.464 rows=19028 loops=3)
              Hash Cond: (o.status_id = s.id)
              ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=20) (actual time=0.007..98.671 rows=133333 loops=3)
              ->  Hash  (cost=8.16..8.16 rows=1 width=520) (actual time=2.571..2.572 rows=1 loops=3)
                    Buckets: 1024  Batches: 1  Memory Usage: 9kB
                    ->  Index Scan using "Status_name_key" on "Status" s  (cost=0.14..8.16 rows=1 width=520) (actual time=2.217..2.219 rows=1 loops=3)
                          Index Cond: ((name)::text = 'Paid'::text)
        ->  Index Scan using "User_pkey" on "User" u  (cost=0.42..0.61 rows=1 width=4) (actual time=0.175..0.175 rows=0 loops=57084)
              Index Cond: (id = o.user_id)
              Filter: ((email)::text = 'debbie.lane.16786.50af0753@example.com'::text)
              Rows Removed by Filter: 1
Planning Time: 9.001 ms
Execution Time: 3904.940 ms


==================================================
EXPLAIN ANALYZE — Query 25: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
Nested Loop Left Join  (cost=13.59..1411.12 rows=32 width=87) (actual time=96.006..183.131 rows=51 loops=1)
  ->  Nested Loop  (cost=0.29..1392.83 rows=3 width=39) (actual time=82.276..160.812 rows=4 loops=1)
        ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..8.30 rows=1 width=10) (actual time=0.014..0.018 rows=1 loops=1)
              Index Cond: (id = 35)
        ->  Seq Scan on "Variant" v  (cost=0.00..1384.50 rows=3 width=37) (actual time=82.259..160.789 rows=4 loops=1)
              Filter: (product_id = 35)
              Rows Removed by Filter: 46996
  ->  Hash Right Join  (cost=13.30..14.83 rows=11 width=24) (actual time=4.847..4.859 rows=13 loops=4)
        Hash Cond: (a.id = opt.attribute_id)
        ->  Seq Scan on "Attribute" a  (cost=0.00..1.30 rows=30 width=18) (actual time=0.005..0.007 rows=30 loops=4)
        ->  Hash  (cost=13.17..13.17 rows=11 width=14) (actual time=4.220..4.221 rows=13 loops=4)
              Buckets: 1024  Batches: 1  Memory Usage: 9kB
              ->  Nested Loop Left Join  (cost=0.70..13.17 rows=11 width=14) (actual time=1.656..3.762 rows=13 loops=4)
                    ->  Index Only Scan using uq_varopt_variant_option on "VariantOption" vo  (cost=0.42..9.95 rows=11 width=8) (actual time=1.645..3.038 rows=13 loops=4)
                          Index Cond: (variant_id = v.id)
                          Heap Fetches: 7
                    ->  Index Scan using "Option_pkey" on "Option" opt  (cost=0.28..0.29 rows=1 width=14) (actual time=0.056..0.056 rows=1 loops=51)
                          Index Cond: (id = vo.option_id)
Planning Time: 26.064 ms
Execution Time: 186.076 ms


==================================================
EXPLAIN ANALYZE — Query 26: Wszystkie Warianty i Ich Ceny dla Konkretnego Produktu (np. ID=350259)
==================================================
Nested Loop Left Join  (cost=13.59..1411.28 rows=32 width=87) (actual time=0.009..0.871 rows=0 loops=1)
  ->  Nested Loop  (cost=0.29..1392.83 rows=3 width=39) (actual time=0.009..0.009 rows=0 loops=1)
        ->  Index Scan using "Product_pkey" on "Product" p  (cost=0.29..8.30 rows=1 width=10) (actual time=0.008..0.009 rows=0 loops=1)
              Index Cond: (id = 350259)
        ->  Seq Scan on "Variant" v  (cost=0.00..1384.50 rows=3 width=37) (never executed)
              Filter: (product_id = 350259)
  ->  Hash Right Join  (cost=13.30..14.83 rows=11 width=24) (never executed)
        Hash Cond: (a.id = opt.attribute_id)
        ->  Seq Scan on "Attribute" a  (cost=0.00..1.30 rows=30 width=18) (never executed)
        ->  Hash  (cost=13.17..13.17 rows=11 width=14) (never executed)
              ->  Nested Loop Left Join  (cost=0.70..13.17 rows=11 width=14) (never executed)
                    ->  Index Only Scan using uq_varopt_variant_option on "VariantOption" vo  (cost=0.42..9.95 rows=11 width=8) (never executed)
                          Index Cond: (variant_id = v.id)
                          Heap Fetches: 0
                    ->  Index Scan using "Option_pkey" on "Option" opt  (cost=0.28..0.29 rows=1 width=14) (never executed)
                          Index Cond: (id = vo.option_id)
Planning Time: 27.643 ms
Execution Time: 2.414 ms


==================================================
EXPLAIN ANALYZE — Query 27: Lista Wszystkich Dziecięcych Kategorii (Podkategorii) dla Konkretnej Kategorii Nadrzędnej (np. ID=5)
==================================================
Seq Scan on "Category"  (cost=0.00..3.88 rows=3 width=12) (actual time=0.649..1.557 rows=3 loops=1)
  Filter: (parent_id = 5)
  Rows Removed by Filter: 147
Planning Time: 22.322 ms
Execution Time: 9.055 ms


==================================================
EXPLAIN ANALYZE — Query 28: Porównanie Średniej Oceny dla Promowanych i Niepromowanych Produktów
==================================================
GroupAggregate  (cost=27693179.28..27693331.78 rows=200 width=64) (actual time=193.952..195.669 rows=2 loops=1)
  Group Key: sub.promotion_status
  ->  Sort  (cost=27693179.28..27693229.28 rows=20000 width=64) (actual time=190.989..191.676 rows=12624 loops=1)
        Sort Key: sub.promotion_status
        Sort Method: quicksort  Memory: 864kB
        ->  Subquery Scan on sub  (cost=1300.51..27691750.51 rows=20000 width=64) (actual time=139.808..148.949 rows=12624 loops=1)
              ->  HashAggregate  (cost=1300.51..27691550.51 rows=20000 width=68) (actual time=139.806..147.686 rows=12624 loops=1)
                    Group Key: p.id
                    Batches: 1  Memory Usage: 2577kB
                    ->  Hash Join  (cost=688.00..1200.51 rows=20000 width=8) (actual time=34.865..63.078 rows=20000 loops=1)
                          Hash Cond: (r.product_id = p.id)
                          ->  Seq Scan on "Review" r  (cost=0.00..460.00 rows=20000 width=8) (actual time=2.121..21.171 rows=20000 loops=1)
                          ->  Hash  (cost=438.00..438.00 rows=20000 width=4) (actual time=27.418..27.419 rows=20000 loops=1)
                                Buckets: 32768  Batches: 1  Memory Usage: 960kB
                                ->  Seq Scan on "Product" p  (cost=0.00..438.00 rows=20000 width=4) (actual time=0.017..15.103 rows=20000 loops=1)
                    SubPlan 2
                      ->  Seq Scan on "Variant" v2  (cost=0.00..1267.00 rows=5736 width=4) (actual time=0.243..4.504 rows=5684 loops=1)
                            Filter: (promotion_id IS NOT NULL)
                            Rows Removed by Filter: 41316
Planning Time: 29.505 ms
Execution Time: 216.476 ms


==================================================
EXPLAIN ANALYZE — Query 29: Top 5 Miast Generujących Największy Przychód (Wg. Adresu Wysyłki)
==================================================
Limit  (cost=15500.49..15500.50 rows=5 width=45) (actual time=4732.684..4870.095 rows=5 loops=1)
  ->  Sort  (cost=15500.49..15550.49 rows=20000 width=45) (actual time=4732.674..4868.807 rows=5 loops=1)
        Sort Key: (sum((oi.unit_price * (oi.quantity)::numeric))) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  Finalize HashAggregate  (cost=14918.30..15168.30 rows=20000 width=45) (actual time=4719.918..4861.371 rows=12950 loops=1)
              Group Key: a.city
              Batches: 1  Memory Usage: 5905kB
              ->  Gather  (cost=13022.54..14793.30 rows=16666 width=45) (actual time=4475.108..4690.184 rows=16129 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Partial HashAggregate  (cost=12022.54..12126.70 rows=8333 width=45) (actual time=4136.811..4144.194 rows=5376 loops=3)
                          Group Key: a.city
                          Batches: 1  Memory Usage: 2449kB
                          Worker 0:  Batches: 1  Memory Usage: 2449kB
                          Worker 1:  Batches: 1  Memory Usage: 2449kB
                          ->  Nested Loop  (cost=725.43..11939.21 rows=8333 width=23) (actual time=68.718..4008.470 rows=6667 loops=3)
                                ->  Hash Join  (cost=725.00..6852.67 rows=8333 width=14) (actual time=48.390..349.234 rows=6667 loops=3)
                                      Hash Cond: (o.id = oi.order_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=0.014..216.870 rows=133333 loops=3)
                                      ->  Hash  (cost=475.00..475.00 rows=20000 width=14) (actual time=46.399..47.423 rows=20000 loops=3)
                                            Buckets: 32768  Batches: 1  Memory Usage: 1194kB
                                            ->  Seq Scan on "OrderItem" oi  (cost=0.00..475.00 rows=20000 width=14) (actual time=16.065..40.350 rows=20000 loops=3)
                                ->  Index Scan using "Address_pkey" on "Address" a  (cost=0.43..0.61 rows=1 width=17) (actual time=0.540..0.540 rows=1 loops=20000)
                                      Index Cond: (id = o.shipping_address_id)
Planning Time: 66.839 ms
Execution Time: 4881.622 ms


==================================================
EXPLAIN ANALYZE — Query 30: Porównanie Wolumenu Sprzedaży Produktów Promowanych vs. Niepromowanych (w Ostatnich 30 Dniach)
==================================================
Finalize GroupAggregate  (cost=8454.18..8511.45 rows=200 width=40) (actual time=1028.619..1169.221 rows=2 loops=1)
  Group Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
  ->  Gather Merge  (cost=8454.18..8507.45 rows=400 width=40) (actual time=1024.023..1166.643 rows=3 loops=1)
        Workers Planned: 2
        Workers Launched: 2
        ->  Partial GroupAggregate  (cost=7454.16..7461.26 rows=200 width=40) (actual time=356.198..356.407 rows=1 loops=3)
              Group Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
              ->  Sort  (cost=7454.16..7455.86 rows=680 width=36) (actual time=354.760..354.800 rows=548 loops=3)
                    Sort Key: (CASE WHEN (v.promotion_id IS NOT NULL) THEN 'Promowany'::text ELSE 'Niepromowany'::text END)
                    Sort Method: quicksort  Memory: 111kB
                    Worker 0:  Sort Method: quicksort  Memory: 25kB
                    Worker 1:  Sort Method: quicksort  Memory: 25kB
                    ->  Nested Loop  (cost=725.29..7422.16 rows=680 width=36) (actual time=49.314..337.899 rows=548 loops=3)
                          ->  Hash Join  (cost=725.00..7069.45 rows=680 width=8) (actual time=33.979..193.733 rows=548 loops=3)
                                Hash Cond: (o.id = oi.order_id)
                                ->  Parallel Seq Scan on "Order" o  (cost=0.00..6252.67 rows=13597 width=4) (actual time=1.311..150.768 rows=10944 loops=3)
                                      Filter: (order_date >= (now() - '30 days'::interval))
                                      Rows Removed by Filter: 122389
                                ->  Hash  (cost=475.00..475.00 rows=20000 width=12) (actual time=25.419..25.420 rows=20000 loops=3)
                                      Buckets: 32768  Batches: 1  Memory Usage: 1116kB
                                      ->  Seq Scan on "OrderItem" oi  (cost=0.00..475.00 rows=20000 width=12) (actual time=11.882..16.925 rows=20000 loops=3)
                          ->  Index Scan using "Variant_pkey" on "Variant" v  (cost=0.29..0.52 rows=1 width=8) (actual time=0.233..0.233 rows=1 loops=1645)
                                Index Cond: (id = oi.variant_id)
Planning Time: 38.225 ms
Execution Time: 1176.893 ms


==================================================
EXPLAIN ANALYZE — Query 31: Wskaźnik Lojalności (Repeat Purchase Rate) Użytkowników z Podziałem na Miasto Adresu Rozliczeniowego
==================================================
Sort  (cost=147659.76..147734.83 rows=30028 width=61) (actual time=7197.454..7361.939 rows=66456 loops=1)
  Sort Key: (round((((count(*) FILTER (WHERE (u.orders_count > 1)))::numeric * 100.0) / (NULLIF(count(DISTINCT o.user_id), 0))::numeric), 2)) DESC
  Sort Method: external merge  Disk: 3192kB
  ->  GroupAggregate  (cost=94089.28..145426.58 rows=30028 width=61) (actual time=6681.282..7208.783 rows=66456 loops=1)
        Group Key: a.city
        ->  Gather Merge  (cost=94089.28..140675.88 rows=400000 width=25) (actual time=6668.687..7074.871 rows=400000 loops=1)
              Workers Planned: 2
              Workers Launched: 2
              ->  Sort  (cost=93089.26..93505.93 rows=166667 width=25) (actual time=5688.320..5760.275 rows=133333 loops=3)
                    Sort Key: a.city, o.user_id
                    Sort Method: external merge  Disk: 4504kB
                    Worker 0:  Sort Method: external merge  Disk: 5440kB
                    Worker 1:  Sort Method: external merge  Disk: 5384kB
                    ->  Parallel Hash Join  (cost=53841.40..74643.72 rows=166667 width=25) (actual time=1838.039..4877.641 rows=133333 loops=3)
                          Hash Cond: (a.id = o.billing_address_id)
                          ->  Parallel Seq Scan on "Address" a  (cost=0.00..18237.00 rows=498900 width=17) (actual time=7.265..1893.134 rows=400000 loops=3)
                          ->  Parallel Hash  (cost=51758.07..51758.07 rows=166667 width=16) (actual time=1824.284..1827.083 rows=133333 loops=3)
                                Buckets: 524288  Batches: 1  Memory Usage: 22912kB
                                ->  Hash Join  (cost=43620.89..51758.07 rows=166667 width=16) (actual time=1235.558..1574.640 rows=133333 loops=3)
                                      Hash Cond: (o.user_id = u.user_id)
                                      ->  Parallel Seq Scan on "Order" o  (cost=0.00..5002.67 rows=166667 width=8) (actual time=3.251..57.523 rows=133333 loops=3)
                                      ->  Hash  (cost=38663.70..38663.70 rows=285135 width=12) (actual time=1177.232..1179.275 rows=329619 loops=3)
                                            Buckets: 262144  Batches: 4  Memory Usage: 5596kB
                                            ->  Subquery Scan on u  (cost=29836.00..38663.70 rows=285135 width=12) (actual time=565.421..942.832 rows=329619 loops=3)
                                                  ->  HashAggregate  (cost=29836.00..35812.35 rows=285135 width=12) (actual time=564.569..889.178 rows=329619 loops=3)
                                                        Group Key: "Order".user_id
                                                        Planned Partitions: 4  Batches: 5  Memory Usage: 8241kB  Disk Usage: 7672kB
                                                        Worker 0:  Batches: 5  Memory Usage: 8241kB  Disk Usage: 7672kB
                                                        Worker 1:  Batches: 5  Memory Usage: 8241kB  Disk Usage: 7672kB
                                                        ->  Seq Scan on "Order"  (cost=0.00..7336.00 rows=400000 width=4) (actual time=7.785..154.545 rows=400000 loops=3)
Planning Time: 8.871 ms
Execution Time: 7497.752 ms

FINISHED — 2025-12-07 22:22:59.702526
========================================================================================================================
